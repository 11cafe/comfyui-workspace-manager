import{f as V,r as f,j as n,g as B,h as re,a0 as J,b as Ve,o as qe,l as Ye,i as A,U as ae,P as Qe,a1 as Je,N as ke,a2 as Xe,Q as Le,S as Ie,T as Ze,$ as et,M as tt,O as st,R as nt,_ as ot}from"./input.js";import{al as it,m as rt,am as at,an as lt,ao as G,ap as le,B as oe,F as W,ac as Ee,h as N,i as ie,Z as Ae,aq as ct,k as H,a4 as Te,a5 as dt,ae as Ne,j as X,H as $,ar as De,as as xe,g as q,w as ht,at as Fe,f as Pe,au as ye,av as ut,aw as Oe,ax as pt,ay as ft,az as mt,aA as gt,aB as xt,aC as yt,aD as ee,aE as vt,aF as wt,aG as jt}from"./App-CrjjADF1.js";import{G as Mt,C as _t}from"./chunk-JARCRF6W-bSSCzR1D.js";import{app as z}from"/scripts/app.js";import{api as ce}from"/scripts/api.js";import{S as Z}from"./chunk-3RSXBRAN-GXqN2xqN.js";var ze=V(function(e,s){const{spacing:o="0.5rem",spacingX:i,spacingY:r,children:a,justify:l,direction:c,align:h,className:d,shouldWrapChildren:p,...u}=e,g=f.useMemo(()=>p?f.Children.map(a,(m,x)=>n.jsx(de,{children:m},x)):a,[a,p]);return n.jsx(B.div,{ref:s,className:re("chakra-wrap",d),...u,children:n.jsx(B.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:l,alignItems:h,flexDirection:c,listStyleType:"none",gap:o,columnGap:i,rowGap:r,padding:"0"},children:g})})});ze.displayName="Wrap";var de=V(function(e,s){const{className:o,...i}=e;return n.jsx(B.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:re("chakra-wrap__listitem",o),...i})});de.displayName="WrapItem";function ve(t){return rt(t,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}var Be=V(function(e,s){const{area:o,colSpan:i,colStart:r,colEnd:a,rowEnd:l,rowSpan:c,rowStart:h,...d}=e,p=it({gridArea:o,gridColumn:ve(i),gridRow:ve(c),gridColumnStart:r,gridColumnEnd:a,gridRowStart:h,gridRowEnd:l});return n.jsx(B.div,{ref:s,__css:p,...d})});Be.displayName="GridItem";var te=(t,e)=>e?`${t}.${e}, ${e}`:void 0;function Re(t){var e;const{bg:s,bgColor:o,backgroundColor:i,shadow:r,boxShadow:a,shadowColor:l}=t,{getArrowProps:c,getArrowInnerProps:h}=at(),d=lt(),p=(e=s??o)!=null?e:i,u=r??a;return n.jsx(B.div,{...c(),className:"chakra-popover__arrow-positioner",children:n.jsx(B.div,{className:re("chakra-popover__arrow",t.className),...h(t),__css:{"--popper-arrow-shadow-color":te("colors",l),"--popper-arrow-bg":te("colors",p),"--popper-arrow-shadow":te("shadows",u),...d.arrow}})})}Re.displayName="PopoverArrow";function St(t,e,s){return(t-e)*100/(s-e)}J({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});J({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var bt=J({"0%":{left:"-40%"},"100%":{left:"100%"}}),Ct=J({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function kt(t){const{value:e=0,min:s,max:o,valueText:i,getValueText:r,isIndeterminate:a,role:l="progressbar"}=t,c=St(e,s,o);return{bind:{"data-indeterminate":a?"":void 0,"aria-valuemax":o,"aria-valuemin":s,"aria-valuenow":a?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof r=="function"?r(e,c):i})(),role:l},percent:c,value:e}}var[Lt,It]=Ve({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Et=V((t,e)=>{const{min:s,max:o,value:i,isIndeterminate:r,role:a,...l}=t,c=kt({value:i,min:s,max:o,isIndeterminate:r,role:a}),d={height:"100%",...It().filledTrack};return n.jsx(B.div,{ref:e,style:{width:`${c.percent}%`,...l.style},...c.bind,...l,__css:d})}),We=V((t,e)=>{var s;const{value:o,min:i=0,max:r=100,hasStripe:a,isAnimated:l,children:c,borderRadius:h,isIndeterminate:d,"aria-label":p,"aria-labelledby":u,"aria-valuetext":g,title:m,role:x,...j}=qe(t),M=Ye("Progress",t),C=h??((s=M.track)==null?void 0:s.borderRadius),k={animation:`${Ct} 1s linear infinite`},D={...!d&&a&&l&&k,...d&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${bt} 1s ease infinite normal none running`}},b={overflow:"hidden",position:"relative",...M.track};return n.jsx(B.div,{ref:e,borderRadius:C,__css:b,...j,children:n.jsxs(Lt,{value:M,children:[n.jsx(Et,{"aria-label":p,"aria-labelledby":u,"aria-valuetext":g,min:i,max:r,value:o,isIndeterminate:d,css:D,borderRadius:C,title:m,role:x}),c]})})});We.displayName="Progress";function K(t){return Array.isArray?Array.isArray(t):Ge(t)==="[object Array]"}const At=1/0;function Tt(t){return t==null?"":function(e){if(typeof e=="string")return e;let s=e+"";return s=="0"&&1/e==-At?"-0":s}(t)}function F(t){return typeof t=="string"}function $e(t){return typeof t=="number"}function Nt(t){return t===!0||t===!1||function(e){return function(s){return typeof s=="object"}(e)&&e!==null}(t)&&Ge(t)=="[object Boolean]"}function T(t){return t!=null}function se(t){return!t.trim().length}function Ge(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Dt=t=>`Missing ${t} property in key`,Ft=t=>`Property 'weight' in key '${t}' must be a positive integer`,we=Object.prototype.hasOwnProperty;class Pt{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(o=>{let i=Ke(o);this._keys.push(i),this._keyMap[i.id]=i,s+=i.weight}),this._keys.forEach(o=>{o.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ke(t){let e=null,s=null,o=null,i=1,r=null;if(F(t)||K(t))o=t,e=je(t),s=Me(t);else{if(!we.call(t,"name"))throw new Error(Dt("name"));const a=t.name;if(o=a,we.call(t,"weight")&&(i=t.weight,i<=0))throw new Error(Ft(a));e=je(a),s=Me(a),r=t.getFn}return{path:e,id:s,weight:i,src:o,getFn:r}}function je(t){return K(t)?t:t.split(".")}function Me(t){return K(t)?t.join("."):t}var w={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,useExtendedSearch:!1,getFn:function(t,e){let s=[],o=!1;const i=(r,a,l)=>{if(T(r))if(a[l]){const c=r[a[l]];if(!T(c))return;if(l===a.length-1&&(F(c)||$e(c)||Nt(c)))s.push(Tt(c));else if(K(c)){o=!0;for(let h=0,d=c.length;h<d;h+=1)i(c[h],a,l+1)}else a.length&&i(c,a,l+1)}else s.push(r)};return i(t,F(e)?e.split("."):e,0),o?s:s[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};const Ot=/[^ ]+/g;class he{constructor({getFn:e=w.getFn,fieldNormWeight:s=w.fieldNormWeight}={}){this.norm=function(o=1,i=3){const r=new Map,a=Math.pow(10,i);return{get(l){const c=l.match(Ot).length;if(r.has(c))return r.get(c);const h=1/Math.pow(c,.5*o),d=parseFloat(Math.round(h*a)/a);return r.set(c,d),d},clear(){r.clear()}}}(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,o)=>{this._keysMap[s.id]=o})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,F(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();F(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,o=this.size();s<o;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!T(e)||se(e))return;let o={v:e,i:s,n:this.norm.get(e)};this.records.push(o)}_addObject(e,s){let o={i:s,$:{}};this.keys.forEach((i,r)=>{let a=i.getFn?i.getFn(e):this.getFn(e,i.path);if(T(a)){if(K(a)){let l=[];const c=[{nestedArrIndex:-1,value:a}];for(;c.length;){const{nestedArrIndex:h,value:d}=c.pop();if(T(d))if(F(d)&&!se(d)){let p={v:d,i:h,n:this.norm.get(d)};l.push(p)}else K(d)&&d.forEach((p,u)=>{c.push({nestedArrIndex:u,value:p})})}o.$[r]=l}else if(F(a)&&!se(a)){let l={v:a,n:this.norm.get(a)};o.$[r]=l}}}),this.records.push(o)}toJSON(){return{keys:this.keys,records:this.records}}}function Ue(t,e,{getFn:s=w.getFn,fieldNormWeight:o=w.fieldNormWeight}={}){const i=new he({getFn:s,fieldNormWeight:o});return i.setKeys(t.map(Ke)),i.setSources(e),i.create(),i}function Q(t,{errors:e=0,currentLocation:s=0,expectedLocation:o=0,distance:i=w.distance,ignoreLocation:r=w.ignoreLocation}={}){const a=e/t.length;if(r)return a;const l=Math.abs(o-s);return i?a+l/i:l?1:a}const R=32;function zt(t,e,s,{location:o=w.location,distance:i=w.distance,threshold:r=w.threshold,findAllMatches:a=w.findAllMatches,minMatchCharLength:l=w.minMatchCharLength,includeMatches:c=w.includeMatches,ignoreLocation:h=w.ignoreLocation}={}){if(e.length>R)throw new Error(`Pattern length exceeds max of ${R}.`);const d=e.length,p=t.length,u=Math.max(0,Math.min(o,p));let g=r,m=u;const x=l>1||c,j=x?Array(p):[];let M;for(;(M=t.indexOf(e,m))>-1;){let b=Q(e,{currentLocation:M,expectedLocation:u,distance:i,ignoreLocation:h});if(g=Math.min(b,g),m=M+d,x){let L=0;for(;L<d;)j[M+L]=1,L+=1}}m=-1;let C=[],k=1,P=d+p;const Y=1<<d-1;for(let b=0;b<d;b+=1){let L=0,I=P;for(;L<I;)Q(e,{errors:b,currentLocation:u+I,expectedLocation:u,distance:i,ignoreLocation:h})<=g?L=I:P=I,I=Math.floor((P-L)/2+L);P=I;let O=Math.max(1,u-I+1),E=a?p:Math.min(u+I,p)+d,y=Array(E+2);y[E+1]=(1<<b)-1;for(let v=E;v>=O;v-=1){let _=v-1,S=s[t.charAt(_)];if(x&&(j[_]=+!!S),y[v]=(y[v+1]<<1|1)&S,b&&(y[v]|=(C[v+1]|C[v])<<1|1|C[v+1]),y[v]&Y&&(k=Q(e,{errors:b,currentLocation:_,expectedLocation:u,distance:i,ignoreLocation:h}),k<=g)){if(g=k,m=_,m<=u)break;O=Math.max(1,2*u-m)}}if(Q(e,{errors:b+1,currentLocation:u,expectedLocation:u,distance:i,ignoreLocation:h})>g)break;C=y}const D={isMatch:m>=0,score:Math.max(.001,k)};if(x){const b=function(L=[],I=w.minMatchCharLength){let O=[],E=-1,y=-1,v=0;for(let _=L.length;v<_;v+=1){let S=L[v];S&&E===-1?E=v:S||E===-1||(y=v-1,y-E+1>=I&&O.push([E,y]),E=-1)}return L[v-1]&&v-E>=I&&O.push([E,v-1]),O}(j,l);b.length?c&&(D.indices=b):D.isMatch=!1}return D}function Bt(t){let e={};for(let s=0,o=t.length;s<o;s+=1){const i=t.charAt(s);e[i]=(e[i]||0)|1<<o-s-1}return e}class Rt{constructor(e,{location:s=w.location,threshold:o=w.threshold,distance:i=w.distance,includeMatches:r=w.includeMatches,findAllMatches:a=w.findAllMatches,minMatchCharLength:l=w.minMatchCharLength,isCaseSensitive:c=w.isCaseSensitive,ignoreLocation:h=w.ignoreLocation}={}){if(this.options={location:s,threshold:o,distance:i,includeMatches:r,findAllMatches:a,minMatchCharLength:l,isCaseSensitive:c,ignoreLocation:h},this.pattern=c?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const d=(u,g)=>{this.chunks.push({pattern:u,alphabet:Bt(u),startIndex:g})},p=this.pattern.length;if(p>R){let u=0;const g=p%R,m=p-g;for(;u<m;)d(this.pattern.substr(u,R),u),u+=R;if(g){const x=p-R;d(this.pattern.substr(x),x)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,includeMatches:o}=this.options;if(s||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return o&&(m.indices=[[0,e.length-1]]),m}const{location:i,distance:r,threshold:a,findAllMatches:l,minMatchCharLength:c,ignoreLocation:h}=this.options;let d=[],p=0,u=!1;this.chunks.forEach(({pattern:m,alphabet:x,startIndex:j})=>{const{isMatch:M,score:C,indices:k}=zt(e,m,x,{location:i+j,distance:r,threshold:a,findAllMatches:l,minMatchCharLength:c,includeMatches:o,ignoreLocation:h});M&&(u=!0),p+=C,M&&k&&(d=[...d,...k])});let g={isMatch:u,score:u?p/this.chunks.length:1};return u&&o&&(g.indices=d),g}}const _e=[];function Se(t,e){for(let s=0,o=_e.length;s<o;s+=1){let i=_e[s];if(i.condition(t,e))return new i(t,e)}return new Rt(t,e)}function Wt(t,e){const s=t.matches;e.matches=[],T(s)&&s.forEach(o=>{if(!T(o.indices)||!o.indices.length)return;const{indices:i,value:r}=o;let a={indices:i,value:r};o.key&&(a.key=o.key.src),o.idx>-1&&(a.refIndex=o.idx),e.matches.push(a)})}function $t(t,e){e.score=t.score}class U{constructor(e,s={},o){if(this.options={...w,...s},this.options.useExtendedSearch)throw new Error("Extended search is not available");this._keyStore=new Pt(this.options.keys),this.setCollection(e,o)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof he))throw new Error("Incorrect 'index' type");this._myIndex=s||Ue(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){T(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let o=0,i=this._docs.length;o<i;o+=1){const r=this._docs[o];e(r,o)&&(this.removeAt(o),o-=1,i-=1,s.push(r))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:o,includeScore:i,shouldSort:r,sortFn:a,ignoreFieldNorm:l}=this.options;let c=F(e)?F(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(h,{ignoreFieldNorm:d=w.ignoreFieldNorm}){h.forEach(p=>{let u=1;p.matches.forEach(({key:g,norm:m,score:x})=>{const j=g?g.weight:null;u*=Math.pow(x===0&&j?Number.EPSILON:x,(j||1)*(d?1:m))}),p.score=u})}(c,{ignoreFieldNorm:l}),r&&c.sort(a),$e(s)&&s>-1&&(c=c.slice(0,s)),function(h,d,{includeMatches:p=w.includeMatches,includeScore:u=w.includeScore}={}){const g=[];return p&&g.push(Wt),u&&g.push($t),h.map(m=>{const{idx:x}=m,j={item:d[x],refIndex:x};return g.length&&g.forEach(M=>{M(m,j)}),j})}(c,this._docs,{includeMatches:o,includeScore:i})}_searchStringList(e){const s=Se(e,this.options),{records:o}=this._myIndex,i=[];return o.forEach(({v:r,i:a,n:l})=>{if(!T(r))return;const{isMatch:c,score:h,indices:d}=s.searchIn(r);c&&i.push({item:r,idx:a,matches:[{score:h,value:r,norm:l,indices:d}]})}),i}_searchLogical(e){throw new Error("Logical search is not available")}_searchObjectList(e){const s=Se(e,this.options),{keys:o,records:i}=this._myIndex,r=[];return i.forEach(({$:a,i:l})=>{if(!T(a))return;let c=[];o.forEach((h,d)=>{c.push(...this._findMatches({key:h,value:a[d],searcher:s}))}),c.length&&r.push({idx:l,item:a,matches:c})}),r}_findMatches({key:e,value:s,searcher:o}){if(!T(s))return[];let i=[];if(K(s))s.forEach(({v:r,i:a,n:l})=>{if(!T(r))return;const{isMatch:c,score:h,indices:d}=o.searchIn(r);c&&i.push({score:h,key:e,value:r,idx:a,norm:l,indices:d})});else{const{v:r,n:a}=s,{isMatch:l,score:c,indices:h}=o.searchIn(r);l&&i.push({score:c,key:e,value:r,norm:a,indices:h})}return i}}U.version="7.0.0",U.createIndex=Ue,U.parseIndex=function(t,{getFn:e=w.getFn,fieldNormWeight:s=w.fieldNormWeight}={}){const{keys:o,records:i}=t,r=new he({getFn:e,fieldNormWeight:s});return r.setKeys(o),r.setIndexRecords(i),r},U.config=w;function Gt({selectedModel:t,setSelectedModel:e,modelTypeList:s}){const o=i=>{e(i)};return n.jsx(ze,{children:s.map(i=>n.jsx(de,{children:n.jsx(A,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>o(i),size:"sm",children:i})},i))})}const Kt={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function Ut({data:t}){const[e,s]=f.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[o,i]=f.useState(!t.file_hash),[r,a]=f.useState();f.useEffect(()=>{i(!t.file_hash),l()},[t.file_hash]);const l=async()=>{var d;const h=await G.models.get(t.model_name+"@"+t.model_type);if(h!=null&&(a(h),(d=h.imageUrl)!=null&&d.length&&s(h.imageUrl)),!(h!=null&&h.imageUrl)&&t.file_hash!=null)try{const p=await le(t.file_hash),u=p.imageUrl;u&&s(u);const g={id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,modelName:p.modelName??null,civitModelID:p.civitModelID,civitModelVersionID:p.civitModelVersionID,imageUrl:u??null};a(g)}catch{}t.preview&&s(t.preview)},c=h=>{const d=Kt[t.model_type];d&&(h.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),h.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),h.dataTransfer.setData("nodeType",d))};return n.jsxs(oe,{children:[n.jsxs(oe,{position:"relative",borderRadius:4,draggable:!0,onDragStart:c,children:[o?n.jsx(W,{bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:n.jsx(ae,{})}):n.jsx(Ee,{src:e,draggable:!1,boxSize:"100%",height:150,objectFit:"cover",borderRadius:4,cursor:(r==null?void 0:r.civitModelID)!=null?"pointer":"auto",onClick:()=>{(r==null?void 0:r.civitModelID)==null||(r==null?void 0:r.civitModelVersionID)==null||window.open(`https://civitai.com/models/${r==null?void 0:r.civitModelID}?modelVersionId=${r==null?void 0:r.civitModelVersionID}`)}}),n.jsx(N,{position:"absolute",bottom:"0",left:"0",right:"0",color:"white",fontSize:14})]}),n.jsx(ie,{label:n.jsxs("span",{children:[t.model_name+t.model_extension,n.jsx("br",{}),t.date.toLocaleDateString()]}),children:n.jsx(N,{textAlign:"center",p:"1",fontSize:14,noOfLines:2,children:t.model_name+t.model_extension})})]})}function Ht({list:t}){return n.jsx(Mt,{templateColumns:"repeat(3, minmax(0, 1fr))",gap:1,marginTop:2,children:t.map(e=>n.jsx(Be,{children:n.jsx(Ut,{data:e})},e.model_name+e.date.getTime()))})}function Vt(){const{setRoute:t}=f.useContext(Ae);return n.jsx(n.Fragment,{children:n.jsx(A,{size:"sm",colorScheme:"teal",onClick:()=>t("installModels"),children:"Install Models"})})}const qt=()=>{const[t,e]=f.useState(["checkpoints"]),[s,o]=f.useState([]),[i,r]=f.useState(!0);f.useEffect(()=>{a(),ce.addEventListener("model_list",async c=>{l(c.detail)})},[]);const a=async()=>{const c=await ct();l(c)},l=async c=>{if(!c)return;r(!1);const h=Array.from(new Set(c.map(p=>p.model_type))),d=h.indexOf("checkpoints");d>=0&&h.splice(d,1),h.unshift("checkpoints"),e(h),o(c.map(p=>({...p,date:new Date(p.date*1e3)})))};return{modelTypeList:t,modelsList:s,loading:i}};function Yt(){const[t,e]=f.useState(!1),s=()=>{var a;(a=H)==null||a.getSetting("showNsfwModelThumbnail").then(l=>{e(l??!1)})};f.useEffect(()=>{s()},[]);const o=a=>{var c;const l=a.target.checked;(c=H)==null||c.upsert({showNsfwModelThumbnail:l}).then(()=>{s(),i(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},i=async()=>{const a=await G.models.toArray();for(let l=0;l<a.length;l+=5){const c=a.slice(l,l+5);await Promise.all(c.map(r))}},r=async a=>{try{if(a.fileHash==null)return;const c=(await le(a.fileHash)).imageUrl;G.models.update(a.id,{imageUrl:c??null})}catch{}};return n.jsx(_t,{isChecked:t,onChange:o,children:"Show NSFW"})}function Qt(){const t=async e=>{if(e.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const o=e.dataTransfer.getData("modelRelativePath"),i=e.dataTransfer.getData("nodeType"),r=LiteGraph.createNode(i);r.pos=[e.canvasX,e.canvasY],r.configure({widgets_values:[o]}),z.graph.add(r)};return f.useEffect(()=>(z.canvasEl.addEventListener("drop",t),()=>{z.canvasEl.removeEventListener("drop",t)}),[]),null}function Jt({onClose:t}){const[e,s]=f.useState("checkpoints"),[o,i]=f.useState(""),[r,a]=f.useState("name"),{loading:l,modelTypeList:c,modelsList:h}=qt(),[d,p]=f.useState([]),[u,g]=f.useState([]);f.useEffect(()=>{x();async function x(){const j=await G.models.toArray();p(h.map(M=>({...M,db:j.find(C=>C.id===M.model_name+"@"+M.model_type)})))}},[h]),f.useEffect(()=>{let x=[];o.length?x=new U(d,{keys:["model_name","db.modelName"]}).search(o).map(C=>C.item):x=h.filter(j=>j.model_type===e).sort((j,M)=>r==="name"?j.model_name.localeCompare(M.model_name):M.date.getTime()-j.date.getTime()),g(x)},[e,h,o,r,d]),f.useEffect(()=>(z.canvasEl.addEventListener("click",t),()=>{z.canvasEl.removeEventListener("click",t)}),[t]);const m=440;return n.jsx(Qe,{children:n.jsxs(oe,{style:{width:m},children:[n.jsxs(Te,{width:m,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:dt,overflowY:"auto",children:[n.jsxs(W,{justifyContent:"space-between",alignContent:"center",py:3,children:[n.jsx(Ne,{size:"md",mr:2,children:"Models"}),n.jsx(Vt,{})]}),n.jsx(W,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:n.jsx(X,{size:"sm",placeholder:"Search",value:o,onChange:x=>i(x.target.value)})}),n.jsxs(W,{gap:4,justifyContent:"space-between",alignItems:"center",mb:1,children:[!o.length&&n.jsxs($,{children:[n.jsx("span",{children:"Sort By"}),n.jsxs(Z,{value:r,size:"sm",width:"120px",onChange:x=>a(x.target.value),children:[n.jsx("option",{value:"name",children:"Name"}),n.jsx("option",{value:"date",children:"Date"})]})]}),n.jsx(Yt,{})]}),!o.length&&n.jsx(Gt,{modelTypeList:c,setSelectedModel:s,selectedModel:e}),n.jsx(Ht,{list:u}),l&&n.jsx(W,{justifyContent:"center",alignItems:"center",height:"100%",children:n.jsx(ae,{})})]}),n.jsx(Qt,{})]})})}const Xt=async t=>{try{const s=await(await ce.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:s}))}catch(e){console.error("Failed to connect to the server:",e)}};function be(t,e=1){const i=t/1024;return i>=1024?(i/1024).toFixed(e)+" GB":i.toFixed(e)+" MB"}function Ce(t,e){if(!t||t.length===0)return;let s=t.find(o=>o.nsfw==="None"||o.nsfwLevel===1);return e&&(s=s??t[0]),s}function Zt(t,e=280,s){var o,i,r,a;if(t){if(t.images)return`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(o=Ce(t.images,s))==null?void 0:o.url}/width=${e}/`;if(De(t))return(a=Ce((r=(i=t.modelVersions)==null?void 0:i.at(0))==null?void 0:r.images,s))==null?void 0:a.url}}const ne=280;function es({model:t,onClickInstallModel:e,installing:s}){var u,g;const[o,i]=f.useState();f.useEffect(()=>{m();async function m(){var j;const x=await((j=H)==null?void 0:j.getSetting("showNsfwModelThumbnail"));i(Zt(t,ne,x))}},[t]);const r=De(t)?t.modelVersions:t.versions,[a,l]=f.useState(((u=r==null?void 0:r[0])==null?void 0:u.name)??""),c=r==null?void 0:r.find(m=>(m==null?void 0:m.name)===a),h=()=>{window.open(`https://civitai.com/models/${t.id}`)},d=f.useCallback(()=>{if(c==null){console.error("no file is find by name",a);return}e(xe(c,t.name),t)},[a]),p=(g=xe(c))==null?void 0:g.sizeKB;return n.jsxs(Te,{width:ne,justifyContent:"space-between",mb:2,gap:1,children:[n.jsx(Ee,{borderRadius:3,boxSize:ne+"px",objectFit:"cover",src:o,alt:"model cover image",cursor:"pointer",onClick:()=>h()}),n.jsxs(q,{p:1,children:[n.jsx(ie,{label:t.name,children:n.jsx(N,{fontWeight:500,noOfLines:1,children:t.name})}),n.jsxs(W,{justifyContent:"space-between",alignItems:"center",children:[n.jsx(A,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:n.jsx(N,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),n.jsx(A,{leftIcon:n.jsx(ht,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>d(),isDisabled:!!(a&&s.includes(a)),children:"Install"})]}),n.jsxs($,{children:[n.jsx(Z,{size:"md",style:{paddingLeft:4},onChange:m=>{l(m.target.value)},children:r==null?void 0:r.map(m=>{const x=m==null?void 0:m.name;return x?n.jsx("option",{value:x,style:{padding:0},children:x},m.id):null})}),p&&n.jsx(ie,{label:be(p),children:n.jsx(N,{flexShrink:1,noOfLines:1,width:"40%",children:be(p)})})]})]})]})}function ts({searchQuery:t,setSearchQuery:e,onSearch:s}){return n.jsxs(W,{gap:1,alignItems:"center",grow:1,children:[n.jsx(X,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:o=>e(o.target.value),onKeyUp:o=>{o.code==="Enter"&&s()}}),n.jsx(A,{size:"sm",onClick:()=>s(),colorScheme:"teal",children:"Search"})]})}function ss({isOpen:t,fileSelected:e,onClose:s,selectFolder:o}){const[i,r]=f.useState(""),[a,l]=f.useState([]),[c,h]=f.useState(""),d=f.useRef(null);f.useEffect(()=>{p()},[]);const p=async()=>{const u=await Fe();u&&(["custom_nodes","config","saved_prompts"].forEach(g=>{delete u[g]}),l(Object.values(u).flatMap(g=>g)))};return n.jsx(Je,{isOpen:t,leastDestructiveRef:d,onClose:s,children:n.jsx(ke,{children:n.jsxs(Xe,{children:[n.jsx(Le,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),n.jsx(Ie,{children:n.jsxs(q,{spacing:4,children:[!e&&n.jsxs(n.Fragment,{children:[n.jsx(N,{children:"Model download url"}),n.jsx(X,{placeholder:"https://civitai.com/api/download/models/311399",onChange:u=>h(u.target.value),value:c})]}),n.jsx(N,{children:"Choose model install folder"}),n.jsx(Z,{placeholder:"Select option",value:i,onChange:u=>r(u.target.value),children:a.map(u=>n.jsx("option",{value:u,children:u},u))})]})}),n.jsxs(Ze,{children:[n.jsx(A,{ref:d,onClick:s,children:"Cancel"}),n.jsx(A,{onClick:()=>o(i,c),ml:3,isDisabled:c.length===0,children:"Confirm"})]})]})})})}function ns(){const{colorMode:t}=et(),e=Pe(),[s,o]=f.useState([]);return f.useEffect(()=>{ye.addEventListener("download_progress",i=>{o(i.detail)}),ye.addEventListener("download_error",i=>{e({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),n.jsx(q,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,pt:2,children:s.map(({save_path:i,progress:r})=>n.jsxs($,{children:[n.jsx(N,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),n.jsx(We,{isIndeterminate:!r,hasStripe:!0,width:"50%",value:r}),n.jsxs(N,{fontSize:16,width:"10%",children:[r.toFixed(1),"%"]}),n.jsx(A,{variant:"outline",size:"sm",colorScheme:"red",onClick:()=>ut(i),children:"Cancel"})]},i))})}function os(){const[t,e]=f.useState(""),{onOpen:s,onClose:o,isOpen:i}=Oe(),r=()=>{xt(t),o()};return n.jsxs(pt,{isOpen:i,onOpen:s,onClose:o,placement:"right",closeOnBlur:!1,children:[n.jsx(ft,{children:n.jsx(A,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),n.jsxs(mt,{p:5,children:[n.jsx(Re,{}),n.jsx(gt,{}),n.jsxs(q,{spacing:4,children:[n.jsx(N,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),n.jsx(X,{value:t,onChange:a=>e(a.target.value),placeholder:"API Key"}),n.jsx(A,{size:"sm",py:1,mr:8,onClick:r,children:"Save"})]})]})]})}async function is(t,e){var a,l;const s={queries:[{q:t,indexUid:"models_v8",facets:["category.name","checkpointType","fileFormats","lastVersionAtUnix","tags.name","type","user.username","version.baseModel"],attributesToHighlight:["*"],highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__",limit:80,offset:0}]};return e&&(s.queries[0].filter=[[`"type"="${e}"`]]),((l=(a=await(await fetch("https://meilisearch-v1-6.civitai.com/multi-search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(s)})).json())==null?void 0:a.results)==null?void 0:l.at(0)).hits??[]}function rs({onclose:t,searchQuery:e="",modelType:s}){const[o,i]=f.useState([]),[r,a]=f.useState(!1),[l,c]=f.useState(s),h=Pe(),[d,p]=f.useState([]),[u,g]=f.useState(e),{isOpen:m,onOpen:x,onClose:j}=Oe(),[M,C,k]=yt(),[P,Y]=f.useState({}),[D,b]=f.useState(ee),L=f.useCallback(async()=>{var S;a(!0);const y=await is(u,l);i(y);const v=await Fe();v&&Y(v);const _=await((S=H)==null?void 0:S.getSetting("defaultFolders"));_&&b(_),a(!1)},[u,l]),I=(y,v)=>{var pe,fe,me,ge;if(!((pe=k.current)!=null&&pe.id)&&!v){console.error("no url to download");return}let _=v??`https://civitai.com/api/download/models/${(fe=k.current)==null?void 0:fe.id}`,S=(me=k.current)==null?void 0:me.name;if(!S&&(S=_.split("/").pop(),!S)){console.error("downloadUrl is malformed");return}h({title:"Installing...",description:S,status:"info",duration:4e3,isClosable:!0}),S!=null&&p(He=>[...He,S??""]);const ue=wt();ue&&(_+=`?token=${ue}`),Xt({file_hash:(ge=k.current)==null?void 0:ge.SHA256,filename:S,save_path:y,url:_}),C(void 0),j()},O=async(y,v)=>{const _=D[v.type];C(y),_==null?x():I(_)},E=async(y,v)=>{var S;const _={...D,[y]:v};await((S=H)==null?void 0:S.upsert({defaultFolders:_})),b(_)};return f.useEffect(()=>{L()},[l]),n.jsxs(n.Fragment,{children:[n.jsxs(tt,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[n.jsx(ke,{}),n.jsxs(st,{width:"90%",maxWidth:"90vw",height:"90vh",children:[n.jsxs(Le,{pb:1,children:[n.jsxs($,{gap:2,mb:2,alignItems:"center",children:[n.jsx(Ne,{size:"md",mr:2,children:"Models"}),n.jsx(ts,{searchQuery:u,setSearchQuery:g,onSearch:L}),n.jsx(A,{size:"sm",py:1,mr:8,onClick:x,children:"Custom URL Install"}),n.jsx(os,{})]}),n.jsxs($,{gap:2,wrap:"wrap",children:[n.jsx(A,{size:"sm",py:1,onClick:()=>{c(void 0)},isActive:l==null,children:"All"}),vt.map(y=>n.jsx(A,{size:"sm",py:1,isActive:l===y,onClick:()=>{c(y)},children:y},y)),l&&P[ee[l]]&&n.jsxs($,{ml:"auto",children:[n.jsx(N,{fontSize:17,whiteSpace:"nowrap",children:"Default Download Folder:"}),n.jsx(Z,{value:D[l],onChange:y=>E(l,y.target.value),children:P[ee[l]].map(y=>n.jsx("option",{value:y,children:y},y))})]})]}),r&&n.jsx(ae,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),n.jsx(nt,{}),n.jsxs(Ie,{overflowY:"auto",children:[n.jsx($,{wrap:"wrap",children:o==null?void 0:o.map(y=>n.jsx(es,{model:y,onClickInstallModel:O,installing:d},y.id))}),n.jsx(ns,{})]})]})]}),n.jsx(ss,{fileSelected:!!M,isOpen:m,onClose:j,selectFolder:(y,v)=>{I(y,k.current?void 0:v)}})]})}const as=f.lazy(()=>ot(()=>import("./InstallMissingModelsButton-CgAeLGDH.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function ls(){const{setRoute:t,route:e}=f.useContext(Ae),s=async o=>{if(o.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const r=o.dataTransfer.getData("modelRelativePath"),a=o.dataTransfer.getData("nodeType"),l=LiteGraph.createNode(a);l.pos=[o.canvasX,o.canvasY],l.configure({widgets_values:[r]}),z.graph.add(l)};return f.useEffect(()=>(z.canvasEl.addEventListener("drop",s),ce.addEventListener("model_list",async o=>{var a;const i=(a=o.detail)==null?void 0:a.map(async l=>{const c=await G.models.get(l.model_name+"@"+l.model_type);if(c!=null&&c.fileHash)return c;let h={id:l.model_name+"@"+l.model_type,modelName:null,fileHash:l.file_hash??null,fileFolder:l.model_type,fileName:l.model_name+l.model_extension};if(!l.file_hash)return h;const d=await le(l.file_hash);return h={...h,modelName:d.modelName??null,civitModelID:d.civitModelID,civitModelVersionID:d.civitModelVersionID,imageUrl:d.imageUrl??null},h}),r=(await Promise.all(i)).filter(l=>l!=null);await G.models.clear(),await G.models.bulkPut(r.filter(l=>l!=null)),window.dispatchEvent(new CustomEvent("model_list_updated"))}),()=>{z.canvasEl.removeEventListener("drop",s)}),[]),n.jsxs(q,{style:{position:"relative"},children:[n.jsx(A,{size:"sm",backgroundColor:"#434554",color:"white",colorScheme:"blue","aria-label":"My models",onClick:()=>t("modelList"),px:1,height:jt+"px",children:"Models"}),n.jsx("div",{style:{position:"absolute",top:"38px",left:"0px"},children:n.jsx(f.Suspense,{children:n.jsx(as,{})})}),e==="modelList"&&n.jsx(Jt,{onClose:()=>t("root")}),e==="installModels"&&n.jsx(rs,{modelType:"Checkpoint",onclose:()=>t("root")})]})}const ms=Object.freeze(Object.defineProperty({__proto__:null,default:ls},Symbol.toStringTag,{value:"Module"}));export{Be as G,ms as M,Xt as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-CgAeLGDH.js","workspace_web/input.js","workspace_web/App-CrjjADF1.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-JARCRF6W-bSSCzR1D.js","workspace_web/chunk-7D6N5TE5-xH4ur8L5.js","workspace_web/chunk-3RSXBRAN-GXqN2xqN.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}