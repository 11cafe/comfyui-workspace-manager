import{r as f}from"./input.js";import{app as s}from"/scripts/app.js";import{a6 as v,j as k,ar as m,o as y,E as d,A as r}from"./App-0lRNBI-F.js";import"/scripts/api.js";function C(){const{setIsDirty:c,setRoute:p,saveCurWorkflow:h}=f.useContext(v),w=k();f.useEffect(()=>{const a=async e=>{switch(e){case d.SAVE:h();break;case d.SAVE_AS:p("saveAsModal");break}},t=s.graph.onAfterChange;s.graph.onAfterChange=function(){t==null||t.apply(s.canvas,arguments),i()},document.addEventListener("click",e=>{(s.canvas.node_over!=null||s.canvas.node_capturing_input!=null||s.canvas.node_widget!=null)&&i()}),document.addEventListener("keydown",async function(e){var n;if(document.visibilityState==="hidden")return;const o=await m(e);o?a(o):(n=e.target)!=null&&n.matches("input, textarea")&&i()})},[]);const g=async()=>{var t;const a=JSON.stringify(s.graph.serialize());a!=null&&await((t=r)==null?void 0:t.updateFlow(r.curWorkflow.id,{json:a})),c(!1)},i=async()=>{var t,e,o,n,u,l;if((e=(t=r)==null?void 0:t.curWorkflow)!=null&&e.saveLock)return;const a=await((o=y)==null?void 0:o.getSetting("autoSave"));if(!a){c(!0);return}(u=(n=r)==null?void 0:n.curWorkflow)!=null&&u.id&&a&&(await((l=r)==null?void 0:l.latestVersionCheck())?g():w({title:"Your changes cannot be saved!",description:"You are working on an outdated version. This workflow is changed by another tab. Please refresh to get the latest version.",status:"warning",isClosable:!0,duration:null}))};return null}export{C as default};
