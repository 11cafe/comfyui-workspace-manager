import{r as n,m as he,x as ne,b as fe,f as le,j as e,g as J,h as pe,n as y,s as M,q as Y,l as ge,o as me,H as ve,a3 as we,i as q,M as xe,N as ke,O as be,Q as ye,S as Ce}from"./input.js";import{aG as je,d as Se,B as Ie,A as De,a4 as Pe,H as Q,h as X,a2 as Re,_ as ie,f as _e,k as ae,g as re,aH as Fe,j as Me,F as Ee,aI as Ne,x as K,aJ as U,aK as Le,aL as We,aM as Te,T as He,aN as Ve}from"./App-fzzmRT0z.js";import{app as Oe}from"/scripts/app.js";import{t as Ae}from"./index-pz0vT7Or.js";import{L as Be}from"./chunk-K7XRJ7NL-Vyo84f0U.js";import{I as Ke}from"./IconCopy-HyQhCS2G.js";import"/scripts/api.js";function qe(t){return t&&ne(t)&&ne(t.target)}function Ge(t={}){const{onChange:p,value:c,defaultValue:s,name:d,isDisabled:h,isFocusable:u,isNative:g,...f}=t,[w,C]=n.useState(s||""),x=typeof c<"u",j=x?c:w,k=n.useRef(null),S=n.useCallback(()=>{const a=k.current;if(!a)return;let i="input:not(:disabled):checked";const I=a.querySelector(i);if(I){I.focus();return}i="input:not(:disabled)";const o=a.querySelector(i);o==null||o.focus()},[]),m=`radio-${n.useId()}`,N=d||m,R=n.useCallback(a=>{const i=qe(a)?a.target.value:a;x||C(i),p==null||p(String(i))},[p,x]),O=n.useCallback((a={},i=null)=>({...a,ref:he(i,k),role:"radiogroup"}),[]),_=n.useCallback((a={},i=null)=>({...a,ref:i,name:N,[g?"checked":"isChecked"]:j!=null?a.value===j:void 0,onChange(o){R(o)},"data-radiogroup":!0}),[g,N,R,j]);return{getRootProps:O,getRadioProps:_,name:N,ref:k,focus:S,setValue:C,value:j,onChange:R,isDisabled:h,isFocusable:u,htmlProps:f}}var[$e,ce]=fe({name:"RadioGroupContext",strict:!1}),de=le((t,p)=>{const{colorScheme:c,size:s,variant:d,children:h,className:u,isDisabled:g,isFocusable:f,...w}=t,{value:C,onChange:x,getRootProps:j,name:k,htmlProps:S}=Ge(w),E=n.useMemo(()=>({name:k,size:s,onChange:x,colorScheme:c,value:C,variant:d,isDisabled:g,isFocusable:f}),[k,s,x,c,C,d,g,f]);return e.jsx($e,{value:E,children:e.jsx(J.div,{...j(S,p),className:pe("chakra-radio-group",u),children:h})})});de.displayName="RadioGroup";var ze={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Ue(t={}){const{defaultChecked:p,isChecked:c,isFocusable:s,isDisabled:d,isReadOnly:h,isRequired:u,onChange:g,isInvalid:f,name:w,value:C,id:x,"data-radiogroup":j,"aria-describedby":k,...S}=t,E=`radio-${n.useId()}`,m=je(),R=!!ce()||!!j;let _=!!m&&!R?m.id:E;_=x??_;const a=d??(m==null?void 0:m.isDisabled),i=h??(m==null?void 0:m.isReadOnly),I=u??(m==null?void 0:m.isRequired),o=f??(m==null?void 0:m.isInvalid),[r,P]=n.useState(!1),[v,D]=n.useState(!1),[b,L]=n.useState(!1),[W,T]=n.useState(!1),[G,$]=n.useState(!!p),A=typeof c<"u",F=A?c:G;n.useEffect(()=>Ae(P),[]);const H=n.useCallback(l=>{if(i||a){l.preventDefault();return}A||$(l.target.checked),g==null||g(l)},[A,a,i,g]),B=n.useCallback(l=>{l.key===" "&&T(!0)},[T]),z=n.useCallback(l=>{l.key===" "&&T(!1)},[T]),ee=n.useCallback((l={},V=null)=>({...l,ref:V,"data-active":y(W),"data-hover":y(b),"data-disabled":y(a),"data-invalid":y(o),"data-checked":y(F),"data-focus":y(v),"data-focus-visible":y(v&&r),"data-readonly":y(i),"aria-hidden":!0,onMouseDown:M(l.onMouseDown,()=>T(!0)),onMouseUp:M(l.onMouseUp,()=>T(!1)),onMouseEnter:M(l.onMouseEnter,()=>L(!0)),onMouseLeave:M(l.onMouseLeave,()=>L(!1))}),[W,b,a,o,F,v,i,r]),{onFocus:oe,onBlur:se}=m??{},ue=n.useCallback((l={},V=null)=>{const te=a&&!s;return{...l,id:_,ref:V,type:"radio",name:w,value:C,onChange:M(l.onChange,H),onBlur:M(se,l.onBlur,()=>D(!1)),onFocus:M(oe,l.onFocus,()=>D(!0)),onKeyDown:M(l.onKeyDown,B),onKeyUp:M(l.onKeyUp,z),checked:F,disabled:te,readOnly:i,required:I,"aria-invalid":Y(o),"aria-disabled":Y(te),"aria-required":Y(I),"data-readonly":y(i),"aria-describedby":k,style:ze}},[a,s,_,w,C,H,se,oe,B,z,F,i,I,o,k]);return{state:{isInvalid:o,isFocused:v,isChecked:F,isActive:W,isHovered:b,isDisabled:a,isReadOnly:i,isRequired:I},getCheckboxProps:ee,getRadioProps:ee,getInputProps:ue,getLabelProps:(l={},V=null)=>({...l,ref:V,onMouseDown:M(l.onMouseDown,Je),"data-disabled":y(a),"data-checked":y(F),"data-invalid":y(o)}),getRootProps:(l,V=null)=>({...l,ref:V,"data-disabled":y(a),"data-checked":y(F),"data-invalid":y(o)}),htmlProps:S}}function Je(t){t.preventDefault(),t.stopPropagation()}function Qe(t,p){const c={},s={};for(const[d,h]of Object.entries(t))p.includes(d)?c[d]=h:s[d]=h;return[c,s]}var Z=le((t,p)=>{var c;const s=ce(),{onChange:d,value:h}=t,u=ge("Radio",{...s,...t}),g=me(t),{spacing:f="0.5rem",children:w,isDisabled:C=s==null?void 0:s.isDisabled,isFocusable:x=s==null?void 0:s.isFocusable,inputProps:j,...k}=g;let S=t.isChecked;(s==null?void 0:s.value)!=null&&h!=null&&(S=s.value===h);let E=d;s!=null&&s.onChange&&h!=null&&(E=ve(s.onChange,d));const m=(c=t==null?void 0:t.name)!=null?c:s==null?void 0:s.name,{getInputProps:N,getCheckboxProps:R,getLabelProps:O,getRootProps:_,htmlProps:a}=Ue({...k,isChecked:S,isFocusable:x,isDisabled:C,onChange:E,name:m}),[i,I]=Qe(a,we),o=R(I),r=N(j,p),P=O(),v=Object.assign({},i,_()),D={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...u.container},b={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...u.control},L={userSelect:"none",marginStart:f,...u.label};return e.jsxs(J.label,{className:"chakra-radio",...v,__css:D,children:[e.jsx("input",{className:"chakra-radio__input",...r}),e.jsx(J.span,{className:"chakra-radio__control",...o,__css:b}),w&&e.jsx(J.span,{className:"chakra-radio__label",...P,__css:L,children:w})]})});Z.displayName="Radio";var Ye=Se("cloud","IconCloud",[["path",{d:"M6.657 18c-2.572 0 -4.657 -2.007 -4.657 -4.483c0 -2.475 2.085 -4.482 4.657 -4.482c.393 -1.762 1.794 -3.2 3.675 -3.773c1.88 -.572 3.956 -.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486c0 1.927 -1.551 3.487 -3.465 3.487h-11.878",key:"svg-0"}]]);function Xe({options:t,value:p,onChange:c}){const[s,d]=n.useState(!1),h=n.useRef(null),u=t.find(f=>f.value===p);n.useEffect(()=>{const f=w=>{h.current&&!h.current.contains(w.target)&&d(!1)};return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[h]);const g=()=>d(!s);return e.jsxs(Ie,{position:"relative",children:[e.jsx(q,{onClick:g,rightIcon:e.jsx(De,{}),leftIcon:u==null?void 0:u.icon,children:u==null?void 0:u.label}),s&&e.jsx(Pe,{gap:4,ref:h,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:t.map(f=>e.jsx(q,{onClick:()=>{d(!1),c(f.value)},leftIcon:f.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:f.label},f.label))})]})}function Ze({version:t,cloudHost:p,cloudWorkflowID:c}){const s=t,d=e.jsxs(Q,{spacing:4,alignItems:"center",children:[e.jsx(X,{children:s.name}),e.jsx(X,{color:"GrayText",children:Re(s.createTime,!1)}),s.cloudID&&c&&e.jsx("a",{href:p+"/workflow/"+c+"/"+s.cloudID,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsx(q,{size:"xs",colorScheme:"teal",variant:"outline",leftIcon:e.jsx(Ye,{}),rightIcon:e.jsx(ie,{size:18}),children:"Shared"})})]});return t.cloudID?e.jsx(e.Fragment,{children:d}):e.jsx(Z,{value:s.id,mb:5,children:d},s.id)}function ho({onClose:t}){var i,I;const[p,c]=n.useState("v"+eo()),[s,d]=n.useState([]),[h,u]=n.useState(!1),[g,f]=n.useState(""),[w,C]=n.useState("PRIVATE"),[x,j]=n.useState("new_version"),k=n.useRef(""),[S,E]=n.useState(),m=_e(),N=async o=>{var L,W;const r=o.data;if(o.origin!==k.current||r.type!=="share_workflow_success")return;const P=r.localWorkflowID,v=r.localVersionID,D=r.version.id,b=r.version.workflowID;b&&P&&await((L=K)==null?void 0:L.updateMetaInfo(P,{cloudID:b,cloudOrigin:o.origin,privacy:w})),v&&D&&await((W=U)==null?void 0:W.update(v,{cloudID:D,cloudOrigin:o.origin})),R(),window.open(k.current+"/workflow/"+b+"/"+D,"_blank"),u(!1)};n.useEffect(()=>(R(),window.addEventListener("message",N),()=>{window.removeEventListener("message",N)}),[]);const R=async()=>{var P,v,D;const o=await((P=ae)==null?void 0:P.getSetting("cloudHost"));o&&(f(o),k.current=o);const r=((v=K)==null?void 0:v.curWorkflow)??void 0;E(r),r!=null&&r.cloudID&&r.cloudOrigin&&Te(r).then(b=>{C(b)}),(D=U)==null||D.listByWorkflowID(r.id).then(b=>{d(b)})},O=o=>{navigator.clipboard.writeText(o).then(()=>{m({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(r=>{console.error("Failed to copy text: ",r)})},_=async()=>{var $,A,F;u(!0);const o=Le(32),r=await(($=ae)==null?void 0:$.getSetting("cloudHost"));let P,v;try{if(P=We(),x==="new_version"?v=await((A=U)==null?void 0:A.add({workflowID:S.id,name:p,createTime:Date.now(),json:JSON.stringify(Oe.graph.serialize())})):v=await((F=U)==null?void 0:F.get(x)),!v){alert(`Failed to find version: ${x}, please try again.`),u(!1);return}}catch(H){console.error(H),u(!1),alert("Failed to share workflow, please try again.");return}const D=window.location.protocol,b=window.location.host,L=`${D}//${b}`,W=r+`/share_workflow_confirm/${o}?redirectUrl=${L}`,T=window.open(W,"Share Workflow","width=800,height=800"),G=H=>{var B;if(H.origin===r&&H.data==="child_ready"){const z=(B=K)==null?void 0:B.curWorkflow;T.postMessage({workflow:z,version:v,nodeDefs:P,privacy:w},r),window.removeEventListener("message",G)}};window.addEventListener("message",G)},a=(I=(i=K)==null?void 0:i.curWorkflow)==null?void 0:I.cloudID;return e.jsxs(xe,{isOpen:!0,onClose:t,size:"lg",children:[e.jsx(ke,{}),e.jsxs(be,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsxs(ye,{children:['Share "',S==null?void 0:S.name,'"']}),e.jsxs(Ce,{pb:10,children:[e.jsxs(re,{gap:5,children:[a==null?e.jsx(Xe,{options:Fe,value:w,onChange:o=>{C(o)}}):e.jsx(He,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(Ve,{privacy:w,showEmoji:!0})}),a&&e.jsxs(Q,{spacing:2,color:"teal.400",children:[e.jsxs(Be,{href:g+"/workflow/"+a,isExternal:!0,children:[g+"/workflow/"+a," ",e.jsx(ie,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(q,{width:"180px",size:"sm",leftIcon:e.jsx(Ke,{}),onClick:()=>{var o,r;O(g+"/workflow/"+((r=(o=K)==null?void 0:o.curWorkflow)==null?void 0:r.cloudID))},children:"Copy link"})]}),e.jsx(X,{children:"Choose a version to share:"}),e.jsx(de,{gap:4,onChange:o=>{j(o)},value:x,children:e.jsxs(re,{children:[e.jsxs(Q,{mb:5,alignItems:"center",children:[e.jsx(Z,{value:"new_version"},"new_version"),e.jsx(Me,{value:p,width:"60%",onFocus:()=>{j("new_version")},onChange:o=>{c(o.target.value)}}),e.jsx(Ee,{color:"green",children:e.jsx(Ne,{colorScheme:"purple",children:"New version"})})]}),s.slice(0,4).map(o=>e.jsx(Ze,{version:o,cloudHost:g,cloudWorkflowID:a??null},o.id))]})})]}),e.jsx(Q,{justifyContent:"flex-end",mt:16,children:e.jsx(q,{colorScheme:"teal",onClick:_,isDisabled:h,children:h?"Sharing":"Share"})})]})]})]})}function eo(){const t=new Date,p=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${p}-${c}-${s}`}export{ho as default};
