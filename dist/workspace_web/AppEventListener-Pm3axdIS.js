import{r as p}from"./input.js";import{app as n}from"/scripts/app.js";import{a5 as v,j as m,ao as S,o as y,E as w,A as s}from"./App-to8jIIgG.js";import"/scripts/api.js";function C(){const{setIsDirty:r,setRoute:h,saveCurWorkflow:g}=p.useContext(v),k=m();p.useEffect(()=>{const o=async t=>{switch(t){case w.SAVE:g();break;case w.SAVE_AS:h("saveAsModal");break}};document.addEventListener("click",t=>{(n.canvas.node_over!=null||n.canvas.node_capturing_input!=null||n.canvas.node_widget!=null)&&i()}),document.addEventListener("keydown",async function(t){var a;if(document.visibilityState==="hidden")return;const e=await S(t);e?o(e):(a=t.target)!=null&&a.matches("input, textarea")&&i()})},[]);const i=async()=>{var t,e,a,c,u,l,d;if((e=(t=s)==null?void 0:t.curWorkflow)!=null&&e.saveLock)return;const o=await((a=y)==null?void 0:a.getSetting("autoSave"));if(o||r(!0),(u=(c=s)==null?void 0:c.curWorkflow)!=null&&u.id&&o)if(!await((l=s)==null?void 0:l.latestVersionCheck()))k({title:"You are working on an outdated version",description:"This workflow is changed by another tab. Please close the page and reopen to get the latest version.",status:"warning",duration:5e3,isClosable:!0});else{const f=JSON.stringify(n.graph.serialize());f!=null&&await((d=s)==null?void 0:d.updateFlow(s.curWorkflow.id,{json:f})),r(!1)}};return null}export{C as default};
