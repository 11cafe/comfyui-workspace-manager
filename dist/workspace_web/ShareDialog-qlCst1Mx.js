import{r as s,m as se,x as J,b as te,f as ae,j as e,g as ne,h as re,i as M,M as ie,N as le,O as ce,Q as de,S as ue}from"./input.js";import{B as fe,A as he,a4 as pe,f as ge,k as U,F as Y,g as H,aH as we,H as Q,j as me,aI as xe,aJ as ke,x as E,aK as F,aL as ve,aM as be,aN as je,T as Se,aO as ye,_ as Ce}from"./App-YasK6gmY.js";import{app as Ie}from"/scripts/app.js";import{S as De,L as Re}from"./chunk-VTV6N5LE-Z0LTKDqP.js";import{I as Ee}from"./IconCopy-4GcN7HJ6.js";import"/scripts/api.js";import"./chunk-7D6N5TE5-TAIoKN5-.js";function Le(a){return a&&J(a)&&J(a.target)}function _e(a={}){const{onChange:d,value:u,defaultValue:g,name:w,isDisabled:f,isFocusable:r,isNative:h,...n}=a,[m,S]=s.useState(g||""),p=typeof u<"u",k=p?u:m,x=s.useRef(null),i=s.useCallback(()=>{const l=x.current;if(!l)return;let c="input:not(:disabled):checked";const D=l.querySelector(c);if(D){D.focus();return}c="input:not(:disabled)";const v=l.querySelector(c);v==null||v.focus()},[]),_=`radio-${s.useId()}`,y=w||_,I=s.useCallback(l=>{const c=Le(l)?l.target.value:l;p||S(c),d==null||d(String(c))},[d,p]),W=s.useCallback((l={},c=null)=>({...l,ref:se(c,x),role:"radiogroup"}),[]),N=s.useCallback((l={},c=null)=>({...l,ref:c,name:y,[h?"checked":"isChecked"]:k!=null?l.value===k:void 0,onChange(v){I(v)},"data-radiogroup":!0}),[h,y,I,k]);return{getRootProps:W,getRadioProps:N,name:y,ref:x,focus:i,setValue:S,value:k,onChange:I,isDisabled:f,isFocusable:r,htmlProps:n}}var[We,ze]=te({name:"RadioGroupContext",strict:!1}),X=ae((a,d)=>{const{colorScheme:u,size:g,variant:w,children:f,className:r,isDisabled:h,isFocusable:n,...m}=a,{value:S,onChange:p,getRootProps:k,name:x,htmlProps:i}=_e(m),L=s.useMemo(()=>({name:x,size:g,onChange:p,colorScheme:u,value:S,variant:w,isDisabled:h,isFocusable:n}),[x,g,p,u,S,w,h,n]);return e.jsx(We,{value:L,children:e.jsx(ne.div,{...k(i,d),className:re("chakra-radio-group",r),children:f})})});X.displayName="RadioGroup";function Ne({options:a,value:d,onChange:u}){const[g,w]=s.useState(!1),f=s.useRef(null),r=a.find(n=>n.value===d);s.useEffect(()=>{const n=m=>{f.current&&!f.current.contains(m.target)&&w(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[f]);const h=()=>w(!g);return e.jsxs(fe,{position:"relative",children:[e.jsx(M,{onClick:h,rightIcon:e.jsx(he,{}),leftIcon:r==null?void 0:r.icon,children:r==null?void 0:r.label}),g&&e.jsx(pe,{gap:4,ref:f,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:a.map(n=>e.jsx(M,{onClick:()=>{w(!1),u(n.value)},leftIcon:n.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:n.label},n.label))})]})}function Be({onClose:a}){var O,$,z;const[d,u]=s.useState("v"+Pe()),[g,w]=s.useState([]),[f,r]=s.useState(!1),[h,n]=s.useState(""),[m,S]=s.useState("PRIVATE"),[p,k]=s.useState("new_version"),x=s.useRef(""),i=(O=E)==null?void 0:O.curWorkflow,L=ge(),_=s.useRef(null),[y,I]=s.useState(!0),W=async o=>{var P,T;const t=o.data;if(o.origin!==x.current||t.type!=="share_workflow_success")return;const b=t.localWorkflowID,j=t.localVersionID,C=t.version.id,R=t.version.workflowID;R&&b&&await((P=E)==null?void 0:P.updateMetaInfo(b,{cloudID:R,cloudOrigin:o.origin,privacy:m})),j&&C&&await((T=F)==null?void 0:T.update(j,{cloudID:C,cloudOrigin:o.origin})),N(),window.open(x.current+"/workflow/"+R+"/"+C,"_blank"),r(!1)};s.useEffect(()=>{N(),window.addEventListener("message",W);const o=t=>{t.detail&&c(t.detail?JSON.stringify(t.detail):void 0)};return window.addEventListener("workspace_info_deps_updated",o),()=>{window.removeEventListener("message",W),window.removeEventListener("workspace_info_deps_updated",o)}},[]);const N=async()=>{var t,b;const o=await((t=U)==null?void 0:t.getSetting("cloudHost"));o&&(n(o),x.current=o),i!=null&&i.cloudID&&i.cloudOrigin&&je(i).then(j=>{S(j)}),(b=F)==null||b.listByWorkflowID(i.id).then(j=>{w(j)})},l=o=>{navigator.clipboard.writeText(o).then(()=>{L({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(t=>{console.error("Failed to copy text: ",t)})},c=async o=>{var G,K,q;r(!0);const t=ve(32),b=await((G=U)==null?void 0:G.getSetting("cloudHost"));let j,C;try{if(j=be(),p==="new_version"?C=await((K=F)==null?void 0:K.add({workflowID:i.id,name:d,createTime:Date.now(),json:o??JSON.stringify(Ie.graph.serialize())})):C=await((q=F)==null?void 0:q.get(p)),!C){alert(`Failed to find version: ${p}, please try again.`),r(!1);return}}catch(V){console.error(V),r(!1),alert("Failed to share workflow, please try again.");return}const R=window.location.protocol,P=window.location.host,T=`${R}//${P}`,Z=b+`/share_workflow_confirm/${t}?redirectUrl=${T}`,ee=window.open(Z,"Share Workflow","width=800,height=800"),B=V=>{var A;if(V.origin===b&&V.data==="child_ready"){const oe=(A=E)==null?void 0:A.curWorkflow;ee.postMessage({workflow:oe,version:C,nodeDefs:j,privacy:m},b),window.removeEventListener("message",B)}};window.addEventListener("message",B)},D=async()=>{var o;y?(o=_.current)==null||o.requestSubmit():c()},v=(z=($=E)==null?void 0:$.curWorkflow)==null?void 0:z.cloudID;return e.jsxs(ie,{isOpen:!0,onClose:a,size:"lg",children:[e.jsx(le,{}),e.jsxs(ce,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsx(de,{children:e.jsxs(Y,{justifyContent:"space-between",children:[e.jsxs("p",{children:['Share "',i==null?void 0:i.name,'"']}),e.jsx(M,{colorScheme:"teal",onClick:D,size:"sm",isDisabled:f,children:f?"Sharing":"Share"})]})}),e.jsx(ue,{pb:10,children:e.jsxs(H,{gap:5,children:[v==null?e.jsx(Ne,{options:we,value:m,onChange:o=>{S(o)}}):e.jsx(Se,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(ye,{privacy:m,showEmoji:!0})}),v&&e.jsxs(Q,{spacing:2,color:"teal.400",children:[e.jsxs(Re,{wordBreak:"break-all",href:h+"/workflow/"+v,isExternal:!0,children:[h+"/workflow/"+v," ",e.jsx(Ce,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(M,{size:"sm",leftIcon:e.jsx(Ee,{size:18}),onClick:()=>{var o,t;l(h+"/workflow/"+((t=(o=E)==null?void 0:o.curWorkflow)==null?void 0:t.cloudID))},children:"Copy link"})]}),e.jsx(X,{gap:4,onChange:o=>{k(o)},value:p,children:e.jsx(H,{children:e.jsxs(Q,{mb:5,alignItems:"center",children:[e.jsx(me,{value:d,width:"60%",onFocus:()=>{k("new_version")},onChange:o=>{u(o.target.value)}}),e.jsx(Y,{color:"green",children:e.jsx(xe,{colorScheme:"purple",children:"Version Name"})})]})})}),e.jsxs(H,{borderRadius:6,borderWidth:"1px",p:2,children:[e.jsx(De,{isChecked:y,onChange:()=>I(!y),fontWeight:"600",children:"Share Resource Links"}),y&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"GrayText"},children:"You can disable reource sharing if you don't want to resolve submit errors"}),e.jsx(ke,{ref:_})]})]})]})})]})]})}function Pe(){const a=new Date,d=a.getFullYear(),u=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0");return`${d}-${u}-${g}`}export{Be as default};
