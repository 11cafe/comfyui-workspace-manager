import{r as t,m as ae,x as Y,b as ne,f as re,j as e,g as ie,h as le,i as M,M as ce,N as de,O as ue,Q as fe,S as he}from"./input.js";import{B as pe,A as ge,a6 as we,aE as me,f as xe,k as z,F as X,g as H,aK as ve,H as Z,j as ke,aL as ye,aM as be,x as E,aN as F,aO as je,aP as Se,a5 as Ce,aQ as De,h as Ie,T as Re,aR as Ee,_ as Le}from"./App-eQybp91e.js";import{S as Te,L as We}from"./chunk-VTV6N5LE-_EaL4yE7.js";import{I as _e}from"./IconCopy-D2k-9fMf.js";import"./chunk-7D6N5TE5-lFR77IBa.js";function Pe(n){return n&&Y(n)&&Y(n.target)}function Ne(n={}){const{onChange:u,value:f,defaultValue:g,name:w,isDisabled:h,isFocusable:r,isNative:c,...a}=n,[b,j]=t.useState(g||""),p=typeof f<"u",m=p?f:b,x=t.useRef(null),i=t.useCallback(()=>{const l=x.current;if(!l)return;let d="input:not(:disabled):checked";const I=l.querySelector(d);if(I){I.focus();return}d="input:not(:disabled)";const v=l.querySelector(d);v==null||v.focus()},[]),T=`radio-${t.useId()}`,S=w||T,D=t.useCallback(l=>{const d=Pe(l)?l.target.value:l;p||j(d),u==null||u(String(d))},[u,p]),W=t.useCallback((l={},d=null)=>({...l,ref:ae(d,x),role:"radiogroup"}),[]),_=t.useCallback((l={},d=null)=>({...l,ref:d,name:S,[c?"checked":"isChecked"]:m!=null?l.value===m:void 0,onChange(v){D(v)},"data-radiogroup":!0}),[c,S,D,m]);return{getRootProps:W,getRadioProps:_,name:S,ref:x,focus:i,setValue:j,value:m,onChange:D,isDisabled:h,isFocusable:r,htmlProps:a}}var[Ve,Be]=ne({name:"RadioGroupContext",strict:!1}),ee=re((n,u)=>{const{colorScheme:f,size:g,variant:w,children:h,className:r,isDisabled:c,isFocusable:a,...b}=n,{value:j,onChange:p,getRootProps:m,name:x,htmlProps:i}=Ne(b),L=t.useMemo(()=>({name:x,size:g,onChange:p,colorScheme:f,value:j,variant:w,isDisabled:c,isFocusable:a}),[x,g,p,f,j,w,c,a]);return e.jsx(Ve,{value:L,children:e.jsx(ie.div,{...m(i,u),className:le("chakra-radio-group",r),children:h})})});ee.displayName="RadioGroup";function Fe({options:n,value:u,onChange:f}){const[g,w]=t.useState(!1),h=t.useRef(null),r=n.find(a=>a.value===u);t.useEffect(()=>{const a=b=>{h.current&&!h.current.contains(b.target)&&w(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[h]);const c=()=>w(!g);return e.jsxs(pe,{position:"relative",children:[e.jsx(M,{onClick:c,rightIcon:e.jsx(ge,{}),leftIcon:r==null?void 0:r.icon,children:r==null?void 0:r.label}),g&&e.jsx(we,{gap:4,ref:h,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:n.map(a=>e.jsx(M,{onClick:()=>{w(!1),f(a.value)},leftIcon:a.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:a.label},a.label))})]})}function Ke({onClose:n}){var O,$,G,B,K;const[u,f]=t.useState("v"+Me()),[g,w]=t.useState([]),[h,r]=t.useState(!1),c=($=(O=z)==null?void 0:O.settings)==null?void 0:$.cloudHost,[a,b,j]=me("PRIVATE"),[p,m]=t.useState("new_version"),x=t.useRef(""),i=(G=E)==null?void 0:G.curWorkflow,L=xe(),T=t.useRef(null),[S,D]=t.useState(!0),W=async o=>{var P,N;const s=o.data;if(s.type!=="share_workflow_success")return;const k=s.localWorkflowID,y=s.localVersionID,C=s.version.id,R=s.version.workflowID;R&&k&&await((P=E)==null?void 0:P.updateMetaInfo(k,{cloudID:R,cloudOrigin:o.origin,privacy:j.current})),y&&C&&await((N=F)==null?void 0:N.update(y,{cloudID:C,cloudOrigin:o.origin})),_(),window.open(x.current+"/workflow/"+R+"/"+C,"_blank"),r(!1)};t.useEffect(()=>{_(),window.addEventListener("message",W);const o=s=>{s.detail&&d(s.detail?JSON.stringify(s.detail):void 0)};return window.addEventListener("workspace_info_deps_updated",o),()=>{window.removeEventListener("message",W),window.removeEventListener("workspace_info_deps_updated",o)}},[]);const _=async()=>{var s,k;const o=await((s=z)==null?void 0:s.getSetting("cloudHost"));o&&(x.current=o),i!=null&&i.cloudID&&i.cloudOrigin&&De(i).then(y=>{b(y)}),(k=F)==null||k.listByWorkflowID(i.id).then(y=>{w(y)})},l=o=>{navigator.clipboard.writeText(o).then(()=>{L({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(s=>{console.error("Failed to copy text: ",s)})},d=async o=>{var A,U,J;r(!0);const s=je(32),k=await((A=z)==null?void 0:A.getSetting("cloudHost"));let y,C;try{if(y=Se(),p==="new_version"?C=await((U=F)==null?void 0:U.add({workflowID:i.id,name:u,createTime:Date.now(),json:o??JSON.stringify(Ce.graph.serialize())})):C=await((J=F)==null?void 0:J.get(p)),!C){alert(`Failed to find version: ${p}, please try again.`),r(!1);return}}catch(V){console.error(V),r(!1),alert("Failed to share workflow, please try again.");return}const R=window.location.protocol,P=window.location.host,N=`${R}//${P}`,oe=k+`/share_workflow_confirm/${s}?redirectUrl=${N}`,se=window.open(oe,"Share Workflow","width=800,height=800"),q=V=>{var Q;if(V.origin===k&&V.data==="child_ready"){const te=(Q=E)==null?void 0:Q.curWorkflow;se.postMessage({workflow:te,version:C,nodeDefs:y,privacy:j.current},k),window.removeEventListener("message",q)}};window.addEventListener("message",q)},I=async()=>{var o;S?(o=T.current)==null||o.requestSubmit():d()},v=(K=(B=E)==null?void 0:B.curWorkflow)==null?void 0:K.cloudID;return e.jsxs(ce,{isOpen:!0,onClose:n,size:"lg",children:[e.jsx(de,{}),e.jsxs(ue,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsxs(fe,{children:[e.jsxs(X,{justifyContent:"space-between",children:[e.jsxs("p",{children:['Share "',i==null?void 0:i.name,'"']}),e.jsx(M,{colorScheme:"teal",onClick:I,size:"sm",isDisabled:h,children:h?"Sharing":"Share"})]}),c&&e.jsxs(Ie,{fontSize:16,color:"GrayText",fontWeight:400,children:["Share to ",new URL(c).host]})]}),e.jsx(he,{pb:10,children:e.jsxs(H,{gap:5,children:[v==null?e.jsx(Fe,{options:ve,value:a,onChange:o=>{b(o)}}):e.jsx(Re,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(Ee,{privacy:a,showEmoji:!0})}),v&&e.jsxs(Z,{spacing:2,color:"teal.400",children:[e.jsxs(We,{wordBreak:"break-all",href:c+"/workflow/"+v,isExternal:!0,children:[c+"/workflow/"+v," ",e.jsx(Le,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(M,{size:"sm",leftIcon:e.jsx(_e,{size:18}),onClick:()=>{var o,s;l(c+"/workflow/"+((s=(o=E)==null?void 0:o.curWorkflow)==null?void 0:s.cloudID))},children:"Copy link"})]}),e.jsx(ee,{gap:4,onChange:o=>{m(o)},value:p,children:e.jsx(H,{children:e.jsxs(Z,{mb:5,alignItems:"center",children:[e.jsx(ke,{value:u,width:"60%",onFocus:()=>{m("new_version")},onChange:o=>{f(o.target.value)}}),e.jsx(X,{color:"green",children:e.jsx(ye,{colorScheme:"purple",children:"Version Name"})})]})})}),e.jsxs(H,{borderRadius:6,borderWidth:"1px",p:2,children:[e.jsx(Te,{isChecked:S,onChange:()=>D(!S),fontWeight:"600",children:"Share Resource Links"}),S&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"GrayText"},children:"You can disable reource sharing if you don't want to resolve submit errors"}),e.jsx(be,{ref:T})]})]})]})})]})]})}function Me(){const n=new Date,u=n.getFullYear(),f=String(n.getMonth()+1).padStart(2,"0"),g=String(n.getDate()).padStart(2,"0");return`${u}-${f}-${g}`}export{Ke as default};
