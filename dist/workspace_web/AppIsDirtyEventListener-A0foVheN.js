import{r as c}from"./input.js";import{X as v,a3 as r,af as m,w as u,E as l,ag as S,ah as _}from"./App-JMiaxpBt.js";import{u as C}from"./useDebounceFn-ld478fd0.js";function L(){const{isDirty:f,setIsDirty:p,setRoute:h,saveCurWorkflow:w,setCurFlowIDAndName:g}=c.useContext(v),k=c.useRef(f);c.useEffect(()=>{k.current=f},[f]),c.useEffect(()=>{const i=e=>{var n;if(document.visibilityState==="hidden")return;const t=_(e);if(t)switch(t===l.openSpotlightSearch&&e.preventDefault(),window.dispatchEvent(new CustomEvent(S,{detail:{shortcutType:t}})),t){case l.SAVE:w();break;case l.SAVE_AS:h("saveAsModal");break;case l.openSpotlightSearch:h("spotlightSearch");break}else(n=e.target)!=null&&n.matches("input, textarea")&&Object.keys(r.canvas.selected_nodes??{}).length&&E()};(async()=>{var t,n,a;const e=(n=(t=r.graph.extra)==null?void 0:t[m])==null?void 0:n.id;if(e){const s=await((a=u)==null?void 0:a.get(e));s&&g(s),!(s!=null&&s.saveLock)&&s&&s.json!==JSON.stringify(r.graph.serialize())&&p(!0)}})();const o=r.graph.onConfigure;return r.graph.onConfigure=function(){o==null||o.apply(this,arguments),setTimeout(()=>{var t,n,a,s;const e=(n=(t=r.graph.extra)==null?void 0:t[m])==null?void 0:n.id;(e==null||e!=((s=(a=u)==null?void 0:a.curWorkflow)==null?void 0:s.id))&&g(null)},500)},document.addEventListener("click",e=>{Object.keys(r.canvas.selected_nodes??{}).length&&(r.canvas.node_over!=null||r.canvas.node_capturing_input!=null||r.canvas.node_widget!=null)&&E()}),document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]);const y=async()=>{var d,o,e,t;if((o=(d=u)==null?void 0:d.curWorkflow)!=null&&o.saveLock||k.current)return;const i=r.graph.serialize();JSON.stringify(i)!==((t=(e=u)==null?void 0:e.curWorkflow)==null?void 0:t.json)&&p(!0)},[E,D]=C(y,900);return null}export{L as default};
