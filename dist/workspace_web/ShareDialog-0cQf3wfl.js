import{f as Z,n as ge,o as ie,j as e,g as G,e as ce,r as a,m as me,w as ne,b as ve,l as y,q as E,p as Y,k as we,H as ke,ah as be,h as K,M as xe,N as ye,O as Ce,Q as Se,S as je}from"./input.js";import{aB as De,h as Ie,B as Pe,J as Re,ab as _e,H as Q,l as X,a7 as Fe,a9 as de,j as Ee,o as le,k as re,aC as Me,n as Ne,F as We,A as q,aD as J,aE as Le,aF as Te,aG as Be,T as He,aH as Ve}from"./App-PEx1CV7x.js";import{app as Oe}from"/scripts/app.js";import{t as Ae}from"./index-pz0vT7Or.js";import{L as qe}from"./chunk-K7XRJ7NL-DRLDc1uk.js";import{I as Ge}from"./IconCopy-WkAIl9eH.js";import"/scripts/api.js";var ue=Z(function(c,r){const o=ge("Badge",c),{className:d,...h}=ie(c);return e.jsx(G.span,{ref:r,className:ce("chakra-badge",c.className),...h,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});ue.displayName="Badge";function Ke(t){return t&&ne(t)&&ne(t.target)}function $e(t={}){const{onChange:c,value:r,defaultValue:o,name:d,isDisabled:h,isFocusable:f,isNative:g,...p}=t,[w,C]=a.useState(o||""),k=typeof r<"u",S=k?r:w,b=a.useRef(null),j=a.useCallback(()=>{const n=b.current;if(!n)return;let u="input:not(:disabled):checked";const D=n.querySelector(u);if(D){D.focus();return}u="input:not(:disabled)";const s=n.querySelector(u);s==null||s.focus()},[]),m=`radio-${a.useId()}`,N=d||m,R=a.useCallback(n=>{const u=Ke(n)?n.target.value:n;k||C(u),c==null||c(String(u))},[c,k]),V=a.useCallback((n={},u=null)=>({...n,ref:me(u,b),role:"radiogroup"}),[]),_=a.useCallback((n={},u=null)=>({...n,ref:u,name:N,[g?"checked":"isChecked"]:S!=null?n.value===S:void 0,onChange(s){R(s)},"data-radiogroup":!0}),[g,N,R,S]);return{getRootProps:V,getRadioProps:_,name:N,ref:b,focus:j,setValue:C,value:S,onChange:R,isDisabled:h,isFocusable:f,htmlProps:p}}var[ze,he]=ve({name:"RadioGroupContext",strict:!1}),fe=Z((t,c)=>{const{colorScheme:r,size:o,variant:d,children:h,className:f,isDisabled:g,isFocusable:p,...w}=t,{value:C,onChange:k,getRootProps:S,name:b,htmlProps:j}=$e(w),M=a.useMemo(()=>({name:b,size:o,onChange:k,colorScheme:r,value:C,variant:d,isDisabled:g,isFocusable:p}),[b,o,k,r,C,d,g,p]);return e.jsx(ze,{value:M,children:e.jsx(G.div,{...S(j,c),className:ce("chakra-radio-group",f),children:h})})});fe.displayName="RadioGroup";var Ue={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Je(t={}){const{defaultChecked:c,isChecked:r,isFocusable:o,isDisabled:d,isReadOnly:h,isRequired:f,onChange:g,isInvalid:p,name:w,value:C,id:k,"data-radiogroup":S,"aria-describedby":b,...j}=t,M=`radio-${a.useId()}`,m=De(),R=!!he()||!!S;let _=!!m&&!R?m.id:M;_=k??_;const n=d??(m==null?void 0:m.isDisabled),u=h??(m==null?void 0:m.isReadOnly),D=f??(m==null?void 0:m.isRequired),s=p??(m==null?void 0:m.isInvalid),[l,P]=a.useState(!1),[v,I]=a.useState(!1),[x,W]=a.useState(!1),[L,T]=a.useState(!1),[$,z]=a.useState(!!c),O=typeof r<"u",F=O?r:$;a.useEffect(()=>Ae(P),[]);const B=a.useCallback(i=>{if(u||n){i.preventDefault();return}O||z(i.target.checked),g==null||g(i)},[O,n,u,g]),A=a.useCallback(i=>{i.key===" "&&T(!0)},[T]),U=a.useCallback(i=>{i.key===" "&&T(!1)},[T]),oe=a.useCallback((i={},H=null)=>({...i,ref:H,"data-active":y(L),"data-hover":y(x),"data-disabled":y(n),"data-invalid":y(s),"data-checked":y(F),"data-focus":y(v),"data-focus-visible":y(v&&l),"data-readonly":y(u),"aria-hidden":!0,onMouseDown:E(i.onMouseDown,()=>T(!0)),onMouseUp:E(i.onMouseUp,()=>T(!1)),onMouseEnter:E(i.onMouseEnter,()=>W(!0)),onMouseLeave:E(i.onMouseLeave,()=>W(!1))}),[L,x,n,s,F,v,u,l]),{onFocus:se,onBlur:te}=m??{},pe=a.useCallback((i={},H=null)=>{const ae=n&&!o;return{...i,id:_,ref:H,type:"radio",name:w,value:C,onChange:E(i.onChange,B),onBlur:E(te,i.onBlur,()=>I(!1)),onFocus:E(se,i.onFocus,()=>I(!0)),onKeyDown:E(i.onKeyDown,A),onKeyUp:E(i.onKeyUp,U),checked:F,disabled:ae,readOnly:u,required:D,"aria-invalid":Y(s),"aria-disabled":Y(ae),"aria-required":Y(D),"data-readonly":y(u),"aria-describedby":b,style:Ue}},[n,o,_,w,C,B,te,se,A,U,F,u,D,s,b]);return{state:{isInvalid:s,isFocused:v,isChecked:F,isActive:L,isHovered:x,isDisabled:n,isReadOnly:u,isRequired:D},getCheckboxProps:oe,getRadioProps:oe,getInputProps:pe,getLabelProps:(i={},H=null)=>({...i,ref:H,onMouseDown:E(i.onMouseDown,Qe),"data-disabled":y(n),"data-checked":y(F),"data-invalid":y(s)}),getRootProps:(i,H=null)=>({...i,ref:H,"data-disabled":y(n),"data-checked":y(F),"data-invalid":y(s)}),htmlProps:j}}function Qe(t){t.preventDefault(),t.stopPropagation()}function Ye(t,c){const r={},o={};for(const[d,h]of Object.entries(t))c.includes(d)?r[d]=h:o[d]=h;return[r,o]}var ee=Z((t,c)=>{var r;const o=he(),{onChange:d,value:h}=t,f=we("Radio",{...o,...t}),g=ie(t),{spacing:p="0.5rem",children:w,isDisabled:C=o==null?void 0:o.isDisabled,isFocusable:k=o==null?void 0:o.isFocusable,inputProps:S,...b}=g;let j=t.isChecked;(o==null?void 0:o.value)!=null&&h!=null&&(j=o.value===h);let M=d;o!=null&&o.onChange&&h!=null&&(M=ke(o.onChange,d));const m=(r=t==null?void 0:t.name)!=null?r:o==null?void 0:o.name,{getInputProps:N,getCheckboxProps:R,getLabelProps:V,getRootProps:_,htmlProps:n}=Je({...b,isChecked:j,isFocusable:k,isDisabled:C,onChange:M,name:m}),[u,D]=Ye(n,be),s=R(D),l=N(S,c),P=V(),v=Object.assign({},u,_()),I={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...f.container},x={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...f.control},W={userSelect:"none",marginStart:p,...f.label};return e.jsxs(G.label,{className:"chakra-radio",...v,__css:I,children:[e.jsx("input",{className:"chakra-radio__input",...l}),e.jsx(G.span,{className:"chakra-radio__control",...s,__css:x}),w&&e.jsx(G.span,{className:"chakra-radio__label",...P,__css:W,children:w})]})});ee.displayName="Radio";var Xe=Ie("cloud","IconCloud",[["path",{d:"M6.657 18c-2.572 0 -4.657 -2.007 -4.657 -4.483c0 -2.475 2.085 -4.482 4.657 -4.482c.393 -1.762 1.794 -3.2 3.675 -3.773c1.88 -.572 3.956 -.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486c0 1.927 -1.551 3.487 -3.465 3.487h-11.878",key:"svg-0"}]]);function Ze({options:t,value:c,onChange:r}){const[o,d]=a.useState(!1),h=a.useRef(null),f=t.find(p=>p.value===c);a.useEffect(()=>{const p=w=>{h.current&&!h.current.contains(w.target)&&d(!1)};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[h]);const g=()=>d(!o);return e.jsxs(Pe,{position:"relative",children:[e.jsx(K,{onClick:g,rightIcon:e.jsx(Re,{}),leftIcon:f==null?void 0:f.icon,children:f==null?void 0:f.label}),o&&e.jsx(_e,{gap:4,ref:h,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:t.map(p=>e.jsx(K,{onClick:()=>{d(!1),r(p.value)},leftIcon:p.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:p.label},p.label))})]})}function eo({version:t,cloudHost:c,cloudWorkflowID:r}){const o=t,d=e.jsxs(Q,{spacing:4,alignItems:"center",children:[e.jsx(X,{children:o.name}),e.jsx(X,{color:"GrayText",children:Fe(o.createTime,!1)}),o.cloudID&&r&&e.jsx("a",{href:c+"/workflow/"+r+"/"+o.cloudID,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsx(K,{size:"xs",colorScheme:"teal",variant:"outline",leftIcon:e.jsx(Xe,{}),rightIcon:e.jsx(de,{size:18}),children:"Shared"})})]});return t.cloudID?e.jsx(e.Fragment,{children:d}):e.jsx(ee,{value:o.id,mb:5,children:d},o.id)}function fo({onClose:t}){var u,D;const[c,r]=a.useState("version "+oo()),[o,d]=a.useState([]),[h,f]=a.useState(!1),[g,p]=a.useState(""),[w,C]=a.useState("PRIVATE"),[k,S]=a.useState("new_version"),b=a.useRef(""),[j,M]=a.useState(),m=Ee(),N=async s=>{var W,L;const l=s.data;if(s.origin!==b.current||l.type!=="share_workflow_success")return;const P=l.localWorkflowID,v=l.localVersionID,I=l.version.id,x=l.version.workflowID;x&&P&&await((W=q)==null?void 0:W.updateMetaInfo(P,{cloudID:x,cloudOrigin:s.origin,privacy:w})),v&&I&&await((L=J)==null?void 0:L.update(v,{cloudID:I,cloudOrigin:s.origin})),R(),window.open(b.current+"/workflow/"+x+"/"+I,"_blank"),f(!1)};a.useEffect(()=>(R(),window.addEventListener("message",N),()=>{window.removeEventListener("message",N)}),[]);const R=async()=>{var P,v,I;const s=await((P=le)==null?void 0:P.getSetting("cloudHost"));s&&(p(s),b.current=s);const l=((v=q)==null?void 0:v.curWorkflow)??void 0;M(l),l!=null&&l.cloudID&&l.cloudOrigin&&Be(l).then(x=>{C(x)}),(I=J)==null||I.listByWorkflowID(l.id).then(x=>{d(x)})},V=s=>{navigator.clipboard.writeText(s).then(()=>{m({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(l=>{console.error("Failed to copy text: ",l)})},_=async()=>{var z,O,F;f(!0);const s=Le(32),l=await((z=le)==null?void 0:z.getSetting("cloudHost"));let P,v;try{if(P=Te(),k==="new_version"?v=await((O=J)==null?void 0:O.add({workflowID:j.id,name:c,createTime:Date.now(),json:JSON.stringify(Oe.graph.serialize())})):v=await((F=J)==null?void 0:F.get(k)),!v){alert(`Failed to find version: ${k}, please try again.`),f(!1);return}}catch(B){console.error(B),f(!1),alert("Failed to share workflow, please try again.");return}const I=window.location.protocol,x=window.location.host,W=`${I}//${x}`,L=l+`/share_workflow_confirm/${s}?redirectUrl=${W}`,T=window.open(L,"Share Workflow","width=800,height=800"),$=B=>{var A;if(B.origin===l&&B.data==="child_ready"){const U=(A=q)==null?void 0:A.curWorkflow;T.postMessage({workflow:U,version:v,nodeDefs:P,privacy:w},l),window.removeEventListener("message",$)}};window.addEventListener("message",$)},n=(D=(u=q)==null?void 0:u.curWorkflow)==null?void 0:D.cloudID;return e.jsxs(xe,{isOpen:!0,onClose:t,size:"lg",children:[e.jsx(ye,{}),e.jsxs(Ce,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsxs(Se,{children:['Share "',j==null?void 0:j.name,'"']}),e.jsxs(je,{pb:10,children:[e.jsxs(re,{gap:5,children:[n==null?e.jsx(Ze,{options:Me,value:w,onChange:s=>{C(s)}}):e.jsx(He,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(Ve,{privacy:w,showEmoji:!0})}),n&&e.jsxs(Q,{spacing:2,color:"teal.400",children:[e.jsxs(qe,{href:g+"/workflow/"+n,isExternal:!0,children:[g+"/workflow/"+n," ",e.jsx(de,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(K,{width:"180px",size:"sm",leftIcon:e.jsx(Ge,{}),onClick:()=>{var s,l;V(g+"/workflow/"+((l=(s=q)==null?void 0:s.curWorkflow)==null?void 0:l.cloudID))},children:"Copy link"})]}),e.jsx(X,{children:"Choose a version to share:"}),e.jsx(fe,{gap:4,onChange:s=>{S(s)},value:k,children:e.jsxs(re,{children:[e.jsxs(Q,{mb:5,alignItems:"center",children:[e.jsx(ee,{value:"new_version"},"new_version"),e.jsx(Ne,{value:c,width:"60%",onFocus:()=>{S("new_version")},onChange:s=>{r(s.target.value)}}),e.jsx(We,{color:"green",children:e.jsx(ue,{colorScheme:"purple",children:"New version"})})]}),o.slice(0,4).map(s=>e.jsx(eo,{version:s,cloudHost:g,cloudWorkflowID:n??null},s.id))]})})]}),e.jsx(Q,{justifyContent:"flex-end",mt:16,children:e.jsx(K,{colorScheme:"teal",onClick:_,isDisabled:h,children:h?"Sharing":"Share"})})]})]})]})}function oo(){const t=new Date,c=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${c}-${r}-${o}`}export{fo as default};
