import{r as d,d as Se,y as Wt,m as be,b as ct,f as V,l as ut,o as Ae,E as Yt,j as r,g as E,h as dt,p as Xt,W as ht,i as ft,M as Zt,N as qt,O as Jt,Q as Qt,R as en,S as tn}from"./input.js";import{a9 as nn,aa as sn,d as Fe,F as v,ab as rn,ac as on,I as M,j as an,g as Ee,B as xt,h as W,Z as oe,ad as ln,x as A,H as Y,i as F,w as mt,a2 as pt,e as gt,a1 as $,ae as cn,y as un}from"./App-hrcUHChT.js";import{c as je,p as dn,r as st,v as rt,I as hn,N as fn,a as xn,b as mn,d as pn,e as gn,M as vt,u as vn,S as yn}from"./MediaPreview-e1lXgf4Q.js";import{S as wn}from"./chunk-3RSXBRAN-SaXgh8_S.js";import{u as Sn,C as $e,G as bn}from"./chunk-JARCRF6W-vkQKHTn8.js";import{app as ot}from"/scripts/app.js";import{L as Ne}from"./chunk-K7XRJ7NL-Vyo84f0U.js";import"/scripts/api.js";import"./IconSearch-cyoB12iB.js";import"./index-pz0vT7Or.js";const yt=1/60*1e3,jn=typeof performance<"u"?()=>performance.now():()=>Date.now(),wt=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(jn()),yt);function kn(e){let t=[],s=[],n=0,o=!1,a=!1;const l=new WeakSet,c={schedule:(i,u=!1,x=!1)=>{const f=x&&o,g=f?t:s;return u&&l.add(i),g.indexOf(i)===-1&&(g.push(i),f&&o&&(n=t.length)),i},cancel:i=>{const u=s.indexOf(i);u!==-1&&s.splice(u,1),l.delete(i)},process:i=>{if(o){a=!0;return}if(o=!0,[t,s]=[s,t],s.length=0,n=t.length,n)for(let u=0;u<n;u++){const x=t[u];x(i),l.has(x)&&(c.schedule(x),e())}o=!1,a&&(a=!1,c.process(i))}};return c}const Pn=40;let _e=!0,X=!1,Me=!1;const O={delta:0,timestamp:0},Z=["read","update","preRender","render","postRender"],ae=Z.reduce((e,t)=>(e[t]=kn(()=>X=!0),e),{}),Cn=Z.reduce((e,t)=>{const s=ae[t];return e[t]=(n,o=!1,a=!1)=>(X||En(),s.schedule(n,o,a)),e},{}),In=Z.reduce((e,t)=>(e[t]=ae[t].cancel,e),{});Z.reduce((e,t)=>(e[t]=()=>ae[t].process(O),e),{});const Tn=e=>ae[e].process(O),St=e=>{X=!1,O.delta=_e?yt:Math.max(Math.min(e-O.timestamp,Pn),1),O.timestamp=e,Me=!0,Z.forEach(Tn),Me=!1,X&&(_e=!1,wt(St))},En=()=>{X=!0,_e=!0,Me||wt(St)},at=()=>O;var L=e=>e?"":void 0,ke=e=>e?!0:void 0,q=(...e)=>e.filter(Boolean).join(" ");function Pe(...e){return function(s){e.some(n=>(n==null||n(s),s==null?void 0:s.defaultPrevented))}}function Q(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}var te={width:0,height:0},ee=e=>e||te;function Nn(e){const{orientation:t,thumbPercents:s,thumbRects:n,isReversed:o}=e,a=y=>{var w;const N=(w=n[y])!=null?w:te;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...Q({orientation:t,vertical:{bottom:`calc(${s[y]}% - ${N.height/2}px)`},horizontal:{left:`calc(${s[y]}% - ${N.width/2}px)`}})}},l=t==="vertical"?n.reduce((y,w)=>ee(y).height>ee(w).height?y:w,te):n.reduce((y,w)=>ee(y).width>ee(w).width?y:w,te),c={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...Q({orientation:t,vertical:l?{paddingLeft:l.width/2,paddingRight:l.width/2}:{},horizontal:l?{paddingTop:l.height/2,paddingBottom:l.height/2}:{}})},i={position:"absolute",...Q({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},u=s.length===1,x=[0,o?100-s[0]:s[0]],f=u?x:s;let g=f[0];!u&&o&&(g=100-g);const p=Math.abs(f[f.length-1]-f[0]),k={...i,...Q({orientation:t,vertical:o?{height:`${p}%`,top:`${g}%`}:{height:`${p}%`,bottom:`${g}%`},horizontal:o?{width:`${p}%`,right:`${g}%`}:{width:`${p}%`,left:`${g}%`}})};return{trackStyle:i,innerTrackStyle:k,rootStyle:c,getThumbStyle:a}}function _n(e){const{isReversed:t,direction:s,orientation:n}=e;return s==="ltr"||n==="vertical"?t:!t}function Mn(e,t,s,n){return e.addEventListener(t,s,n),()=>{e.removeEventListener(t,s,n)}}function Dn(e){const t=Rn(e);return typeof t.PointerEvent<"u"&&e instanceof t.PointerEvent?e.pointerType==="mouse":e instanceof t.MouseEvent}function bt(e){return!!e.touches}function zn(e){return bt(e)&&e.touches.length>1}function Rn(e){var t;return(t=e.view)!=null?t:window}function An(e,t="page"){const s=e.touches[0]||e.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function Fn(e,t="page"){return{x:e[`${t}X`],y:e[`${t}Y`]}}function jt(e,t="page"){return bt(e)?An(e,t):Fn(e,t)}function $n(e){return t=>{const s=Dn(t);(!s||s&&t.button===0)&&e(t)}}function Vn(e,t=!1){function s(o){e(o,{point:jt(o)})}return t?$n(s):s}function ne(e,t,s,n){return Mn(e,t,Vn(s,t==="pointerdown"),n)}var Bn=Object.defineProperty,Ln=(e,t,s)=>t in e?Bn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,T=(e,t,s)=>(Ln(e,typeof t!="symbol"?t+"":t,s),s),On=class{constructor(e,t,s){T(this,"history",[]),T(this,"startEvent",null),T(this,"lastEvent",null),T(this,"lastEventInfo",null),T(this,"handlers",{}),T(this,"removeListeners",()=>{}),T(this,"threshold",3),T(this,"win"),T(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const c=Ce(this.lastEventInfo,this.history),i=this.startEvent!==null,u=Kn(c.offset,{x:0,y:0})>=this.threshold;if(!i&&!u)return;const{timestamp:x}=at();this.history.push({...c.point,timestamp:x});const{onStart:f,onMove:g}=this.handlers;i||(f==null||f(this.lastEvent,c),this.startEvent=this.lastEvent),g==null||g(this.lastEvent,c)}),T(this,"onPointerMove",(c,i)=>{this.lastEvent=c,this.lastEventInfo=i,Cn.update(this.updatePoint,!0)}),T(this,"onPointerUp",(c,i)=>{const u=Ce(i,this.history),{onEnd:x,onSessionEnd:f}=this.handlers;f==null||f(c,u),this.end(),!(!x||!this.startEvent)&&(x==null||x(c,u))});var n;if(this.win=(n=e.view)!=null?n:window,zn(e))return;this.handlers=t,s&&(this.threshold=s),e.stopPropagation(),e.preventDefault();const o={point:jt(e)},{timestamp:a}=at();this.history=[{...o.point,timestamp:a}];const{onSessionStart:l}=t;l==null||l(e,Ce(o,this.history)),this.removeListeners=Hn(ne(this.win,"pointermove",this.onPointerMove),ne(this.win,"pointerup",this.onPointerUp),ne(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),In.update(this.updatePoint)}};function lt(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ce(e,t){return{point:e.point,delta:lt(e.point,t[t.length-1]),offset:lt(e.point,t[0]),velocity:Un(t,.1)}}var Gn=e=>e*1e3;function Un(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,n=null;const o=e[e.length-1];for(;s>=0&&(n=e[s],!(o.timestamp-n.timestamp>Gn(t)));)s--;if(!n)return{x:0,y:0};const a=(o.timestamp-n.timestamp)/1e3;if(a===0)return{x:0,y:0};const l={x:(o.x-n.x)/a,y:(o.y-n.y)/a};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}function Hn(...e){return t=>e.reduce((s,n)=>n(s),t)}function Ie(e,t){return Math.abs(e-t)}function it(e){return"x"in e&&"y"in e}function Kn(e,t){if(typeof e=="number"&&typeof t=="number")return Ie(e,t);if(it(e)&&it(t)){const s=Ie(e.x,t.x),n=Ie(e.y,t.y);return Math.sqrt(s**2+n**2)}return 0}function kt(e){const t=d.useRef(null);return t.current=e,t}function Wn(e,t){const{onPan:s,onPanStart:n,onPanEnd:o,onPanSessionStart:a,onPanSessionEnd:l,threshold:c}=t,i=!!(s||n||o||a||l),u=d.useRef(null),x=kt({onSessionStart:a,onSessionEnd:l,onStart:n,onMove:s,onEnd(f,g){u.current=null,o==null||o(f,g)}});d.useEffect(()=>{var f;(f=u.current)==null||f.updateHandlers(x.current)}),d.useEffect(()=>{const f=e.current;if(!f||!i)return;function g(p){u.current=new On(p,x.current,c)}return ne(f,"pointerdown",g)},[e,i,x,c]),d.useEffect(()=>()=>{var f;(f=u.current)==null||f.end(),u.current=null},[])}function Yn(e,t){if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const s=e.ownerDocument.defaultView??window,n=new s.ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const[a]=o;let l,c;if("borderBoxSize"in a){const i=a.borderBoxSize,u=Array.isArray(i)?i[0]:i;l=u.inlineSize,c=u.blockSize}else l=e.offsetWidth,c=e.offsetHeight;t({width:l,height:c})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}var Xn=globalThis!=null&&globalThis.document?d.useLayoutEffect:d.useEffect;function Zn(e,t){var s,n;if(!e||!e.parentElement)return;const o=(n=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?n:window,a=new o.MutationObserver(()=>{t()});return a.observe(e.parentElement,{childList:!0}),()=>{a.disconnect()}}function qn({getNodes:e,observeMutation:t=!0}){const[s,n]=d.useState([]),[o,a]=d.useState(0);return Xn(()=>{const l=e(),c=l.map((i,u)=>Yn(i,x=>{n(f=>[...f.slice(0,u),x,...f.slice(u+1)])}));if(t){const i=l[0];c.push(Zn(i,()=>{a(u=>u+1)}))}return()=>{c.forEach(i=>{i==null||i()})}},[o]),s}function Jn(e){return typeof e=="object"&&e!==null&&"current"in e}function Qn(e){const[t]=qn({observeMutation:!1,getNodes(){return[Jn(e)?e.current:e]}});return t}function es(e){var t;const{min:s=0,max:n=100,onChange:o,value:a,defaultValue:l,isReversed:c,direction:i="ltr",orientation:u="horizontal",id:x,isDisabled:f,isReadOnly:g,onChangeStart:p,onChangeEnd:k,step:y=1,getAriaValueText:w,"aria-valuetext":N,"aria-label":B,"aria-labelledby":b,name:D,focusThumbOnChange:Dt=!0,...Ve}=e,Be=Se(p),G=Se(k),Le=Se(w),I=_n({isReversed:c,direction:i,orientation:u}),[zt,de]=nn({value:a,defaultValue:l??ns(s,n),onChange:o}),[he,Oe]=d.useState(!1),[fe,Ge]=d.useState(!1),xe=!(f||g),me=(n-s)/10,U=y||(n-s)/100,S=je(zt,s,n),Rt=n-S+s,Ue=rt(I?Rt:S,s,n),J=u==="vertical",j=kt({min:s,max:n,step:y,isDisabled:f,value:S,isInteractive:xe,isReversed:I,isVertical:J,eventSource:null,focusThumbOnChange:Dt,orientation:u}),pe=d.useRef(null),ge=d.useRef(null),He=d.useRef(null),At=d.useId(),Ke=x??At,[We,Ye]=[`slider-thumb-${Ke}`,`slider-track-${Ke}`],Ft=d.useCallback(h=>{var m,H;if(!pe.current)return;const P=j.current;P.eventSource="pointer";const _=pe.current.getBoundingClientRect(),{clientX:ye,clientY:Ut}=(H=(m=h.touches)==null?void 0:m[0])!=null?H:h,Ht=J?_.bottom-Ut:ye-_.left,Kt=J?_.height:_.width;let we=Ht/Kt;I&&(we=1-we);let K=dn(we,P.min,P.max);return P.step&&(K=parseFloat(st(K,P.min,P.step))),K=je(K,P.min,P.max),K},[J,I,j]),z=d.useCallback(h=>{const m=j.current;m.isInteractive&&(h=parseFloat(st(h,m.min,U)),h=je(h,m.min,m.max),de(h))},[U,de,j]),R=d.useMemo(()=>({stepUp(h=U){const m=I?S-h:S+h;z(m)},stepDown(h=U){const m=I?S+h:S-h;z(m)},reset(){z(l||0)},stepTo(h){z(h)}}),[z,I,S,U,l]),Xe=d.useCallback(h=>{const m=j.current,P={ArrowRight:()=>R.stepUp(),ArrowUp:()=>R.stepUp(),ArrowLeft:()=>R.stepDown(),ArrowDown:()=>R.stepDown(),PageUp:()=>R.stepUp(me),PageDown:()=>R.stepDown(me),Home:()=>z(m.min),End:()=>z(m.max)}[h.key];P&&(h.preventDefault(),h.stopPropagation(),P(h),m.eventSource="keyboard")},[R,z,me,j]),Ze=(t=Le==null?void 0:Le(S))!=null?t:N,ve=Qn(ge),{getThumbStyle:qe,rootStyle:Je,trackStyle:Qe,innerTrackStyle:et}=d.useMemo(()=>{const h=j.current,m=ve??{width:0,height:0};return Nn({isReversed:I,orientation:h.orientation,thumbRects:[m],thumbPercents:[Ue]})},[I,ve,Ue,j]),tt=d.useCallback(()=>{j.current.focusThumbOnChange&&setTimeout(()=>{var m;return(m=ge.current)==null?void 0:m.focus()})},[j]);Wt(()=>{const h=j.current;tt(),h.eventSource==="keyboard"&&(G==null||G(h.value))},[S,G]);function nt(h){const m=Ft(h);m!=null&&m!==j.current.value&&de(m)}Wn(He,{onPanSessionStart(h){const m=j.current;m.isInteractive&&(Oe(!0),tt(),nt(h),Be==null||Be(m.value))},onPanSessionEnd(){const h=j.current;h.isInteractive&&(Oe(!1),G==null||G(h.value))},onPan(h){j.current.isInteractive&&nt(h)}});const $t=d.useCallback((h={},m=null)=>({...h,...Ve,ref:be(m,He),tabIndex:-1,"aria-disabled":ke(f),"data-focused":L(fe),style:{...h.style,...Je}}),[Ve,f,fe,Je]),Vt=d.useCallback((h={},m=null)=>({...h,ref:be(m,pe),id:Ye,"data-disabled":L(f),style:{...h.style,...Qe}}),[f,Ye,Qe]),Bt=d.useCallback((h={},m=null)=>({...h,ref:m,style:{...h.style,...et}}),[et]),Lt=d.useCallback((h={},m=null)=>({...h,ref:be(m,ge),role:"slider",tabIndex:xe?0:void 0,id:We,"data-active":L(he),"aria-valuetext":Ze,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":S,"aria-orientation":u,"aria-disabled":ke(f),"aria-readonly":ke(g),"aria-label":B,"aria-labelledby":B?void 0:b,style:{...h.style,...qe(0)},onKeyDown:Pe(h.onKeyDown,Xe),onFocus:Pe(h.onFocus,()=>Ge(!0)),onBlur:Pe(h.onBlur,()=>Ge(!1))}),[xe,We,he,Ze,s,n,S,u,f,g,B,b,qe,Xe]),Ot=d.useCallback((h,m=null)=>{const H=!(h.value<s||h.value>n),P=S>=h.value,_=rt(h.value,s,n),ye={position:"absolute",pointerEvents:"none",...ts({orientation:u,vertical:{bottom:I?`${100-_}%`:`${_}%`},horizontal:{left:I?`${100-_}%`:`${_}%`}})};return{...h,ref:m,role:"presentation","aria-hidden":!0,"data-disabled":L(f),"data-invalid":L(!H),"data-highlighted":L(P),style:{...h.style,...ye}}},[f,I,n,s,u,S]),Gt=d.useCallback((h={},m=null)=>({...h,ref:m,type:"hidden",value:S,name:D}),[D,S]);return{state:{value:S,isFocused:fe,isDragging:he},actions:R,getRootProps:$t,getTrackProps:Vt,getInnerTrackProps:Bt,getThumbProps:Lt,getMarkerProps:Ot,getInputProps:Gt}}function ts(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}function ns(e,t){return t<e?e:e+(t-e)/2}var[ss,le]=ct({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[rs,ie]=ct({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),Pt=V((e,t)=>{var s;const n={...e,orientation:(s=e==null?void 0:e.orientation)!=null?s:"horizontal"},o=ut("Slider",n),a=Ae(n),{direction:l}=Yt();a.direction=l;const{getInputProps:c,getRootProps:i,...u}=es(a),x=i(),f=c({},t);return r.jsx(ss,{value:u,children:r.jsx(rs,{value:o,children:r.jsxs(E.div,{...x,className:q("chakra-slider",n.className),__css:o.container,children:[n.children,r.jsx("input",{...f})]})})})});Pt.displayName="Slider";var Ct=V((e,t)=>{const{getThumbProps:s}=le(),n=ie(),o=s(e,t);return r.jsx(E.div,{...o,className:q("chakra-slider__thumb",e.className),__css:n.thumb})});Ct.displayName="SliderThumb";var It=V((e,t)=>{const{getTrackProps:s}=le(),n=ie(),o=s(e,t);return r.jsx(E.div,{...o,className:q("chakra-slider__track",e.className),__css:n.track})});It.displayName="SliderTrack";var Tt=V((e,t)=>{const{getInnerTrackProps:s}=le(),n=ie(),o=s(e,t);return r.jsx(E.div,{...o,className:q("chakra-slider__filled-track",e.className),__css:n.filledTrack})});Tt.displayName="SliderFilledTrack";var os=V((e,t)=>{const{getMarkerProps:s}=le(),n=ie(),o=s(e,t);return r.jsx(E.div,{...o,className:q("chakra-slider__marker",e.className),__css:n.mark})});os.displayName="SliderMark";var De=V(function(t,s){const n=ut("Switch",t),{spacing:o="0.5rem",children:a,...l}=Ae(t),{getIndicatorProps:c,getInputProps:i,getCheckboxProps:u,getRootProps:x,getLabelProps:f}=Sn(l),g=d.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...n.container}),[n.container]),p=d.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...n.track}),[n.track]),k=d.useMemo(()=>({userSelect:"none",marginStart:o,...n.label}),[o,n.label]);return r.jsxs(E.label,{...x(),className:dt("chakra-switch",t.className),__css:g,children:[r.jsx("input",{className:"chakra-switch__input",...i({},s)}),r.jsx(E.span,{...u(),className:"chakra-switch__track",__css:p,children:r.jsx(E.span,{__css:n.thumb,className:"chakra-switch__thumb",...c()})}),a&&r.jsx(E.span,{className:"chakra-switch__label",...f(),__css:k,children:a})]})});De.displayName="Switch";function as(e,t=[]){const s=Object.assign({},e);for(const n of t)n in s&&delete s[n];return s}var ls=["h","minH","height","minHeight"],Et=V((e,t)=>{const s=Xt("Textarea",e),{className:n,rows:o,...a}=Ae(e),l=sn(a),c=o?as(s,ls):s;return r.jsx(E.textarea,{ref:t,rows:o,...l,className:dt("chakra-textarea",n),__css:c})});Et.displayName="Textarea";var is=Fe("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),Nt=Fe("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),_t=Fe("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);const cs=({setMediaAct:e,media:t,currentNum:s})=>{const n=l=>{const c=(s+l+t.length)%t.length;e&&e(t[c])},o={width:"100%",height:"100%"};if(t.length===0)return r.jsx("p",{children:"No images found, let's start generating 🪄"});const a=t.at(s);return a?r.jsxs(v,{justifyContent:"center",alignItems:"center",position:"relative",width:o.width,height:o.height,overflow:"hidden",children:[r.jsx("div",{style:{position:"absolute",cursor:"pointer",width:"100%",height:"100%"},onClick:()=>{window.open(a.imageUrl)},children:rn(a.imageUrl)?r.jsx(on,{src:a.imageUrl,alt:`image-${a.id}`,width:"100%",height:"100%",objectFit:"contain"}):r.jsx("video",{style:{objectFit:"contain"},width:"100%",height:"100%",src:a.imageUrl,loop:!0,autoPlay:!0,muted:!0,children:r.jsx("track",{kind:"captions"})})},a.id),r.jsx(M,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Previous image",icon:r.jsx(is,{}),onClick:()=>n(-1),position:"absolute",left:"0",zIndex:"2"}),r.jsx(M,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Next image",icon:r.jsx(hn,{}),onClick:()=>n(1),position:"absolute",right:"0",zIndex:"2"})]}):null},us=({inputItem:e})=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.label??e.inputName}),r.jsx(an,{value:e.inputValue,onChange:t=>{}})]}),ds=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsxs(fn,{width:"100%",step:e==null?void 0:e.step,value:t.inputValue,min:e==null?void 0:e.min,max:e==null?void 0:e.max,onChange:s=>{},children:[r.jsx(xn,{}),r.jsxs(mn,{children:[r.jsx(pn,{}),r.jsx(gn,{})]})]})]}),r.jsx(v,{children:r.jsxs(Pt,{maxWidth:"400px",step:e==null?void 0:e.step,value:Number(t.inputValue),min:(e==null?void 0:e.min)??0,max:(e==null?void 0:e.max)??100,onChange:s=>{},children:[r.jsx(It,{children:r.jsx(Tt,{})}),r.jsx(Ct,{})]})})]})},hs=e=>{var s;const{inputItem:t}=e;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx(wn,{value:t.inputValue,onChange:n=>{},children:(s=e==null?void 0:e.options)==null?void 0:s.map((n,o)=>r.jsx("option",{value:n,children:n},`select${t.nodeID}${t.inputName}${o}`))})]})},fs=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsx(v,{children:t.label??t.inputName}),r.jsx(Et,{value:t.inputValue,onChange:s=>{},rows:5})]})};var C=(e=>(e.Input="Input",e.InputSlider="InputSlider",e.Select="Select",e.Textarea="Textarea",e.Checkbox="Checkbox",e.NoSupport="NoSupport",e))(C||{});const xs=e=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.inputItem.label??e.inputItem.inputName}),r.jsx(v,{children:"No Support"})]}),ms=e=>{const t=e.inputItem;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx($e,{defaultChecked:!!t.inputValue,onChange:s=>{var n;(n=e==null?void 0:e.updateMetaData)==null||n.call(e,{promptKey:e.promptKey,name:e.name,value:s.target.checked})}})]})},ce=d.createContext({topFields:[],calcInputList:[],showNodeName:!1,updateTopField(){}}),ps={[C.Input]:us,[C.InputSlider]:ds,[C.Select]:hs,[C.Textarea]:fs,[C.Checkbox]:ms,NoSupport:xs},gs=LiteGraph.registered_node_types;function vs(e,t){var o,a,l,c,i;const s=(o=gs[e])==null?void 0:o.nodeData,n={...((a=s==null?void 0:s.input)==null?void 0:a.required)??{},...((l=s==null?void 0:s.input)==null?void 0:l.optional)??{}}[t];return(n==null?void 0:n[0])==="STRING"?(c=n==null?void 0:n[1])!=null&&c.multiline?{type:C.Textarea}:{type:C.Input}:(n==null?void 0:n[0])==="BOOLEAN"?{type:C.Checkbox}:(n==null?void 0:n[0])==="FLOAT"?{...(n==null?void 0:n[1])??{},type:C.InputSlider}:(n==null?void 0:n[0])==="INT"?{...(n==null?void 0:n[1])??{},type:C.InputSlider}:Array.isArray(n==null?void 0:n[0])&&((i=n==null?void 0:n[0])!=null&&i.every(u=>typeof u=="string"))?{options:n==null?void 0:n[0],type:C.Select}:{type:C.NoSupport}}const ze=({inputItem:e})=>{const t=vs(e.classType,e.inputName),[s,n]=d.useState(!1),o=ps[t.type??"Input"],{updateTopField:a,topFields:l}=d.useContext(ce),c=e.children[0]==="negative"||e.children[0]==="positive"?`-${e.children[0]}`:"",i={...e,label:e.label??e.inputName+c};return r.jsxs(v,{alignItems:"center",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[r.jsx(M,{size:"xs",onClick:()=>a==null?void 0:a({name:e.inputName,promptKey:e.nodeID,class_type:e.classType}),variant:"ghost",icon:re(l,{name:e.inputName,promptKey:e.nodeID,classType:e.classType})?r.jsx(Nt,{size:14}):r.jsx(_t,{size:14}),"aria-label":"pin"}),r.jsx("div",{style:{flex:1},children:r.jsx(o,{inputItem:i,...t})})]})};function ys(){const{topFields:e,updateTopField:t,calcInputList:s}=d.useContext(ce);return e.length===0?null:r.jsx(r.Fragment,{children:r.jsx(v,{px:2,gap:2,direction:"column",children:e==null?void 0:e.map(n=>{const o=s.find(a=>a.nodeID==n.promptKey&&a.inputName===n.name&&a.classType===n.class_type);return!n.class_type||!o?null:r.jsx(ze,{inputItem:o},`formTopField${n.promptKey}${n.name}`)})})})}function ws(){const{topFields:e,calcInputList:t,showNodeName:s}=d.useContext(ce),n=d.useCallback(a=>{const l=[];return a.forEach(c=>{const i=l[l.length-1];!i||i[0].nodeID!==c.nodeID||i[0].classType!==c.classType?l.push([c]):i.push(c)}),l},[]);if(d.useEffect(()=>{},[s]),!s)return r.jsx(Ee,{children:t.map(a=>re(e,{name:a.inputName,promptKey:a.nodeID,classType:a.classType})?null:r.jsx(ze,{inputItem:a},`form${a.nodeID}${a.inputName}`))});const o=n(t);return r.jsx(Ee,{children:o.map(a=>a[0]?r.jsx(Ss,{title:a[0].classType+" #"+a[0].nodeID,children:r.jsx(v,{px:2,gap:1,direction:"column",children:a.map(l=>re(e,{name:l.inputName,promptKey:l.nodeID,classType:l.classType})?null:r.jsx(ze,{inputItem:l},`form${l.nodeID}${l.inputName}`))})},a[0].nodeID):null)})}function Ss({title:e,children:t}){return r.jsxs(xt,{border:"1px",borderColor:"gray.500",borderRadius:"md",p:4,children:[r.jsx(W,{size:"sm",mb:1,color:"GrayText",children:e}),r.jsx("div",{children:t})]})}let se=[],Re=new Set;function Mt(e,t){if(!Re.has(e.nodeID))return Re.add(e.nodeID),Object.entries(e.inputs).forEach(([s,n])=>{if(Array.isArray(n)){const o=n[0];Mt(t[o],t)}}),Object.entries(e.inputs).forEach(([s,n])=>{Array.isArray(n)||se.push({classType:e.class_type,inputName:s,inputValue:n,nodeID:e.nodeID,children:e.children||[]})}),se}function bs(e){se=[],Re=new Set;for(const t of Object.keys(e))e[t].nodeID=t,Object.entries(e[t].inputs).forEach(([s,n])=>{if(Array.isArray(n)){const o=n[0],a=e[o];a.children||(a.children=[]),a.children.push(s)}});for(const t of Object.keys(e))Mt(e[t],e);return se}const re=(e,t)=>e==null?void 0:e.some(s=>s.promptKey===(t==null?void 0:t.promptKey)&&s.name===(t==null?void 0:t.name)&&s.class_type===t.classType);function js({media:e}){const[t,s]=d.useState([]),{curFlowID:n}=d.useContext(oe),[o,a]=d.useState(),[l,c]=d.useState(!0),[i,u]=d.useState(!0);d.useEffect(()=>{e?ln(`/workspace/view_media?filename=${e.localPath}`).then(p=>{a(p.prompt)}):ot.graphToPrompt(ot.graph).then(p=>{a(p.output)})},[e]),d.useEffect(()=>{if(!o)return;const p=bs(o);s(p)},[o]);const[x,f]=d.useState([]);d.useEffect(()=>{(async()=>{var p,k;if(n){const y=(k=await((p=A)==null?void 0:p.get(n)))==null?void 0:k.topFieldsConfig;y&&(f(y),c(!1))}})()},[n]);const g=p=>{var k,y;if(re(x,{name:p.name,promptKey:p==null?void 0:p.promptKey,classType:(p==null?void 0:p.class_type)??""})){const w=x.filter(N=>N.name!==p.name||N.promptKey!==p.promptKey);f(w),n&&((k=A)==null||k.updateTopFields(n,{topFieldsConfig:w}))}else{const w=[...x,p];f(w),n&&((y=A)==null||y.updateTopFields(n,{topFieldsConfig:w}))}};return r.jsx(ce.Provider,{value:{topFields:x,showNodeName:i,calcInputList:t,updateTopField:g},children:r.jsxs(v,{direction:"column",align:"stretch",gap:5,children:[r.jsx(ys,{}),r.jsxs(Y,{children:[r.jsx("p",{children:"Show all inputs"}),r.jsx(De,{isChecked:l,onChange:p=>c(!l)}),r.jsx("p",{children:"Show node names"}),r.jsx(De,{isChecked:i,onChange:p=>u(!i)})]}),l&&r.jsx(ws,{})]})})}const ue=d.createContext({showAllImages:!1,curMedia:null,setCurMedia(){},setMediaList(){},setShowAllImages(){}}),ks=({media:e})=>{var l,c;const[t,s]=d.useState(!1),{setMediaList:n}=d.useContext(ue),{loadFilePath:o}=d.useContext(oe),{showDialog:a}=ht();return d.useEffect(()=>{var i,u;s((e==null?void 0:e.localPath)!=null&&((u=(i=A)==null?void 0:i.curWorkflow)==null?void 0:u.coverMediaPath)===(e==null?void 0:e.localPath))},[e]),e?r.jsxs(v,{flexWrap:"wrap",gap:3,children:[r.jsx(v,{alignItems:"center",gap:2,children:e.localPath&&r.jsxs(r.Fragment,{children:[r.jsx(W,{children:e==null?void 0:e.localPath}),r.jsx(F,{label:"Donwload image from gallery",children:r.jsx(Ne,{href:`/workspace/view_media?filename=${e==null?void 0:e.localPath}`,download:e==null?void 0:e.localPath,children:r.jsx(M,{size:"sm",icon:r.jsx(mt,{size:19}),"aria-label":"donwload image from gallery"})})})]})}),r.jsx(v,{gap:1,alignItems:"center",color:"GrayText",children:!!(e!=null&&e.createTime)&&r.jsx(W,{children:pt((e==null?void 0:e.createTime)??0,!0)})}),r.jsx(F,{label:"Remove image from gallery",children:r.jsx(M,{size:"sm",variant:"ghost",icon:r.jsx(gt,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var u;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&(await((u=$)==null?void 0:u.delete(e.id)),n(x=>x.filter(f=>f.id!==e.id)))}})}),((c=(l=A)==null?void 0:l.curWorkflow)==null?void 0:c.id)&&r.jsx(F,{label:"Set as cover",children:r.jsx(M,{size:"sm",variant:"ghost",icon:t?r.jsx(Nt,{size:19}):r.jsx(_t,{size:19}),"aria-label":"set as cover",onClick:async()=>{var i;await((i=A)==null?void 0:i.updateMetaInfo(A.curWorkflow.id,{coverMediaPath:t?void 0:e.localPath})),s(!t)}})}),r.jsx(ft,{onClick:()=>a("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{o(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>o(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"})]}):null},Ps=({media:e})=>r.jsxs(v,{overflowY:"auto",mb:4,direction:"column",gap:2,flex:1,children:[r.jsx(ks,{media:e}),r.jsx(js,{media:e??null})]}),Te=120;function Cs({mediaList:e}){const{curMedia:t,setCurMedia:s}=d.useContext(ue);return r.jsxs(v,{gap:3,h:"100%",children:[r.jsxs(bn,{gridTemplateRows:e.length<=6?"1fr 20%":"1fr",flex:1,gap:2,children:[r.jsx("div",{style:{height:"56vh"},children:r.jsx(cs,{media:e.map(n=>({id:n.id,imageUrl:`/workspace/view_media?filename=${n.localPath}`})),currentNum:(e==null?void 0:e.findIndex(n=>n.id===(t==null?void 0:t.id)))??0,setMediaAct:n=>s((e==null?void 0:e.find(o=>o.id===n.id))??null)})}),r.jsx(v,{wrap:"wrap",children:e==null?void 0:e.map(n=>r.jsx(xt,{display:"inline-block",p:1,borderRadius:"4px",width:`${Te+3}px`,height:`${Te+3}px`,cursor:"pointer",border:(t==null?void 0:t.id)===n.id?"1px solid gray":"",onClick:()=>s(n),children:r.jsx(vt,{mediaLocalPath:n.localPath,size:Te,objectFit:"contain",hideBrokenImage:!0,onBrokenLink:()=>{var o;(o=$)==null||o.delete(n.id)}})},`image-bottom-${n.id}`))})]}),r.jsx(Ps,{media:t??void 0})]})}const Is=({media:e,isSelecting:t,selectedID:s,onClickMedia:n})=>{const{curFlowID:a,loadFilePath:l}=d.useContext(oe),{showDialog:c}=ht();if(e.localPath==null||a==null)return null;const i=r.jsxs(Ne,{isExternal:!0,onClick:()=>n(e),position:"relative",children:[t&&r.jsx($e,{isChecked:s.includes(e.id),position:"absolute",top:2,left:2}),r.jsx(vt,{mediaLocalPath:e.localPath,size:180,onBrokenLink:()=>{var u;(u=$)==null||u.delete(e.id)},hideBrokenImage:!0,autoPlay:!0,isPreview:!0})]});return r.jsxs(Ee,{width:180,mb:2,children:[r.jsx(F,{label:pt(e.createTime,!0),children:i}),r.jsx(F,{label:e.localPath,children:r.jsx(W,{color:"GrayText",noOfLines:1,children:e.localPath})}),r.jsxs(Y,{hidden:t,gap:0,children:[r.jsx(ft,{flexGrow:1,onClick:()=>c("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{l(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>l(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),r.jsx(F,{label:"Donwload image from gallery",children:r.jsx(Ne,{href:`/workspace/view_media?filename=${e.localPath}`,download:e.localPath,children:r.jsx(M,{size:"sm",variant:"ghost",icon:r.jsx(mt,{size:19}),"aria-label":"donwload image from gallery"})})}),r.jsx(F,{label:"Remove image from gallery",children:r.jsx(M,{size:"sm",variant:"ghost",icon:r.jsx(gt,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var x;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&await((x=$)==null?void 0:x.delete(e.id))}})})]})]})},Ts=Is;function Es({searchQuery:e}){const[t,s]=d.useState([]),{setCurMedia:n,setShowAllImages:o,setMediaList:a}=d.useContext(ue);d.useEffect(()=>{var c,i;e===""?(c=$)==null||c.listAll().then(u=>{s(u.slice(0,50)??[])}):(i=$)==null||i.filter(u=>{var x;return((x=u.workflowJSON)==null?void 0:x.includes(e))??!1}).then(u=>{s(u)})},[e]);const l=c=>{a([c].concat(t.filter(i=>i.id!==c.id))),n(c),o(!1)};return r.jsx(Y,{wrap:"wrap",children:t.map(c=>r.jsx(Ts,{selectedID:[],media:c,isSelecting:!1,onClickMedia:l},c.id))})}function Os({onclose:e}){const{curFlowID:t}=d.useContext(oe),[s,n]=d.useState(""),[o,a]=d.useState([]),[l,c]=d.useState(!1),[i,u]=d.useState([]),[x,f]=d.useState(),[g,p]=d.useState(""),k=vn(g,300),[y,w]=d.useState(!1),N=async()=>{var D;if(t==null)return;const b=await((D=$)==null?void 0:D.listByWorkflowID(t));u(b??[]),b!=null&&b.length&&f(b[0])};if(d.useEffect(()=>{var b;N(),t&&((b=A)==null||b.get(t).then(D=>{D&&n(D.name)}))},[]),t==null)return null;const B=i.length>0&&o.length===i.length;return r.jsx(ue.Provider,{value:{curMedia:x??null,setCurMedia:f,setMediaList:u,showAllImages:y,setShowAllImages:w},children:r.jsxs(Zt,{isOpen:!0,onClose:e,blockScrollOnMount:!0,children:[r.jsx(qt,{}),r.jsxs(Jt,{width:"90%",maxWidth:"90vw",height:"90vh",children:[r.jsxs(Qt,{children:[r.jsxs(Y,{gap:2,mb:2,children:[r.jsxs(cn,{size:"md",mr:2,children:["Gallery - ",s]}),r.jsx(yn,{searchValue:g,onUpdateSearchValue:b=>{p(b),y||w(!0)},placeholder:"Search prompt, model name, etc.",style:{width:"300px"}})]}),l&&r.jsxs(Y,{gap:3,children:[r.jsx($e,{isChecked:B,onChange:()=>{a(B?[]:i.map(b=>b.id))},children:"All"}),r.jsxs(W,{fontSize:16,children:[o.length," Selected"]}),r.jsx(M,{size:"sm",icon:r.jsx(un,{size:19}),onClick:()=>c(!1),"aria-label":"cancel"})]})]}),r.jsx(en,{}),r.jsx(tn,{overflowY:"auto",children:y?r.jsx(Es,{searchQuery:k}):r.jsx(Cs,{mediaList:i})})]})]})})}export{Os as default};
