import{r as n,j as e,P as x,B as p}from"./input.js";import{app as t}from"/scripts/app.js";import{I as f,G as j,a as g}from"./ModelManagerTopbar-Clt4PNkc.js";import{B as v,a2 as y,ai as M,F as _,a9 as w,T as i,L as I}from"./App-Eqg3V87d.js";import{G as E}from"./chunk-JARCRF6W-po8hqWTL.js";import{V as S}from"./chunk-NTCQBYKE-qX6uHBx-.js";import"/scripts/api.js";import"./chunk-6RSEZNRH-3Efv3ksN.js";function b({onClose:r,missingModels:a}){const[o,c]=n.useState(!1),[d,u]=n.useState("");n.useEffect(()=>(t.canvasEl.addEventListener("click",r),()=>{t.canvasEl.removeEventListener("click",r)}),[]);const l=440;return e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(v,{style:{width:l},children:e.jsxs(y,{width:l,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:1e3,overflowY:"auto",children:[e.jsx(M,{children:e.jsxs(_,{justifyContent:"space-between",alignContent:"center",children:[e.jsx(w,{size:"md",mr:2,children:"Models"}),e.jsx(f,{})]})}),e.jsx(E,{templateColumns:"1",gap:1,marginTop:2,children:a.map(s=>e.jsxs(j,{p:3,shadow:"md",borderWidth:"1px",children:[e.jsxs(S,{align:"start",children:[e.jsx(i,{children:s.class_type}),e.jsx(i,{fontWeight:"bold",children:"Input:"}),e.jsx(i,{children:s.input_name}),e.jsx(i,{fontWeight:"bold",children:"Received Value:"}),e.jsx(i,{color:"red.400",children:s.received_value})]}),e.jsx(p,{colorScheme:"blue",mt:5,iconSpacing:1,leftIcon:e.jsx(I,{size:20}),size:"sm",onClick:()=>{window.open(`https://civitai.com/search/models?sortBy=models_v5&query=${C(s.received_value)}`,"_blank")},children:"Search in CivitAI"})]}))})]})})}),o&&e.jsx(g,{searchQuery:d,onclose:()=>c(!1)})]})}function C(r){return r.replace(/\.[^/.]+$/,"").trim()}function F({}){const[r,a]=n.useState(!1),[o,c]=n.useState([]);return n.useEffect(()=>{const d=t.queuePrompt;t.queuePrompt=async function(){try{await d.apply(t,[...arguments])}finally{console.log("queuePrompt app.node err",t.lastNodeErrors);const u=t.lastNodeErrors??{};c(Object.values(u).flatMap(l=>l.errors.filter(s=>s.type==="value_not_in_list").map(s=>{const{input_name:m,received_value:h}=s.extra_info;return{class_type:l.class_type,input_name:m,received_value:h}})))}}},[]),o.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs(p,{size:"sm","aria-label":"missing models",px:2,onClick:()=>a(!0),children:["Install Missing (",o.length,")"]}),r&&e.jsx(b,{onClose:()=>a(!1),missingModels:o})]})}export{F as default};
