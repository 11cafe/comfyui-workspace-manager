import{f as P,r as d,j as e,g as T,h as V,a3 as z,b as Ee,o as re,i as le,k as Pe,ab as Le,B as _,a8 as $,ac as De,L as ce,ad as Ne,O as de,R as ue,S as Ae,Y as Be,M as Fe,N as Re,Q as ze,P as Oe,_ as We}from"./input.js";import{aj as Ge,ai as Ke,Z as He,ak as F,m as k,F as L,k as I,B as he,al as pe,am as se,a8 as me,j as O,r as ne,C as Ve,H as E,l as W,an as fe,p as ge,ao as xe,_ as $e,$ as Ye,a0 as Ue,a1 as qe,a2 as Qe,ap as K,ah as je,aq as Xe,ar as Ze,a9 as Je,as as et,at as tt}from"./App-GluzE5n7.js";import{I as ve,G as st,C as nt}from"./chunk-JARCRF6W-IwBcFM3i.js";import{app as A}from"/scripts/app.js";import{api as R}from"/scripts/api.js";var ye=P(function(s,n){const{spacing:o="0.5rem",spacingX:i,spacingY:a,children:r,justify:l,direction:c,align:u,className:p,shouldWrapChildren:g,...h}=s,m=d.useMemo(()=>g?d.Children.map(r,(f,v)=>e.jsx(Y,{children:f},v)):r,[r,g]);return e.jsx(T.div,{ref:n,className:V("chakra-wrap",p),...h,children:e.jsx(T.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:l,alignItems:u,flexDirection:c,listStyleType:"none",gap:o,columnGap:i,rowGap:a,padding:"0"},children:m})})});ye.displayName="Wrap";var Y=P(function(s,n){const{className:o,...i}=s;return e.jsx(T.li,{ref:n,__css:{display:"flex",alignItems:"flex-start"},className:V("chakra-wrap__listitem",o),...i})});Y.displayName="WrapItem";function oe(t){return Ke(t,s=>s==="auto"?"auto":`span ${s}/span ${s}`)}var we=P(function(s,n){const{area:o,colSpan:i,colStart:a,colEnd:r,rowEnd:l,rowSpan:c,rowStart:u,...p}=s,g=Ge({gridArea:o,gridColumn:oe(i),gridRow:oe(c),gridColumnStart:a,gridColumnEnd:r,gridRowStart:u,gridRowEnd:l});return e.jsx(T.div,{ref:n,__css:g,...p})});we.displayName="GridItem";function ot(t,s,n){return(t-s)*100/(n-s)}z({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});z({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var at=z({"0%":{left:"-40%"},"100%":{left:"100%"}}),it=z({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function rt(t){const{value:s=0,min:n,max:o,valueText:i,getValueText:a,isIndeterminate:r,role:l="progressbar"}=t,c=ot(s,n,o);return{bind:{"data-indeterminate":r?"":void 0,"aria-valuemax":o,"aria-valuemin":n,"aria-valuenow":r?void 0:s,"aria-valuetext":(()=>{if(s!=null)return typeof a=="function"?a(s,c):i})(),role:l},percent:c,value:s}}var[lt,ct]=Ee({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),dt=P((t,s)=>{const{min:n,max:o,value:i,isIndeterminate:a,role:r,...l}=t,c=rt({value:i,min:n,max:o,isIndeterminate:a,role:r}),p={height:"100%",...ct().filledTrack};return e.jsx(T.div,{ref:s,style:{width:`${c.percent}%`,...l.style},...c.bind,...l,__css:p})}),Se=P((t,s)=>{var n;const{value:o,min:i=0,max:a=100,hasStripe:r,isAnimated:l,children:c,borderRadius:u,isIndeterminate:p,"aria-label":g,"aria-labelledby":h,"aria-valuetext":m,title:f,role:v,...j}=re(t),y=le("Progress",t),M=u??((n=y.track)==null?void 0:n.borderRadius),w={animation:`${it} 1s linear infinite`},N={...!p&&r&&l&&w,...p&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${at} 1s ease infinite normal none running`}},B={overflow:"hidden",position:"relative",...y.track};return e.jsx(T.div,{ref:s,borderRadius:M,__css:B,...j,children:e.jsxs(lt,{value:y,children:[e.jsx(dt,{"aria-label":g,"aria-labelledby":h,"aria-valuetext":m,min:i,max:a,value:o,isIndeterminate:p,css:N,borderRadius:M,title:f,role:v}),c]})})});Se.displayName="Progress";var _e=P(function(s,n){const{children:o,placeholder:i,className:a,...r}=s;return e.jsxs(T.select,{...r,ref:n,className:V("chakra-select",a),children:[i&&e.jsx("option",{value:"",children:i}),o]})});_e.displayName="SelectField";function ut(t,s){const n={},o={};for(const[i,a]of Object.entries(t))s.includes(i)?n[i]=a:o[i]=a;return[n,o]}var G=P((t,s)=>{var n;const o=le("Select",t),{rootProps:i,placeholder:a,icon:r,color:l,height:c,h:u,minH:p,minHeight:g,iconColor:h,iconSize:m,...f}=re(t),[v,j]=ut(f,Le),y=He(j),M={width:"100%",height:"fit-content",position:"relative",color:l},w={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(n=o.field)==null?void 0:n._focus}};return e.jsxs(T.div,{className:"chakra-select__wrapper",__css:M,...v,...i,children:[e.jsx(_e,{ref:s,height:u??c,minH:p??g,placeholder:a,...y,__css:w,children:t.children}),e.jsx(be,{"data-disabled":Pe(y.disabled),...(h||l)&&{color:h||l},__css:o.icon,...m&&{fontSize:m},children:r})]})});G.displayName="Select";var ht=t=>e.jsx("svg",{viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),pt=T("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),be=t=>{const{children:s=e.jsx(ht,{}),...n}=t,o=d.cloneElement(s,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e.jsx(pt,{...n,className:"chakra-select__icon-wrapper",children:d.isValidElement(s)?o:null})};be.displayName="SelectIcon";function mt({selectedModel:t,setSelectedModel:s,modelTypeList:n}){const o=i=>{s(i)};return e.jsx(ye,{children:n.map(i=>e.jsx(Y,{children:e.jsx(_,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>o(i),size:"sm",children:i})},i))})}const ft={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function gt({data:t}){const[s,n]=d.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[o,i]=d.useState(!t.file_hash),[a,r]=d.useState();d.useEffect(()=>{i(!t.file_hash),l()},[t.file_hash]);const l=async()=>{var p,g,h,m;const u=await F.models.get(t.model_name+"@"+t.model_type);if(u!=null)r(u),(p=u.imageUrl)!=null&&p.length&&n(u.imageUrl);else if(t.file_hash!=null)try{const f=`https://civitai.com/api/v1/model-versions/by-hash/${t.file_hash}`,j=await(await fetch(f)).json();let y;if(await((g=k)==null?void 0:g.getSetting("showNsfwModelThumbnail"))===!0)y=(m=(h=j==null?void 0:j.images)==null?void 0:h[0])==null?void 0:m.url;else if(!j.model.nsfw){const w=j.images.find(D=>D.nsfw==="None");y=w==null?void 0:w.url}y&&n(y),F.models.add({id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,civitModelID:String(j.modelId),civitModelVersionID:String(j.id),imageUrl:y??null})}catch{}t.preview&&n(t.preview)},c=u=>{const p=ft[t.model_type];p&&(u.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),u.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),u.dataTransfer.setData("nodeType",p))};return o?e.jsxs(L,{position:"relative",borderRadius:4,bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:[o&&e.jsx($,{}),e.jsx(I,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:12,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]}):e.jsxs(he,{position:"relative",borderRadius:4,draggable:!0,onDragStart:c,children:[e.jsx(ve,{src:s,draggable:!1,boxSize:"100%",height:178,objectFit:"cover",borderRadius:4,cursor:(a==null?void 0:a.civitModelID)!=null?"pointer":"auto",onClick:()=>{(a==null?void 0:a.civitModelID)==null||(a==null?void 0:a.civitModelVersionID)==null||window.open(`https://civitai.com/models/${a==null?void 0:a.civitModelID}?modelVersionId=${a==null?void 0:a.civitModelVersionID}`)}}),e.jsx(I,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:14,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]})}function xt({list:t}){return e.jsx(st,{templateColumns:"repeat(3, 1fr)",gap:1,marginTop:2,children:t.map(s=>e.jsx(we,{children:e.jsx(gt,{data:s})},s.model_name))})}const jt=async t=>{try{const n=await(await R.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:n}))}catch(s){console.error("Failed to connect to the server:",s)}};function ae(t,s=1){const i=t/1024;return i>=1024?(i/1024).toFixed(s)+" GB":i.toFixed(s)+" MB"}function ie(t,s){if(!t||t.length===0)return;let n=t.find(o=>o.nsfw==="None");return s&&(n=n??t[0]),n}function vt(t,s=280,n){var o,i,a,r;if(t)return pe(t)?(a=ie((i=(o=t.modelVersions)==null?void 0:o.at(0))==null?void 0:i.images,n))==null?void 0:a.url:`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(r=ie(t.images,n))==null?void 0:r.url}/width=${s}/`}const H=280;function yt({model:t,onClickInstallModel:s,installing:n}){var h,m;const[o,i]=d.useState();d.useEffect(()=>{f();async function f(){var j;const v=await((j=k)==null?void 0:j.getSetting("showNsfwModelThumbnail"));i(vt(t,H,v))}},[t]);const a=pe(t)?t.modelVersions:t.versions,[r,l]=d.useState(((h=a==null?void 0:a[0])==null?void 0:h.name)??""),c=a==null?void 0:a.find(f=>(f==null?void 0:f.name)===r),u=()=>{window.open(`https://civitai.com/models/${t.id}`)},p=d.useCallback(()=>{if(c==null){console.error("no file is find by name",r);return}s(se(c,t.name),t)},[r]),g=(m=se(c))==null?void 0:m.sizeKB;return e.jsxs(me,{width:H,justifyContent:"space-between",mb:2,gap:1,children:[e.jsx(ve,{borderRadius:3,boxSize:H+"px",objectFit:"cover",src:o,alt:"model cover image",cursor:"pointer",onClick:()=>u()}),e.jsxs(O,{p:1,children:[e.jsx(ne,{label:t.name,children:e.jsx(I,{fontWeight:500,noOfLines:1,children:t.name})}),e.jsxs(L,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(_,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:e.jsx(I,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),e.jsx(_,{leftIcon:e.jsx(Ve,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>p(),isDisabled:!!(r&&n.includes(r)),children:"Install"})]}),e.jsxs(E,{children:[e.jsx(G,{size:"md",style:{paddingLeft:4},onChange:f=>{l(f.target.value)},children:a==null?void 0:a.map(f=>{const v=f==null?void 0:f.name;return v?e.jsx("option",{value:v,style:{padding:0},children:v},f.id):null})}),g&&e.jsx(ne,{label:ae(g),children:e.jsx(I,{flexShrink:1,noOfLines:1,width:"40%",children:ae(g)})})]})]})]})}function wt({searchQuery:t,setSearchQuery:s,onSearch:n}){return e.jsxs(L,{gap:1,alignItems:"center",grow:1,children:[e.jsx(W,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:o=>s(o.target.value),onKeyUp:o=>{o.code==="Enter"&&n()}}),e.jsx(_,{size:"sm",onClick:()=>n(),colorScheme:"teal",children:"Search"})]})}function St({isOpen:t,fileSelected:s,onClose:n,selectFolder:o}){const[i,a]=d.useState(""),[r,l]=d.useState([]),[c,u]=d.useState(""),p=d.useRef(null);d.useEffect(()=>{g()},[]);const g=async()=>{const h=await fe();h&&(["custom_nodes","config","saved_prompts"].forEach(m=>{delete h[m]}),l(Object.values(h).flatMap(m=>m)))};return e.jsx(De,{isOpen:t,leastDestructiveRef:p,onClose:n,children:e.jsx(ce,{children:e.jsxs(Ne,{children:[e.jsx(de,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),e.jsx(ue,{children:e.jsxs(O,{spacing:4,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(I,{children:"Model download url"}),e.jsx(W,{placeholder:"https://civitai.com/api/download/models/311399",onChange:h=>u(h.target.value),value:c})]}),e.jsx(I,{children:"Choose model install folder"}),e.jsx(G,{placeholder:"Select option",value:i,onChange:h=>a(h.target.value),children:r.map(h=>e.jsx("option",{value:h,children:h},h))})]})}),e.jsxs(Ae,{children:[e.jsx(_,{ref:p,onClick:n,children:"Cancel"}),e.jsx(_,{onClick:()=>o(i,c),ml:3,isDisabled:c.length===0,children:"Confirm"})]})]})})})}function _t(){const{colorMode:t}=Be(),s=ge(),[n,o]=d.useState([]);return d.useEffect(()=>{R.addEventListener("download_progress",i=>{o(i.detail)}),R.addEventListener("download_error",i=>{s({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),e.jsx(O,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,children:n.map(({save_path:i,progress:a})=>e.jsxs(E,{children:[e.jsx(I,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),e.jsx(Se,{isIndeterminate:!a,hasStripe:!0,width:"50%",value:a}),e.jsxs(I,{fontSize:16,width:"10%",children:[a.toFixed(1),"%"]})]},i))})}const Me="WORKSPACE_CIVIT_API_KEY_STORAGE_KEY";function bt(){return localStorage.getItem(Me)}function Mt(t){localStorage.setItem(Me,t)}function Ct(){const[t,s]=d.useState(""),{onOpen:n,onClose:o,isOpen:i}=xe(),a=()=>{Mt(t),o()};return e.jsxs($e,{isOpen:i,onOpen:n,onClose:o,placement:"right",closeOnBlur:!1,children:[e.jsx(Ye,{children:e.jsx(_,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),e.jsxs(Ue,{p:5,children:[e.jsx(qe,{}),e.jsx(Qe,{}),e.jsxs(O,{spacing:4,children:[e.jsx(I,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),e.jsx(W,{value:t,onChange:r=>s(r.target.value),placeholder:"API Key"}),e.jsx(_,{size:"sm",py:1,mr:8,onClick:a,children:"Save"})]})]})]})}const It=t=>typeof t=="function",Ce=t=>{const[s,n]=d.useState(t),o=d.useRef(s),i=d.useCallback(a=>{o.current=It(a)?a(o.current):a,n(o.current)},[]);return[s,i,o]};async function Tt(t,s){var r,l;const n={queries:[{q:t,indexUid:"models_v5",facets:["category.name","checkpointType","fileFormats","lastVersionAtUnix","tags.name","type","user.username","version.baseModel"],attributesToHighlight:["*"],highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__",limit:80,offset:0}]};return s&&(n.queries[0].filter=[[`"type"="${s}"`]]),((l=(r=await(await fetch("https://meilisearch-v1-6.civitai.com/multi-search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(n)})).json())==null?void 0:r.results)==null?void 0:l.at(0)).hits??[]}function kt({onclose:t,searchQuery:s="",modelType:n}){const[o,i]=d.useState([]),[a,r]=d.useState(!1),[l,c]=d.useState(n),u=ge(),[p,g]=d.useState([]),[h,m]=d.useState(s),{isOpen:f,onOpen:v,onClose:j}=xe(),[y,M,w]=Ce(),[D,U]=d.useState({}),[N,B]=d.useState(K),q=d.useCallback(async()=>{var S;r(!0);const x=await Tt(h,l);i(x);const C=await fe();C&&U(C);const b=await((S=k)==null?void 0:S.getSetting("defaultFolders"));b&&B(b),r(!1)},[h,l]),Q=(x,C)=>{var Z,J,ee,te;if(!((Z=w.current)!=null&&Z.id)&&!C){console.error("no url to download");return}let b=C??`https://civitai.com/api/download/models/${(J=w.current)==null?void 0:J.id}`,S=(ee=w.current)==null?void 0:ee.name;if(!S&&(S=b.split("/").pop(),!S)){console.error("downloadUrl is malformed");return}u({title:"Installing...",description:S,status:"info",duration:4e3,isClosable:!0}),S!=null&&g(ke=>[...ke,S??""]);const X=bt();X&&(b+=`?token=${X}`),jt({file_hash:(te=w.current)==null?void 0:te.SHA256,filename:S,save_path:x,url:b}),M(void 0),j()},Ie=async(x,C)=>{const b=N[C.type];M(x),b==null?v():Q(b)},Te=async(x,C)=>{var S;const b={...N,[x]:C};await((S=k)==null?void 0:S.upsert({defaultFolders:b})),B(b)};return d.useEffect(()=>{q()},[l]),e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[e.jsx(ce,{}),e.jsxs(Re,{width:"90%",maxWidth:"90vw",height:"90vh",children:[e.jsxs(de,{children:[e.jsxs(E,{gap:2,mb:2,alignItems:"center",children:[e.jsx(je,{size:"md",mr:2,children:"Models"}),e.jsx(wt,{searchQuery:h,setSearchQuery:m,onSearch:q}),e.jsx(_,{size:"sm",py:1,mr:8,onClick:v,children:"Custom URL Install"}),e.jsx(Ct,{})]}),e.jsxs(E,{gap:2,mb:2,wrap:"wrap",children:[e.jsx(_,{size:"sm",py:1,onClick:()=>{c(void 0)},isActive:l==null,children:"All"}),Xe.map(x=>e.jsx(_,{size:"sm",py:1,isActive:l===x,onClick:()=>{c(x)},children:x},x)),l&&D[K[l]]&&e.jsxs(E,{ml:"auto",children:[e.jsx(I,{whiteSpace:"nowrap",children:"Default Download Folder:"}),e.jsx(G,{value:N[l],onChange:x=>Te(l,x.target.value),children:D[K[l]].map(x=>e.jsx("option",{value:x,children:x}))})]})]}),a&&e.jsx($,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),e.jsx(ze,{}),e.jsxs(ue,{overflowY:"auto",children:[e.jsx(E,{wrap:"wrap",children:o==null?void 0:o.map(x=>e.jsx(yt,{model:x,onClickInstallModel:Ie,installing:p},x.id))}),e.jsx(_t,{})]})]})]}),e.jsx(St,{fileSelected:!!y,isOpen:f,onClose:j,selectFolder:(x,C)=>{Q(x,w.current?void 0:C)}})]})}function Et(){const[t,s]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",colorScheme:"teal",onClick:()=>s(!0),children:"Install Models"}),t&&e.jsx(kt,{modelType:"Checkpoint",onclose:()=>s(!1)})]})}const Pt=()=>{const[t,s]=d.useState(["checkpoints"]),[n,o]=d.useState([]),[i,a]=d.useState(!0);d.useEffect(()=>{r(),R.addEventListener("model_list",c=>{l(c.detail)})},[]);const r=async()=>{const c=await Ze();l(c)},l=async c=>{if(!c)return;a(!1);const u=Array.from(new Set(c.map(g=>g.model_type))),p=u.indexOf("checkpoints");p>=0&&u.splice(p,1),u.unshift("checkpoints"),s(u),o(c)};return{modelTypeList:t,modelsList:n,loading:i}};function Lt(){const[t,s,n]=Ce(!1),o=()=>{var l;(l=k)==null||l.getSetting("showNsfwModelThumbnail").then(c=>{s(c??!1)})};d.useEffect(()=>{o()},[]);const i=l=>{var u;const c=l.target.checked;(u=k)==null||u.upsert({showNsfwModelThumbnail:c}).then(()=>{o(),a(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},a=async()=>{const l=await F.models.toArray();for(let c=0;c<l.length;c+=5){const u=l.slice(c,c+5);await Promise.all(u.map(r))}},r=async l=>{var c,u;try{const p=`https://civitai.com/api/v1/model-versions/by-hash/${l.fileHash}`,h=await(await fetch(p)).json();let m;if(n.current)m=(u=(c=h==null?void 0:h.images)==null?void 0:c[0])==null?void 0:u.url;else if(!h.model.nsfw){const f=h.images.find(v=>v.nsfw==="None");m=f==null?void 0:f.url}F.models.update(l.id,{imageUrl:m??null})}catch{}};return e.jsx(nt,{isChecked:t,onChange:i,width:"100px",children:"Show NSFW"})}function Dt({onClose:t}){const[s,n]=d.useState("checkpoints"),[o,i]=d.useState(""),{loading:a,modelTypeList:r,modelsList:l}=Pt(),[c,u]=d.useState([]);d.useEffect(()=>{const h=l.filter(m=>o.length?m.model_name.toLowerCase().includes(o.toLowerCase()):m.model_type===s);u(h)},[s,l,o]),d.useEffect(()=>(A.canvasEl.addEventListener("click",t),()=>{A.canvasEl.removeEventListener("click",t)}),[]);const p=440,g=()=>e.jsxs(e.Fragment,{children:[e.jsxs(L,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:[e.jsx(W,{size:"sm",placeholder:"Search",value:o,onChange:h=>i(h.target.value)}),e.jsx(Lt,{})]}),!o.length&&e.jsx(mt,{modelTypeList:r,setSelectedModel:n,selectedModel:s}),e.jsx(xt,{list:c}),a&&e.jsx(L,{justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx($,{})})]});return e.jsx(Oe,{children:e.jsx(he,{style:{width:p},children:e.jsxs(me,{width:p,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:Je,overflowY:"auto",children:[e.jsxs(L,{justifyContent:"space-between",alignContent:"center",py:3,children:[e.jsx(je,{size:"md",mr:2,children:"Models"}),e.jsx(Et,{})]}),g()]})})})}const Nt=d.lazy(()=>We(()=>import("./InstallMissingModelsButton-KOf9hKlm.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function At(){const[t,s]=d.useState(!1),[n,o]=d.useState(),i=async r=>{if(r.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const c=r.dataTransfer.getData("modelRelativePath"),u=r.dataTransfer.getData("nodeType"),p=LiteGraph.createNode(u);p.pos=[r.canvasX,r.canvasY],p.configure({widgets_values:[c]}),A.graph.add(p)};d.useEffect(()=>{var r;return(r=k)==null||r.getSetting("modelManagerTopBarStyle").then(l=>{a(l,!1)}),A.canvasEl.addEventListener("drop",i),()=>{A.canvasEl.removeEventListener("drop",i)}},[]);const a=(r,l=!1)=>{var M;const{top:c=0,right:u=0}=n||{},{top:p=0,right:g=0}=r??{};let h=c+p,m=n===void 0?g:u-g;const f=document.documentElement.clientWidth,v=document.documentElement.clientHeight,j=document.getElementById("modelManagerTopBar"),y=(j==null?void 0:j.offsetWidth)||224;h+32>v&&(h=v-38),m+y>f&&(m=f-y-4),o({top:Math.max(4,h),right:Math.max(4,m)}),l&&((M=k)==null||M.upsert({modelManagerTopBarStyle:{top:h,right:m}}))};return e.jsx(et,{onDragEnd:r=>{a({top:r.y,right:r.x},!0)},dragIconId:"dragModelManagerTopBarIcon",children:n?e.jsxs(E,{style:{position:"fixed",...n},gap:2,draggable:!1,id:"modelManagerTopBar",className:"model-manager-top-bar",children:[e.jsx(tt,{id:"dragModelManagerTopBarIcon",className:"drag-model-manager-top-bar-icon",cursor:"move",size:15,color:"#FFF"}),e.jsx(Nt,{}),e.jsx(_,{size:"sm",colorScheme:"blue","aria-label":"My models",onClick:()=>s(!0),px:1,children:"Models"}),t&&e.jsx(Dt,{onClose:()=>s(!1)})]}):""})}const Wt=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"}));export{we as G,Et as I,Wt as M,Tt as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-KOf9hKlm.js","workspace_web/input.js","workspace_web/App-GluzE5n7.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-NTCQBYKE-ZsMy4OBB.js","workspace_web/chunk-JARCRF6W-IwBcFM3i.js","workspace_web/index-pz0vT7Or.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}