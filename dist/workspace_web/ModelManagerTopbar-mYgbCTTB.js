import{f as T,r as u,j as e,g as M,h as K,a3 as B,b as be,o as ne,i as oe,k as _e,ab as Me,B as v,a8 as H,ac as Ce,L as ae,ad as Ie,O as ie,R as re,S as Te,X as ke,M as Ee,N as Ae,Q as Ne,P as Pe,_ as De}from"./input.js";import{ad as Le,ac as Re,W as Be,ae as P,l as C,F as A,T as _,B as le,a5 as ce,j as z,o as J,w as ze,H as N,k as O,af as Oe,m as de,ag as ue,X as Fe,Y as We,Z as Ge,_ as Ke,$ as He,ab as he,ah as $e,a6 as Ve,ai as Ye,aj as Ue}from"./App-Rycz7pg4.js";import{I as me,G as qe,C as Qe}from"./chunk-JARCRF6W-ADGa7_HV.js";import{app as L}from"/scripts/app.js";import{api as R}from"/scripts/api.js";var pe=T(function(s,a){const{spacing:o="0.5rem",spacingX:i,spacingY:n,children:r,justify:c,direction:l,align:d,className:h,shouldWrapChildren:f,...m}=s,g=u.useMemo(()=>f?u.Children.map(r,(p,w)=>e.jsx($,{children:p},w)):r,[r,f]);return e.jsx(M.div,{ref:a,className:K("chakra-wrap",h),...m,children:e.jsx(M.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:c,alignItems:d,flexDirection:l,listStyleType:"none",gap:o,columnGap:i,rowGap:n,padding:"0"},children:g})})});pe.displayName="Wrap";var $=T(function(s,a){const{className:o,...i}=s;return e.jsx(M.li,{ref:a,__css:{display:"flex",alignItems:"flex-start"},className:K("chakra-wrap__listitem",o),...i})});$.displayName="WrapItem";function Z(t){return Re(t,s=>s==="auto"?"auto":`span ${s}/span ${s}`)}var fe=T(function(s,a){const{area:o,colSpan:i,colStart:n,colEnd:r,rowEnd:c,rowSpan:l,rowStart:d,...h}=s,f=Le({gridArea:o,gridColumn:Z(i),gridRow:Z(l),gridColumnStart:n,gridColumnEnd:r,gridRowStart:d,gridRowEnd:c});return e.jsx(M.div,{ref:a,__css:f,...h})});fe.displayName="GridItem";function Xe(t,s,a){return(t-s)*100/(a-s)}B({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});B({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var Je=B({"0%":{left:"-40%"},"100%":{left:"100%"}}),Ze=B({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function et(t){const{value:s=0,min:a,max:o,valueText:i,getValueText:n,isIndeterminate:r,role:c="progressbar"}=t,l=Xe(s,a,o);return{bind:{"data-indeterminate":r?"":void 0,"aria-valuemax":o,"aria-valuemin":a,"aria-valuenow":r?void 0:s,"aria-valuetext":(()=>{if(s!=null)return typeof n=="function"?n(s,l):i})(),role:c},percent:l,value:s}}var[tt,st]=be({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),nt=T((t,s)=>{const{min:a,max:o,value:i,isIndeterminate:n,role:r,...c}=t,l=et({value:i,min:a,max:o,isIndeterminate:n,role:r}),h={height:"100%",...st().filledTrack};return e.jsx(M.div,{ref:s,style:{width:`${l.percent}%`,...c.style},...l.bind,...c,__css:h})}),ge=T((t,s)=>{var a;const{value:o,min:i=0,max:n=100,hasStripe:r,isAnimated:c,children:l,borderRadius:d,isIndeterminate:h,"aria-label":f,"aria-labelledby":m,"aria-valuetext":g,title:p,role:w,...x}=ne(t),y=oe("Progress",t),b=d??((a=y.track)==null?void 0:a.borderRadius),j={animation:`${Ze} 1s linear infinite`},W={...!h&&r&&c&&j,...h&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Je} 1s ease infinite normal none running`}},S={overflow:"hidden",position:"relative",...y.track};return e.jsx(M.div,{ref:s,borderRadius:b,__css:S,...x,children:e.jsxs(tt,{value:y,children:[e.jsx(nt,{"aria-label":f,"aria-labelledby":m,"aria-valuetext":g,min:i,max:n,value:o,isIndeterminate:h,css:W,borderRadius:b,title:p,role:w}),l]})})});ge.displayName="Progress";var xe=T(function(s,a){const{children:o,placeholder:i,className:n,...r}=s;return e.jsxs(M.select,{...r,ref:a,className:K("chakra-select",n),children:[i&&e.jsx("option",{value:"",children:i}),o]})});xe.displayName="SelectField";function ot(t,s){const a={},o={};for(const[i,n]of Object.entries(t))s.includes(i)?a[i]=n:o[i]=n;return[a,o]}var V=T((t,s)=>{var a;const o=oe("Select",t),{rootProps:i,placeholder:n,icon:r,color:c,height:l,h:d,minH:h,minHeight:f,iconColor:m,iconSize:g,...p}=ne(t),[w,x]=ot(p,Me),y=Be(x),b={width:"100%",height:"fit-content",position:"relative",color:c},j={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(a=o.field)==null?void 0:a._focus}};return e.jsxs(M.div,{className:"chakra-select__wrapper",__css:b,...w,...i,children:[e.jsx(xe,{ref:s,height:d??l,minH:h??f,placeholder:n,...y,__css:j,children:t.children}),e.jsx(we,{"data-disabled":_e(y.disabled),...(m||c)&&{color:m||c},__css:o.icon,...g&&{fontSize:g},children:r})]})});V.displayName="Select";var at=t=>e.jsx("svg",{viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),it=M("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),we=t=>{const{children:s=e.jsx(at,{}),...a}=t,o=u.cloneElement(s,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e.jsx(it,{...a,className:"chakra-select__icon-wrapper",children:u.isValidElement(s)?o:null})};we.displayName="SelectIcon";function rt({selectedModel:t,setSelectedModel:s,modelTypeList:a}){const o=i=>{s(i)};return e.jsx(pe,{children:a.map(i=>e.jsx($,{children:e.jsx(v,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>o(i),size:"sm",children:i})},i))})}const lt={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function ct({data:t}){const[s,a]=u.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[o,i]=u.useState(!t.file_hash),[n,r]=u.useState();u.useEffect(()=>{i(!t.file_hash),c()},[t.file_hash]);const c=async()=>{var h,f,m,g;const d=await P.models.get(t.model_name+"@"+t.model_type);if(d!=null)r(d),(h=d.imageUrl)!=null&&h.length&&a(d.imageUrl);else if(t.file_hash!=null)try{const p=`https://civitai.com/api/v1/model-versions/by-hash/${t.file_hash}`,x=await(await fetch(p)).json();let y;if(await((f=C)==null?void 0:f.getSetting("showNsfwModelThumbnail"))===!0)y=(g=(m=x==null?void 0:x.images)==null?void 0:m[0])==null?void 0:g.url;else if(!x.model.nsfw){const j=x.images.find(D=>D.nsfw==="None");y=j==null?void 0:j.url}y&&a(y),P.models.add({id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,civitModelID:String(x.modelId),civitModelVersionID:String(x.id),imageUrl:y??null})}catch{}t.preview&&a(t.preview)},l=d=>{const h=lt[t.model_type];h&&(d.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),d.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),d.dataTransfer.setData("nodeType",h))};return o?e.jsxs(A,{position:"relative",borderRadius:4,bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:[o&&e.jsx(H,{}),e.jsx(_,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:12,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]}):e.jsxs(le,{position:"relative",borderRadius:4,draggable:!0,onDragStart:l,children:[e.jsx(me,{src:s,draggable:!1,boxSize:"100%",height:178,objectFit:"cover",borderRadius:4,cursor:(n==null?void 0:n.civitModelID)!=null?"pointer":"auto",onClick:()=>{(n==null?void 0:n.civitModelID)==null||(n==null?void 0:n.civitModelVersionID)==null||window.open(`https://civitai.com/models/${n==null?void 0:n.civitModelID}?modelVersionId=${n==null?void 0:n.civitModelVersionID}`)}}),e.jsx(_,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:14,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]})}function dt({list:t}){return e.jsx(qe,{templateColumns:"repeat(3, 1fr)",gap:1,marginTop:2,children:t.map(s=>e.jsx(fe,{children:e.jsx(ct,{data:s})},s.model_name))})}const ut=async t=>{try{const a=await(await R.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:a}))}catch(s){console.error("Failed to connect to the server:",s)}},ht=["Checkpoint","TextualInversion","Hypernetwork","LORA","Controlnet","Upscaler","VAE"],mt=2,pt={Checkpoint:"checkpoints",TextualInversion:"embeddings",Hypernetwork:"hypernetworks",LORA:"loras",Controlnet:"controlnet",Upscaler:"upscale_models",VAE:"vae"};function Se(t){return t.modelVersions!==void 0}function ft(t){var s;return((s=t.files)==null?void 0:s[0])!==void 0}function ee(t,s){var o,i,n,r,c,l;if(!t)return;let a;return ft(t)?a={id:t.id,SHA256:(i=(o=t.files)==null?void 0:o[0].hashes)==null?void 0:i.SHA256,name:(n=t.files)==null?void 0:n[0].name,sizeKB:(c=(r=t.files)==null?void 0:r[0])==null?void 0:c.sizeKB}:a={id:t.id,SHA256:(l=t.hashes)==null?void 0:l[2],name:`${s} ${t.name}`},a}function te(t,s=1){const i=t/1024;return i>=1024?(i/1024).toFixed(s)+" GB":i.toFixed(s)+" MB"}function se(t,s){if(!t||t.length===0)return;let a=t.find(o=>o.nsfw==="None");return s&&(a=a??t[0]),a}function gt(t,s=280,a){var o,i,n,r;if(t)return Se(t)?(n=se((i=(o=t.modelVersions)==null?void 0:o.at(0))==null?void 0:i.images,a))==null?void 0:n.url:`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(r=se(t.images,a))==null?void 0:r.url}/width=${s}/`}const G=280;function xt({model:t,onClickInstallModel:s,installing:a}){var m,g;const[o,i]=u.useState();u.useEffect(()=>{p();async function p(){var x;const w=await((x=C)==null?void 0:x.getSetting("showNsfwModelThumbnail"));i(gt(t,G,w))}},[t]);const n=Se(t)?t.modelVersions:t.versions,[r,c]=u.useState(((m=n==null?void 0:n[0])==null?void 0:m.name)??""),l=n==null?void 0:n.find(p=>(p==null?void 0:p.name)===r),d=()=>{window.open(`https://civitai.com/models/${t.id}`)},h=u.useCallback(()=>{if(l==null){console.error("no file is find by name",r);return}s(ee(l),t)},[r]),f=(g=ee(l))==null?void 0:g.sizeKB;return e.jsxs(ce,{width:G,justifyContent:"space-between",mb:2,gap:1,children:[e.jsx(me,{borderRadius:3,boxSize:G+"px",objectFit:"cover",src:o,alt:"model cover image",cursor:"pointer",onClick:()=>d()}),e.jsxs(z,{p:1,children:[e.jsx(J,{label:t.name,children:e.jsx(_,{fontWeight:500,noOfLines:1,children:t.name})}),e.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(v,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:e.jsx(_,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),e.jsx(v,{leftIcon:e.jsx(ze,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>h(),isDisabled:!!(r&&a.includes(r)),children:"Install"})]}),e.jsxs(N,{children:[e.jsx(V,{size:"md",style:{paddingLeft:4},onChange:p=>{c(p.target.value)},children:n==null?void 0:n.map(p=>{const w=p==null?void 0:p.name;return w?e.jsx("option",{value:w,style:{padding:0},children:w},p.id):null})}),f&&e.jsx(J,{label:te(f),children:e.jsx(_,{flexShrink:1,noOfLines:1,width:"40%",children:te(f)})})]})]})]})}function wt({searchQuery:t,setSearchQuery:s,onSearch:a}){return e.jsxs(A,{gap:1,alignItems:"center",grow:1,children:[e.jsx(O,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:o=>s(o.target.value),onKeyUp:o=>{o.code==="Enter"&&a()}}),e.jsx(v,{size:"sm",onClick:()=>a(),colorScheme:"teal",children:"Search"})]})}function St({isOpen:t,fileSelected:s,onClose:a,selectFolder:o}){const[i,n]=u.useState(""),[r,c]=u.useState([]),[l,d]=u.useState(""),h=u.useRef(null);u.useEffect(()=>{f()},[]);const f=async()=>{const m=await Oe();m&&c(m.filter(g=>!["custom_nodes","config","saved_prompts"].includes(g)))};return e.jsx(Ce,{isOpen:t,leastDestructiveRef:h,onClose:a,children:e.jsx(ae,{children:e.jsxs(Ie,{children:[e.jsx(ie,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),e.jsx(re,{children:e.jsxs(z,{spacing:4,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(_,{children:"Model download url"}),e.jsx(O,{placeholder:"https://civitai.com/api/download/models/311399",onChange:m=>d(m.target.value),value:l})]}),e.jsx(_,{children:"Choose model install folder"}),e.jsx(V,{placeholder:"Select option",value:i,onChange:m=>n(m.target.value),children:r.map(m=>e.jsx("option",{value:m,children:m},m))})]})}),e.jsxs(Te,{children:[e.jsx(v,{ref:h,onClick:a,children:"Cancel"}),e.jsx(v,{onClick:()=>o(i,l),ml:3,isDisabled:l.length===0,children:"Confirm"})]})]})})})}function yt(){const{colorMode:t}=ke(),s=de(),[a,o]=u.useState([]);return u.useEffect(()=>{R.addEventListener("download_progress",i=>{o(i.detail)}),R.addEventListener("download_error",i=>{s({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),e.jsx(z,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,children:a.map(({save_path:i,progress:n})=>e.jsxs(N,{children:[e.jsx(_,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),e.jsx(ge,{isIndeterminate:!n,hasStripe:!0,width:"50%",value:n}),e.jsxs(_,{fontSize:16,width:"10%",children:[n.toFixed(1),"%"]})]},i))})}const ye="WORKSPACE_CIVIT_API_KEY_STORAGE_KEY";function jt(){return localStorage.getItem(ye)}function vt(t){localStorage.setItem(ye,t)}function bt(){const[t,s]=u.useState(""),{onOpen:a,onClose:o,isOpen:i}=ue(),n=()=>{vt(t),o()};return e.jsxs(Fe,{isOpen:i,onOpen:a,onClose:o,placement:"right",closeOnBlur:!1,children:[e.jsx(We,{children:e.jsx(v,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),e.jsxs(Ge,{p:5,children:[e.jsx(Ke,{}),e.jsx(He,{}),e.jsxs(z,{spacing:4,children:[e.jsx(_,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),e.jsx(O,{value:t,onChange:r=>s(r.target.value),placeholder:"API Key"}),e.jsx(v,{size:"sm",py:1,mr:8,onClick:n,children:"Save"})]})]})]})}const _t=t=>typeof t=="function",je=t=>{const[s,a]=u.useState(t),o=u.useRef(s),i=u.useCallback(n=>{o.current=_t(n)?n(o.current):n,a(o.current)},[]);return[s,i,o]};async function Mt(t){var l,d;const a={limit:"30",nsfw:await((l=C)==null?void 0:l.getSetting("showNsfwModelThumbnail"))??!1,types:t},i=`https://civitai.com/api/v1/models?${new URLSearchParams(a).toString()}`,n=await((d=P.cache)==null?void 0:d.get(i));if((n==null?void 0:n.value)!=null)try{const{data:h,timestamp:f}=JSON.parse(n==null?void 0:n.value);if((Date.now()-f)/(1e3*60*60*24)<mt)return h}catch(h){console.error("err fetching cache",h)}const c=await(await fetch(i)).json();return P.cache.put({id:i,value:JSON.stringify({data:c.items,timestamp:Date.now()})}),c.items}async function Ct(t,s){var r;const o={limit:30,filter:`nsfw = ${await((r=C)==null?void 0:r.getSetting("showNsfwModelThumbnail"))??!1} AND type != Workflows`,q:t};s&&(o.filter+=`AND type = ${s}`);const n=await(await fetch("https://meilisearch-v1-6.civitai.com/indexes/models_v5/search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(o)})).json();return(n==null?void 0:n.hits)??[]}function It({onclose:t,searchQuery:s="",modelType:a}){const[o,i]=u.useState([]),[n,r]=u.useState(!1),[c,l]=u.useState(a),d=de(),[h,f]=u.useState([]),[m,g]=u.useState(s),{isOpen:p,onOpen:w,onClose:x}=ue(),[y,b,j]=je(),D=u.useCallback(async()=>{if(r(!0),m){const S=await Ct(m,c);i(S)}else{const S=await Mt(c);i(S)}r(!1)},[m,c]),F=(S,k)=>{var U,q,Q,X;if(!((U=j.current)!=null&&U.id)&&!k){console.error("no url to download");return}let E=k??`https://civitai.com/api/download/models/${(q=j.current)==null?void 0:q.id}`,I=(Q=j.current)==null?void 0:Q.name;if(!I&&(I=E.split("/").pop(),!I)){console.error("downloadUrl is malformed");return}d({title:"Installing...",description:I,status:"info",duration:4e3,isClosable:!0}),I!=null&&f(ve=>[...ve,I??""]);const Y=jt();Y&&(E+=`?token=${Y}`),ut({file_hash:(X=j.current)==null?void 0:X.SHA256,filename:I,save_path:S,url:E}),b(void 0),x()},W=(S,k)=>{const E=pt[k.type];b(S),E==null?w():F(E)};return u.useEffect(()=>{D()},[c]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[e.jsx(ae,{}),e.jsxs(Ae,{width:"90%",maxWidth:"90vw",height:"90vh",children:[e.jsxs(ie,{children:[e.jsxs(N,{gap:2,mb:2,alignItems:"center",children:[e.jsx(he,{size:"md",mr:2,children:"Models"}),e.jsx(wt,{searchQuery:m,setSearchQuery:g,onSearch:D}),e.jsx(v,{size:"sm",py:1,mr:8,onClick:w,children:"Custom URL Install"}),e.jsx(bt,{})]}),e.jsxs(N,{gap:2,mb:2,wrap:"wrap",children:[e.jsx(v,{size:"sm",py:1,onClick:()=>{l(void 0)},isActive:c==null,children:"All"}),ht.map(S=>e.jsx(v,{size:"sm",py:1,isActive:c===S,onClick:()=>{l(S)},children:S},S))]}),n&&e.jsx(H,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),e.jsx(Ne,{}),e.jsxs(re,{overflowY:"auto",children:[e.jsx(N,{wrap:"wrap",children:o==null?void 0:o.map(S=>e.jsx(xt,{model:S,onClickInstallModel:W,installing:h},S.id))}),e.jsx(yt,{})]})]})]}),e.jsx(St,{fileSelected:!!y,isOpen:p,onClose:x,selectFolder:(S,k)=>{F(S,j.current?void 0:k)}})]})}function Tt(){const[t,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",colorScheme:"teal",onClick:()=>s(!0),children:"Install Models"}),t&&e.jsx(It,{modelType:"Checkpoint",onclose:()=>s(!1)})]})}const kt=()=>{const[t,s]=u.useState(["checkpoints"]),[a,o]=u.useState([]),[i,n]=u.useState(!0);u.useEffect(()=>{r(),R.addEventListener("model_list",l=>{c(l.detail)})},[]);const r=async()=>{const l=await $e();c(l)},c=async l=>{if(!l)return;n(!1);const d=Array.from(new Set(l.map(f=>f.model_type))),h=d.indexOf("checkpoints");h>=0&&d.splice(h,1),d.unshift("checkpoints"),s(d),o(l)};return{modelTypeList:t,modelsList:a,loading:i}};function Et(){const[t,s,a]=je(!1),o=()=>{var c;(c=C)==null||c.getSetting("showNsfwModelThumbnail").then(l=>{s(l??!1)})};u.useEffect(()=>{o()},[]);const i=c=>{var d;const l=c.target.checked;(d=C)==null||d.upsert({showNsfwModelThumbnail:l}).then(()=>{o(),n(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},n=async()=>{const c=await P.models.toArray();for(let l=0;l<c.length;l+=5){const d=c.slice(l,l+5);await Promise.all(d.map(r))}},r=async c=>{var l,d;try{const h=`https://civitai.com/api/v1/model-versions/by-hash/${c.fileHash}`,m=await(await fetch(h)).json();let g;if(a.current)g=(d=(l=m==null?void 0:m.images)==null?void 0:l[0])==null?void 0:d.url;else if(!m.model.nsfw){const p=m.images.find(w=>w.nsfw==="None");g=p==null?void 0:p.url}P.models.update(c.id,{imageUrl:g??null})}catch{}};return e.jsx(Qe,{isChecked:t,onChange:i,width:"100px",children:"Show NSFW"})}function At({onClose:t}){const[s,a]=u.useState("checkpoints"),[o,i]=u.useState(""),{loading:n,modelTypeList:r,modelsList:c}=kt(),[l,d]=u.useState([]);u.useEffect(()=>{const m=c.filter(g=>o.length?g.model_name.toLowerCase().includes(o.toLowerCase()):g.model_type===s);d(m)},[s,c,o]),u.useEffect(()=>(L.canvasEl.addEventListener("click",t),()=>{L.canvasEl.removeEventListener("click",t)}),[]);const h=440,f=()=>e.jsxs(e.Fragment,{children:[e.jsxs(A,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:[e.jsx(O,{size:"sm",placeholder:"Search",value:o,onChange:m=>i(m.target.value)}),e.jsx(Et,{})]}),!o.length&&e.jsx(rt,{modelTypeList:r,setSelectedModel:a,selectedModel:s}),e.jsx(dt,{list:l}),n&&e.jsx(A,{justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(H,{})})]});return e.jsx(Pe,{children:e.jsx(le,{style:{width:h},children:e.jsxs(ce,{width:h,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:Ve,overflowY:"auto",children:[e.jsxs(A,{justifyContent:"space-between",alignContent:"center",py:3,children:[e.jsx(he,{size:"md",mr:2,children:"Models"}),e.jsx(Tt,{})]}),f()]})})})}const Nt=u.lazy(()=>De(()=>import("./InstallMissingModelsButton-SyvWmFAK.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Pt(){const[t,s]=u.useState(!1),[a,o]=u.useState(),i=async r=>{if(r.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const l=r.dataTransfer.getData("modelRelativePath"),d=r.dataTransfer.getData("nodeType"),h=LiteGraph.createNode(d);h.pos=[r.canvasX,r.canvasY],h.configure({widgets_values:[l]}),L.graph.add(h)};u.useEffect(()=>{var r;return(r=C)==null||r.getSetting("modelManagerTopBarStyle").then(c=>{n(c,!1)}),L.canvasEl.addEventListener("drop",i),()=>{L.canvasEl.removeEventListener("drop",i)}},[]);const n=(r,c=!1)=>{var b;const{top:l=0,right:d=0}=a||{},{top:h=0,right:f=0}=r??{};let m=l+h,g=a===void 0?f:d-f;const p=document.documentElement.clientWidth,w=document.documentElement.clientHeight,x=document.getElementById("modelManagerTopBar"),y=(x==null?void 0:x.offsetWidth)||224;m+32>w&&(m=w-38),g+y>p&&(g=p-y-4),o({top:Math.max(4,m),right:Math.max(4,g)}),c&&((b=C)==null||b.upsert({modelManagerTopBarStyle:{top:m,right:g}}))};return e.jsx(Ye,{onDragEnd:r=>{n({top:r.y,right:r.x},!0)},dragIconId:"dragModelManagerTopBarIcon",children:a?e.jsxs(N,{style:{position:"fixed",...a},gap:2,draggable:!1,id:"modelManagerTopBar",className:"model-manager-top-bar",children:[e.jsx(Ue,{id:"dragModelManagerTopBarIcon",className:"drag-model-manager-top-bar-icon",cursor:"move",size:15,color:"#FFF"}),e.jsx(Nt,{}),e.jsx(v,{size:"sm",colorScheme:"blue","aria-label":"My models",onClick:()=>s(!0),px:1,children:"Models"}),t&&e.jsx(At,{onClose:()=>s(!1)})]}):""})}const Ot=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"}));export{fe as G,Tt as I,Ot as M,Ct as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-SyvWmFAK.js","workspace_web/input.js","workspace_web/App-Rycz7pg4.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-NTCQBYKE-izZ4Ms_6.js","workspace_web/chunk-JARCRF6W-ADGa7_HV.js","workspace_web/index-pz0vT7Or.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}