import{r as n,m as he,v as ne,b as fe,f as le,j as e,g as J,h as pe,k as y,p as E,n as X,i as ge,o as ve,G as we,ab as me,B as q,M as ke,L as be,N as xe,O as ye,R as Ce}from"./input.js";import{an as je,B as Se,A as De,a5 as Ie,H as Y,T as Q,z as Pe,ao as Re,a3 as ie,m as _e,l as ae,j as re,ap as Fe,k as Ee,F as Le,x as U,aq as z,ar as Me,as as Ne,at as We,au as Te,ab as Ve,aa as He}from"./App-iJ8dSmpT.js";import{app as Ae}from"/scripts/app.js";import{t as Be}from"./index-pz0vT7Or.js";import{T as Oe}from"./chunk-RPO2WXNL-dt-e86vT.js";import"/scripts/api.js";function Ue(t){return t&&ne(t)&&ne(t.target)}function qe(t={}){const{onChange:f,value:r,defaultValue:s,name:p,isDisabled:u,isFocusable:d,isNative:g,...h}=t,[b,j]=n.useState(s||""),k=typeof r<"u",S=k?r:b,w=n.useRef(null),D=n.useCallback(()=>{const a=w.current;if(!a)return;let c="input:not(:disabled):checked";const I=a.querySelector(c);if(I){I.focus();return}c="input:not(:disabled)";const o=a.querySelector(c);o==null||o.focus()},[]),v=`radio-${n.useId()}`,M=p||v,R=n.useCallback(a=>{const c=Ue(a)?a.target.value:a;k||j(c),f==null||f(String(c))},[f,k]),A=n.useCallback((a={},c=null)=>({...a,ref:he(c,w),role:"radiogroup"}),[]),_=n.useCallback((a={},c=null)=>({...a,ref:c,name:M,[g?"checked":"isChecked"]:S!=null?a.value===S:void 0,onChange(o){R(o)},"data-radiogroup":!0}),[g,M,R,S]);return{getRootProps:A,getRadioProps:_,name:M,ref:w,focus:D,setValue:j,value:S,onChange:R,isDisabled:u,isFocusable:d,htmlProps:h}}var[Ge,ce]=fe({name:"RadioGroupContext",strict:!1}),de=le((t,f)=>{const{colorScheme:r,size:s,variant:p,children:u,className:d,isDisabled:g,isFocusable:h,...b}=t,{value:j,onChange:k,getRootProps:S,name:w,htmlProps:D}=qe(b),L=n.useMemo(()=>({name:w,size:s,onChange:k,colorScheme:r,value:j,variant:p,isDisabled:g,isFocusable:h}),[w,s,k,r,j,p,g,h]);return e.jsx(Ge,{value:L,children:e.jsx(J.div,{...S(D,f),className:pe("chakra-radio-group",d),children:u})})});de.displayName="RadioGroup";var Ke={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function $e(t={}){const{defaultChecked:f,isChecked:r,isFocusable:s,isDisabled:p,isReadOnly:u,isRequired:d,onChange:g,isInvalid:h,name:b,value:j,id:k,"data-radiogroup":S,"aria-describedby":w,...D}=t,L=`radio-${n.useId()}`,v=je(),R=!!ce()||!!S;let _=!!v&&!R?v.id:L;_=k??_;const a=p??(v==null?void 0:v.isDisabled),c=u??(v==null?void 0:v.isReadOnly),I=d??(v==null?void 0:v.isRequired),o=h??(v==null?void 0:v.isInvalid),[l,P]=n.useState(!1),[m,C]=n.useState(!1),[x,N]=n.useState(!1),[W,T]=n.useState(!1),[G,K]=n.useState(!!f),B=typeof r<"u",F=B?r:G;n.useEffect(()=>Be(P),[]);const V=n.useCallback(i=>{if(c||a){i.preventDefault();return}B||K(i.target.checked),g==null||g(i)},[B,a,c,g]),O=n.useCallback(i=>{i.key===" "&&T(!0)},[T]),$=n.useCallback(i=>{i.key===" "&&T(!1)},[T]),ee=n.useCallback((i={},H=null)=>({...i,ref:H,"data-active":y(W),"data-hover":y(x),"data-disabled":y(a),"data-invalid":y(o),"data-checked":y(F),"data-focus":y(m),"data-focus-visible":y(m&&l),"data-readonly":y(c),"aria-hidden":!0,onMouseDown:E(i.onMouseDown,()=>T(!0)),onMouseUp:E(i.onMouseUp,()=>T(!1)),onMouseEnter:E(i.onMouseEnter,()=>N(!0)),onMouseLeave:E(i.onMouseLeave,()=>N(!1))}),[W,x,a,o,F,m,c,l]),{onFocus:oe,onBlur:se}=v??{},ue=n.useCallback((i={},H=null)=>{const te=a&&!s;return{...i,id:_,ref:H,type:"radio",name:b,value:j,onChange:E(i.onChange,V),onBlur:E(se,i.onBlur,()=>C(!1)),onFocus:E(oe,i.onFocus,()=>C(!0)),onKeyDown:E(i.onKeyDown,O),onKeyUp:E(i.onKeyUp,$),checked:F,disabled:te,readOnly:c,required:I,"aria-invalid":X(o),"aria-disabled":X(te),"aria-required":X(I),"data-readonly":y(c),"aria-describedby":w,style:Ke}},[a,s,_,b,j,V,se,oe,O,$,F,c,I,o,w]);return{state:{isInvalid:o,isFocused:m,isChecked:F,isActive:W,isHovered:x,isDisabled:a,isReadOnly:c,isRequired:I},getCheckboxProps:ee,getRadioProps:ee,getInputProps:ue,getLabelProps:(i={},H=null)=>({...i,ref:H,onMouseDown:E(i.onMouseDown,ze),"data-disabled":y(a),"data-checked":y(F),"data-invalid":y(o)}),getRootProps:(i,H=null)=>({...i,ref:H,"data-disabled":y(a),"data-checked":y(F),"data-invalid":y(o)}),htmlProps:D}}function ze(t){t.preventDefault(),t.stopPropagation()}function Je(t,f){const r={},s={};for(const[p,u]of Object.entries(t))f.includes(p)?r[p]=u:s[p]=u;return[r,s]}var Z=le((t,f)=>{var r;const s=ce(),{onChange:p,value:u}=t,d=ge("Radio",{...s,...t}),g=ve(t),{spacing:h="0.5rem",children:b,isDisabled:j=s==null?void 0:s.isDisabled,isFocusable:k=s==null?void 0:s.isFocusable,inputProps:S,...w}=g;let D=t.isChecked;(s==null?void 0:s.value)!=null&&u!=null&&(D=s.value===u);let L=p;s!=null&&s.onChange&&u!=null&&(L=we(s.onChange,p));const v=(r=t==null?void 0:t.name)!=null?r:s==null?void 0:s.name,{getInputProps:M,getCheckboxProps:R,getLabelProps:A,getRootProps:_,htmlProps:a}=$e({...w,isChecked:D,isFocusable:k,isDisabled:j,onChange:L,name:v}),[c,I]=Je(a,me),o=R(I),l=M(S,f),P=A(),m=Object.assign({},c,_()),C={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...d.container},x={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...d.control},N={userSelect:"none",marginStart:h,...d.label};return e.jsxs(J.label,{className:"chakra-radio",...m,__css:C,children:[e.jsx("input",{className:"chakra-radio__input",...l}),e.jsx(J.span,{className:"chakra-radio__control",...o,__css:x}),b&&e.jsx(J.span,{className:"chakra-radio__label",...P,__css:N,children:b})]})});Z.displayName="Radio";function Ye({options:t,value:f,onChange:r}){const[s,p]=n.useState(!1),u=n.useRef(null),d=t.find(h=>h.value===f);n.useEffect(()=>{const h=b=>{u.current&&!u.current.contains(b.target)&&p(!1)};return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[u]);const g=()=>p(!s);return e.jsxs(Se,{position:"relative",children:[e.jsx(q,{onClick:g,rightIcon:e.jsx(De,{}),leftIcon:d==null?void 0:d.icon,children:d==null?void 0:d.label}),s&&e.jsx(Ie,{gap:4,ref:u,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:t.map(h=>e.jsx(q,{onClick:()=>{p(!1),r(h.value)},leftIcon:h.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:h.label},h.label))})]})}function Qe({version:t,cloudHost:f}){const r=t,s=e.jsxs(Y,{spacing:4,alignItems:"center",children:[e.jsx(Q,{children:r.name}),e.jsx(Q,{color:"GrayText",children:Pe(r.createTime,!1)}),r.cloudID&&e.jsx("a",{href:f+"/workflow_ver/"+r.cloudID,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsx(q,{size:"xs",colorScheme:"teal",variant:"outline",leftIcon:e.jsx(Re,{}),rightIcon:e.jsx(ie,{size:18}),children:"Shared"})})]});return t.cloudID?e.jsx(e.Fragment,{children:s}):e.jsx(Z,{value:r.id,mb:5,children:s},r.id)}function io({onClose:t}){var c,I;const[f,r]=n.useState("version "+Xe()),[s,p]=n.useState([]),[u,d]=n.useState(!1),[g,h]=n.useState(""),[b,j]=n.useState("PRIVATE"),[k,S]=n.useState("new_version"),w=n.useRef(""),[D,L]=n.useState(),v=_e(),M=async o=>{var N,W;const l=o.data;if(o.origin!==w.current||l.type!=="share_workflow_success")return;const P=l.localWorkflowID,m=l.localVersionID,C=l.version.id,x=l.version.workflowID;x&&P&&await((N=U)==null?void 0:N.updateFlow(P,{cloudID:x,cloudURL:w.current+"/workflow/"+x})),m&&C&&await((W=z)==null?void 0:W.update(m,{cloudID:C,cloudURL:w.current+"/workflow_ver/"+C})),R(),window.open(w.current+"/workflow_ver/"+C,"_blank"),d(!1)};n.useEffect(()=>(R(),window.addEventListener("message",M),()=>{window.removeEventListener("message",M)}),[]);const R=async()=>{var P,m,C;const o=await((P=ae)==null?void 0:P.getSetting("cloudHost"));o&&(h(o),w.current=o);const l=((m=U)==null?void 0:m.curWorkflow)??void 0;L(l),l!=null&&l.cloudID&&l.cloudURL&&We(l).then(x=>{j(x)}),(C=z)==null||C.listByWorkflowID(l.id).then(x=>{p(x)})},A=o=>{navigator.clipboard.writeText(o).then(()=>{v({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(l=>{console.error("Failed to copy text: ",l)})},_=async()=>{var K,B,F;d(!0);const o=Me(32),l=await((K=ae)==null?void 0:K.getSetting("cloudHost"));let P,m;try{if(P=Ne(),k==="new_version"?m=await((B=z)==null?void 0:B.add({workflowID:D.id,name:f,createTime:Date.now(),json:JSON.stringify(Ae.graph.serialize())})):m=await((F=z)==null?void 0:F.get(k)),!m){alert(`Failed to find version: ${k}, please try again.`),d(!1);return}}catch(V){console.error(V),d(!1),alert("Failed to share workflow, please try again.");return}const C=window.location.protocol,x=window.location.host,N=`${C}//${x}`,W=l+`/share_workflow_confirm/${o}?redirectUrl=${N}`,T=window.open(W,"Share Workflow","width=800,height=800"),G=V=>{var O;if(V.origin===l&&V.data==="child_ready"){const $=(O=U)==null?void 0:O.curWorkflow;T.postMessage({workflow:$,version:m,nodeDefs:P,privacy:b},l),window.removeEventListener("message",G)}};window.addEventListener("message",G)},a=(I=(c=U)==null?void 0:c.curWorkflow)==null?void 0:I.cloudID;return e.jsxs(ke,{isOpen:!0,onClose:t,size:"lg",children:[e.jsx(be,{}),e.jsxs(xe,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsxs(ye,{children:['Share "',D==null?void 0:D.name,'"']}),e.jsxs(Ce,{pb:10,children:[e.jsxs(re,{gap:5,children:[a==null?e.jsx(Ye,{options:Fe,value:b,onChange:o=>{j(o)}}):e.jsx(Oe,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(Te,{privacy:b,showEmoji:!0})}),a&&e.jsxs(Y,{spacing:2,color:"teal.400",children:[e.jsxs(Ve,{href:g+"/workflow/"+a,isExternal:!0,children:[g+"/workflow/"+a," ",e.jsx(ie,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(q,{width:"180px",size:"sm",leftIcon:e.jsx(He,{}),onClick:()=>{var o,l;A(g+"/workflow/"+((l=(o=U)==null?void 0:o.curWorkflow)==null?void 0:l.cloudID))},children:"Copy link"})]}),e.jsx(Q,{children:"Choose a version to share:"}),e.jsx(de,{gap:4,onChange:o=>{S(o)},value:k,children:e.jsxs(re,{children:[e.jsxs(Y,{mb:5,alignItems:"center",children:[e.jsx(Z,{value:"new_version"},"new_version"),e.jsx(Ee,{value:f,width:"60%",onFocus:()=>{S("new_version")},onChange:o=>{r(o.target.value)}}),e.jsx(Le,{color:"green",children:e.jsx(Q,{children:"New version"})})]}),s.slice(0,4).map(o=>e.jsx(Qe,{version:o,cloudHost:g},o.id))]})})]}),e.jsx(Y,{justifyContent:"flex-end",mt:16,children:e.jsx(q,{colorScheme:"teal",onClick:_,isDisabled:u,children:u?"Sharing":"Share"})})]})]})]})}function Xe(){const t=new Date,f=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${f}-${r}-${s}`}export{io as default};
