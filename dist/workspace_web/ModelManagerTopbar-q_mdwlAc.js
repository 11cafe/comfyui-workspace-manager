import{f as $,r as g,j as n,g as O,e as re,a4 as X,b as Ye,o as _e,k as be,l as qe,ac as Qe,h as T,a9 as ae,ad as Je,N as Ie,ae as Xe,Q as ke,S as Ce,T as Ze,Z as et,M as tt,O as st,R as nt,P as ot,_ as it}from"./input.js";import{aj as rt,ai as at,_ as lt,ak as Y,o as W,B as oe,F as K,l as F,m as ie,al as Le,am as me,aa as Ee,k as Z,z as ct,H as B,n as ee,an as Te,j as Ae,ao as Ne,$ as dt,a0 as ht,a1 as ut,a2 as ft,a3 as pt,ap as Fe,aq as te,ah as Pe,ar as mt,as as gt,ab as xt,at as yt,au as vt}from"./App-drfZ5q2u.js";import{I as De,G as wt,C as Mt}from"./chunk-JARCRF6W-8reMSw11.js";import{app as U}from"/scripts/app.js";import{api as J}from"/scripts/api.js";var Oe=$(function(e,s){const{spacing:o="0.5rem",spacingX:i,spacingY:r,children:a,justify:c,direction:l,align:h,className:d,shouldWrapChildren:f,...u}=e,m=g.useMemo(()=>f?g.Children.map(a,(p,x)=>n.jsx(le,{children:p},x)):a,[a,f]);return n.jsx(O.div,{ref:s,className:re("chakra-wrap",d),...u,children:n.jsx(O.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:c,alignItems:h,flexDirection:l,listStyleType:"none",gap:o,columnGap:i,rowGap:r,padding:"0"},children:m})})});Oe.displayName="Wrap";var le=$(function(e,s){const{className:o,...i}=e;return n.jsx(O.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:re("chakra-wrap__listitem",o),...i})});le.displayName="WrapItem";function ge(t){return at(t,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}var ze=$(function(e,s){const{area:o,colSpan:i,colStart:r,colEnd:a,rowEnd:c,rowSpan:l,rowStart:h,...d}=e,f=rt({gridArea:o,gridColumn:ge(i),gridRow:ge(l),gridColumnStart:r,gridColumnEnd:a,gridRowStart:h,gridRowEnd:c});return n.jsx(O.div,{ref:s,__css:f,...d})});ze.displayName="GridItem";function St(t,e,s){return(t-e)*100/(s-e)}X({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});X({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var jt=X({"0%":{left:"-40%"},"100%":{left:"100%"}}),_t=X({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function bt(t){const{value:e=0,min:s,max:o,valueText:i,getValueText:r,isIndeterminate:a,role:c="progressbar"}=t,l=St(e,s,o);return{bind:{"data-indeterminate":a?"":void 0,"aria-valuemax":o,"aria-valuemin":s,"aria-valuenow":a?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof r=="function"?r(e,l):i})(),role:c},percent:l,value:e}}var[It,kt]=Ye({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Ct=$((t,e)=>{const{min:s,max:o,value:i,isIndeterminate:r,role:a,...c}=t,l=bt({value:i,min:s,max:o,isIndeterminate:r,role:a}),d={height:"100%",...kt().filledTrack};return n.jsx(O.div,{ref:e,style:{width:`${l.percent}%`,...c.style},...l.bind,...c,__css:d})}),Be=$((t,e)=>{var s;const{value:o,min:i=0,max:r=100,hasStripe:a,isAnimated:c,children:l,borderRadius:h,isIndeterminate:d,"aria-label":f,"aria-labelledby":u,"aria-valuetext":m,title:p,role:x,...y}=_e(t),v=be("Progress",t),j=h??((s=v.track)==null?void 0:s.borderRadius),_={animation:`${_t} 1s linear infinite`},P={...!d&&a&&c&&_,...d&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${jt} 1s ease infinite normal none running`}},k={overflow:"hidden",position:"relative",...v.track};return n.jsx(O.div,{ref:e,borderRadius:j,__css:k,...y,children:n.jsxs(It,{value:v,children:[n.jsx(Ct,{"aria-label":f,"aria-labelledby":u,"aria-valuetext":m,min:i,max:r,value:o,isIndeterminate:d,css:P,borderRadius:j,title:p,role:x}),l]})})});Be.displayName="Progress";var We=$(function(e,s){const{children:o,placeholder:i,className:r,...a}=e;return n.jsxs(O.select,{...a,ref:s,className:re("chakra-select",r),children:[i&&n.jsx("option",{value:"",children:i}),o]})});We.displayName="SelectField";function Lt(t,e){const s={},o={};for(const[i,r]of Object.entries(t))e.includes(i)?s[i]=r:o[i]=r;return[s,o]}var q=$((t,e)=>{var s;const o=be("Select",t),{rootProps:i,placeholder:r,icon:a,color:c,height:l,h,minH:d,minHeight:f,iconColor:u,iconSize:m,...p}=_e(t),[x,y]=Lt(p,Qe),v=lt(y),j={width:"100%",height:"fit-content",position:"relative",color:c},_={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(s=o.field)==null?void 0:s._focus}};return n.jsxs(O.div,{className:"chakra-select__wrapper",__css:j,...x,...i,children:[n.jsx(We,{ref:e,height:h??l,minH:d??f,placeholder:r,...v,__css:_,children:t.children}),n.jsx(Re,{"data-disabled":qe(v.disabled),...(u||c)&&{color:u||c},__css:o.icon,...m&&{fontSize:m},children:a})]})});q.displayName="Select";var Et=t=>n.jsx("svg",{viewBox:"0 0 24 24",...t,children:n.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Tt=O("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Re=t=>{const{children:e=n.jsx(Et,{}),...s}=t,o=g.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return n.jsx(Tt,{...s,className:"chakra-select__icon-wrapper",children:g.isValidElement(e)?o:null})};Re.displayName="SelectIcon";function G(t){return Array.isArray?Array.isArray(t):Ge(t)==="[object Array]"}const At=1/0;function Nt(t){return t==null?"":function(e){if(typeof e=="string")return e;let s=e+"";return s=="0"&&1/e==-At?"-0":s}(t)}function D(t){return typeof t=="string"}function Ke(t){return typeof t=="number"}function Ft(t){return t===!0||t===!1||function(e){return function(s){return typeof s=="object"}(e)&&e!==null}(t)&&Ge(t)=="[object Boolean]"}function N(t){return t!=null}function se(t){return!t.trim().length}function Ge(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Pt=t=>`Missing ${t} property in key`,Dt=t=>`Property 'weight' in key '${t}' must be a positive integer`,xe=Object.prototype.hasOwnProperty;class Ot{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(o=>{let i=$e(o);this._keys.push(i),this._keyMap[i.id]=i,s+=i.weight}),this._keys.forEach(o=>{o.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function $e(t){let e=null,s=null,o=null,i=1,r=null;if(D(t)||G(t))o=t,e=ye(t),s=ve(t);else{if(!xe.call(t,"name"))throw new Error(Pt("name"));const a=t.name;if(o=a,xe.call(t,"weight")&&(i=t.weight,i<=0))throw new Error(Dt(a));e=ye(a),s=ve(a),r=t.getFn}return{path:e,id:s,weight:i,src:o,getFn:r}}function ye(t){return G(t)?t:t.split(".")}function ve(t){return G(t)?t.join("."):t}var S={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,useExtendedSearch:!1,getFn:function(t,e){let s=[],o=!1;const i=(r,a,c)=>{if(N(r))if(a[c]){const l=r[a[c]];if(!N(l))return;if(c===a.length-1&&(D(l)||Ke(l)||Ft(l)))s.push(Nt(l));else if(G(l)){o=!0;for(let h=0,d=l.length;h<d;h+=1)i(l[h],a,c+1)}else a.length&&i(l,a,c+1)}else s.push(r)};return i(t,D(e)?e.split("."):e,0),o?s:s[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};const zt=/[^ ]+/g;class ce{constructor({getFn:e=S.getFn,fieldNormWeight:s=S.fieldNormWeight}={}){this.norm=function(o=1,i=3){const r=new Map,a=Math.pow(10,i);return{get(c){const l=c.match(zt).length;if(r.has(l))return r.get(l);const h=1/Math.pow(l,.5*o),d=parseFloat(Math.round(h*a)/a);return r.set(l,d),d},clear(){r.clear()}}}(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,o)=>{this._keysMap[s.id]=o})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,D(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();D(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,o=this.size();s<o;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!N(e)||se(e))return;let o={v:e,i:s,n:this.norm.get(e)};this.records.push(o)}_addObject(e,s){let o={i:s,$:{}};this.keys.forEach((i,r)=>{let a=i.getFn?i.getFn(e):this.getFn(e,i.path);if(N(a)){if(G(a)){let c=[];const l=[{nestedArrIndex:-1,value:a}];for(;l.length;){const{nestedArrIndex:h,value:d}=l.pop();if(N(d))if(D(d)&&!se(d)){let f={v:d,i:h,n:this.norm.get(d)};c.push(f)}else G(d)&&d.forEach((f,u)=>{l.push({nestedArrIndex:u,value:f})})}o.$[r]=c}else if(D(a)&&!se(a)){let c={v:a,n:this.norm.get(a)};o.$[r]=c}}}),this.records.push(o)}toJSON(){return{keys:this.keys,records:this.records}}}function Ve(t,e,{getFn:s=S.getFn,fieldNormWeight:o=S.fieldNormWeight}={}){const i=new ce({getFn:s,fieldNormWeight:o});return i.setKeys(t.map($e)),i.setSources(e),i.create(),i}function Q(t,{errors:e=0,currentLocation:s=0,expectedLocation:o=0,distance:i=S.distance,ignoreLocation:r=S.ignoreLocation}={}){const a=e/t.length;if(r)return a;const c=Math.abs(o-s);return i?a+c/i:c?1:a}const R=32;function Bt(t,e,s,{location:o=S.location,distance:i=S.distance,threshold:r=S.threshold,findAllMatches:a=S.findAllMatches,minMatchCharLength:c=S.minMatchCharLength,includeMatches:l=S.includeMatches,ignoreLocation:h=S.ignoreLocation}={}){if(e.length>R)throw new Error(`Pattern length exceeds max of ${R}.`);const d=e.length,f=t.length,u=Math.max(0,Math.min(o,f));let m=r,p=u;const x=c>1||l,y=x?Array(f):[];let v;for(;(v=t.indexOf(e,p))>-1;){let k=Q(e,{currentLocation:v,expectedLocation:u,distance:i,ignoreLocation:h});if(m=Math.min(k,m),p=v+d,x){let C=0;for(;C<d;)y[v+C]=1,C+=1}}p=-1;let j=[],_=1,A=d+f;const V=1<<d-1;for(let k=0;k<d;k+=1){let C=0,L=A;for(;C<L;)Q(e,{errors:k,currentLocation:u+L,expectedLocation:u,distance:i,ignoreLocation:h})<=m?C=L:A=L,L=Math.floor((A-C)/2+C);A=L;let z=Math.max(1,u-L+1),E=a?f:Math.min(u+L,f)+d,w=Array(E+2);w[E+1]=(1<<k)-1;for(let M=E;M>=z;M-=1){let b=M-1,I=s[t.charAt(b)];if(x&&(y[b]=+!!I),w[M]=(w[M+1]<<1|1)&I,k&&(w[M]|=(j[M+1]|j[M])<<1|1|j[M+1]),w[M]&V&&(_=Q(e,{errors:k,currentLocation:b,expectedLocation:u,distance:i,ignoreLocation:h}),_<=m)){if(m=_,p=b,p<=u)break;z=Math.max(1,2*u-p)}}if(Q(e,{errors:k+1,currentLocation:u,expectedLocation:u,distance:i,ignoreLocation:h})>m)break;j=w}const P={isMatch:p>=0,score:Math.max(.001,_)};if(x){const k=function(C=[],L=S.minMatchCharLength){let z=[],E=-1,w=-1,M=0;for(let b=C.length;M<b;M+=1){let I=C[M];I&&E===-1?E=M:I||E===-1||(w=M-1,w-E+1>=L&&z.push([E,w]),E=-1)}return C[M-1]&&M-E>=L&&z.push([E,M-1]),z}(y,c);k.length?l&&(P.indices=k):P.isMatch=!1}return P}function Wt(t){let e={};for(let s=0,o=t.length;s<o;s+=1){const i=t.charAt(s);e[i]=(e[i]||0)|1<<o-s-1}return e}class Rt{constructor(e,{location:s=S.location,threshold:o=S.threshold,distance:i=S.distance,includeMatches:r=S.includeMatches,findAllMatches:a=S.findAllMatches,minMatchCharLength:c=S.minMatchCharLength,isCaseSensitive:l=S.isCaseSensitive,ignoreLocation:h=S.ignoreLocation}={}){if(this.options={location:s,threshold:o,distance:i,includeMatches:r,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreLocation:h},this.pattern=l?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const d=(u,m)=>{this.chunks.push({pattern:u,alphabet:Wt(u),startIndex:m})},f=this.pattern.length;if(f>R){let u=0;const m=f%R,p=f-m;for(;u<p;)d(this.pattern.substr(u,R),u),u+=R;if(m){const x=f-R;d(this.pattern.substr(x),x)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,includeMatches:o}=this.options;if(s||(e=e.toLowerCase()),this.pattern===e){let p={isMatch:!0,score:0};return o&&(p.indices=[[0,e.length-1]]),p}const{location:i,distance:r,threshold:a,findAllMatches:c,minMatchCharLength:l,ignoreLocation:h}=this.options;let d=[],f=0,u=!1;this.chunks.forEach(({pattern:p,alphabet:x,startIndex:y})=>{const{isMatch:v,score:j,indices:_}=Bt(e,p,x,{location:i+y,distance:r,threshold:a,findAllMatches:c,minMatchCharLength:l,includeMatches:o,ignoreLocation:h});v&&(u=!0),f+=j,v&&_&&(d=[...d,..._])});let m={isMatch:u,score:u?f/this.chunks.length:1};return u&&o&&(m.indices=d),m}}const we=[];function Me(t,e){for(let s=0,o=we.length;s<o;s+=1){let i=we[s];if(i.condition(t,e))return new i(t,e)}return new Rt(t,e)}function Kt(t,e){const s=t.matches;e.matches=[],N(s)&&s.forEach(o=>{if(!N(o.indices)||!o.indices.length)return;const{indices:i,value:r}=o;let a={indices:i,value:r};o.key&&(a.key=o.key.src),o.idx>-1&&(a.refIndex=o.idx),e.matches.push(a)})}function Gt(t,e){e.score=t.score}class H{constructor(e,s={},o){if(this.options={...S,...s},this.options.useExtendedSearch)throw new Error("Extended search is not available");this._keyStore=new Ot(this.options.keys),this.setCollection(e,o)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof ce))throw new Error("Incorrect 'index' type");this._myIndex=s||Ve(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){N(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let o=0,i=this._docs.length;o<i;o+=1){const r=this._docs[o];e(r,o)&&(this.removeAt(o),o-=1,i-=1,s.push(r))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:o,includeScore:i,shouldSort:r,sortFn:a,ignoreFieldNorm:c}=this.options;let l=D(e)?D(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(h,{ignoreFieldNorm:d=S.ignoreFieldNorm}){h.forEach(f=>{let u=1;f.matches.forEach(({key:m,norm:p,score:x})=>{const y=m?m.weight:null;u*=Math.pow(x===0&&y?Number.EPSILON:x,(y||1)*(d?1:p))}),f.score=u})}(l,{ignoreFieldNorm:c}),r&&l.sort(a),Ke(s)&&s>-1&&(l=l.slice(0,s)),function(h,d,{includeMatches:f=S.includeMatches,includeScore:u=S.includeScore}={}){const m=[];return f&&m.push(Kt),u&&m.push(Gt),h.map(p=>{const{idx:x}=p,y={item:d[x],refIndex:x};return m.length&&m.forEach(v=>{v(p,y)}),y})}(l,this._docs,{includeMatches:o,includeScore:i})}_searchStringList(e){const s=Me(e,this.options),{records:o}=this._myIndex,i=[];return o.forEach(({v:r,i:a,n:c})=>{if(!N(r))return;const{isMatch:l,score:h,indices:d}=s.searchIn(r);l&&i.push({item:r,idx:a,matches:[{score:h,value:r,norm:c,indices:d}]})}),i}_searchLogical(e){throw new Error("Logical search is not available")}_searchObjectList(e){const s=Me(e,this.options),{keys:o,records:i}=this._myIndex,r=[];return i.forEach(({$:a,i:c})=>{if(!N(a))return;let l=[];o.forEach((h,d)=>{l.push(...this._findMatches({key:h,value:a[d],searcher:s}))}),l.length&&r.push({idx:c,item:a,matches:l})}),r}_findMatches({key:e,value:s,searcher:o}){if(!N(s))return[];let i=[];if(G(s))s.forEach(({v:r,i:a,n:c})=>{if(!N(r))return;const{isMatch:l,score:h,indices:d}=o.searchIn(r);l&&i.push({score:h,key:e,value:r,idx:a,norm:c,indices:d})});else{const{v:r,n:a}=s,{isMatch:c,score:l,indices:h}=o.searchIn(r);c&&i.push({score:l,key:e,value:r,norm:a,indices:h})}return i}}H.version="7.0.0",H.createIndex=Ve,H.parseIndex=function(t,{getFn:e=S.getFn,fieldNormWeight:s=S.fieldNormWeight}={}){const{keys:o,records:i}=t,r=new ce({getFn:e,fieldNormWeight:s});return r.setKeys(o),r.setIndexRecords(i),r},H.config=S;function $t({selectedModel:t,setSelectedModel:e,modelTypeList:s}){const o=i=>{e(i)};return n.jsx(Oe,{children:s.map(i=>n.jsx(le,{children:n.jsx(T,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>o(i),size:"sm",children:i})},i))})}const Vt={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function Ht({data:t}){const[e,s]=g.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[o,i]=g.useState(!t.file_hash),[r,a]=g.useState();g.useEffect(()=>{i(!t.file_hash),c()},[t.file_hash]);const c=async()=>{var d,f,u,m;const h=await Y.models.get(t.model_name+"@"+t.model_type);if(h!=null&&(a(h),(d=h.imageUrl)!=null&&d.length&&s(h.imageUrl)),t.file_hash!=null)try{const p=`https://civitai.com/api/v1/model-versions/by-hash/${t.file_hash}`,y=await(await fetch(p)).json();let v;if(await((f=W)==null?void 0:f.getSetting("showNsfwModelThumbnail"))===!0)v=(m=(u=y==null?void 0:y.images)==null?void 0:u[0])==null?void 0:m.url;else if(!y.model.nsfw){const A=y.images.find(V=>V.nsfw==="None");v=A==null?void 0:A.url}v&&s(v);const _={id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,modelName:y.model.name,civitModelID:String(y.modelId),civitModelVersionID:String(y.id),imageUrl:v??null};Y.models.put(_),a(_)}catch{}t.preview&&s(t.preview)},l=h=>{const d=Vt[t.model_type];d&&(h.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),h.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),h.dataTransfer.setData("nodeType",d))};return n.jsxs(oe,{children:[n.jsxs(oe,{position:"relative",borderRadius:4,draggable:!0,onDragStart:l,children:[o?n.jsx(K,{bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:n.jsx(ae,{})}):n.jsx(De,{src:e,draggable:!1,boxSize:"100%",height:150,objectFit:"cover",borderRadius:4,cursor:(r==null?void 0:r.civitModelID)!=null?"pointer":"auto",onClick:()=>{(r==null?void 0:r.civitModelID)==null||(r==null?void 0:r.civitModelVersionID)==null||window.open(`https://civitai.com/models/${r==null?void 0:r.civitModelID}?modelVersionId=${r==null?void 0:r.civitModelVersionID}`)}}),n.jsx(F,{position:"absolute",bottom:"0",left:"0",right:"0",color:"white",fontSize:14})]}),n.jsx(ie,{label:t.date.toLocaleDateString(),children:n.jsx(F,{textAlign:"center",p:"1",fontSize:14,noOfLines:2,children:(r==null?void 0:r.modelName)??t.model_name})})]})}function Ut({list:t}){return n.jsx(wt,{templateColumns:"repeat(3, minmax(0, 1fr))",gap:1,marginTop:2,children:t.map(e=>n.jsx(ze,{children:n.jsx(Ht,{data:e})},e.model_name+e.date.getTime()))})}const Yt=async t=>{try{const s=await(await J.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:s}))}catch(e){console.error("Failed to connect to the server:",e)}};function Se(t,e=1){const i=t/1024;return i>=1024?(i/1024).toFixed(e)+" GB":i.toFixed(e)+" MB"}function je(t,e){if(!t||t.length===0)return;let s=t.find(o=>o.nsfw==="None");return e&&(s=s??t[0]),s}function qt(t,e=280,s){var o,i,r,a;if(t)return Le(t)?(r=je((i=(o=t.modelVersions)==null?void 0:o.at(0))==null?void 0:i.images,s))==null?void 0:r.url:`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(a=je(t.images,s))==null?void 0:a.url}/width=${e}/`}const ne=280;function Qt({model:t,onClickInstallModel:e,installing:s}){var u,m;const[o,i]=g.useState();g.useEffect(()=>{p();async function p(){var y;const x=await((y=W)==null?void 0:y.getSetting("showNsfwModelThumbnail"));i(qt(t,ne,x))}},[t]);const r=Le(t)?t.modelVersions:t.versions,[a,c]=g.useState(((u=r==null?void 0:r[0])==null?void 0:u.name)??""),l=r==null?void 0:r.find(p=>(p==null?void 0:p.name)===a),h=()=>{window.open(`https://civitai.com/models/${t.id}`)},d=g.useCallback(()=>{if(l==null){console.error("no file is find by name",a);return}e(me(l,t.name),t)},[a]),f=(m=me(l))==null?void 0:m.sizeKB;return n.jsxs(Ee,{width:ne,justifyContent:"space-between",mb:2,gap:1,children:[n.jsx(De,{borderRadius:3,boxSize:ne+"px",objectFit:"cover",src:o,alt:"model cover image",cursor:"pointer",onClick:()=>h()}),n.jsxs(Z,{p:1,children:[n.jsx(ie,{label:t.name,children:n.jsx(F,{fontWeight:500,noOfLines:1,children:t.name})}),n.jsxs(K,{justifyContent:"space-between",alignItems:"center",children:[n.jsx(T,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:n.jsx(F,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),n.jsx(T,{leftIcon:n.jsx(ct,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>d(),isDisabled:!!(a&&s.includes(a)),children:"Install"})]}),n.jsxs(B,{children:[n.jsx(q,{size:"md",style:{paddingLeft:4},onChange:p=>{c(p.target.value)},children:r==null?void 0:r.map(p=>{const x=p==null?void 0:p.name;return x?n.jsx("option",{value:x,style:{padding:0},children:x},p.id):null})}),f&&n.jsx(ie,{label:Se(f),children:n.jsx(F,{flexShrink:1,noOfLines:1,width:"40%",children:Se(f)})})]})]})]})}function Jt({searchQuery:t,setSearchQuery:e,onSearch:s}){return n.jsxs(K,{gap:1,alignItems:"center",grow:1,children:[n.jsx(ee,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:o=>e(o.target.value),onKeyUp:o=>{o.code==="Enter"&&s()}}),n.jsx(T,{size:"sm",onClick:()=>s(),colorScheme:"teal",children:"Search"})]})}function Xt({isOpen:t,fileSelected:e,onClose:s,selectFolder:o}){const[i,r]=g.useState(""),[a,c]=g.useState([]),[l,h]=g.useState(""),d=g.useRef(null);g.useEffect(()=>{f()},[]);const f=async()=>{const u=await Te();u&&(["custom_nodes","config","saved_prompts"].forEach(m=>{delete u[m]}),c(Object.values(u).flatMap(m=>m)))};return n.jsx(Je,{isOpen:t,leastDestructiveRef:d,onClose:s,children:n.jsx(Ie,{children:n.jsxs(Xe,{children:[n.jsx(ke,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),n.jsx(Ce,{children:n.jsxs(Z,{spacing:4,children:[!e&&n.jsxs(n.Fragment,{children:[n.jsx(F,{children:"Model download url"}),n.jsx(ee,{placeholder:"https://civitai.com/api/download/models/311399",onChange:u=>h(u.target.value),value:l})]}),n.jsx(F,{children:"Choose model install folder"}),n.jsx(q,{placeholder:"Select option",value:i,onChange:u=>r(u.target.value),children:a.map(u=>n.jsx("option",{value:u,children:u},u))})]})}),n.jsxs(Ze,{children:[n.jsx(T,{ref:d,onClick:s,children:"Cancel"}),n.jsx(T,{onClick:()=>o(i,l),ml:3,isDisabled:l.length===0,children:"Confirm"})]})]})})})}function Zt(){const{colorMode:t}=et(),e=Ae(),[s,o]=g.useState([]);return g.useEffect(()=>{J.addEventListener("download_progress",i=>{o(i.detail)}),J.addEventListener("download_error",i=>{e({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),n.jsx(Z,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,children:s.map(({save_path:i,progress:r})=>n.jsxs(B,{children:[n.jsx(F,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),n.jsx(Be,{isIndeterminate:!r,hasStripe:!0,width:"50%",value:r}),n.jsxs(F,{fontSize:16,width:"10%",children:[r.toFixed(1),"%"]})]},i))})}const He="WORKSPACE_CIVIT_API_KEY_STORAGE_KEY";function es(){return localStorage.getItem(He)}function ts(t){localStorage.setItem(He,t)}function ss(){const[t,e]=g.useState(""),{onOpen:s,onClose:o,isOpen:i}=Ne(),r=()=>{ts(t),o()};return n.jsxs(dt,{isOpen:i,onOpen:s,onClose:o,placement:"right",closeOnBlur:!1,children:[n.jsx(ht,{children:n.jsx(T,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),n.jsxs(ut,{p:5,children:[n.jsx(ft,{}),n.jsx(pt,{}),n.jsxs(Z,{spacing:4,children:[n.jsx(F,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),n.jsx(ee,{value:t,onChange:a=>e(a.target.value),placeholder:"API Key"}),n.jsx(T,{size:"sm",py:1,mr:8,onClick:r,children:"Save"})]})]})]})}async function ns(t,e){var a,c;const s={queries:[{q:t,indexUid:"models_v5",facets:["category.name","checkpointType","fileFormats","lastVersionAtUnix","tags.name","type","user.username","version.baseModel"],attributesToHighlight:["*"],highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__",limit:80,offset:0}]};return e&&(s.queries[0].filter=[[`"type"="${e}"`]]),((c=(a=await(await fetch("https://meilisearch-v1-6.civitai.com/multi-search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(s)})).json())==null?void 0:a.results)==null?void 0:c.at(0)).hits??[]}function os({onclose:t,searchQuery:e="",modelType:s}){const[o,i]=g.useState([]),[r,a]=g.useState(!1),[c,l]=g.useState(s),h=Ae(),[d,f]=g.useState([]),[u,m]=g.useState(e),{isOpen:p,onOpen:x,onClose:y}=Ne(),[v,j,_]=Fe(),[A,V]=g.useState({}),[P,k]=g.useState(te),C=g.useCallback(async()=>{var I;a(!0);const w=await ns(u,c);i(w);const M=await Te();M&&V(M);const b=await((I=W)==null?void 0:I.getSetting("defaultFolders"));b&&k(b),a(!1)},[u,c]),L=(w,M)=>{var he,ue,fe,pe;if(!((he=_.current)!=null&&he.id)&&!M){console.error("no url to download");return}let b=M??`https://civitai.com/api/download/models/${(ue=_.current)==null?void 0:ue.id}`,I=(fe=_.current)==null?void 0:fe.name;if(!I&&(I=b.split("/").pop(),!I)){console.error("downloadUrl is malformed");return}h({title:"Installing...",description:I,status:"info",duration:4e3,isClosable:!0}),I!=null&&f(Ue=>[...Ue,I??""]);const de=es();de&&(b+=`?token=${de}`),Yt({file_hash:(pe=_.current)==null?void 0:pe.SHA256,filename:I,save_path:w,url:b}),j(void 0),y()},z=async(w,M)=>{const b=P[M.type];j(w),b==null?x():L(b)},E=async(w,M)=>{var I;const b={...P,[w]:M};await((I=W)==null?void 0:I.upsert({defaultFolders:b})),k(b)};return g.useEffect(()=>{C()},[c]),n.jsxs(n.Fragment,{children:[n.jsxs(tt,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[n.jsx(Ie,{}),n.jsxs(st,{width:"90%",maxWidth:"90vw",height:"90vh",children:[n.jsxs(ke,{pb:1,children:[n.jsxs(B,{gap:2,mb:2,alignItems:"center",children:[n.jsx(Pe,{size:"md",mr:2,children:"Models"}),n.jsx(Jt,{searchQuery:u,setSearchQuery:m,onSearch:C}),n.jsx(T,{size:"sm",py:1,mr:8,onClick:x,children:"Custom URL Install"}),n.jsx(ss,{})]}),n.jsxs(B,{gap:2,wrap:"wrap",children:[n.jsx(T,{size:"sm",py:1,onClick:()=>{l(void 0)},isActive:c==null,children:"All"}),mt.map(w=>n.jsx(T,{size:"sm",py:1,isActive:c===w,onClick:()=>{l(w)},children:w},w)),c&&A[te[c]]&&n.jsxs(B,{ml:"auto",children:[n.jsx(F,{fontSize:17,whiteSpace:"nowrap",children:"Default Download Folder:"}),n.jsx(q,{value:P[c],onChange:w=>E(c,w.target.value),children:A[te[c]].map(w=>n.jsx("option",{value:w,children:w}))})]})]}),r&&n.jsx(ae,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),n.jsx(nt,{}),n.jsxs(Ce,{overflowY:"auto",children:[n.jsx(B,{wrap:"wrap",children:o==null?void 0:o.map(w=>n.jsx(Qt,{model:w,onClickInstallModel:z,installing:d},w.id))}),n.jsx(Zt,{})]})]})]}),n.jsx(Xt,{fileSelected:!!v,isOpen:p,onClose:y,selectFolder:(w,M)=>{L(w,_.current?void 0:M)}})]})}function is(){const[t,e]=g.useState(!1);return n.jsxs(n.Fragment,{children:[n.jsx(T,{size:"sm",colorScheme:"teal",onClick:()=>e(!0),children:"Install Models"}),t&&n.jsx(os,{modelType:"Checkpoint",onclose:()=>e(!1)})]})}const rs=()=>{const[t,e]=g.useState(["checkpoints"]),[s,o]=g.useState([]),[i,r]=g.useState(!0);g.useEffect(()=>{a(),J.addEventListener("model_list",l=>{c(l.detail)})},[]);const a=async()=>{const l=await gt();c(l)},c=async l=>{if(!l)return;r(!1);const h=Array.from(new Set(l.map(f=>f.model_type))),d=h.indexOf("checkpoints");d>=0&&h.splice(d,1),h.unshift("checkpoints"),e(h),o(l.map(f=>({...f,date:new Date(f.date*1e3)})))};return{modelTypeList:t,modelsList:s,loading:i}};function as(){const[t,e,s]=Fe(!1),o=()=>{var c;(c=W)==null||c.getSetting("showNsfwModelThumbnail").then(l=>{e(l??!1)})};g.useEffect(()=>{o()},[]);const i=c=>{var h;const l=c.target.checked;(h=W)==null||h.upsert({showNsfwModelThumbnail:l}).then(()=>{o(),r(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},r=async()=>{const c=await Y.models.toArray();for(let l=0;l<c.length;l+=5){const h=c.slice(l,l+5);await Promise.all(h.map(a))}},a=async c=>{var l,h;try{const d=`https://civitai.com/api/v1/model-versions/by-hash/${c.fileHash}`,u=await(await fetch(d)).json();let m;if(s.current)m=(h=(l=u==null?void 0:u.images)==null?void 0:l[0])==null?void 0:h.url;else if(!u.model.nsfw){const p=u.images.find(x=>x.nsfw==="None");m=p==null?void 0:p.url}Y.models.update(c.id,{imageUrl:m??null})}catch{}};return n.jsx(Mt,{isChecked:t,onChange:i,children:"Show NSFW"})}function ls({onClose:t}){const[e,s]=g.useState("checkpoints"),[o,i]=g.useState(""),[r,a]=g.useState("name"),{loading:c,modelTypeList:l,modelsList:h}=rs(),[d,f]=g.useState([]),[u,m]=g.useState([]);g.useEffect(()=>{x();async function x(){const y=await Y.models.toArray();f(h.map(v=>({...v,db:y.find(j=>j.id===v.model_name+"@"+v.model_type)})))}},[h]),g.useEffect(()=>{let x=[];o.length?x=new H(d,{keys:["model_name","db.modelName"]}).search(o).map(j=>j.item):x=h.filter(y=>y.model_type===e).sort((y,v)=>r==="name"?y.model_name.localeCompare(v.model_name):v.date.getTime()-y.date.getTime()),m(x)},[e,h,o,r,d]),g.useEffect(()=>(U.canvasEl.addEventListener("click",t),()=>{U.canvasEl.removeEventListener("click",t)}),[t]);const p=440;return n.jsx(ot,{children:n.jsx(oe,{style:{width:p},children:n.jsxs(Ee,{width:p,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:xt,overflowY:"auto",children:[n.jsxs(K,{justifyContent:"space-between",alignContent:"center",py:3,children:[n.jsx(Pe,{size:"md",mr:2,children:"Models"}),n.jsx(is,{})]}),n.jsx(K,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:n.jsx(ee,{size:"sm",placeholder:"Search",value:o,onChange:x=>i(x.target.value)})}),n.jsxs(K,{gap:4,justifyContent:"space-between",alignItems:"center",mb:1,children:[!o.length&&n.jsxs(B,{children:[n.jsx("span",{children:"Sort By"}),n.jsxs(q,{value:r,size:"sm",width:"120px",onChange:x=>a(x.target.value),children:[n.jsx("option",{value:"name",children:"Name"}),n.jsx("option",{value:"date",children:"Date"})]})]}),n.jsx(as,{})]}),!o.length&&n.jsx($t,{modelTypeList:l,setSelectedModel:s,selectedModel:e}),n.jsx(Ut,{list:u}),c&&n.jsx(K,{justifyContent:"center",alignItems:"center",height:"100%",children:n.jsx(ae,{})})]})})})}const cs=g.lazy(()=>it(()=>import("./InstallMissingModelsButton-3YBLlHRc.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function ds(){const[t,e]=g.useState(!1),[s,o]=g.useState(),i=async a=>{if(a.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const l=a.dataTransfer.getData("modelRelativePath"),h=a.dataTransfer.getData("nodeType"),d=LiteGraph.createNode(h);d.pos=[a.canvasX,a.canvasY],d.configure({widgets_values:[l]}),U.graph.add(d)};g.useEffect(()=>{var a;return(a=W)==null||a.getSetting("modelManagerTopBarStyle").then(c=>{r(c,!1)}),U.canvasEl.addEventListener("drop",i),()=>{U.canvasEl.removeEventListener("drop",i)}},[]);const r=(a,c=!1)=>{var j;const{top:l=0,right:h=0}=s||{},{top:d=0,right:f=0}=a??{};let u=l+d,m=s===void 0?f:h-f;const p=document.documentElement.clientWidth,x=document.documentElement.clientHeight,y=document.getElementById("modelManagerTopBar"),v=(y==null?void 0:y.offsetWidth)||224;u+32>x&&(u=x-38),m+v>p&&(m=p-v-4),o({top:Math.max(4,u),right:Math.max(4,m)}),c&&((j=W)==null||j.upsert({modelManagerTopBarStyle:{top:u,right:m}}))};return n.jsx(yt,{onDragEnd:a=>{r({top:a.y,right:a.x},!0)},dragIconId:"dragModelManagerTopBarIcon",children:s?n.jsxs(B,{style:{position:"fixed",...s},gap:2,draggable:!1,id:"modelManagerTopBar",className:"model-manager-top-bar",children:[n.jsx(vt,{id:"dragModelManagerTopBarIcon",className:"drag-model-manager-top-bar-icon",cursor:"move",size:15,color:"#FFF"}),n.jsx(cs,{}),n.jsx(T,{size:"sm",colorScheme:"blue","aria-label":"My models",onClick:()=>e(!0),px:1,children:"Models"}),t&&n.jsx(ls,{onClose:()=>e(!1)})]}):""})}const gs=Object.freeze(Object.defineProperty({__proto__:null,default:ds},Symbol.toStringTag,{value:"Module"}));export{ze as G,is as I,gs as M,ns as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-3YBLlHRc.js","workspace_web/input.js","workspace_web/App-drfZ5q2u.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-NTCQBYKE-USZln8kG.js","workspace_web/chunk-JARCRF6W-8reMSw11.js","workspace_web/index-pz0vT7Or.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}