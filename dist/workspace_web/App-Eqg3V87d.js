var li=Object.defineProperty;var ci=(t,e,n)=>e in t?li(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ie=(t,e,n)=>(ci(t,typeof e!="symbol"?e+"":e,n),n);import{r as w,c as jt,m as Fe,u as at,f as ee,j as x,B as Ye,a as ui,b as Y,d as le,o as ze,e as cn,g as Se,I as di,h as or,i as hr,k as je,l as fi,n as hi,p as pi,q as mi,s as sr,t as vi,v as yi,w as gi,x as wi,y as bi,z as Ps,A as xi,C as js,D as _i,E as ki,F as Ci,P as uo,M as Ns,G as As,H as Fs,J as Ms,K as Rs,L as Ts,N as Bs,O as Ei,R as fo,_ as ho}from"./input.js";import{app as Ie}from"/scripts/app.js";import{api as Yo}from"/scripts/api.js";function Oi(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Di=Oi();function Ii(t){const e=Object.assign({},t);for(let n in e)e[n]===void 0&&delete e[n];return e}var Si=Object.defineProperty,Pi=(t,e,n)=>e in t?Si(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,re=(t,e,n)=>(Pi(t,typeof e!="symbol"?e+"":e,n),n);function Go(t){return t.sort((e,n)=>{const r=e.compareDocumentPosition(n);if(r&Node.DOCUMENT_POSITION_FOLLOWING||r&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(r&Node.DOCUMENT_POSITION_PRECEDING||r&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(r&Node.DOCUMENT_POSITION_DISCONNECTED||r&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}var ji=t=>typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE;function Xo(t,e,n){let r=t+1;return n&&r>=e&&(r=0),r}function Zo(t,e,n){let r=t-1;return n&&r<0&&(r=e),r}var Dr=typeof window<"u"?w.useLayoutEffect:w.useEffect,Wn=t=>t,Ni=class{constructor(){re(this,"descendants",new Map),re(this,"register",t=>{if(t!=null)return ji(t)?this.registerNode(t):e=>{this.registerNode(e,t)}}),re(this,"unregister",t=>{this.descendants.delete(t);const e=Go(Array.from(this.descendants.keys()));this.assignIndex(e)}),re(this,"destroy",()=>{this.descendants.clear()}),re(this,"assignIndex",t=>{this.descendants.forEach(e=>{const n=t.indexOf(e.node);e.index=n,e.node.dataset.index=e.index.toString()})}),re(this,"count",()=>this.descendants.size),re(this,"enabledCount",()=>this.enabledValues().length),re(this,"values",()=>Array.from(this.descendants.values()).sort((e,n)=>e.index-n.index)),re(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),re(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),re(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),re(this,"first",()=>this.item(0)),re(this,"firstEnabled",()=>this.enabledItem(0)),re(this,"last",()=>this.item(this.descendants.size-1)),re(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),re(this,"indexOf",t=>{var e,n;return t&&(n=(e=this.descendants.get(t))==null?void 0:e.index)!=null?n:-1}),re(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(e=>e.node.isSameNode(t))),re(this,"next",(t,e=!0)=>{const n=Xo(t,this.count(),e);return this.item(n)}),re(this,"nextEnabled",(t,e=!0)=>{const n=this.item(t);if(!n)return;const r=this.enabledIndexOf(n.node),o=Xo(r,this.enabledCount(),e);return this.enabledItem(o)}),re(this,"prev",(t,e=!0)=>{const n=Zo(t,this.count()-1,e);return this.item(n)}),re(this,"prevEnabled",(t,e=!0)=>{const n=this.item(t);if(!n)return;const r=this.enabledIndexOf(n.node),o=Zo(r,this.enabledCount()-1,e);return this.enabledItem(o)}),re(this,"registerNode",(t,e)=>{if(!t||this.descendants.has(t))return;const n=Array.from(this.descendants.keys()).concat(t),r=Go(n);e!=null&&e.disabled&&(e.disabled=!!e.disabled);const o={node:t,index:-1,...e};this.descendants.set(t,o),this.assignIndex(r)})}};function Ai(){const t=w.useRef(new Ni);return Dr(()=>()=>t.current.destroy()),t.current}var[Fi,Ls]=jt({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});function Mi(t){const e=Ls(),[n,r]=w.useState(-1),o=w.useRef(null);Dr(()=>()=>{o.current&&e.unregister(o.current)},[]),Dr(()=>{if(!o.current)return;const a=Number(o.current.dataset.index);n!=a&&!Number.isNaN(a)&&r(a)});const s=Wn(t?e.register(t):e.register);return{descendants:e,index:n,enabledIndex:e.enabledIndexOf(o.current),register:Fe(s,o)}}function Ri(){return[Wn(Fi),()=>Wn(Ls()),()=>Ai(),o=>Mi(o)]}function Ti(t){const{value:e,defaultValue:n,onChange:r,shouldUpdate:o=(f,h)=>f!==h}=t,s=at(r),a=at(o),[i,l]=w.useState(n),u=e!==void 0,c=u?e:i,d=at(f=>{const v=typeof f=="function"?f(c):f;a(c,v)&&(u||l(v),s(v))},[u,s,c,a]);return[c,d]}function Ks(t){return w.Children.toArray(t).filter(e=>w.isValidElement(e))}var Xt=ee((t,e)=>{const{icon:n,children:r,isRound:o,"aria-label":s,...a}=t,i=n||r,l=w.isValidElement(i)?w.cloneElement(i,{"aria-hidden":!0,focusable:!1}):null;return x.jsx(Ye,{padding:"0",borderRadius:o?"full":void 0,ref:e,"aria-label":s,...a,children:l})});Xt.displayName="IconButton";var[Bi,Ws]=ui("Card"),Li=ee(function(e,n){const{className:r,...o}=e,s=Ws();return x.jsx(Y.div,{ref:n,className:le("chakra-card__body",r),__css:s.body,...o})}),Ki=ee(function(e,n){const{className:r,...o}=e,s=Ws();return x.jsx(Y.div,{ref:n,className:le("chakra-card__header",r),__css:s.header,...o})}),Wi=ee(function(e,n){const{className:r,children:o,direction:s="column",justify:a,align:i,...l}=ze(e),u=cn("Card",e);return x.jsx(Y.div,{ref:n,className:le("chakra-card",r),__css:{display:"flex",flexDirection:s,justifyContent:a,alignItems:i,position:"relative",minWidth:0,wordWrap:"break-word",...u.container},...l,children:x.jsx(Bi,{value:u,children:o})})}),[$i,$s]=jt({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[Ui,Nt]=jt({strict:!1,name:"FormControlContext"});function qi(t){const{id:e,isRequired:n,isInvalid:r,isDisabled:o,isReadOnly:s,...a}=t,i=w.useId(),l=e||`field-${i}`,u=`${l}-label`,c=`${l}-feedback`,d=`${l}-helptext`,[f,h]=w.useState(!1),[v,p]=w.useState(!1),[g,y]=w.useState(!1),m=w.useCallback((b={},I=null)=>({id:d,...b,ref:Fe(I,E=>{E&&p(!0)})}),[d]),_=w.useCallback((b={},I=null)=>({...b,ref:I,"data-focus":Se(g),"data-disabled":Se(o),"data-invalid":Se(r),"data-readonly":Se(s),id:b.id!==void 0?b.id:u,htmlFor:b.htmlFor!==void 0?b.htmlFor:l}),[l,o,g,r,s,u]),k=w.useCallback((b={},I=null)=>({id:c,...b,ref:Fe(I,E=>{E&&h(!0)}),"aria-live":"polite"}),[c]),O=w.useCallback((b={},I=null)=>({...b,...a,ref:I,role:"group","data-focus":Se(g),"data-disabled":Se(o),"data-invalid":Se(r),"data-readonly":Se(s)}),[a,o,g,r,s]),C=w.useCallback((b={},I=null)=>({...b,ref:I,role:"presentation","aria-hidden":!0,children:b.children||"*"}),[]);return{isRequired:!!n,isInvalid:!!r,isReadOnly:!!s,isDisabled:!!o,isFocused:!!g,onFocus:()=>y(!0),onBlur:()=>y(!1),hasFeedbackText:f,setHasFeedbackText:h,hasHelpText:v,setHasHelpText:p,id:l,labelId:u,feedbackId:c,helpTextId:d,htmlProps:a,getHelpTextProps:m,getErrorMessageProps:k,getRootProps:O,getLabelProps:_,getRequiredIndicatorProps:C}}var po=ee(function(e,n){const r=cn("Form",e),o=ze(e),{getRootProps:s,htmlProps:a,...i}=qi(o),l=le("chakra-form-control",e.className);return x.jsx(Ui,{value:i,children:x.jsx($i,{value:r,children:x.jsx(Y.div,{...s({},n),className:l,__css:r.container})})})});po.displayName="FormControl";var zi=ee(function(e,n){const r=Nt(),o=$s(),s=le("chakra-form__helper-text",e.className);return x.jsx(Y.div,{...r==null?void 0:r.getHelpTextProps(e,n),__css:o.helperText,className:s})});zi.displayName="FormHelperText";var[Vi,Hi]=jt({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),mo=ee((t,e)=>{const n=cn("FormError",t),r=ze(t),o=Nt();return o!=null&&o.isInvalid?x.jsx(Vi,{value:n,children:x.jsx(Y.div,{...o==null?void 0:o.getErrorMessageProps(r,e),className:le("chakra-form__error-message",t.className),__css:{display:"flex",alignItems:"center",...n.text}})}):null});mo.displayName="FormErrorMessage";var Ji=ee((t,e)=>{const n=Hi(),r=Nt();if(!(r!=null&&r.isInvalid))return null;const o=le("chakra-form__error-icon",t.className);return x.jsx(di,{ref:e,"aria-hidden":!0,...t,__css:n.icon,className:o,children:x.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});Ji.displayName="FormErrorIcon";var vo=ee(function(e,n){var r;const o=or("FormLabel",e),s=ze(e),{className:a,children:i,requiredIndicator:l=x.jsx(Us,{}),optionalIndicator:u=null,...c}=s,d=Nt(),f=(r=d==null?void 0:d.getLabelProps(c,n))!=null?r:{ref:n,...c};return x.jsxs(Y.label,{...f,className:le("chakra-form__label",s.className),__css:{display:"block",textAlign:"start",...o},children:[i,d!=null&&d.isRequired?l:u]})});vo.displayName="FormLabel";var Us=ee(function(e,n){const r=Nt(),o=$s();if(!(r!=null&&r.isRequired))return null;const s=le("chakra-form__required-indicator",e.className);return x.jsx(Y.span,{...r==null?void 0:r.getRequiredIndicatorProps(e,n),__css:o.requiredIndicator,className:s})});Us.displayName="RequiredIndicator";function Yi(t){const{isDisabled:e,isInvalid:n,isReadOnly:r,isRequired:o,...s}=Gi(t);return{...s,disabled:e,readOnly:r,required:o,"aria-invalid":hr(n),"aria-required":hr(o),"aria-readonly":hr(r)}}function Gi(t){var e,n,r;const o=Nt(),{id:s,disabled:a,readOnly:i,required:l,isRequired:u,isInvalid:c,isReadOnly:d,isDisabled:f,onFocus:h,onBlur:v,...p}=t,g=t["aria-describedby"]?[t["aria-describedby"]]:[];return o!=null&&o.hasFeedbackText&&(o!=null&&o.isInvalid)&&g.push(o.feedbackId),o!=null&&o.hasHelpText&&g.push(o.helpTextId),{...p,"aria-describedby":g.join(" ")||void 0,id:s??(o==null?void 0:o.id),isDisabled:(e=a??f)!=null?e:o==null?void 0:o.isDisabled,isReadOnly:(n=i??d)!=null?n:o==null?void 0:o.isReadOnly,isRequired:(r=l??u)!=null?r:o==null?void 0:o.isRequired,isInvalid:c??(o==null?void 0:o.isInvalid),onFocus:je(o==null?void 0:o.onFocus,h),onBlur:je(o==null?void 0:o.onBlur,v)}}function Ut(t,e,n,r){const o=at(n);return w.useEffect(()=>{const s=typeof t=="function"?t():t??document;if(!(!n||!s))return s.addEventListener(e,o,r),()=>{s.removeEventListener(e,o,r)}},[e,t,r,o,n]),()=>{const s=typeof t=="function"?t():t??document;s==null||s.removeEventListener(e,o,r)}}var qs={exports:{}},Xi="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Zi=Xi,Qi=Zi;function zs(){}function Vs(){}Vs.resetWarningCache=zs;var el=function(){function t(r,o,s,a,i,l){if(l!==Qi){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Vs,resetWarningCache:zs};return n.PropTypes=n,n};qs.exports=el();var tl=qs.exports;const tt=fi(tl);function nl(t){const e=t.ownerDocument.defaultView||window,{overflow:n,overflowX:r,overflowY:o}=e.getComputedStyle(t);return/auto|scroll|overlay|hidden/.test(n+o+r)}function rl(t){return t.localName==="html"?t:t.assignedSlot||t.parentElement||t.ownerDocument.documentElement}function Hs(t){return["html","body","#document"].includes(t.localName)?t.ownerDocument.body:hi(t)&&nl(t)?t:Hs(rl(t))}var ol=Di?w.useLayoutEffect:w.useEffect;function Qo(t,e=[]){const n=w.useRef(t);return ol(()=>{n.current=t}),w.useCallback((...r)=>{var o;return(o=n.current)==null?void 0:o.call(n,...r)},e)}function sl(t,e){const n=w.useId();return w.useMemo(()=>t||[e,n].filter(Boolean).join("-"),[t,e,n])}function al(t,e){const n=t!==void 0;return[n,n&&typeof t<"u"?t:e]}function il(t={}){const{onClose:e,onOpen:n,isOpen:r,id:o}=t,s=Qo(n),a=Qo(e),[i,l]=w.useState(t.defaultIsOpen||!1),[u,c]=al(r,i),d=sl(o,"disclosure"),f=w.useCallback(()=>{u||l(!1),a==null||a()},[u,a]),h=w.useCallback(()=>{u||l(!0),s==null||s()},[u,s]),v=w.useCallback(()=>{(c?f:h)()},[c,h,f]);return{isOpen:!!c,onOpen:h,onClose:f,onToggle:v,isControlled:u,getButtonProps:(p={})=>({...p,"aria-expanded":c,"aria-controls":d,onClick:pi(p.onClick,v)}),getDisclosureProps:(p={})=>({...p,hidden:!c,id:d})}}var ar=ee(function(e,n){const{htmlSize:r,...o}=e,s=cn("Input",o),a=ze(o),i=Yi(a),l=le("chakra-input",e.className);return x.jsx(Y.input,{size:r,...i,__css:s.field,ref:n,className:l})});ar.displayName="Input";ar.id="Input";var ll=Object.freeze(["base","sm","md","lg","xl","2xl"]);function cl(t,e){return Array.isArray(t)?t.map(n=>n===null?null:e(n)):mi(t)?Object.keys(t).reduce((n,r)=>(n[r]=e(t[r]),n),{}):t!=null?e(t):null}function lf(t,e=ll){const n={};return t.forEach((r,o)=>{const s=e[o];r!=null&&(n[s]=r)}),n}var $n=ee(function(e,n){const r=or("Text",e),{className:o,align:s,decoration:a,casing:i,...l}=ze(e),u=Ii({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return x.jsx(Y.p,{ref:n,className:le("chakra-text",e.className),...u,...l,__css:r})});$n.displayName="Text";var Js=t=>x.jsx(Y.div,{className:"chakra-stack__divider",...t,__css:{...t.__css,borderWidth:0,alignSelf:"stretch",borderColor:"inherit",width:"auto",height:"auto"}});Js.displayName="StackDivider";var Ys=t=>x.jsx(Y.div,{className:"chakra-stack__item",...t,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...t.__css}});Ys.displayName="StackItem";function ul(t){const{spacing:e,direction:n}=t,r={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":cl(n,o=>r[o])}}var yo=ee((t,e)=>{const{isInline:n,direction:r,align:o,justify:s,spacing:a="0.5rem",wrap:i,children:l,divider:u,className:c,shouldWrapChildren:d,...f}=t,h=n?"row":r??"column",v=w.useMemo(()=>ul({spacing:a,direction:h}),[a,h]),p=!!u,g=!d&&!p,y=w.useMemo(()=>{const _=Ks(l);return g?_:_.map((k,O)=>{const C=typeof k.key<"u"?k.key:O,b=O+1===_.length,E=d?x.jsx(Ys,{children:k},C):k;if(!p)return E;const j=w.cloneElement(u,{__css:v}),N=b?null:j;return x.jsxs(w.Fragment,{children:[E,N]},C)})},[u,v,p,g,d,l]),m=le("chakra-stack",c);return x.jsx(Y.div,{ref:e,display:"flex",alignItems:o,justifyContent:s,flexDirection:h,flexWrap:i,gap:p?void 0:a,className:m,...f,children:y})});yo.displayName="Stack";var xt=ee((t,e)=>x.jsx(yo,{align:"center",...t,direction:"row",ref:e}));xt.displayName="HStack";var Gs=ee(function(e,n){const r=or("Heading",e),{className:o,...s}=ze(e);return x.jsx(Y.h2,{ref:n,className:le("chakra-heading",e.className),...s,__css:r})});Gs.displayName="Heading";var go=Y("div");go.displayName="Box";var Xs=ee(function(e,n){const{size:r,centerContent:o=!0,...s}=e,a=o?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return x.jsx(go,{ref:n,boxSize:r,__css:{...a,flexShrink:0,flexGrow:0},...s})});Xs.displayName="Square";var dl=ee(function(e,n){const{size:r,...o}=e;return x.jsx(Xs,{size:r,ref:n,borderRadius:"9999px",...o})});dl.displayName="Circle";var Zs=ee(function(e,n){const{direction:r,align:o,justify:s,wrap:a,basis:i,grow:l,shrink:u,...c}=e,d={display:"flex",flexDirection:r,alignItems:o,justifyContent:s,flexWrap:a,flexBasis:i,flexGrow:l,flexShrink:u};return x.jsx(Y.div,{ref:n,__css:d,...c})});Zs.displayName="Flex";function fl(t){const{key:e}=t;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function hl(t={}){const{timeout:e=300,preventDefault:n=()=>!0}=t,[r,o]=w.useState([]),s=w.useRef(),a=()=>{s.current&&(clearTimeout(s.current),s.current=null)},i=()=>{a(),s.current=setTimeout(()=>{o([]),s.current=null},e)};w.useEffect(()=>a,[]);function l(u){return c=>{if(c.key==="Backspace"){const d=[...r];d.pop(),o(d);return}if(fl(c)){const d=r.concat(c.key);n(c)&&(c.preventDefault(),c.stopPropagation()),o(d),u(d.join("")),i()}}}return l}function pl(t,e,n,r){if(e==null)return r;if(!r)return t.find(a=>n(a).toLowerCase().startsWith(e.toLowerCase()));const o=t.filter(s=>n(s).toLowerCase().startsWith(e.toLowerCase()));if(o.length>0){let s;return o.includes(r)?(s=o.indexOf(r)+1,s===o.length&&(s=0),o[s]):(s=t.indexOf(o[0]),t[s])}return r}function ml(){const t=w.useRef(new Map),e=t.current,n=w.useCallback((o,s,a,i)=>{t.current.set(a,{type:s,el:o,options:i}),o.addEventListener(s,a,i)},[]),r=w.useCallback((o,s,a,i)=>{o.removeEventListener(s,a,i),t.current.delete(a)},[]);return w.useEffect(()=>()=>{e.forEach((o,s)=>{r(o.el,o.type,s,o.options)})},[r,e]),{add:n,remove:r}}function pr(t){const e=t.target,{tagName:n,isContentEditable:r}=e;return n!=="INPUT"&&n!=="TEXTAREA"&&r!==!0}function vl(t={}){const{ref:e,isDisabled:n,isFocusable:r,clickOnEnter:o=!0,clickOnSpace:s=!0,onMouseDown:a,onMouseUp:i,onClick:l,onKeyDown:u,onKeyUp:c,tabIndex:d,onMouseOver:f,onMouseLeave:h,...v}=t,[p,g]=w.useState(!0),[y,m]=w.useState(!1),_=ml(),k=D=>{D&&D.tagName!=="BUTTON"&&g(!1)},O=p?d:d||0,C=n&&!r,b=w.useCallback(D=>{if(n){D.stopPropagation(),D.preventDefault();return}D.currentTarget.focus(),l==null||l(D)},[n,l]),I=w.useCallback(D=>{y&&pr(D)&&(D.preventDefault(),D.stopPropagation(),m(!1),_.remove(document,"keyup",I,!1))},[y,_]),E=w.useCallback(D=>{if(u==null||u(D),n||D.defaultPrevented||D.metaKey||!pr(D.nativeEvent)||p)return;const S=o&&D.key==="Enter";s&&D.key===" "&&(D.preventDefault(),m(!0)),S&&(D.preventDefault(),D.currentTarget.click()),_.add(document,"keyup",I,!1)},[n,p,u,o,s,_,I]),j=w.useCallback(D=>{if(c==null||c(D),n||D.defaultPrevented||D.metaKey||!pr(D.nativeEvent)||p)return;s&&D.key===" "&&(D.preventDefault(),m(!1),D.currentTarget.click())},[s,p,n,c]),N=w.useCallback(D=>{D.button===0&&(m(!1),_.remove(document,"mouseup",N,!1))},[_]),L=w.useCallback(D=>{if(D.button!==0)return;if(n){D.stopPropagation(),D.preventDefault();return}p||m(!0),D.currentTarget.focus({preventScroll:!0}),_.add(document,"mouseup",N,!1),a==null||a(D)},[n,p,a,_,N]),T=w.useCallback(D=>{D.button===0&&(p||m(!1),i==null||i(D))},[i,p]),R=w.useCallback(D=>{if(n){D.preventDefault();return}f==null||f(D)},[n,f]),Z=w.useCallback(D=>{y&&(D.preventDefault(),m(!1)),h==null||h(D)},[y,h]),$=Fe(e,k);return p?{...v,ref:$,type:"button","aria-disabled":C?void 0:n,disabled:C,onClick:b,onMouseDown:a,onMouseUp:i,onKeyUp:c,onKeyDown:u,onMouseOver:f,onMouseLeave:h}:{...v,ref:$,role:"button","data-active":Se(y),"aria-disabled":n?"true":void 0,tabIndex:C?void 0:O,onClick:b,onMouseDown:L,onMouseUp:T,onKeyUp:j,onKeyDown:E,onMouseOver:R,onMouseLeave:Z}}function yl(t){const e=t.current;if(!e)return!1;const n=gi(e);return!n||e.contains(n)?!1:!!wi(n)}function gl(t,e){const{shouldFocus:n,visible:r,focusRef:o}=e,s=n&&!r;sr(()=>{if(!s||yl(t))return;const a=(o==null?void 0:o.current)||t.current;let i;if(a)return i=requestAnimationFrame(()=>{a.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(i)}},[s,t,o])}var wl={preventScroll:!0,shouldFocus:!1};function cf(t,e=wl){const{focusRef:n,preventScroll:r,shouldFocus:o,visible:s}=e,a=bl(t)?t.current:t,i=o&&s,l=w.useRef(i),u=w.useRef(s);vi(()=>{!u.current&&s&&(l.current=i),u.current=s},[s,i]);const c=w.useCallback(()=>{if(!(!s||!a||!l.current)&&(l.current=!1,!a.contains(document.activeElement)))if(n!=null&&n.current)requestAnimationFrame(()=>{var d;(d=n.current)==null||d.focus({preventScroll:r})});else{const d=yi(a);d.length>0&&requestAnimationFrame(()=>{d[0].focus({preventScroll:r})})}},[s,r,a,n]);sr(()=>{c()},[c]),Ut(a,"transitionend",c)}function bl(t){return"current"in t}var vt=(t,e)=>({var:t,varRef:e?`var(${t}, ${e})`:`var(${t})`}),de={arrowShadowColor:vt("--popper-arrow-shadow-color"),arrowSize:vt("--popper-arrow-size","8px"),arrowSizeHalf:vt("--popper-arrow-size-half"),arrowBg:vt("--popper-arrow-bg"),transformOrigin:vt("--popper-transform-origin"),arrowOffset:vt("--popper-arrow-offset")};function xl(t){if(t.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}var _l={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},kl=t=>_l[t],es={scroll:!0,resize:!0};function Cl(t){let e;return typeof t=="object"?e={enabled:!0,options:{...es,...t}}:e={enabled:t,options:es},e}var El={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:t})=>{t.styles.popper.width=`${t.rects.reference.width}px`},effect:({state:t})=>()=>{const e=t.elements.reference;t.elements.popper.style.width=`${e.offsetWidth}px`}},Ol={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:t})=>{ts(t)},effect:({state:t})=>()=>{ts(t)}},ts=t=>{t.elements.popper.style.setProperty(de.transformOrigin.var,kl(t.placement))},Dl={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:t})=>{Il(t)}},Il=t=>{var e;if(!t.placement)return;const n=Sl(t.placement);if((e=t.elements)!=null&&e.arrow&&n){Object.assign(t.elements.arrow.style,{[n.property]:n.value,width:de.arrowSize.varRef,height:de.arrowSize.varRef,zIndex:-1});const r={[de.arrowSizeHalf.var]:`calc(${de.arrowSize.varRef} / 2 - 1px)`,[de.arrowOffset.var]:`calc(${de.arrowSizeHalf.varRef} * -1)`};for(const o in r)t.elements.arrow.style.setProperty(o,r[o])}},Sl=t=>{if(t.startsWith("top"))return{property:"bottom",value:de.arrowOffset.varRef};if(t.startsWith("bottom"))return{property:"top",value:de.arrowOffset.varRef};if(t.startsWith("left"))return{property:"right",value:de.arrowOffset.varRef};if(t.startsWith("right"))return{property:"left",value:de.arrowOffset.varRef}},Pl={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:t})=>{ns(t)},effect:({state:t})=>()=>{ns(t)}},ns=t=>{if(!t.elements.arrow)return;const e=t.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const n=xl(t.placement);n&&e.style.setProperty("--popper-arrow-default-shadow",n),Object.assign(e.style,{transform:"rotate(45deg)",background:de.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},jl={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},Nl={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function Al(t,e="ltr"){var n,r;const o=((n=jl[t])==null?void 0:n[e])||t;return e==="ltr"?o:(r=Nl[t])!=null?r:o}var ye="top",ke="bottom",Ce="right",ge="left",wo="auto",un=[ye,ke,Ce,ge],Ot="start",Zt="end",Fl="clippingParents",Qs="viewport",Bt="popper",Ml="reference",rs=un.reduce(function(t,e){return t.concat([e+"-"+Ot,e+"-"+Zt])},[]),ea=[].concat(un,[wo]).reduce(function(t,e){return t.concat([e,e+"-"+Ot,e+"-"+Zt])},[]),Rl="beforeRead",Tl="read",Bl="afterRead",Ll="beforeMain",Kl="main",Wl="afterMain",$l="beforeWrite",Ul="write",ql="afterWrite",zl=[Rl,Tl,Bl,Ll,Kl,Wl,$l,Ul,ql];function Me(t){return t?(t.nodeName||"").toLowerCase():null}function be(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function ft(t){var e=be(t).Element;return t instanceof e||t instanceof Element}function _e(t){var e=be(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function bo(t){if(typeof ShadowRoot>"u")return!1;var e=be(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Vl(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var r=e.styles[n]||{},o=e.attributes[n]||{},s=e.elements[n];!_e(s)||!Me(s)||(Object.assign(s.style,r),Object.keys(o).forEach(function(a){var i=o[a];i===!1?s.removeAttribute(a):s.setAttribute(a,i===!0?"":i)}))})}function Hl(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(r){var o=e.elements[r],s=e.attributes[r]||{},a=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:n[r]),i=a.reduce(function(l,u){return l[u]="",l},{});!_e(o)||!Me(o)||(Object.assign(o.style,i),Object.keys(s).forEach(function(l){o.removeAttribute(l)}))})}}const Jl={name:"applyStyles",enabled:!0,phase:"write",fn:Vl,effect:Hl,requires:["computeStyles"]};function Ne(t){return t.split("-")[0]}var it=Math.max,Un=Math.min,Dt=Math.round;function Ir(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function ta(){return!/^((?!chrome|android).)*safari/i.test(Ir())}function It(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r=t.getBoundingClientRect(),o=1,s=1;e&&_e(t)&&(o=t.offsetWidth>0&&Dt(r.width)/t.offsetWidth||1,s=t.offsetHeight>0&&Dt(r.height)/t.offsetHeight||1);var a=ft(t)?be(t):window,i=a.visualViewport,l=!ta()&&n,u=(r.left+(l&&i?i.offsetLeft:0))/o,c=(r.top+(l&&i?i.offsetTop:0))/s,d=r.width/o,f=r.height/s;return{width:d,height:f,top:c,right:u+d,bottom:c+f,left:u,x:u,y:c}}function xo(t){var e=It(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function na(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&bo(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ue(t){return be(t).getComputedStyle(t)}function Yl(t){return["table","td","th"].indexOf(Me(t))>=0}function Qe(t){return((ft(t)?t.ownerDocument:t.document)||window.document).documentElement}function ir(t){return Me(t)==="html"?t:t.assignedSlot||t.parentNode||(bo(t)?t.host:null)||Qe(t)}function os(t){return!_e(t)||Ue(t).position==="fixed"?null:t.offsetParent}function Gl(t){var e=/firefox/i.test(Ir()),n=/Trident/i.test(Ir());if(n&&_e(t)){var r=Ue(t);if(r.position==="fixed")return null}var o=ir(t);for(bo(o)&&(o=o.host);_e(o)&&["html","body"].indexOf(Me(o))<0;){var s=Ue(o);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return o;o=o.parentNode}return null}function dn(t){for(var e=be(t),n=os(t);n&&Yl(n)&&Ue(n).position==="static";)n=os(n);return n&&(Me(n)==="html"||Me(n)==="body"&&Ue(n).position==="static")?e:n||Gl(t)||e}function _o(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function qt(t,e,n){return it(t,Un(e,n))}function Xl(t,e,n){var r=qt(t,e,n);return r>n?n:r}function ra(){return{top:0,right:0,bottom:0,left:0}}function oa(t){return Object.assign({},ra(),t)}function sa(t,e){return e.reduce(function(n,r){return n[r]=t,n},{})}var Zl=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,oa(typeof e!="number"?e:sa(e,un))};function Ql(t){var e,n=t.state,r=t.name,o=t.options,s=n.elements.arrow,a=n.modifiersData.popperOffsets,i=Ne(n.placement),l=_o(i),u=[ge,Ce].indexOf(i)>=0,c=u?"height":"width";if(!(!s||!a)){var d=Zl(o.padding,n),f=xo(s),h=l==="y"?ye:ge,v=l==="y"?ke:Ce,p=n.rects.reference[c]+n.rects.reference[l]-a[l]-n.rects.popper[c],g=a[l]-n.rects.reference[l],y=dn(s),m=y?l==="y"?y.clientHeight||0:y.clientWidth||0:0,_=p/2-g/2,k=d[h],O=m-f[c]-d[v],C=m/2-f[c]/2+_,b=qt(k,C,O),I=l;n.modifiersData[r]=(e={},e[I]=b,e.centerOffset=b-C,e)}}function ec(t){var e=t.state,n=t.options,r=n.element,o=r===void 0?"[data-popper-arrow]":r;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||na(e.elements.popper,o)&&(e.elements.arrow=o))}const tc={name:"arrow",enabled:!0,phase:"main",fn:Ql,effect:ec,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function St(t){return t.split("-")[1]}var nc={top:"auto",right:"auto",bottom:"auto",left:"auto"};function rc(t,e){var n=t.x,r=t.y,o=e.devicePixelRatio||1;return{x:Dt(n*o)/o||0,y:Dt(r*o)/o||0}}function ss(t){var e,n=t.popper,r=t.popperRect,o=t.placement,s=t.variation,a=t.offsets,i=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,f=a.x,h=f===void 0?0:f,v=a.y,p=v===void 0?0:v,g=typeof c=="function"?c({x:h,y:p}):{x:h,y:p};h=g.x,p=g.y;var y=a.hasOwnProperty("x"),m=a.hasOwnProperty("y"),_=ge,k=ye,O=window;if(u){var C=dn(n),b="clientHeight",I="clientWidth";if(C===be(n)&&(C=Qe(n),Ue(C).position!=="static"&&i==="absolute"&&(b="scrollHeight",I="scrollWidth")),C=C,o===ye||(o===ge||o===Ce)&&s===Zt){k=ke;var E=d&&C===O&&O.visualViewport?O.visualViewport.height:C[b];p-=E-r.height,p*=l?1:-1}if(o===ge||(o===ye||o===ke)&&s===Zt){_=Ce;var j=d&&C===O&&O.visualViewport?O.visualViewport.width:C[I];h-=j-r.width,h*=l?1:-1}}var N=Object.assign({position:i},u&&nc),L=c===!0?rc({x:h,y:p},be(n)):{x:h,y:p};if(h=L.x,p=L.y,l){var T;return Object.assign({},N,(T={},T[k]=m?"0":"",T[_]=y?"0":"",T.transform=(O.devicePixelRatio||1)<=1?"translate("+h+"px, "+p+"px)":"translate3d("+h+"px, "+p+"px, 0)",T))}return Object.assign({},N,(e={},e[k]=m?p+"px":"",e[_]=y?h+"px":"",e.transform="",e))}function oc(t){var e=t.state,n=t.options,r=n.gpuAcceleration,o=r===void 0?!0:r,s=n.adaptive,a=s===void 0?!0:s,i=n.roundOffsets,l=i===void 0?!0:i,u={placement:Ne(e.placement),variation:St(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ss(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ss(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const sc={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:oc,data:{}};var bn={passive:!0};function ac(t){var e=t.state,n=t.instance,r=t.options,o=r.scroll,s=o===void 0?!0:o,a=r.resize,i=a===void 0?!0:a,l=be(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&u.forEach(function(c){c.addEventListener("scroll",n.update,bn)}),i&&l.addEventListener("resize",n.update,bn),function(){s&&u.forEach(function(c){c.removeEventListener("scroll",n.update,bn)}),i&&l.removeEventListener("resize",n.update,bn)}}const ic={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ac,data:{}};var lc={left:"right",right:"left",bottom:"top",top:"bottom"};function Pn(t){return t.replace(/left|right|bottom|top/g,function(e){return lc[e]})}var cc={start:"end",end:"start"};function as(t){return t.replace(/start|end/g,function(e){return cc[e]})}function ko(t){var e=be(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function Co(t){return It(Qe(t)).left+ko(t).scrollLeft}function uc(t,e){var n=be(t),r=Qe(t),o=n.visualViewport,s=r.clientWidth,a=r.clientHeight,i=0,l=0;if(o){s=o.width,a=o.height;var u=ta();(u||!u&&e==="fixed")&&(i=o.offsetLeft,l=o.offsetTop)}return{width:s,height:a,x:i+Co(t),y:l}}function dc(t){var e,n=Qe(t),r=ko(t),o=(e=t.ownerDocument)==null?void 0:e.body,s=it(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),a=it(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),i=-r.scrollLeft+Co(t),l=-r.scrollTop;return Ue(o||n).direction==="rtl"&&(i+=it(n.clientWidth,o?o.clientWidth:0)-s),{width:s,height:a,x:i,y:l}}function Eo(t){var e=Ue(t),n=e.overflow,r=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+r)}function aa(t){return["html","body","#document"].indexOf(Me(t))>=0?t.ownerDocument.body:_e(t)&&Eo(t)?t:aa(ir(t))}function zt(t,e){var n;e===void 0&&(e=[]);var r=aa(t),o=r===((n=t.ownerDocument)==null?void 0:n.body),s=be(r),a=o?[s].concat(s.visualViewport||[],Eo(r)?r:[]):r,i=e.concat(a);return o?i:i.concat(zt(ir(a)))}function Sr(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function fc(t,e){var n=It(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function is(t,e,n){return e===Qs?Sr(uc(t,n)):ft(e)?fc(e,n):Sr(dc(Qe(t)))}function hc(t){var e=zt(ir(t)),n=["absolute","fixed"].indexOf(Ue(t).position)>=0,r=n&&_e(t)?dn(t):t;return ft(r)?e.filter(function(o){return ft(o)&&na(o,r)&&Me(o)!=="body"}):[]}function pc(t,e,n,r){var o=e==="clippingParents"?hc(t):[].concat(e),s=[].concat(o,[n]),a=s[0],i=s.reduce(function(l,u){var c=is(t,u,r);return l.top=it(c.top,l.top),l.right=Un(c.right,l.right),l.bottom=Un(c.bottom,l.bottom),l.left=it(c.left,l.left),l},is(t,a,r));return i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}function ia(t){var e=t.reference,n=t.element,r=t.placement,o=r?Ne(r):null,s=r?St(r):null,a=e.x+e.width/2-n.width/2,i=e.y+e.height/2-n.height/2,l;switch(o){case ye:l={x:a,y:e.y-n.height};break;case ke:l={x:a,y:e.y+e.height};break;case Ce:l={x:e.x+e.width,y:i};break;case ge:l={x:e.x-n.width,y:i};break;default:l={x:e.x,y:e.y}}var u=o?_o(o):null;if(u!=null){var c=u==="y"?"height":"width";switch(s){case Ot:l[u]=l[u]-(e[c]/2-n[c]/2);break;case Zt:l[u]=l[u]+(e[c]/2-n[c]/2);break}}return l}function Qt(t,e){e===void 0&&(e={});var n=e,r=n.placement,o=r===void 0?t.placement:r,s=n.strategy,a=s===void 0?t.strategy:s,i=n.boundary,l=i===void 0?Fl:i,u=n.rootBoundary,c=u===void 0?Qs:u,d=n.elementContext,f=d===void 0?Bt:d,h=n.altBoundary,v=h===void 0?!1:h,p=n.padding,g=p===void 0?0:p,y=oa(typeof g!="number"?g:sa(g,un)),m=f===Bt?Ml:Bt,_=t.rects.popper,k=t.elements[v?m:f],O=pc(ft(k)?k:k.contextElement||Qe(t.elements.popper),l,c,a),C=It(t.elements.reference),b=ia({reference:C,element:_,strategy:"absolute",placement:o}),I=Sr(Object.assign({},_,b)),E=f===Bt?I:C,j={top:O.top-E.top+y.top,bottom:E.bottom-O.bottom+y.bottom,left:O.left-E.left+y.left,right:E.right-O.right+y.right},N=t.modifiersData.offset;if(f===Bt&&N){var L=N[o];Object.keys(j).forEach(function(T){var R=[Ce,ke].indexOf(T)>=0?1:-1,Z=[ye,ke].indexOf(T)>=0?"y":"x";j[T]+=L[Z]*R})}return j}function mc(t,e){e===void 0&&(e={});var n=e,r=n.placement,o=n.boundary,s=n.rootBoundary,a=n.padding,i=n.flipVariations,l=n.allowedAutoPlacements,u=l===void 0?ea:l,c=St(r),d=c?i?rs:rs.filter(function(v){return St(v)===c}):un,f=d.filter(function(v){return u.indexOf(v)>=0});f.length===0&&(f=d);var h=f.reduce(function(v,p){return v[p]=Qt(t,{placement:p,boundary:o,rootBoundary:s,padding:a})[Ne(p)],v},{});return Object.keys(h).sort(function(v,p){return h[v]-h[p]})}function vc(t){if(Ne(t)===wo)return[];var e=Pn(t);return[as(t),e,as(e)]}function yc(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var o=n.mainAxis,s=o===void 0?!0:o,a=n.altAxis,i=a===void 0?!0:a,l=n.fallbackPlacements,u=n.padding,c=n.boundary,d=n.rootBoundary,f=n.altBoundary,h=n.flipVariations,v=h===void 0?!0:h,p=n.allowedAutoPlacements,g=e.options.placement,y=Ne(g),m=y===g,_=l||(m||!v?[Pn(g)]:vc(g)),k=[g].concat(_).reduce(function(V,H){return V.concat(Ne(H)===wo?mc(e,{placement:H,boundary:c,rootBoundary:d,padding:u,flipVariations:v,allowedAutoPlacements:p}):H)},[]),O=e.rects.reference,C=e.rects.popper,b=new Map,I=!0,E=k[0],j=0;j<k.length;j++){var N=k[j],L=Ne(N),T=St(N)===Ot,R=[ye,ke].indexOf(L)>=0,Z=R?"width":"height",$=Qt(e,{placement:N,boundary:c,rootBoundary:d,altBoundary:f,padding:u}),D=R?T?Ce:ge:T?ke:ye;O[Z]>C[Z]&&(D=Pn(D));var S=Pn(D),F=[];if(s&&F.push($[L]<=0),i&&F.push($[D]<=0,$[S]<=0),F.every(function(V){return V})){E=N,I=!1;break}b.set(N,F)}if(I)for(var K=v?3:1,z=function(H){var ce=k.find(function(ve){var ae=b.get(ve);if(ae)return ae.slice(0,H).every(function(Rt){return Rt})});if(ce)return E=ce,"break"},q=K;q>0;q--){var U=z(q);if(U==="break")break}e.placement!==E&&(e.modifiersData[r]._skip=!0,e.placement=E,e.reset=!0)}}const gc={name:"flip",enabled:!0,phase:"main",fn:yc,requiresIfExists:["offset"],data:{_skip:!1}};function ls(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function cs(t){return[ye,Ce,ke,ge].some(function(e){return t[e]>=0})}function wc(t){var e=t.state,n=t.name,r=e.rects.reference,o=e.rects.popper,s=e.modifiersData.preventOverflow,a=Qt(e,{elementContext:"reference"}),i=Qt(e,{altBoundary:!0}),l=ls(a,r),u=ls(i,o,s),c=cs(l),d=cs(u);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const bc={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:wc};function xc(t,e,n){var r=Ne(t),o=[ge,ye].indexOf(r)>=0?-1:1,s=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,a=s[0],i=s[1];return a=a||0,i=(i||0)*o,[ge,Ce].indexOf(r)>=0?{x:i,y:a}:{x:a,y:i}}function _c(t){var e=t.state,n=t.options,r=t.name,o=n.offset,s=o===void 0?[0,0]:o,a=ea.reduce(function(c,d){return c[d]=xc(d,e.rects,s),c},{}),i=a[e.placement],l=i.x,u=i.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=a}const kc={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:_c};function Cc(t){var e=t.state,n=t.name;e.modifiersData[n]=ia({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Ec={name:"popperOffsets",enabled:!0,phase:"read",fn:Cc,data:{}};function Oc(t){return t==="x"?"y":"x"}function Dc(t){var e=t.state,n=t.options,r=t.name,o=n.mainAxis,s=o===void 0?!0:o,a=n.altAxis,i=a===void 0?!1:a,l=n.boundary,u=n.rootBoundary,c=n.altBoundary,d=n.padding,f=n.tether,h=f===void 0?!0:f,v=n.tetherOffset,p=v===void 0?0:v,g=Qt(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),y=Ne(e.placement),m=St(e.placement),_=!m,k=_o(y),O=Oc(k),C=e.modifiersData.popperOffsets,b=e.rects.reference,I=e.rects.popper,E=typeof p=="function"?p(Object.assign({},e.rects,{placement:e.placement})):p,j=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),N=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,L={x:0,y:0};if(C){if(s){var T,R=k==="y"?ye:ge,Z=k==="y"?ke:Ce,$=k==="y"?"height":"width",D=C[k],S=D+g[R],F=D-g[Z],K=h?-I[$]/2:0,z=m===Ot?b[$]:I[$],q=m===Ot?-I[$]:-b[$],U=e.elements.arrow,V=h&&U?xo(U):{width:0,height:0},H=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:ra(),ce=H[R],ve=H[Z],ae=qt(0,b[$],V[$]),Rt=_?b[$]/2-K-ae-ce-j.mainAxis:z-ae-ce-j.mainAxis,ur=_?-b[$]/2+K+ae+ve+j.mainAxis:q+ae+ve+j.mainAxis,Tt=e.elements.arrow&&dn(e.elements.arrow),ne=Tt?k==="y"?Tt.clientTop||0:Tt.clientLeft||0:0,Oe=(T=N==null?void 0:N[k])!=null?T:0,gn=D+Rt-Oe-ne,dr=D+ur-Oe,Wo=qt(h?Un(S,gn):S,D,h?it(F,dr):F);C[k]=Wo,L[k]=Wo-D}if(i){var $o,ai=k==="x"?ye:ge,ii=k==="x"?ke:Ce,et=C[O],wn=O==="y"?"height":"width",Uo=et+g[ai],qo=et-g[ii],fr=[ye,ge].indexOf(y)!==-1,zo=($o=N==null?void 0:N[O])!=null?$o:0,Vo=fr?Uo:et-b[wn]-I[wn]-zo+j.altAxis,Ho=fr?et+b[wn]+I[wn]-zo-j.altAxis:qo,Jo=h&&fr?Xl(Vo,et,Ho):qt(h?Vo:Uo,et,h?Ho:qo);C[O]=Jo,L[O]=Jo-et}e.modifiersData[r]=L}}const Ic={name:"preventOverflow",enabled:!0,phase:"main",fn:Dc,requiresIfExists:["offset"]};function Sc(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Pc(t){return t===be(t)||!_e(t)?ko(t):Sc(t)}function jc(t){var e=t.getBoundingClientRect(),n=Dt(e.width)/t.offsetWidth||1,r=Dt(e.height)/t.offsetHeight||1;return n!==1||r!==1}function Nc(t,e,n){n===void 0&&(n=!1);var r=_e(e),o=_e(e)&&jc(e),s=Qe(e),a=It(t,o,n),i={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&((Me(e)!=="body"||Eo(s))&&(i=Pc(e)),_e(e)?(l=It(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=Co(s))),{x:a.left+i.scrollLeft-l.x,y:a.top+i.scrollTop-l.y,width:a.width,height:a.height}}function Ac(t){var e=new Map,n=new Set,r=[];t.forEach(function(s){e.set(s.name,s)});function o(s){n.add(s.name);var a=[].concat(s.requires||[],s.requiresIfExists||[]);a.forEach(function(i){if(!n.has(i)){var l=e.get(i);l&&o(l)}}),r.push(s)}return t.forEach(function(s){n.has(s.name)||o(s)}),r}function Fc(t){var e=Ac(t);return zl.reduce(function(n,r){return n.concat(e.filter(function(o){return o.phase===r}))},[])}function Mc(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function Rc(t){var e=t.reduce(function(n,r){var o=n[r.name];return n[r.name]=o?Object.assign({},o,r,{options:Object.assign({},o.options,r.options),data:Object.assign({},o.data,r.data)}):r,n},{});return Object.keys(e).map(function(n){return e[n]})}var us={placement:"bottom",modifiers:[],strategy:"absolute"};function ds(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function Tc(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,r=n===void 0?[]:n,o=e.defaultOptions,s=o===void 0?us:o;return function(i,l,u){u===void 0&&(u=s);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},us,s),modifiersData:{},elements:{reference:i,popper:l},attributes:{},styles:{}},d=[],f=!1,h={state:c,setOptions:function(y){var m=typeof y=="function"?y(c.options):y;p(),c.options=Object.assign({},s,c.options,m),c.scrollParents={reference:ft(i)?zt(i):i.contextElement?zt(i.contextElement):[],popper:zt(l)};var _=Fc(Rc([].concat(r,c.options.modifiers)));return c.orderedModifiers=_.filter(function(k){return k.enabled}),v(),h.update()},forceUpdate:function(){if(!f){var y=c.elements,m=y.reference,_=y.popper;if(ds(m,_)){c.rects={reference:Nc(m,dn(_),c.options.strategy==="fixed"),popper:xo(_)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(j){return c.modifiersData[j.name]=Object.assign({},j.data)});for(var k=0;k<c.orderedModifiers.length;k++){if(c.reset===!0){c.reset=!1,k=-1;continue}var O=c.orderedModifiers[k],C=O.fn,b=O.options,I=b===void 0?{}:b,E=O.name;typeof C=="function"&&(c=C({state:c,options:I,name:E,instance:h})||c)}}}},update:Mc(function(){return new Promise(function(g){h.forceUpdate(),g(c)})}),destroy:function(){p(),f=!0}};if(!ds(i,l))return h;h.setOptions(u).then(function(g){!f&&u.onFirstUpdate&&u.onFirstUpdate(g)});function v(){c.orderedModifiers.forEach(function(g){var y=g.name,m=g.options,_=m===void 0?{}:m,k=g.effect;if(typeof k=="function"){var O=k({state:c,name:y,instance:h,options:_}),C=function(){};d.push(O||C)}})}function p(){d.forEach(function(g){return g()}),d=[]}return h}}var Bc=[ic,Ec,sc,Jl,kc,gc,Ic,tc,bc],Lc=Tc({defaultModifiers:Bc});function la(t={}){const{enabled:e=!0,modifiers:n,placement:r="bottom",strategy:o="absolute",arrowPadding:s=8,eventListeners:a=!0,offset:i,gutter:l=8,flip:u=!0,boundary:c="clippingParents",preventOverflow:d=!0,matchWidth:f,direction:h="ltr"}=t,v=w.useRef(null),p=w.useRef(null),g=w.useRef(null),y=Al(r,h),m=w.useRef(()=>{}),_=w.useCallback(()=>{var j;!e||!v.current||!p.current||((j=m.current)==null||j.call(m),g.current=Lc(v.current,p.current,{placement:y,modifiers:[Pl,Dl,Ol,{...El,enabled:!!f},{name:"eventListeners",...Cl(a)},{name:"arrow",options:{padding:s}},{name:"offset",options:{offset:i??[0,l]}},{name:"flip",enabled:!!u,options:{padding:8}},{name:"preventOverflow",enabled:!!d,options:{boundary:c}},...n??[]],strategy:o}),g.current.forceUpdate(),m.current=g.current.destroy)},[y,e,n,f,a,s,i,l,u,d,c,o]);w.useEffect(()=>()=>{var j;!v.current&&!p.current&&((j=g.current)==null||j.destroy(),g.current=null)},[]);const k=w.useCallback(j=>{v.current=j,_()},[_]),O=w.useCallback((j={},N=null)=>({...j,ref:Fe(k,N)}),[k]),C=w.useCallback(j=>{p.current=j,_()},[_]),b=w.useCallback((j={},N=null)=>({...j,ref:Fe(C,N),style:{...j.style,position:o,minWidth:f?void 0:"max-content",inset:"0 auto auto 0"}}),[o,C,f]),I=w.useCallback((j={},N=null)=>{const{size:L,shadowColor:T,bg:R,style:Z,...$}=j;return{...$,ref:N,"data-popper-arrow":"",style:Kc(j)}},[]),E=w.useCallback((j={},N=null)=>({...j,ref:N,"data-popper-arrow-inner":""}),[]);return{update(){var j;(j=g.current)==null||j.update()},forceUpdate(){var j;(j=g.current)==null||j.forceUpdate()},transformOrigin:de.transformOrigin.varRef,referenceRef:k,popperRef:C,getPopperProps:b,getArrowProps:I,getArrowInnerProps:E,getReferenceProps:O}}function Kc(t){const{size:e,shadowColor:n,bg:r,style:o}=t,s={...o,position:"absolute"};return e&&(s["--popper-arrow-size"]=e),n&&(s["--popper-arrow-shadow-color"]=n),r&&(s["--popper-arrow-bg"]=r),s}function ca(t={}){const{onClose:e,onOpen:n,isOpen:r,id:o}=t,s=at(n),a=at(e),[i,l]=w.useState(t.defaultIsOpen||!1),u=r!==void 0?r:i,c=r!==void 0,d=w.useId(),f=o??`disclosure-${d}`,h=w.useCallback(()=>{c||l(!1),a==null||a()},[c,a]),v=w.useCallback(()=>{c||l(!0),s==null||s()},[c,s]),p=w.useCallback(()=>{u?h():v()},[u,v,h]);function g(m={}){return{...m,"aria-expanded":u,"aria-controls":f,onClick(_){var k;(k=m.onClick)==null||k.call(m,_),p()}}}function y(m={}){return{...m,hidden:!u,id:f}}return{isOpen:u,onOpen:v,onClose:h,onToggle:p,isControlled:c,getButtonProps:g,getDisclosureProps:y}}function Wc(t){const{ref:e,handler:n,enabled:r=!0}=t,o=at(n),a=w.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;w.useEffect(()=>{if(!r)return;const i=d=>{mr(d,e)&&(a.isPointerDown=!0)},l=d=>{if(a.ignoreEmulatedMouseEvents){a.ignoreEmulatedMouseEvents=!1;return}a.isPointerDown&&n&&mr(d,e)&&(a.isPointerDown=!1,o(d))},u=d=>{a.ignoreEmulatedMouseEvents=!0,n&&a.isPointerDown&&mr(d,e)&&(a.isPointerDown=!1,o(d))},c=ua(e.current);return c.addEventListener("mousedown",i,!0),c.addEventListener("mouseup",l,!0),c.addEventListener("touchstart",i,!0),c.addEventListener("touchend",u,!0),()=>{c.removeEventListener("mousedown",i,!0),c.removeEventListener("mouseup",l,!0),c.removeEventListener("touchstart",i,!0),c.removeEventListener("touchend",u,!0)}},[n,e,o,a,r])}function mr(t,e){var n;const r=t.target;return r&&!ua(r).contains(r)?!1:!((n=e.current)!=null&&n.contains(r))}function ua(t){var e;return(e=t==null?void 0:t.ownerDocument)!=null?e:document}function $c(t){const{isOpen:e,ref:n}=t,[r,o]=w.useState(e),[s,a]=w.useState(!1);return w.useEffect(()=>{s||(o(e),a(!0))},[e,s,r]),Ut(()=>n.current,"animationend",()=>{o(e)}),{present:!(e?!1:!r),onComplete(){var l;const u=bi(n.current),c=new u.CustomEvent("animationend",{bubbles:!0});(l=n.current)==null||l.dispatchEvent(c)}}}function Uc(t){const{wasSelected:e,enabled:n,isSelected:r,mode:o="unmount"}=t;return!!(!n||r||o==="keepMounted"&&e)}var[qc,zc,Vc,Hc]=Ri(),[Jc,fn]=jt({strict:!1,name:"MenuContext"});function Yc(t,...e){const n=w.useId(),r=t||n;return w.useMemo(()=>e.map(o=>`${o}-${r}`),[r,e])}function da(t){var e;return(e=t==null?void 0:t.ownerDocument)!=null?e:document}function fs(t){return da(t).activeElement===t}function Gc(t={}){const{id:e,closeOnSelect:n=!0,closeOnBlur:r=!0,initialFocusRef:o,autoSelect:s=!0,isLazy:a,isOpen:i,defaultIsOpen:l,onClose:u,onOpen:c,placement:d="bottom-start",lazyBehavior:f="unmount",direction:h,computePositionOnMount:v=!1,...p}=t,g=w.useRef(null),y=w.useRef(null),m=Vc(),_=w.useCallback(()=>{requestAnimationFrame(()=>{var U;(U=g.current)==null||U.focus({preventScroll:!1})})},[]),k=w.useCallback(()=>{const U=setTimeout(()=>{var V;if(o)(V=o.current)==null||V.focus();else{const H=m.firstEnabled();H&&T(H.index)}});S.current.add(U)},[m,o]),O=w.useCallback(()=>{const U=setTimeout(()=>{const V=m.lastEnabled();V&&T(V.index)});S.current.add(U)},[m]),C=w.useCallback(()=>{c==null||c(),s?k():_()},[s,k,_,c]),{isOpen:b,onOpen:I,onClose:E,onToggle:j}=ca({isOpen:i,defaultIsOpen:l,onClose:u,onOpen:C});Wc({enabled:b&&r,ref:g,handler:U=>{var V;(V=y.current)!=null&&V.contains(U.target)||E()}});const N=la({...p,enabled:b||v,placement:d,direction:h}),[L,T]=w.useState(-1);sr(()=>{b||T(-1)},[b]),gl(g,{focusRef:y,visible:b,shouldFocus:!0});const R=$c({isOpen:b,ref:g}),[Z,$]=Yc(e,"menu-button","menu-list"),D=w.useCallback(()=>{I(),_()},[I,_]),S=w.useRef(new Set([]));w.useEffect(()=>{const U=S.current;return()=>{U.forEach(V=>clearTimeout(V)),U.clear()}},[]);const F=w.useCallback(()=>{I(),k()},[k,I]),K=w.useCallback(()=>{I(),O()},[I,O]),z=w.useCallback(()=>{var U,V;const H=da(g.current),ce=(U=g.current)==null?void 0:U.contains(H.activeElement);if(!(b&&!ce))return;const ae=(V=m.item(L))==null?void 0:V.node;ae==null||ae.focus({preventScroll:!0})},[b,L,m]),q=w.useRef(null);return{openAndFocusMenu:D,openAndFocusFirstItem:F,openAndFocusLastItem:K,onTransitionEnd:z,unstable__animationState:R,descendants:m,popper:N,buttonId:Z,menuId:$,forceUpdate:N.forceUpdate,orientation:"vertical",isOpen:b,onToggle:j,onOpen:I,onClose:E,menuRef:g,buttonRef:y,focusedIndex:L,closeOnSelect:n,closeOnBlur:r,autoSelect:s,setFocusedIndex:T,isLazy:a,lazyBehavior:f,initialFocusRef:o,rafId:q}}function Xc(t={},e=null){const n=fn(),{onToggle:r,popper:o,openAndFocusFirstItem:s,openAndFocusLastItem:a}=n,i=w.useCallback(l=>{const u=l.key,d={Enter:s,ArrowDown:s,ArrowUp:a}[u];d&&(l.preventDefault(),l.stopPropagation(),d(l))},[s,a]);return{...t,ref:Fe(n.buttonRef,e,o.referenceRef),id:n.buttonId,"data-active":Se(n.isOpen),"aria-expanded":n.isOpen,"aria-haspopup":"menu","aria-controls":n.menuId,onClick:je(t.onClick,r),onKeyDown:je(t.onKeyDown,i)}}function Pr(t){var e;return eu(t)&&!!((e=t==null?void 0:t.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function Zc(t={},e=null){const n=fn();if(!n)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:r,setFocusedIndex:o,menuRef:s,isOpen:a,onClose:i,menuId:l,isLazy:u,lazyBehavior:c,unstable__animationState:d}=n,f=zc(),h=hl({preventDefault:y=>y.key!==" "&&Pr(y.target)}),v=w.useCallback(y=>{if(!y.currentTarget.contains(y.target))return;const m=y.key,k={Tab:C=>C.preventDefault(),Escape:i,ArrowDown:()=>{const C=f.nextEnabled(r);C&&o(C.index)},ArrowUp:()=>{const C=f.prevEnabled(r);C&&o(C.index)}}[m];if(k){y.preventDefault(),k(y);return}const O=h(C=>{const b=pl(f.values(),C,I=>{var E,j;return(j=(E=I==null?void 0:I.node)==null?void 0:E.textContent)!=null?j:""},f.item(r));if(b){const I=f.indexOf(b.node);o(I)}});Pr(y.target)&&O(y)},[f,r,h,i,o]),p=w.useRef(!1);a&&(p.current=!0);const g=Uc({wasSelected:p.current,enabled:u,mode:c,isSelected:d.present});return{...t,ref:Fe(s,e),children:g?t.children:null,tabIndex:-1,role:"menu",id:l,style:{...t.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:je(t.onKeyDown,v)}}function Qc(t={}){const{popper:e,isOpen:n}=fn();return e.getPopperProps({...t,style:{visibility:n?"visible":"hidden",...t.style}})}function fa(t={},e=null){const{onMouseEnter:n,onMouseMove:r,onMouseLeave:o,onClick:s,onFocus:a,isDisabled:i,isFocusable:l,closeOnSelect:u,type:c,...d}=t,f=fn(),{setFocusedIndex:h,focusedIndex:v,closeOnSelect:p,onClose:g,menuRef:y,isOpen:m,menuId:_,rafId:k}=f,O=w.useRef(null),C=`${_}-menuitem-${w.useId()}`,{index:b,register:I}=Hc({disabled:i&&!l}),E=w.useCallback(D=>{n==null||n(D),!i&&h(b)},[h,b,i,n]),j=w.useCallback(D=>{r==null||r(D),O.current&&!fs(O.current)&&E(D)},[E,r]),N=w.useCallback(D=>{o==null||o(D),!i&&h(-1)},[h,i,o]),L=w.useCallback(D=>{s==null||s(D),Pr(D.currentTarget)&&(u??p)&&g()},[g,s,p,u]),T=w.useCallback(D=>{a==null||a(D),h(b)},[h,a,b]),R=b===v,Z=i&&!l;sr(()=>{if(m)return R&&!Z&&O.current?(k.current&&cancelAnimationFrame(k.current),k.current=requestAnimationFrame(()=>{var D;(D=O.current)==null||D.focus({preventScroll:!0}),k.current=null})):y.current&&!fs(y.current)&&y.current.focus({preventScroll:!0}),()=>{k.current&&cancelAnimationFrame(k.current)}},[R,Z,y,m]);const $=vl({onClick:L,onFocus:T,onMouseEnter:E,onMouseMove:j,onMouseLeave:N,ref:Fe(I,O,e),isDisabled:i,isFocusable:l});return{...d,...$,type:c??$.type,id:C,role:"menuitem",tabIndex:R?0:-1}}function uf(t={},e=null){const{type:n="radio",isChecked:r,...o}=t;return{...fa(o,e),role:`menuitem${n}`,"aria-checked":r}}function df(t={}){const{children:e,type:n="radio",value:r,defaultValue:o,onChange:s,...a}=t,l=n==="radio"?"":[],[u,c]=Ti({defaultValue:o??l,value:r,onChange:s}),d=w.useCallback(v=>{if(n==="radio"&&typeof u=="string"&&c(v),n==="checkbox"&&Array.isArray(u)){const p=u.includes(v)?u.filter(g=>g!==v):u.concat(v);c(p)}},[u,c,n]),h=Ks(e).map(v=>{if(v.type.id!=="MenuItemOption")return v;const p=y=>{var m,_;d(v.props.value),(_=(m=v.props).onClick)==null||_.call(m,y)},g=n==="radio"?v.props.value===u:u.includes(v.props.value);return w.cloneElement(v,{type:n,onClick:p,isChecked:g})});return{...a,children:h}}function eu(t){var e;if(!tu(t))return!1;const n=(e=t.ownerDocument.defaultView)!=null?e:window;return t instanceof n.HTMLElement}function tu(t){return t!=null&&typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE}var[nu,hn]=jt({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),ha=t=>{const{children:e}=t,n=cn("Menu",t),r=ze(t),{direction:o}=Ps(),{descendants:s,...a}=Gc({...r,direction:o}),i=w.useMemo(()=>a,[a]),{isOpen:l,onClose:u,forceUpdate:c}=i;return x.jsx(qc,{value:s,children:x.jsx(Jc,{value:i,children:x.jsx(nu,{value:n,children:xi(e,{isOpen:l,onClose:u,forceUpdate:c})})})})};ha.displayName="Menu";var pa=ee((t,e)=>{const n=hn();return x.jsx(Y.span,{ref:e,...t,__css:n.command,className:"chakra-menu__command"})});pa.displayName="MenuCommand";var ru=ee((t,e)=>{const{type:n,...r}=t,o=hn(),s=r.as||n?n??void 0:"button",a=w.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...o.item}),[o.item]);return x.jsx(Y.button,{ref:e,type:s,...r,__css:a})}),ma=t=>{const{className:e,children:n,...r}=t,o=hn(),s=w.Children.only(n),a=w.isValidElement(s)?w.cloneElement(s,{focusable:"false","aria-hidden":!0,className:le("chakra-menu__icon",s.props.className)}):null,i=le("chakra-menu__icon-wrapper",e);return x.jsx(Y.span,{className:i,...r,__css:o.icon,children:a})};ma.displayName="MenuIcon";var wt=ee((t,e)=>{const{icon:n,iconSpacing:r="0.75rem",command:o,commandSpacing:s="0.75rem",children:a,...i}=t,l=fa(i,e),c=n||o?x.jsx("span",{style:{pointerEvents:"none",flex:1},children:a}):a;return x.jsxs(ru,{...l,className:le("chakra-menu__menuitem",l.className),children:[n&&x.jsx(ma,{fontSize:"0.8em",marginEnd:r,children:n}),c,o&&x.jsx(pa,{marginStart:s,children:o})]})});wt.displayName="MenuItem";var ou={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},su=Y(js.div),va=ee(function(e,n){var r,o;const{rootProps:s,motionProps:a,...i}=e,{isOpen:l,onTransitionEnd:u,unstable__animationState:c}=fn(),d=Zc(i,n),f=Qc(s),h=hn();return x.jsx(Y.div,{...f,__css:{zIndex:(o=e.zIndex)!=null?o:(r=h.list)==null?void 0:r.zIndex},children:x.jsx(su,{variants:ou,initial:!1,animate:l?"enter":"exit",__css:{outline:0,...h.list},...a,className:le("chakra-menu__menu-list",d.className),...d,onUpdate:u,onAnimationComplete:_i(c.onComplete,d.onAnimationComplete)})})});va.displayName="MenuList";var au=ee((t,e)=>{const n=hn();return x.jsx(Y.button,{ref:e,...t,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...n.button}})}),ya=ee((t,e)=>{const{children:n,as:r,...o}=t,s=Xc(o,e),a=r||au;return x.jsx(a,{...s,className:le("chakra-menu__menu-button",t.className),children:x.jsx(Y.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:t.children})})});ya.displayName="MenuButton";var iu={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},jr=t=>{var e;return((e=t.current)==null?void 0:e.ownerDocument)||document},jn=t=>{var e,n;return((n=(e=t.current)==null?void 0:e.ownerDocument)==null?void 0:n.defaultView)||window};function lu(t={}){const{openDelay:e=0,closeDelay:n=0,closeOnClick:r=!0,closeOnMouseDown:o,closeOnScroll:s,closeOnPointerDown:a=o,closeOnEsc:i=!0,onOpen:l,onClose:u,placement:c,id:d,isOpen:f,defaultIsOpen:h,arrowSize:v=10,arrowShadowColor:p,arrowPadding:g,modifiers:y,isDisabled:m,gutter:_,offset:k,direction:O,...C}=t,{isOpen:b,onOpen:I,onClose:E}=ca({isOpen:f,defaultIsOpen:h,onOpen:l,onClose:u}),{referenceRef:j,getPopperProps:N,getArrowInnerProps:L,getArrowProps:T}=la({enabled:b,placement:c,arrowPadding:g,modifiers:y,gutter:_,offset:k,direction:O}),R=w.useId(),$=`tooltip-${d??R}`,D=w.useRef(null),S=w.useRef(),F=w.useCallback(()=>{S.current&&(clearTimeout(S.current),S.current=void 0)},[]),K=w.useRef(),z=w.useCallback(()=>{K.current&&(clearTimeout(K.current),K.current=void 0)},[]),q=w.useCallback(()=>{z(),E()},[E,z]),U=cu(D,q),V=w.useCallback(()=>{if(!m&&!S.current){b&&U();const ne=jn(D);S.current=ne.setTimeout(I,e)}},[U,m,b,I,e]),H=w.useCallback(()=>{F();const ne=jn(D);K.current=ne.setTimeout(q,n)},[n,q,F]),ce=w.useCallback(()=>{b&&r&&H()},[r,H,b]),ve=w.useCallback(()=>{b&&a&&H()},[a,H,b]),ae=w.useCallback(ne=>{b&&ne.key==="Escape"&&H()},[b,H]);Ut(()=>jr(D),"keydown",i?ae:void 0),Ut(()=>{if(!s)return null;const ne=D.current;if(!ne)return null;const Oe=Hs(ne);return Oe.localName==="body"?jn(D):Oe},"scroll",()=>{b&&s&&q()},{passive:!0,capture:!0}),w.useEffect(()=>{m&&(F(),b&&E())},[m,b,E,F]),w.useEffect(()=>()=>{F(),z()},[F,z]),Ut(()=>D.current,"pointerleave",H);const Rt=w.useCallback((ne={},Oe=null)=>({...ne,ref:Fe(D,Oe,j),onPointerEnter:je(ne.onPointerEnter,dr=>{dr.pointerType!=="touch"&&V()}),onClick:je(ne.onClick,ce),onPointerDown:je(ne.onPointerDown,ve),onFocus:je(ne.onFocus,V),onBlur:je(ne.onBlur,H),"aria-describedby":b?$:void 0}),[V,H,ve,b,$,ce,j]),ur=w.useCallback((ne={},Oe=null)=>N({...ne,style:{...ne.style,[de.arrowSize.var]:v?`${v}px`:void 0,[de.arrowShadowColor.var]:p}},Oe),[N,v,p]),Tt=w.useCallback((ne={},Oe=null)=>{const gn={...ne.style,position:"relative",transformOrigin:de.transformOrigin.varRef};return{ref:Oe,...C,...ne,id:$,role:"tooltip",style:gn}},[C,$]);return{isOpen:b,show:V,hide:H,getTriggerProps:Rt,getTooltipProps:Tt,getTooltipPositionerProps:ur,getArrowProps:T,getArrowInnerProps:L}}var vr="chakra-ui:close-tooltip";function cu(t,e){return w.useEffect(()=>{const n=jr(t);return n.addEventListener(vr,e),()=>n.removeEventListener(vr,e)},[e,t]),()=>{const n=jr(t),r=jn(t);n.dispatchEvent(new r.CustomEvent(vr))}}function uu(t,e=[]){const n=Object.assign({},t);for(const r of e)r in n&&delete n[r];return n}function du(t,e){const n={};for(const r of e)r in t&&(n[r]=t[r]);return n}var fu=Y(js.div),_t=ee((t,e)=>{var n,r;const o=or("Tooltip",t),s=ze(t),a=Ps(),{children:i,label:l,shouldWrapChildren:u,"aria-label":c,hasArrow:d,bg:f,portalProps:h,background:v,backgroundColor:p,bgColor:g,motionProps:y,...m}=s,_=(r=(n=v??p)!=null?n:f)!=null?r:g;if(_){o.bg=_;const N=ki(a,"colors",_);o[de.arrowBg.var]=N}const k=lu({...m,direction:a.direction}),O=typeof i=="string"||u;let C;if(O)C=x.jsx(Y.span,{display:"inline-block",tabIndex:0,...k.getTriggerProps(),children:i});else{const N=w.Children.only(i);C=w.cloneElement(N,k.getTriggerProps(N.props,N.ref))}const b=!!c,I=k.getTooltipProps({},e),E=b?uu(I,["role","id"]):I,j=du(I,["role","id"]);return l?x.jsxs(x.Fragment,{children:[C,x.jsx(Ci,{children:k.isOpen&&x.jsx(uo,{...h,children:x.jsx(Y.div,{...k.getTooltipPositionerProps(),__css:{zIndex:o.zIndex,pointerEvents:"none"},children:x.jsxs(fu,{variants:iu,initial:"exit",animate:"enter",exit:"exit",...y,...E,__css:o,children:[l,b&&x.jsx(Y.span,{srOnly:!0,...j,children:c}),d&&x.jsx(Y.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:x.jsx(Y.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:o.bg}})})]})})})})]}):x.jsx(x.Fragment,{children:i})});_t.displayName="Tooltip";let xn;const hu=new Uint8Array(16);function pu(){if(!xn&&(xn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xn(hu)}const ue=[];for(let t=0;t<256;++t)ue.push((t+256).toString(16).slice(1));function mu(t,e=0){return ue[t[e+0]]+ue[t[e+1]]+ue[t[e+2]]+ue[t[e+3]]+"-"+ue[t[e+4]]+ue[t[e+5]]+"-"+ue[t[e+6]]+ue[t[e+7]]+"-"+ue[t[e+8]]+ue[t[e+9]]+"-"+ue[t[e+10]]+ue[t[e+11]]+ue[t[e+12]]+ue[t[e+13]]+ue[t[e+14]]+ue[t[e+15]]}const vu=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hs={randomUUID:vu};function en(t,e,n){if(hs.randomUUID&&!e&&!t)return hs.randomUUID();t=t||{};const r=t.random||(t.rng||pu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let o=0;o<16;++o)e[n+o]=r[o];return e}return mu(r)}async function ga(t){console.warn("[workspace deprecated] getDB is deprecated",t);try{const e=await fetch(`/workspace/get_db?table=${t}`);return e.ok?await e.json():void 0}catch(e){console.error("Error fetching workspace:",e);return}}async function Oo(t,e){try{return await(await fetch("/workspace/save_db",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,json:e})})).text()}catch(n){console.error("Error saving workspace:",n)}}async function wa(t,e){try{return await(await fetch("/workspace/update_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,json_str:e})})).text()}catch(n){alert("Error saving workflow .json file: "+n),console.error("Error saving workspace:",n)}}async function ba(t,e=!1){try{return await(await fetch("/workspace/delete_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,deleteEmptyFolder:e})})).text()}catch(n){console.error("Error deleting file:",n)}}async function yu(t){try{return await(await fetch("/workspace/get_system_dir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({absolute_dir:t})})).json()}catch(e){console.error("Error getting workflows dir:",e)}}async function ff(){try{return await(await fetch("/workspace/open_workflow_file_browser",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}catch(t){console.error("Error open workflows folder:",t)}}async function gu(t,e){try{return await(await fetch("/workspace/scan_local_new_files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,existFlowIds:e})})).json()}catch(n){console.error("Error scan local new files:",n)}}async function hf(){try{return await(await fetch("/model_manager/get_model_list",{method:"GET",headers:{"Content-Type":"application/json"}})).json()}catch(t){console.error("Error get all models list:",t)}}async function pf(){try{return await(await fetch("/model_manager/get_folder_list",{method:"GET",headers:{"Content-Type":"application/json"}})).json()}catch(t){console.error("Error get all models list:",t)}}async function wu(t){try{return await(await fetch("/workspace/delete_folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_path:t})})).text()}catch(e){console.error("Error move file:",e)}}const bu="backup",qn="workspace";let _n=null;function xu(){return new Promise((t,e)=>{const n=indexedDB.open("WorkspaceDB",3);n.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(qn)||o.createObjectStore(qn,{keyPath:"id"})},n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{e(r.target.error)}})}async function _u(){try{return _n==null&&(_n=await xu()),new Promise((t,e)=>{if(_n==null)return e("indexDB is null");const o=_n.transaction([qn],"readonly").objectStore(qn).get(bu);o.onsuccess=()=>{o.result?t(o.result.value):t(void 0)},o.onerror=()=>e(o.error)})}catch(t){console.error("Error while reading from database:",t)}}async function xa(){try{return await _u()}catch(t){console.error("Error retrieving data from IndexedDB:",t)}}const Q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,oe=Object.keys,he=Array.isArray;function me(t,e){return typeof e!="object"||oe(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||Q.Promise||(Q.Promise=Promise);const tn=Object.getPrototypeOf,ku={}.hasOwnProperty;function xe(t,e){return ku.call(t,e)}function Pt(t,e){typeof e=="function"&&(e=e(tn(t))),(typeof Reflect>"u"?oe:Reflect.ownKeys)(e).forEach(n=>{We(t,n,e[n])})}const _a=Object.defineProperty;function We(t,e,n,r){_a(t,e,me(n&&xe(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function kt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),We(t.prototype,"constructor",t),{extend:Pt.bind(null,t.prototype)}}}}const Cu=Object.getOwnPropertyDescriptor;function Do(t,e){let n;return Cu(t,e)||(n=tn(t))&&Do(n,e)}const Eu=[].slice;function zn(t,e,n){return Eu.call(t,e,n)}function ka(t,e){return e(t)}function Kt(t){if(!t)throw new Error("Assertion Failed")}function Ca(t){Q.setImmediate?setImmediate(t):setTimeout(t,0)}function Ea(t,e){return t.reduce((n,r,o)=>{var s=e(r,o);return s&&(n[s[0]]=s[1]),n},{})}function $e(t,e){if(xe(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,o=e.length;r<o;++r){var s=$e(t,e[r]);n.push(s)}return n}var a=e.indexOf(".");if(a!==-1){var i=t[e.substr(0,a)];return i===void 0?void 0:$e(i,e.substr(a+1))}}function De(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Kt(typeof n!="string"&&"length"in n);for(var r=0,o=e.length;r<o;++r)De(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var a=e.substr(0,s),i=e.substr(s+1);if(i==="")n===void 0?he(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=n;else{var l=t[a];l&&xe(t,a)||(l=t[a]={}),De(l,i,n)}}else n===void 0?he(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Oa(t){var e={};for(var n in t)xe(t,n)&&(e[n]=t[n]);return e}const Ou=[].concat;function Da(t){return Ou.apply([],t)}const Ia="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Da([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>Q[t]),Du=Ia.map(t=>Q[t]);Ea(Ia,t=>[t,!0]);let He=null;function pn(t){He=typeof WeakMap<"u"&&new WeakMap;const e=Nr(t);return He=null,e}function Nr(t){if(!t||typeof t!="object")return t;let e=He&&He.get(t);if(e)return e;if(he(t)){e=[],He&&He.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Nr(t[n]))}else if(Du.indexOf(t.constructor)>=0)e=t;else{const s=tn(t);for(var o in e=s===Object.prototype?{}:Object.create(s),He&&He.set(t,e),t)xe(t,o)&&(e[o]=Nr(t[o]))}return e}const{toString:Iu}={};function Ar(t){return Iu.call(t).slice(8,-1)}const Fr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Su=typeof Fr=="symbol"?function(t){var e;return t!=null&&(e=t[Fr])&&e.apply(t)}:function(){return null},bt={};function Le(t){var e,n,r,o;if(arguments.length===1){if(he(t))return t.slice();if(this===bt&&typeof t=="string")return[t];if(o=Su(t)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Io=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Re=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Sa(t,e){Re=t,Pa=e}var Pa=()=>!0;const Pu=!new Error("").stack;function mt(){if(Pu)try{throw mt.arguments,new Error}catch(t){return t}return new Error}function Mr(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Pa).map(r=>`
`+r).join("")):""}var ja=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],So=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ja),ju={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ct(t,e){this._e=mt(),this.name=t,this.message=e}function Na(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,o)=>o.indexOf(n)===r).join(`
`)}function Vn(t,e,n,r){this._e=mt(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Na(t,e)}function Vt(t,e){this._e=mt(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Na(t,e)}kt(Ct).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Mr(this._e,2))}},toString:function(){return this.name+": "+this.message}}),kt(Vn).from(Ct),kt(Vt).from(Ct);var Po=So.reduce((t,e)=>(t[e]=e+"Error",t),{});const Nu=Ct;var B=So.reduce((t,e)=>{var n=e+"Error";function r(o,s){this._e=mt(),this.name=n,o?typeof o=="string"?(this.message=`${o}${s?`
 `+s:""}`,this.inner=s||null):typeof o=="object"&&(this.message=`${o.name} ${o.message}`,this.inner=o):(this.message=ju[e]||n,this.inner=null)}return kt(r).from(Nu),t[e]=r,t},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var ps=ja.reduce((t,e)=>(t[e+"Error"]=B[e],t),{}),Nn=So.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=B[e]),t),{});function X(){}function nn(t){return t}function Au(t,e){return t==null||t===nn?e:function(n){return e(t(n))}}function ht(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Fu(t,e){return t===X?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ht(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ht(o,this.onerror):o),s!==void 0?s:n}}function Mu(t,e){return t===X?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ht(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ht(r,this.onerror):r)}}function Ru(t,e){return t===X?e:function(n){var r=t.apply(this,arguments);me(n,r);var o=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?ht(o,this.onsuccess):o),s&&(this.onerror=this.onerror?ht(s,this.onerror):s),r===void 0?a===void 0?void 0:a:me(r,a)}}function Tu(t,e){return t===X?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function jo(t,e){return t===X?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,o=arguments.length,s=new Array(o);o--;)s[o]=arguments[o];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Nn.ModifyError=Vn,Nn.DexieError=Ct,Nn.BulkError=Vt;var rn={};const Aa=100,[Rr,Hn,Tr]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,tn(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,tn(e),t]})(),Fa=Hn&&Hn.then,An=Rr&&Rr.constructor,No=!!Tr;var Br=!1,Bu=Tr?()=>{Tr.then(kn)}:Q.setImmediate?setImmediate.bind(null,kn):Q.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{kn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(kn,0)},Ht=function(t,e){Wt.push([t,e]),Jn&&(Bu(),Jn=!1)},Lr=!0,Jn=!0,lt=[],Fn=[],Kr=null,Wr=nn,Et={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ys,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{ys(t[0],t[1])}catch{}})}},M=Et,Wt=[],ct=0,Mn=[];function A(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=X,this._lib=!1;var e=this._PSD=M;if(Re&&(this._stackHolder=mt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==rn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ur(this,this._value))}this._state=null,this._value=null,++e.ref,Ra(this,t)}const $r={get:function(){var t=M,e=Yn;function n(r,o){var s=!t.global&&(t!==M||e!==Yn);const a=s&&!qe();var i=new A((l,u)=>{Ao(this,new Ma(Gn(r,t,s,a),Gn(o,t,s,a),l,u,t))});return Re&&La(i,this),i}return n.prototype=rn,n},set:function(t){We(this,"then",t&&t.prototype===rn?$r:{get:function(){return t},set:$r.set})}};function Ma(t,e,n,r,o){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=o}function Ra(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&mn();n&&typeof n.then=="function"?Ra(t,(o,s)=>{n instanceof A?n._then(o,s):n.then(o,s)}):(t._state=!0,t._value=n,Ta(t)),r&&vn()}},Ur.bind(null,t))}catch(n){Ur(t,n)}}function Ur(t,e){if(Fn.push(e),t._state===null){var n=t._lib&&mn();e=Wr(e),t._state=!1,t._value=e,Re&&e!==null&&typeof e=="object"&&!e._promise&&function(r,o,s){try{r.apply(null,s)}catch(a){o&&o(a)}}(()=>{var r=Do(e,"stack");e._promise=t,We(e,"stack",{get:()=>Br?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){lt.some(o=>o._value===r._value)||lt.push(r)}(t),Ta(t),n&&vn()}}function Ta(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Ao(t,e[n]);var o=t._PSD;--o.ref||o.finalize(),ct===0&&(++ct,Ht(()=>{--ct==0&&Fo()},[]))}function Ao(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++ct,Ht(Lu,[n,t,e])}else t._listeners.push(e)}function Lu(t,e,n){try{Kr=e;var r,o=e._value;e._state?r=t(o):(Fn.length&&(Fn=[]),r=t(o),Fn.indexOf(o)===-1&&function(s){for(var a=lt.length;a;)if(lt[--a]._value===s._value)return void lt.splice(a,1)}(e)),n.resolve(r)}catch(s){n.reject(s)}finally{Kr=null,--ct==0&&Fo(),--n.psd.ref||n.psd.finalize()}}function Ba(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var o,s,a=t._value;a!=null?(o=a.name||"Error",s=a.message||a,r=Mr(a,0)):(o=a,s=""),e.push(o+(s?": "+s:"")+r)}return Re&&((r=Mr(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&Ba(t._prev,e,n)),e}function La(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function kn(){mn()&&vn()}function mn(){var t=Lr;return Lr=!1,Jn=!1,t}function vn(){var t,e,n;do for(;Wt.length>0;)for(t=Wt,Wt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Wt.length>0);Lr=!0,Jn=!0}function Fo(){var t=lt;lt=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Mn.slice(0),n=e.length;n;)e[--n]()}function Cn(t){return new A(rn,!1,t)}function te(t,e){var n=M;return function(){var r=mn(),o=M;try{return Xe(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{Xe(o,!1),r&&vn()}}}Pt(A.prototype,{then:$r,_then:function(t,e){Ao(this,new Ma(null,null,t,e,M))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):Cn(r)):this.then(null,r=>r&&r.name===e?n(r):Cn(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Cn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Br=!0;var t=Ba(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Br=!1}}},timeout:function(t,e){return t<1/0?new A((n,r)=>{var o=setTimeout(()=>r(new B.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,o))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&We(A.prototype,Symbol.toStringTag,"Dexie.Promise"),Et.env=Ka(),Pt(A,{all:function(){var t=Le.apply(null,arguments).map(En);return new A(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((o,s)=>A.resolve(o).then(a=>{t[s]=a,--r||e(t)},n))})},resolve:t=>{if(t instanceof A)return t;if(t&&typeof t.then=="function")return new A((n,r)=>{t.then(n,r)});var e=new A(rn,!0,t);return La(e,Kr),e},reject:Cn,race:function(){var t=Le.apply(null,arguments).map(En);return new A((e,n)=>{t.map(r=>A.resolve(r).then(e,n))})},PSD:{get:()=>M,set:t=>M=t},totalEchoes:{get:()=>Yn},newPSD:Ge,usePSD:Ft,scheduler:{get:()=>Ht,set:t=>{Ht=t}},rejectionMapper:{get:()=>Wr,set:t=>{Wr=t}},follow:(t,e)=>new A((n,r)=>Ge((o,s)=>{var a=M;a.unhandleds=[],a.onunhandled=s,a.finalize=ht(function(){(function(i){function l(){i(),Mn.splice(Mn.indexOf(l),1)}Mn.push(l),++ct,Ht(()=>{--ct==0&&Fo()},[])})(()=>{this.unhandleds.length===0?o():s(this.unhandleds[0])})},a.finalize),t()},e,n,r))}),An&&(An.allSettled&&We(A,"allSettled",function(){const t=Le.apply(null,arguments).map(En);return new A(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((o,s)=>A.resolve(o).then(a=>r[s]={status:"fulfilled",value:a},a=>r[s]={status:"rejected",reason:a}).then(()=>--n||e(r)))})}),An.any&&typeof AggregateError<"u"&&We(A,"any",function(){const t=Le.apply(null,arguments).map(En);return new A((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const o=new Array(r);t.forEach((s,a)=>A.resolve(s).then(i=>e(i),i=>{o[a]=i,--r||n(new AggregateError(o))}))})}));const fe={awaits:0,echoes:0,id:0};var Ku=0,Rn=[],yr=0,Yn=0,Wu=0;function Ge(t,e,n,r){var o=M,s=Object.create(o);s.parent=o,s.ref=0,s.global=!1,s.id=++Wu;var a=Et.env;s.env=No?{Promise:A,PromiseProp:{value:A,configurable:!0,writable:!0},all:A.all,race:A.race,allSettled:A.allSettled,any:A.any,resolve:A.resolve,reject:A.reject,nthen:ms(a.nthen,s),gthen:ms(a.gthen,s)}:{},e&&me(s,e),++o.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var i=Ft(s,t,n,r);return s.ref===0&&s.finalize(),i}function At(){return fe.id||(fe.id=++Ku),++fe.awaits,fe.echoes+=Aa,fe.id}function qe(){return!!fe.awaits&&(--fe.awaits==0&&(fe.id=0),fe.echoes=fe.awaits*Aa,!0)}function En(t){return fe.echoes&&t&&t.constructor===An?(At(),t.then(e=>(qe(),e),e=>(qe(),se(e)))):t}function $u(t){++Yn,fe.echoes&&--fe.echoes!=0||(fe.echoes=fe.id=0),Rn.push(M),Xe(t,!0)}function Uu(){var t=Rn[Rn.length-1];Rn.pop(),Xe(t,!1)}function Xe(t,e){var n=M;if((e?!fe.echoes||yr++&&t===M:!yr||--yr&&t===M)||Wa(e?$u.bind(null,t):Uu),t!==M&&(M=t,n===Et&&(Et.env=Ka()),No)){var r=Et.env.Promise,o=t.env;Hn.then=o.nthen,r.prototype.then=o.gthen,(n.global||t.global)&&(Object.defineProperty(Q,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function Ka(){var t=Q.Promise;return No?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Q,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Hn.then,gthen:t.prototype.then}:{}}function Ft(t,e,n,r,o){var s=M;try{return Xe(t,!0),e(n,r,o)}finally{Xe(s,!1)}}function Wa(t){Fa.call(Rr,t)}function Gn(t,e,n,r){return typeof t!="function"?t:function(){var o=M;n&&At(),Xe(e,!0);try{return t.apply(this,arguments)}finally{Xe(o,!1),r&&Wa(qe)}}}function ms(t,e){return function(n,r){return t.call(this,Gn(n,e),Gn(r,e))}}(""+Fa).indexOf("[native code]")===-1&&(At=qe=X);const vs="unhandledrejection";function ys(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,o={promise:e,reason:t};if(Q.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(vs,!0,!0),me(r,o)):Q.CustomEvent&&me(r=new CustomEvent(vs,{detail:o}),o),r&&Q.dispatchEvent&&(dispatchEvent(r),!Q.PromiseRejectionEvent&&Q.onunhandledrejection))try{Q.onunhandledrejection(r)}catch{}Re&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var se=A.reject;function qr(t,e,n,r){if(t.idbdb&&(t._state.openComplete||M.letThrough||t._vip)){var o=t._createTransaction(e,n,t._dbSchema);try{o.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===Po.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>qr(t,e,n,r))):se(s)}return o._promise(e,(s,a)=>Ge(()=>(M.trans=o,r(s,a,o)))).then(s=>o._completion.then(()=>s))}if(t._state.openComplete)return se(new B.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return se(new B.DatabaseClosed);t.open().catch(X)}return t._state.dbReadyPromise.then(()=>qr(t,e,n,r))}const gs="3.2.4",st="￿",zr=-1/0,Te="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$a="String expected.",Jt=[],lr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),qu=lr,zu=lr,Ua=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),cr="__dbnames",gr="readonly",wr="readwrite";function pt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const qa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function On(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=pn(e))[t],e)}class Vu{_trans(e,n,r){const o=this._tx||M.trans,s=this.name;function a(l,u,c){if(!c.schema[s])throw new B.NotFound("Table "+s+" not part of transaction");return n(c.idbtrans,c)}const i=mn();try{return o&&o.db===this.db?o===M.trans?o._promise(e,a,r):Ge(()=>o._promise(e,a,r),{trans:o,transless:M.transless||M}):qr(this.db,e,[this.name],a)}finally{i&&vn()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(o=>this.hook.reading.fire(o))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(he(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=oe(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>n.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==st)return this.where(r.name).equals(r.keyPath.map(u=>e[u]));!r&&Re&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:o}=this.schema,s=this.db._deps.indexedDB;function a(u,c){try{return s.cmp(u,c)===0}catch{return!1}}const[i,l]=n.reduce(([u,c],d)=>{const f=o[d],h=e[d];return[u||f,u||!f?pt(c,f&&f.multi?v=>{const p=$e(v,d);return he(p)&&p.some(g=>a(h,g))}:v=>a(h,$e(v,d))):c]},[null,null]);return i?this.where(i.name).equals(e[i.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,he(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const o=Object.create(e.prototype);for(var s in r)if(xe(r,s))try{o[s]=r[s]}catch{}return o};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){me(this,e)})}add(e,n){const{auto:r,keyPath:o}=this.schema.primKey;let s=e;return o&&r&&(s=On(o)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:n!=null?[n]:null,values:[s]})).then(a=>a.numFailures?A.reject(a.failures[0]):a.lastResult).then(a=>{if(o)try{De(e,o,a)}catch{}return a})}update(e,n){if(typeof e!="object"||he(e))return this.where(":id").equals(e).modify(n);{const r=$e(e,this.schema.primKey.keyPath);if(r===void 0)return se(new B.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?oe(n).forEach(o=>{De(e,o,n[o])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:o}=this.schema.primKey;let s=e;return o&&r&&(s=On(o)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[s],keys:n!=null?[n]:null})).then(a=>a.numFailures?A.reject(a.failures[0]):a.lastResult).then(a=>{if(o)try{De(e,o,a)}catch{}return a})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?A.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:qa})).then(e=>e.numFailures?A.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(o=>this.hook.reading.fire(o))))}bulkAdd(e,n,r){const o=Array.isArray(n)?n:void 0,s=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:i,keyPath:l}=this.schema.primKey;if(l&&o)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&i?e.map(On(l)):e;return this.core.mutate({trans:a,type:"add",keys:o,values:c,wantResults:s}).then(({numFailures:d,results:f,lastResult:h,failures:v})=>{if(d===0)return s?f:h;throw new Vt(`${this.name}.bulkAdd(): ${d} of ${u} operations failed`,v)})})}bulkPut(e,n,r){const o=Array.isArray(n)?n:void 0,s=(r=r||(o?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:i,keyPath:l}=this.schema.primKey;if(l&&o)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&i?e.map(On(l)):e;return this.core.mutate({trans:a,type:"put",keys:o,values:c,wantResults:s}).then(({numFailures:d,results:f,lastResult:h,failures:v})=>{if(d===0)return s?f:h;throw new Vt(`${this.name}.bulkPut(): ${d} of ${u} operations failed`,v)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:o,failures:s})=>{if(r===0)return o;throw new Vt(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function Yt(t){var e={},n=function(a,i){if(i){for(var l=arguments.length,u=new Array(l-1);--l;)u[l-1]=arguments[l];return e[a].subscribe.apply(null,u),t}if(typeof a=="string")return e[a]};n.addEventType=s;for(var r=1,o=arguments.length;r<o;++r)s(arguments[r]);return n;function s(a,i,l){if(typeof a!="object"){var u;i||(i=Tu),l||(l=X);var c={subscribers:[],fire:l,subscribe:function(d){c.subscribers.indexOf(d)===-1&&(c.subscribers.push(d),c.fire=i(c.fire,d))},unsubscribe:function(d){c.subscribers=c.subscribers.filter(function(f){return f!==d}),c.fire=c.subscribers.reduce(i,l)}};return e[a]=n[a]=c,c}oe(u=a).forEach(function(d){var f=u[d];if(he(f))s(d,u[d][0],u[d][1]);else{if(f!=="asap")throw new B.InvalidArgument("Invalid event config");var h=s(d,nn,function(){for(var v=arguments.length,p=new Array(v);v--;)p[v]=arguments[v];h.subscribers.forEach(function(g){Ca(function(){g.apply(null,p)})})})}})}}function Lt(t,e){return kt(e).from({prototype:t}),e}function yt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function br(t,e){t.filter=pt(t.filter,e)}function xr(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>pt(r(),e()):e,t.justLimit=n&&!r}function Tn(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new B.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function ws(t,e,n){const r=Tn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Dn(t,e,n,r){const o=t.replayFilter?pt(t.filter,t.replayFilter()):t.filter;if(t.or){const s={},a=(i,l,u)=>{if(!o||o(l,u,f=>l.stop(f),f=>l.fail(f))){var c=l.primaryKey,d=""+c;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(c)),xe(s,d)||(s[d]=!0,e(i,l,u))}};return Promise.all([t.or._iterate(a,n),bs(ws(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return bs(ws(t,r,n),pt(t.algorithm,o),e,!t.keysOnly&&t.valueMapper)}function bs(t,e,n,r){var o=te(r?(s,a,i)=>n(r(s),a,i):n);return t.then(s=>{if(s)return s.start(()=>{var a=()=>s.continue();e&&!e(s,i=>a=i,i=>{s.stop(i),a=X},i=>{s.fail(i),a=X})||o(s.value,s,i=>a=i),a()})})}function pe(t,e){try{const n=xs(t),r=xs(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(o,s){const a=o.length,i=s.length,l=a<i?a:i;for(let u=0;u<l;++u)if(o[u]!==s[u])return o[u]<s[u]?-1:1;return a===i?0:a<i?-1:1}(_s(t),_s(e));case"Array":return function(o,s){const a=o.length,i=s.length,l=a<i?a:i;for(let u=0;u<l;++u){const c=pe(o[u],s[u]);if(c!==0)return c}return a===i?0:a<i?-1:1}(t,e)}}catch{}return NaN}function xs(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Ar(t);return n==="ArrayBuffer"?"binary":n}function _s(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Hu{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,se.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,se.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=pt(n.algorithm,e)}_iterate(e,n){return Dn(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&me(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>Dn(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,o=r.table.core;if(yt(r,!0))return o.count({trans:n,query:{index:Tn(r,o.schema),range:r.range}}).then(a=>Math.min(a,r.limit));var s=0;return Dn(r,()=>(++s,!1),n,o).then(()=>s)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),o=r[0],s=r.length-1;function a(u,c){return c?a(u[r[c]],c-1):u[o]}var i=this._ctx.dir==="next"?1:-1;function l(u,c){var d=a(u,s),f=a(c,s);return d<f?-i:d>f?i:0}return this.toArray(function(u){return u.sort(l)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&yt(r,!0)&&r.limit>0){const{valueMapper:o}=r,s=Tn(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:a})=>o?a.map(o):a)}{const o=[];return Dn(r,s=>o.push(s),n,r.table.core).then(()=>o)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,yt(n)?xr(n,()=>{var r=e;return(o,s)=>r===0||(r===1?(--r,!1):(s(()=>{o.advance(r),r=0}),!1))}):xr(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),xr(this._ctx,()=>{var n=e;return function(r,o,s){return--n<=0&&o(s),n>=0}},!0),this}until(e,n){return br(this._ctx,function(r,o,s){return!e(r.value)||(o(s),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return br(this._ctx,function(o){return e(o.value)}),n=this._ctx,r=e,n.isMatch=pt(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,o){e(o.key,o)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,o){e(o.primaryKey,o)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(o,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&yt(n,!0)&&n.limit>0)return this._read(o=>{var s=Tn(n,n.table.core.schema);return n.table.core.query({trans:o,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:o})=>o).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(o,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return br(this._ctx,function(o){var s=o.primaryKey.toString(),a=xe(r,s);return r[s]=!0,!a}),this}modify(e){var n=this._ctx;return this._write(r=>{var o;if(typeof e=="function")o=e;else{var s=oe(e),a=s.length;o=function(p){for(var g=!1,y=0;y<a;++y){var m=s[y],_=e[m];$e(p,m)!==_&&(De(p,m,_),g=!0)}return g}}const i=n.table.core,{outbound:l,extractKey:u}=i.schema.primaryKey,c=this.db._options.modifyChunkSize||200,d=[];let f=0;const h=[],v=(p,g)=>{const{failures:y,numFailures:m}=g;f+=p-m;for(let _ of oe(y))d.push(y[_])};return this.clone().primaryKeys().then(p=>{const g=y=>{const m=Math.min(c,p.length-y);return i.getMany({trans:r,keys:p.slice(y,y+m),cache:"immutable"}).then(_=>{const k=[],O=[],C=l?[]:null,b=[];for(let E=0;E<m;++E){const j=_[E],N={value:pn(j),primKey:p[y+E]};o.call(N,N.value,N)!==!1&&(N.value==null?b.push(p[y+E]):l||pe(u(j),u(N.value))===0?(O.push(N.value),l&&C.push(p[y+E])):(b.push(p[y+E]),k.push(N.value)))}const I=yt(n)&&n.limit===1/0&&(typeof e!="function"||e===_r)&&{index:n.index,range:n.range};return Promise.resolve(k.length>0&&i.mutate({trans:r,type:"add",values:k}).then(E=>{for(let j in E.failures)b.splice(parseInt(j),1);v(k.length,E)})).then(()=>(O.length>0||I&&typeof e=="object")&&i.mutate({trans:r,type:"put",keys:C,values:O,criteria:I,changeSpec:typeof e!="function"&&e}).then(E=>v(O.length,E))).then(()=>(b.length>0||I&&e===_r)&&i.mutate({trans:r,type:"delete",keys:b,criteria:I}).then(E=>v(b.length,E))).then(()=>p.length>y+m&&g(y+c))})};return g(0).then(()=>{if(d.length>0)throw new Vn("Error modifying one or more objects",d,f,h);return p.length})})})}delete(){var e=this._ctx,n=e.range;return yt(e)&&(e.isPrimKey&&!zu||n.type===3)?this._write(r=>{const{primaryKey:o}=e.table.core.schema,s=n;return e.table.core.count({trans:r,query:{index:o,range:s}}).then(a=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:i,lastResult:l,results:u,numFailures:c})=>{if(c)throw new Vn("Could not delete some values",Object.keys(i).map(d=>i[d]),a-c);return a-c}))}):this.modify(_r)}}const _r=(t,e)=>e.value=null;function Ju(t,e){return t<e?-1:t===e?0:1}function Yu(t,e){return t>e?-1:t===e?0:1}function we(t,e,n){var r=t instanceof Va?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function gt(t){return new t.Collection(t,()=>za("")).limit(0)}function Gu(t,e,n,r,o,s){for(var a=Math.min(t.length,r.length),i=-1,l=0;l<a;++l){var u=e[l];if(u!==r[l])return o(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):o(t[l],r[l])<0?t.substr(0,l)+r[l]+n.substr(l+1):i>=0?t.substr(0,i)+e[i]+n.substr(i+1):null;o(t[l],u)<0&&(i=l)}return a<r.length&&s==="next"?t+n.substr(t.length):a<t.length&&s==="prev"?t.substr(0,n.length):i<0?null:t.substr(0,i)+r[i]+n.substr(i+1)}function In(t,e,n,r){var o,s,a,i,l,u,c,d=n.length;if(!n.every(p=>typeof p=="string"))return we(t,$a);function f(p){o=function(y){return y==="next"?m=>m.toUpperCase():m=>m.toLowerCase()}(p),s=function(y){return y==="next"?m=>m.toLowerCase():m=>m.toUpperCase()}(p),a=p==="next"?Ju:Yu;var g=n.map(function(y){return{lower:s(y),upper:o(y)}}).sort(function(y,m){return a(y.lower,m.lower)});i=g.map(function(y){return y.upper}),l=g.map(function(y){return y.lower}),u=p,c=p==="next"?"":r}f("next");var h=new t.Collection(t,()=>Ve(i[0],l[d-1]+r));h._ondirectionchange=function(p){f(p)};var v=0;return h._addAlgorithm(function(p,g,y){var m=p.key;if(typeof m!="string")return!1;var _=s(m);if(e(_,l,v))return!0;for(var k=null,O=v;O<d;++O){var C=Gu(m,_,i[O],l[O],a,u);C===null&&k===null?v=O+1:(k===null||a(k,C)>0)&&(k=C)}return g(k!==null?function(){p.continue(k+c)}:y),!1}),h}function Ve(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function za(t){return{type:1,lower:t,upper:t}}class Va{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,o){r=r!==!1,o=o===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||o)&&(!r||!o)?gt(this):new this.Collection(this,()=>Ve(e,n,!r,!o))}catch{return we(this,Te)}}equals(e){return e==null?we(this,Te):new this.Collection(this,()=>za(e))}above(e){return e==null?we(this,Te):new this.Collection(this,()=>Ve(e,void 0,!0))}aboveOrEqual(e){return e==null?we(this,Te):new this.Collection(this,()=>Ve(e,void 0,!1))}below(e){return e==null?we(this,Te):new this.Collection(this,()=>Ve(void 0,e,!1,!0))}belowOrEqual(e){return e==null?we(this,Te):new this.Collection(this,()=>Ve(void 0,e))}startsWith(e){return typeof e!="string"?we(this,$a):this.between(e,e+st,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):In(this,(n,r)=>n.indexOf(r[0])===0,[e],st)}equalsIgnoreCase(e){return In(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=Le.apply(bt,arguments);return e.length===0?gt(this):In(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Le.apply(bt,arguments);return e.length===0?gt(this):In(this,(n,r)=>r.some(o=>n.indexOf(o)===0),e,st)}anyOf(){const e=Le.apply(bt,arguments);let n=this._cmp;try{e.sort(n)}catch{return we(this,Te)}if(e.length===0)return gt(this);const r=new this.Collection(this,()=>Ve(e[0],e[e.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let o=0;return r._addAlgorithm((s,a,i)=>{const l=s.key;for(;n(l,e[o])>0;)if(++o,o===e.length)return a(i),!1;return n(l,e[o])===0||(a(()=>{s.continue(e[o])}),!1)}),r}notEqual(e){return this.inAnyRange([[zr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Le.apply(bt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return we(this,Te)}const n=e.reduce((r,o)=>r?r.concat([[r[r.length-1][1],o]]):[[zr,o]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,o=this._ascending,s=this._descending,a=this._min,i=this._max;if(e.length===0)return gt(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&o(m[0],m[1])<=0))return we(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);const l=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;let c,d=o;function f(m,_){return d(m[0],_[0])}try{c=e.reduce(function(m,_){let k=0,O=m.length;for(;k<O;++k){const C=m[k];if(r(_[0],C[1])<0&&r(_[1],C[0])>0){C[0]=a(C[0],_[0]),C[1]=i(C[1],_[1]);break}}return k===O&&m.push(_),m},[]),c.sort(f)}catch{return we(this,Te)}let h=0;const v=u?m=>o(m,c[h][1])>0:m=>o(m,c[h][1])>=0,p=l?m=>s(m,c[h][0])>0:m=>s(m,c[h][0])>=0;let g=v;const y=new this.Collection(this,()=>Ve(c[0][0],c[c.length-1][1],!l,!u));return y._ondirectionchange=m=>{m==="next"?(g=v,d=o):(g=p,d=s),c.sort(f)},y._addAlgorithm((m,_,k)=>{for(var O=m.key;g(O);)if(++h,h===c.length)return _(k),!1;return!!function(C){return!v(C)&&!p(C)}(O)||(this._cmp(O,c[h][1])===0||this._cmp(O,c[h][0])===0||_(()=>{d===o?m.continue(c[h][0]):m.continue(c[h][1])}),!1)}),y}startsWithAnyOf(){const e=Le.apply(bt,arguments);return e.every(n=>typeof n=="string")?e.length===0?gt(this):this.inAnyRange(e.map(n=>[n,n+st])):we(this,"startsWithAnyOf() only works with strings")}}function Pe(t){return te(function(e){return on(e),t(e.target.error),!1})}function on(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const sn="storagemutated",Je="x-storagemutated-1",Ze=Yt(null,sn);class Xu{_lock(){return Kt(!M.global),++this._reculock,this._reculock!==1||M.global||(M.lockOwnerFor=this),this}_unlock(){if(Kt(!M.global),--this._reculock==0)for(M.global||(M.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ft(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&M.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Kt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new B.DatabaseClosed(r);case"MissingAPIError":throw new B.MissingAPI(r.message,r);default:throw new B.OpenFailed(r)}if(!this.active)throw new B.TransactionInactive;return Kt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=te(o=>{on(o),this._reject(e.error)}),e.onabort=te(o=>{on(o),this.active&&this._reject(new B.Abort(e.error)),this.active=!1,this.on("abort").fire(o)}),e.oncomplete=te(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Ze.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return se(new B.ReadOnly("Transaction is readonly"));if(!this.active)return se(new B.TransactionInactive);if(this._locked())return new A((s,a)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(s,a)},M])});if(r)return Ge(()=>{var s=new A((a,i)=>{this._lock();const l=n(a,i,this);l&&l.then&&l.then(a,i)});return s.finally(()=>this._unlock()),s._lib=!0,s});var o=new A((s,a)=>{var i=n(s,a,this);i&&i.then&&i.then(s,a)});return o._lib=!0,o}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=A.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var o=n.idbtrans.objectStore(n.storeNames[0]);(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(o.get(-1/0).onsuccess=a)})()}var s=n._waitingFor;return new A((a,i)=>{r.then(l=>n._waitingQueue.push(te(a.bind(null,l))),l=>n._waitingQueue.push(te(i.bind(null,l)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(xe(n,e))return n[e];const r=this.schema[e];if(!r)throw new B.NotFound("Table "+e+" not part of transaction");const o=new this.db.Table(e,r,this);return o.core=this.db.core.table(e),n[e]=o,o}}function Vr(t,e,n,r,o,s,a){return{name:t,keyPath:e,unique:n,multi:r,auto:o,compound:s,src:(n&&!a?"&":"")+(r?"*":"")+(o?"++":"")+Ha(e)}}function Ha(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Ja(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Ea(n,r=>[r.name,r])}}let an=t=>{try{return t.only([[]]),an=()=>[[]],[[]]}catch{return an=()=>st,st}};function Hr(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>$e(r,e)}(t):e=>$e(e,t)}function ks(t){return[].slice.call(t)}let Zu=0;function Gt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Qu(t,e,n){function r(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:c,lowerOpen:d,upperOpen:f}=l;return u===void 0?c===void 0?null:e.upperBound(c,!!f):c===void 0?e.lowerBound(u,!!d):e.bound(u,c,!!d,!!f)}const{schema:o,hasGetAll:s}=function(l,u){const c=ks(l.objectStoreNames);return{schema:{name:l.name,tables:c.map(d=>u.objectStore(d)).map(d=>{const{keyPath:f,autoIncrement:h}=d,v=he(f),p=f==null,g={},y={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:v,keyPath:f,autoIncrement:h,unique:!0,extractKey:Hr(f)},indexes:ks(d.indexNames).map(m=>d.index(m)).map(m=>{const{name:_,unique:k,multiEntry:O,keyPath:C}=m,b={name:_,compound:he(C),keyPath:C,unique:k,multiEntry:O,extractKey:Hr(C)};return g[Gt(C)]=b,b}),getIndexByKeyPath:m=>g[Gt(m)]};return g[":id"]=y.primaryKey,f!=null&&(g[Gt(f)]=y.primaryKey),y})},hasGetAll:c.length>0&&"getAll"in u.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),a=o.tables.map(l=>function(u){const c=u.name;return{name:c,schema:u,mutate:function({trans:d,type:f,keys:h,values:v,range:p}){return new Promise((g,y)=>{g=te(g);const m=d.objectStore(c),_=m.keyPath==null,k=f==="put"||f==="add";if(!k&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:O}=h||v||{length:1};if(h&&v&&h.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(O===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let C;const b=[],I=[];let E=0;const j=L=>{++E,on(L)};if(f==="deleteRange"){if(p.type===4)return g({numFailures:E,failures:I,results:[],lastResult:void 0});p.type===3?b.push(C=m.clear()):b.push(C=m.delete(r(p)))}else{const[L,T]=k?_?[v,h]:[v,null]:[h,null];if(k)for(let R=0;R<O;++R)b.push(C=T&&T[R]!==void 0?m[f](L[R],T[R]):m[f](L[R])),C.onerror=j;else for(let R=0;R<O;++R)b.push(C=m[f](L[R])),C.onerror=j}const N=L=>{const T=L.target.result;b.forEach((R,Z)=>R.error!=null&&(I[Z]=R.error)),g({numFailures:E,failures:I,results:f==="delete"?h:b.map(R=>R.result),lastResult:T})};C.onerror=L=>{j(L),N(L)},C.onsuccess=N})},getMany:({trans:d,keys:f})=>new Promise((h,v)=>{h=te(h);const p=d.objectStore(c),g=f.length,y=new Array(g);let m,_=0,k=0;const O=b=>{const I=b.target;y[I._pos]=I.result,++k===_&&h(y)},C=Pe(v);for(let b=0;b<g;++b)f[b]!=null&&(m=p.get(f[b]),m._pos=b,m.onsuccess=O,m.onerror=C,++_);_===0&&h(y)}),get:({trans:d,key:f})=>new Promise((h,v)=>{h=te(h);const p=d.objectStore(c).get(f);p.onsuccess=g=>h(g.target.result),p.onerror=Pe(v)}),query:function(d){return f=>new Promise((h,v)=>{h=te(h);const{trans:p,values:g,limit:y,query:m}=f,_=y===1/0?void 0:y,{index:k,range:O}=m,C=p.objectStore(c),b=k.isPrimaryKey?C:C.index(k.name),I=r(O);if(y===0)return h({result:[]});if(d){const E=g?b.getAll(I,_):b.getAllKeys(I,_);E.onsuccess=j=>h({result:j.target.result}),E.onerror=Pe(v)}else{let E=0;const j=g||!("openKeyCursor"in b)?b.openCursor(I):b.openKeyCursor(I),N=[];j.onsuccess=L=>{const T=j.result;return T?(N.push(g?T.value:T.primaryKey),++E===y?h({result:N}):void T.continue()):h({result:N})},j.onerror=Pe(v)}})}(s),openCursor:function({trans:d,values:f,query:h,reverse:v,unique:p}){return new Promise((g,y)=>{g=te(g);const{index:m,range:_}=h,k=d.objectStore(c),O=m.isPrimaryKey?k:k.index(m.name),C=v?p?"prevunique":"prev":p?"nextunique":"next",b=f||!("openKeyCursor"in O)?O.openCursor(r(_),C):O.openKeyCursor(r(_),C);b.onerror=Pe(y),b.onsuccess=te(I=>{const E=b.result;if(!E)return void g(null);E.___id=++Zu,E.done=!1;const j=E.continue.bind(E);let N=E.continuePrimaryKey;N&&(N=N.bind(E));const L=E.advance.bind(E),T=()=>{throw new Error("Cursor not stopped")};E.trans=d,E.stop=E.continue=E.continuePrimaryKey=E.advance=()=>{throw new Error("Cursor not started")},E.fail=te(y),E.next=function(){let R=1;return this.start(()=>R--?this.continue():this.stop()).then(()=>this)},E.start=R=>{const Z=new Promise((D,S)=>{D=te(D),b.onerror=Pe(S),E.fail=S,E.stop=F=>{E.stop=E.continue=E.continuePrimaryKey=E.advance=T,D(F)}}),$=()=>{if(b.result)try{R()}catch(D){E.fail(D)}else E.done=!0,E.start=()=>{throw new Error("Cursor behind last entry")},E.stop()};return b.onsuccess=te(D=>{b.onsuccess=$,$()}),E.continue=j,E.continuePrimaryKey=N,E.advance=L,$(),Z},g(E)},y)})},count({query:d,trans:f}){const{index:h,range:v}=d;return new Promise((p,g)=>{const y=f.objectStore(c),m=h.isPrimaryKey?y:y.index(h.name),_=r(v),k=_?m.count(_):m.count();k.onsuccess=te(O=>p(O.target.result)),k.onerror=Pe(g)})}}}(l)),i={};return a.forEach(l=>i[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!i[l])throw new Error(`Table '${l}' not found`);return i[l]},MIN_KEY:-1/0,MAX_KEY:an(e),schema:o}}function Jr({_novip:t},e){const n=e.db,r=function(o,s,{IDBKeyRange:a,indexedDB:i},l){return{dbcore:function(c,d){return d.reduce((f,{create:h})=>({...f,...h(f)}),c)}(Qu(s,a,l),o.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(o=>{const s=o.name;t.core.schema.tables.some(a=>a.name===s)&&(o.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=o.core))})}function Xn({_novip:t},e,n,r){n.forEach(o=>{const s=r[o];e.forEach(a=>{const i=Do(a,o);(!i||"value"in i&&i.value===void 0)&&(a===t.Transaction.prototype||a instanceof t.Transaction?We(a,o,{get(){return this.table(o)},set(l){_a(this,o,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):a[o]=new t.Table(o,s))})})}function Yr({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function ed(t,e){return t._cfg.version-e._cfg.version}function td(t,e,n,r){const o=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,o);s.create(n),s._completion.catch(r);const a=s._reject.bind(s),i=M.transless||M;Ge(()=>{M.trans=s,M.transless=i,e===0?(oe(o).forEach(l=>{kr(n,l,o[l].primKey,o[l].indexes)}),Jr(t,n),A.follow(()=>t.on.populate.fire(s)).catch(a)):function({_novip:l},u,c,d){const f=[],h=l._versions;let v=l._dbSchema=Xr(l,l.idbdb,d),p=!1;const g=h.filter(m=>m._cfg.version>=u);function y(){return f.length?A.resolve(f.shift()(c.idbtrans)).then(y):A.resolve()}return g.forEach(m=>{f.push(()=>{const _=v,k=m._cfg.dbschema;Zr(l,_,d),Zr(l,k,d),v=l._dbSchema=k;const O=Ya(_,k);O.add.forEach(b=>{kr(d,b[0],b[1].primKey,b[1].indexes)}),O.change.forEach(b=>{if(b.recreate)throw new B.Upgrade("Not yet support for changing primary key");{const I=d.objectStore(b.name);b.add.forEach(E=>Gr(I,E)),b.change.forEach(E=>{I.deleteIndex(E.name),Gr(I,E)}),b.del.forEach(E=>I.deleteIndex(E))}});const C=m._cfg.contentUpgrade;if(C&&m._cfg.version>u){Jr(l,d),c._memoizedTables={},p=!0;let b=Oa(k);O.del.forEach(N=>{b[N]=_[N]}),Yr(l,[l.Transaction.prototype]),Xn(l,[l.Transaction.prototype],oe(b),b),c.schema=b;const I=Io(C);let E;I&&At();const j=A.follow(()=>{if(E=C(c),E&&I){var N=qe.bind(null,null);E.then(N,N)}});return E&&typeof E.then=="function"?A.resolve(E):j.then(()=>E)}}),f.push(_=>{(!p||!qu)&&function(k,O){[].slice.call(O.db.objectStoreNames).forEach(C=>k[C]==null&&O.db.deleteObjectStore(C))}(m._cfg.dbschema,_),Yr(l,[l.Transaction.prototype]),Xn(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),c.schema=l._dbSchema})}),y().then(()=>{var m,_;_=d,oe(m=v).forEach(k=>{_.db.objectStoreNames.contains(k)||kr(_,k,m[k].primKey,m[k].indexes)})})}(t,e,s,n).catch(a)})}function Ya(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const o=t[r],s=e[r];if(o){const a={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||o.primKey.auto!==s.primKey.auto&&!lr)a.recreate=!0,n.change.push(a);else{const i=o.idxByName,l=s.idxByName;let u;for(u in i)l[u]||a.del.push(u);for(u in l){const c=i[u],d=l[u];c?c.src!==d.src&&a.change.push(d):a.add.push(d)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,s])}return n}function kr(t,e,n,r){const o=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>Gr(o,s)),o}function Gr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Xr(t,e,n){const r={};return zn(e.objectStoreNames,0).forEach(o=>{const s=n.objectStore(o);let a=s.keyPath;const i=Vr(Ha(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),l=[];for(let c=0;c<s.indexNames.length;++c){const d=s.index(s.indexNames[c]);a=d.keyPath;var u=Vr(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);l.push(u)}r[o]=Ja(o,i,l)}),r}function Zr({_novip:t},e,n){const r=n.db.objectStoreNames;for(let o=0;o<r.length;++o){const s=r[o],a=n.objectStore(s);t._hasGetAll="getAll"in a;for(let i=0;i<a.indexNames.length;++i){const l=a.indexNames[i],u=a.index(l).keyPath,c=typeof u=="string"?u:"["+zn(u).join("+")+"]";if(e[s]){const d=e[s].idxByName[c];d&&(d.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Q.WorkerGlobalScope&&Q instanceof Q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class nd{_parseStoresSpec(e,n){oe(e).forEach(r=>{if(e[r]!==null){var o=e[r].split(",").map((a,i)=>{const l=(a=a.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return Vr(l,u||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),he(u),i===0)}),s=o.shift();if(s.multi)throw new B.Schema("Primary key cannot be multi-valued");o.forEach(a=>{if(a.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),n[r]=Ja(r,s,o)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?me(this._cfg.storesSource,e):e;const r=n._versions,o={};let s={};return r.forEach(a=>{me(o,a._cfg.storesSource),s=a._cfg.dbschema={},a._parseStoresSpec(o,s)}),n._dbSchema=s,Yr(n,[n._allTables,n,n.Transaction.prototype]),Xn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],oe(s),s),n._storeNames=oe(s),this}upgrade(e){return this._cfg.contentUpgrade=jo(this._cfg.contentUpgrade||X,e),this}}function Mo(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new ut(cr,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Ro(t){return t&&typeof t.databases=="function"}function Qr(t){return Ge(function(){return M.letThrough=!0,t()})}function rd(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function od(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?se(e.dbOpenError):t);Re&&(e.openCanceller._stackHolder=mt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function o(){if(e.openCanceller!==r)throw new B.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,a=null,i=!1;return A.race([r,(typeof navigator>"u"?A.resolve():rd()).then(()=>new A((l,u)=>{if(o(),!n)throw new B.MissingAPI;const c=t.name,d=e.autoSchema?n.open(c):n.open(c,Math.round(10*t.verno));if(!d)throw new B.MissingAPI;d.onerror=Pe(u),d.onblocked=te(t._fireOnBlocked),d.onupgradeneeded=te(f=>{if(a=d.transaction,e.autoSchema&&!t._options.allowEmptyDB){d.onerror=on,a.abort(),d.result.close();const v=n.deleteDatabase(c);v.onsuccess=v.onerror=te(()=>{u(new B.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{a.onerror=Pe(u);var h=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;i=h<1,t._novip.idbdb=d.result,td(t,h/10,a,u)}},u),d.onsuccess=te(()=>{a=null;const f=t._novip.idbdb=d.result,h=zn(f.objectStoreNames);if(h.length>0)try{const p=f.transaction((v=h).length===1?v[0]:v,"readonly");e.autoSchema?function({_novip:g},y,m){g.verno=y.version/10;const _=g._dbSchema=Xr(0,y,m);g._storeNames=zn(y.objectStoreNames,0),Xn(g,[g._allTables],oe(_),_)}(t,f,p):(Zr(t,t._dbSchema,p),function(g,y){const m=Ya(Xr(0,g.idbdb,y),g._dbSchema);return!(m.add.length||m.change.some(_=>_.add.length||_.change.length))}(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Jr(t,p)}catch{}var v;Jt.push(t),f.onversionchange=te(p=>{e.vcFired=!0,t.on("versionchange").fire(p)}),f.onclose=te(p=>{t.on("close").fire(p)}),i&&function({indexedDB:p,IDBKeyRange:g},y){!Ro(p)&&y!==cr&&Mo(p,g).put({name:y}).catch(X)}(t._deps,c),l()},u)}))]).then(()=>(o(),e.onReadyBeingFired=[],A.resolve(Qr(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(jo,X);return e.onReadyBeingFired=[],A.resolve(Qr(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{a&&a.abort()}catch{}return r===e.openCanceller&&t._close(),se(l)}).finally(()=>{e.openComplete=!0,s()})}function eo(t){var e=s=>t.next(s),n=o(e),r=o(s=>t.throw(s));function o(s){return a=>{var i=s(a),l=i.value;return i.done?l:l&&typeof l.then=="function"?l.then(n,r):he(l)?Promise.all(l).then(n,r):n(l)}}return o(e)()}function sd(t,e,n){var r=arguments.length;if(r<2)throw new B.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];return n=o.pop(),[t,Da(o),n]}function Ga(t,e,n,r,o){return A.resolve().then(()=>{const s=M.transless||M,a=t._createTransaction(e,n,t._dbSchema,r),i={trans:a,transless:s};if(r)a.idbtrans=r.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===Po.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Ga(t,e,n,null,o))):se(d)}const l=Io(o);let u;l&&At();const c=A.follow(()=>{if(u=o.call(a,a),u)if(l){var d=qe.bind(null,null);u.then(d,d)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=eo(u))},i);return(u&&typeof u.then=="function"?A.resolve(u).then(d=>a.active?d:se(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(d=>(r&&a._resolve(),a._completion.then(()=>d))).catch(d=>(a._reject(d),se(d)))})}function Sn(t,e,n){const r=he(t)?t.slice():[t];for(let o=0;o<n;++o)r.push(e);return r}const ad={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,o={},s=[];function a(c,d,f){const h=Gt(c),v=o[h]=o[h]||[],p=c==null?0:typeof c=="string"?1:c.length,g=d>0,y={...f,isVirtual:g,keyTail:d,keyLength:p,extractKey:Hr(c),unique:!g&&f.unique};return v.push(y),y.isPrimaryKey||s.push(y),p>1&&a(p===2?c[0]:c.slice(0,p-1),d+1,f),v.sort((m,_)=>m.keyTail-_.keyTail),y}const i=a(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[i];for(const c of r.indexes)a(c.keyPath,0,c);function l(c){const d=c.query.index;return d.isVirtual?{...c,query:{index:d,range:(f=c.query.range,h=d.keyTail,{type:f.type===1?2:f.type,lower:Sn(f.lower,f.lowerOpen?t.MAX_KEY:t.MIN_KEY,h),lowerOpen:!0,upper:Sn(f.upper,f.upperOpen?t.MIN_KEY:t.MAX_KEY,h),upperOpen:!0})}}:c;var f,h}return{...n,schema:{...r,primaryKey:i,indexes:s,getIndexByKeyPath:function(c){const d=o[Gt(c)];return d&&d[0]}},count:c=>n.count(l(c)),query:c=>n.query(l(c)),openCursor(c){const{keyTail:d,isVirtual:f,keyLength:h}=c.query.index;return f?n.openCursor(l(c)).then(v=>v&&function(p){return Object.create(p,{continue:{value:function(y){y!=null?p.continue(Sn(y,c.reverse?t.MAX_KEY:t.MIN_KEY,d)):c.unique?p.continue(p.key.slice(0,h).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,d)):p.continue()}},continuePrimaryKey:{value(y,m){p.continuePrimaryKey(Sn(y,t.MAX_KEY,d),m)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const y=p.key;return h===1?y[0]:y.slice(0,h)}},value:{get:()=>p.value}})}(v)):n.openCursor(c)}}}}}};function To(t,e,n,r){return n=n||{},r=r||"",oe(t).forEach(o=>{if(xe(e,o)){var s=t[o],a=e[o];if(typeof s=="object"&&typeof a=="object"&&s&&a){const i=Ar(s);i!==Ar(a)?n[r+o]=e[o]:i==="Object"?To(s,a,n,r+o+"."):s!==a&&(n[r+o]=e[o])}else s!==a&&(n[r+o]=e[o])}else n[r+o]=void 0}),oe(e).forEach(o=>{xe(t,o)||(n[r+o]=e[o])}),n}const id={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){const a=M.trans,{deleting:i,creating:l,updating:u}=a.table(e).hook;switch(s.type){case"add":if(l.fire===X)break;return a._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===X&&u.fire===X)break;return a._promise("readwrite",()=>c(s),!0);case"delete":if(i.fire===X)break;return a._promise("readwrite",()=>c(s),!0);case"deleteRange":if(i.fire===X)break;return a._promise("readwrite",()=>function(f){return d(f.trans,f.range,1e4)}(s),!0)}return n.mutate(s);function c(f){const h=M.trans,v=f.keys||function(p,g){return g.type==="delete"?g.keys:g.keys||g.values.map(p.extractKey)}(r,f);if(!v)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:v}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(p,g,y){return g.type==="add"?Promise.resolve([]):p.getMany({trans:g.trans,keys:y,cache:"immutable"})}(n,f,v).then(p=>{const g=v.map((y,m)=>{const _=p[m],k={onerror:null,onsuccess:null};if(f.type==="delete")i.fire.call(k,y,_,h);else if(f.type==="add"||_===void 0){const O=l.fire.call(k,y,f.values[m],h);y==null&&O!=null&&(y=O,f.keys[m]=y,r.outbound||De(f.values[m],r.keyPath,y))}else{const O=To(_,f.values[m]),C=u.fire.call(k,O,y,_,h);if(C){const b=f.values[m];Object.keys(C).forEach(I=>{xe(b,I)?b[I]=C[I]:De(b,I,C[I])})}}return k});return n.mutate(f).then(({failures:y,results:m,numFailures:_,lastResult:k})=>{for(let O=0;O<v.length;++O){const C=m?m[O]:v[O],b=g[O];C==null?b.onerror&&b.onerror(y[O]):b.onsuccess&&b.onsuccess(f.type==="put"&&p[O]?f.values[O]:C)}return{failures:y,results:m,numFailures:_,lastResult:k}}).catch(y=>(g.forEach(m=>m.onerror&&m.onerror(y)),Promise.reject(y)))})}function d(f,h,v){return n.query({trans:f,values:!1,query:{index:r,range:h},limit:v}).then(({result:p})=>c({type:"delete",keys:p,trans:f}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):p.length<v?{failures:[],numFailures:0,lastResult:void 0}:d(f,{...h,lower:p[p.length-1],lowerOpen:!0},v)))}}}}})};function Xa(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let o=0,s=0;o<e.keys.length&&s<t.length;++o)pe(e.keys[o],t[s])===0&&(r.push(n?pn(e.values[o]):e.values[o]),++s);return r.length===t.length?r:null}catch{return null}}const ld={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const o=Xa(r.keys,r.trans._cache,r.cache==="clone");return o?A.resolve(o):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?pn(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Bo(t){return!("from"in t)}const Be=function(t,e){if(!this){const n=new Be;return t&&"d"in t&&me(n,t),n}me(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function ln(t,e,n){const r=pe(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Bo(t))return me(t,{from:e,to:n,d:1});const o=t.l,s=t.r;if(pe(n,t.from)<0)return o?ln(o,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Cs(t);if(pe(e,t.to)>0)return s?ln(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Cs(t);pe(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),pe(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;o&&!t.l&&Zn(t,o),s&&a&&Zn(t,s)}function Zn(t,e){Bo(e)||function n(r,{from:o,to:s,l:a,r:i}){ln(r,o,s),a&&n(r,a),i&&n(r,i)}(t,e)}function cd(t,e){const n=to(e);let r=n.next();if(r.done)return!1;let o=r.value;const s=to(t);let a=s.next(o.from),i=a.value;for(;!r.done&&!a.done;){if(pe(i.from,o.to)<=0&&pe(i.to,o.from)>=0)return!0;pe(o.from,i.from)<0?o=(r=n.next(i.from)).value:i=(a=s.next(o.from)).value}return!1}function to(t){let e=Bo(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&pe(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||pe(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Cs(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),o=r>1?"r":r<-1?"l":"";if(o){const s=o==="r"?"l":"r",a={...t},i=t[o];t.from=i.from,t.to=i.to,t[o]=i[o],a[o]=i[s],t[s]=a,a.d=Es(a)}t.d=Es(t)}function Es({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Pt(Be.prototype,{add(t){return Zn(this,t),this},addKey(t){return ln(this,t,t),this},addKeys(t){return t.forEach(e=>ln(this,e,e)),this},[Fr](){return to(this)}});const ud={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new Be(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const o=t.table(r),{schema:s}=o,{primaryKey:a}=s,{extractKey:i,outbound:l}=a,u={...o,mutate:f=>{const h=f.trans,v=h.mutatedParts||(h.mutatedParts={}),p=C=>{const b=`idb://${e}/${r}/${C}`;return v[b]||(v[b]=new Be)},g=p(""),y=p(":dels"),{type:m}=f;let[_,k]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const O=f.trans._cache;return o.mutate(f).then(C=>{if(he(_)){m!=="delete"&&(_=C.results),g.addKeys(_);const b=Xa(_,O);b||m==="add"||y.addKeys(_),(b||k)&&function(I,E,j,N){function L(T){const R=I(T.name||"");function Z(D){return D!=null?T.extractKey(D):null}const $=D=>T.multiEntry&&he(D)?D.forEach(S=>R.addKey(S)):R.addKey(D);(j||N).forEach((D,S)=>{const F=j&&Z(j[S]),K=N&&Z(N[S]);pe(F,K)!==0&&(F!=null&&$(F),K!=null&&$(K))})}E.indexes.forEach(L)}(p,s,b,k)}else if(_){const b={from:_.lower,to:_.upper};y.add(b),g.add(b)}else g.add(n),y.add(n),s.indexes.forEach(b=>p(b.name).add(n));return C})}},c=({query:{index:f,range:h}})=>{var v,p;return[f,new Be((v=h.lower)!==null&&v!==void 0?v:t.MIN_KEY,(p=h.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},d={get:f=>[a,new Be(f.key)],getMany:f=>[a,new Be().addKeys(f.keys)],count:c,query:c,openCursor:c};return oe(d).forEach(f=>{u[f]=function(h){const{subscr:v}=M;if(v){const p=k=>{const O=`idb://${e}/${r}/${k}`;return v[O]||(v[O]=new Be)},g=p(""),y=p(":dels"),[m,_]=d[f](h);if(p(m.name||"").add(_),!m.isPrimaryKey){if(f!=="count"){const k=f==="query"&&l&&h.values&&o.query({...h,values:!1});return o[f].apply(this,arguments).then(O=>{if(f==="query"){if(l&&h.values)return k.then(({result:b})=>(g.addKeys(b),O));const C=h.values?O.result.map(i):O.result;h.values?g.addKeys(C):y.addKeys(C)}else if(f==="openCursor"){const C=O,b=h.values;return C&&Object.create(C,{key:{get:()=>(y.addKey(C.primaryKey),C.key)},primaryKey:{get(){const I=C.primaryKey;return y.addKey(I),I}},value:{get:()=>(b&&g.addKey(C.primaryKey),C.value)}})}return O})}y.add(n)}}return o[f].apply(this,arguments)}}),u}}}};class ut{constructor(e,n){this._middlewares={},this.verno=0;const r=ut.dependencies;this._options=n={addons:ut.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:o}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:X,dbReadyPromise:null,cancelOpen:X,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;s.dbReadyPromise=new A(i=>{s.dbReadyResolve=i}),s.openCanceller=new A((i,l)=>{s.cancelOpen=l}),this._state=s,this.name=e,this.on=Yt(this,"populate","blocked","versionchange","close",{ready:[jo,X]}),this.on.ready.subscribe=ka(this.on.ready.subscribe,i=>(l,u)=>{ut.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||A.resolve().then(l),u&&i(l);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(l),u&&i(l);else{i(l);const d=this;u||i(function f(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(f)})}})}),this.Collection=(a=this,Lt(Hu.prototype,function(i,l){this.db=a;let u=qa,c=null;if(l)try{u=l()}catch(v){c=v}const d=i._ctx,f=d.table,h=f.hook.reading.fire;this._ctx={table:f,index:d.index,isPrimKey:!d.index||f.schema.primKey.keyPath&&d.index===f.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:d.or,valueMapper:h!==nn?h:null}})),this.Table=function(i){return Lt(Vu.prototype,function(l,u,c){this.db=i,this._tx=c,this.name=l,this.schema=u,this.hook=i._allTables[l]?i._allTables[l].hook:Yt(null,{creating:[Fu,X],reading:[Au,nn],updating:[Ru,X],deleting:[Mu,X]})})}(this),this.Transaction=function(i){return Lt(Xu.prototype,function(l,u,c,d,f){this.db=i,this.mode=l,this.storeNames=u,this.schema=c,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Yt(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new A((h,v)=>{this._resolve=h,this._reject=v}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var v=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):v&&this.idbtrans&&this.idbtrans.abort(),se(h)})})}(this),this.Version=function(i){return Lt(nd.prototype,function(l){this.db=i,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(i){return Lt(Va.prototype,function(l,u,c){this.db=i,this._ctx={table:l,index:u===":id"?null:u,or:c};const d=i._deps.indexedDB;if(!d)throw new B.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(f,h)=>d.cmp(h,f),this._max=(f,h)=>d.cmp(f,h)>0?f:h,this._min=(f,h)=>d.cmp(f,h)<0?f:h,this._IDBKeyRange=i._deps.IDBKeyRange})}(this),this.on("versionchange",i=>{i.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",i=>{!i.newVersion||i.newVersion<i.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${i.oldVersion/10}`)}),this._maxKey=an(n.IDBKeyRange),this._createTransaction=(i,l,u,c)=>new this.Transaction(i,l,u,this._options.chromeTransactionDurability,c),this._fireOnBlocked=i=>{this.on("blocked").fire(i),Jt.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(i))},this.use(ad),this.use(id),this.use(ud),this.use(ld),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach(i=>i(this))}version(e){if(isNaN(e)||e<.1)throw new B.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(o=>o._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(ed),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?e():new A((n,r)=>{if(this._state.openComplete)return r(new B.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new B.DatabaseClosed);this.open().catch(X)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:o}){o&&this.unuse({stack:e,name:o});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r??10,name:o}),s.sort((a,i)=>a.level-i.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(o=>r?o.create!==r:!!n&&o.name!==n)),this}open(){return od(this)}_close(){const e=this._state,n=Jt.indexOf(this);if(n>=0&&Jt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new A(r=>{e.dbReadyResolve=r}),e.openCanceller=new A((r,o)=>{e.cancelOpen=o})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new B.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new A((r,o)=>{const s=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=te(()=>{(function({indexedDB:i,IDBKeyRange:l},u){!Ro(i)&&u!==cr&&Mo(i,l).delete(u).catch(X)})(this._deps,this.name),r()}),a.onerror=Pe(o),a.onblocked=this._fireOnBlocked};if(e)throw new B.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return oe(this._allTables).map(e=>this._allTables[e])}transaction(){const e=sd.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let o=M.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);const s=e.indexOf("?")!==-1;let a,i;e=e.replace("!","").replace("?","");try{if(i=n.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===gr)a=gr;else{if(e!="rw"&&e!=wr)throw new B.InvalidArgument("Invalid transaction mode: "+e);a=wr}if(o){if(o.mode===gr&&a===wr){if(!s)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&i.forEach(u=>{if(o&&o.storeNames.indexOf(u)===-1){if(!s)throw new B.SubTransaction("Table "+u+" not included in parent transaction.");o=null}}),s&&o&&!o.active&&(o=null)}}catch(u){return o?o._promise(null,(c,d)=>{d(u)}):se(u)}const l=Ga.bind(null,this,a,i,o,r);return o?o._promise(a,l,"lock"):M.trans?Ft(M.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!xe(this._allTables,e))throw new B.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const dd=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class fd{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[dd](){return this}}function Za(t,e){return oe(e).forEach(n=>{Zn(t[n]||(t[n]=new Be),e[n])}),t}function hd(t){let e,n=!1;const r=new fd(o=>{const s=Io(t);let a=!1,i={},l={};const u={get closed(){return a},unsubscribe:()=>{a=!0,Ze.storagemutated.unsubscribe(h)}};o.start&&o.start(u);let c=!1,d=!1;function f(){return oe(l).some(p=>i[p]&&cd(i[p],l[p]))}const h=p=>{Za(i,p),f()&&v()},v=()=>{if(c||a)return;i={};const p={},g=function(y){s&&At();const m=()=>Ge(t,{subscr:y,trans:null}),_=M.trans?Ft(M.transless,m):m();return s&&_.then(qe,qe),_}(p);d||(Ze(sn,h),d=!0),c=!0,Promise.resolve(g).then(y=>{n=!0,e=y,c=!1,a||(f()?v():(i={},l=p,o.next&&o.next(y)))},y=>{c=!1,n=!1,o.error&&o.error(y),u.unsubscribe()})};return v(),u});return r.hasValue=()=>n,r.getValue=()=>e,r}let no;try{no={indexedDB:Q.indexedDB||Q.mozIndexedDB||Q.webkitIndexedDB||Q.msIndexedDB,IDBKeyRange:Q.IDBKeyRange||Q.webkitIDBKeyRange}}catch{no={indexedDB:null,IDBKeyRange:null}}const nt=ut;function Bn(t){let e=Ke;try{Ke=!0,Ze.storagemutated.fire(t)}finally{Ke=e}}Pt(nt,{...Nn,delete:t=>new nt(t,{addons:[]}).delete(),exists:t=>new nt(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Ro(e)?Promise.resolve(e.databases()).then(r=>r.map(o=>o.name).filter(o=>o!==cr)):Mo(e,n).toCollection().primaryKeys()}(nt.dependencies).then(t)}catch{return se(new B.MissingAPI)}},defineClass:()=>function(t){me(this,t)},ignoreTransaction:t=>M.trans?Ft(M.transless,t):t(),vip:Qr,async:function(t){return function(){try{var e=eo(t.apply(this,arguments));return e&&typeof e.then=="function"?e:A.resolve(e)}catch(n){return se(n)}}},spawn:function(t,e,n){try{var r=eo(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:A.resolve(r)}catch(o){return se(o)}},currentTransaction:{get:()=>M.trans||null},waitFor:function(t,e){const n=A.resolve(typeof t=="function"?nt.ignoreTransaction(t):t).timeout(e||6e4);return M.trans?M.trans.waitFor(n):n},Promise:A,debug:{get:()=>Re,set:t=>{Sa(t,t==="dexie"?()=>!0:Ua)}},derive:kt,extend:me,props:Pt,override:ka,Events:Yt,on:Ze,liveQuery:hd,extendObservabilitySet:Za,getByKeyPath:$e,setByKeyPath:De,delByKeyPath:function(t,e){typeof e=="string"?De(t,e,void 0):"length"in e&&[].map.call(e,function(n){De(t,n,void 0)})},shallowClone:Oa,deepClone:pn,getObjectDiff:To,cmp:pe,asap:Ca,minKey:zr,addons:[],connections:Jt,errnames:Po,dependencies:no,semVer:gs,version:gs.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),nt.maxKey=an(nt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ze(sn,t=>{if(!Ke){let e;lr?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Je,!0,!0,t)):e=new CustomEvent(Je,{detail:t}),Ke=!0,dispatchEvent(e),Ke=!1}}),addEventListener(Je,({detail:t})=>{Ke||Bn(t)}));let Ke=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Je);typeof t.unref=="function"&&t.unref(),Ze(sn,e=>{Ke||t.postMessage(e)}),t.onmessage=e=>{e.data&&Bn(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ze(sn,e=>{try{Ke||(typeof localStorage<"u"&&localStorage.setItem(Je,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Je,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Je){const n=JSON.parse(e.newValue);n&&Bn(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Je&&Bn(e.changedParts)})}A.rejectionMapper=function(t,e){if(!t||t instanceof Ct||t instanceof TypeError||t instanceof SyntaxError||!t.name||!ps[t.name])return t;var n=new ps[t.name](e||t.message,t);return"stack"in t&&We(n,"stack",{get:function(){return this.inner.stack}}),n},Sa(Re,Ua);var Ln=(t=>(t.MOVE_TO_ROOT_FOLDER="moveToRootFolder",t.DELETE="delete",t))(Ln||{});const pd="comfyui_workspace_db";class md extends ut{constructor(){super(pd);ie(this,"workflows");ie(this,"changelogs");ie(this,"media");ie(this,"folders");ie(this,"tags");ie(this,"userSettings");ie(this,"models");ie(this,"cache");this.version(1).stores({workflows:"&id, name, parentFolderID",changelogs:"&id, workflowID",media:"&id, workflowID",folders:"&id, name, parentFolderID",tags:"&name",userSettings:"&id",models:"&id, fileName, fileHash",cache:"&id"}).upgrade(n=>{})}}const J=new md;class Mt{constructor(e){ie(this,"tableName");this.tableName=e}async saveDiskDB(){const e=await J[this.tableName].toArray(),n={};e.forEach(r=>{n[r.id]=r}),Oo(this.tableName,JSON.stringify(n))}async add(e){return await J[this.tableName].add(e),await this.saveDiskDB(),e}async put(e){return await J[this.tableName].add(e),await this.saveDiskDB(),e}async listAll(){return await J[this.tableName].toArray()}async batchQuery(e){return await J[this.tableName].bulkGet(e)}async getRecords(){console.warn("[DEPRECATED] getRecords() call, should only be used for one-time backfill for indexdb",this.tableName);const e=await ga(this.tableName);let n;try{n=e!=null?JSON.parse(e):null}catch{}if(n==null){const r=await xa()??"{}";n=JSON.parse(r)[this.tableName]}return n??{}}async get(e){return await J[this.tableName].get(e)}async delete(e){await J[this.tableName].delete(e),await this.saveDiskDB()}}const er=class er extends Mt{constructor(){super("changelogs")}static async load(){return new er}async listByWorkflowID(e){const n=await J.changelogs.where("workflowID").equals(e).reverse().sortBy("createTime");if(n!=null&&n.length)return n;const r=await this.getRecords();return Object.values(r).filter(o=>o.workflowID===e).sort((o,s)=>s.createTime-o.createTime)}async getLastestByWorkflowID(e){const n=await this.listByWorkflowID(e);if(n!=null&&n.length)return n[0];const r=await this.getRecords();return Object.values(r).filter(s=>s.workflowID===e).sort((s,a)=>a.createTime-s.createTime)[0]}async create(e){const n=await this.getLastestByWorkflowID(e.workflowID);if(n!=null&&n.json===e.json)return null;const r={id:en(),json:e.json,workflowID:e.workflowID,createTime:Date.now()};return await J.changelogs.add(r),await this.saveDiskDB(),r}};ie(er,"TABLE_NAME","changelogs");let ro=er;const mf="CWM_WORKFLOWS_SORT_TYPE";var rt=(t=>(t.RECENTLY_MODIFIED="newest",t.OLDEST_MODIFIED="oldest",t.AZ="name A-Z",t.ZA="name Z-A",t))(rt||{});const Qa="comfyspace_tracking",ei="workspace_info";async function $t(t){const e=await Lo(t);if(e==null)return;const n=await Ko(t);await(P==null?void 0:P.updateFlow(t.id,{filePath:n??void 0}));const r=t.json,o=JSON.parse(r);o.extra[ei]={id:t.id,name:t.name},delete o.extra[Qa],await wa(e,JSON.stringify(o))}async function Cr(t){if(t.name==null)return;const e=await Lo(t);e!=null&&ba(e)}async function Lo(t){let e=yd(t.name)+".json",n=t.parentFolderID;for(;n!=null;){const r=await(G==null?void 0:G.get(n));if(r==null)break;e=`${r.name}/${e}`,n=r.parentFolderID??void 0}return e??null}async function Ko(t){const e=await Lo(t);let n=await(W==null?void 0:W.getSetting("myWorkflowsDir"));return n==null?(console.error("myWorkflowsDir is not set"),null):(n.endsWith("/")||(n=n+"/"),n+e)}async function vd(t){const e=await(G==null?void 0:G.get(t));let n=e==null?void 0:e.parentFolderID,r=e==null?void 0:e.name;for(;n;){const s=await(G==null?void 0:G.get(n));if(s==null)break;r=`${s.name}/${r}`,n=s.parentFolderID??void 0}let o=await(W==null?void 0:W.getSetting("myWorkflowsDir"));return o==null?(console.error("myWorkflowsDir is not set"),null):(o.endsWith("/")||(o=o+"/"),o+r)}async function vf(t){const e=await(P==null?void 0:P.listAll())??[],n=await(G==null?void 0:G.listAll())??[],r=[t];let o=0;for(;r.length>0;){const s=r.shift();if(s){for(const i of e)i.parentFolderID===s&&o++;const a=n.filter(i=>i.parentFolderID===s).map(i=>i.id);a.length&&r.push(...a)}}return o}function yd(t){return t=t.replace(/[\\/:*?"<>|]/g,"_"),t.trim()}function gd(t,e=!1){const n=new Date(t),r=String(n.getDate()).padStart(2,"0"),o=String(n.getMonth()+1).padStart(2,"0"),s=n.getFullYear(),a=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0"),l=String(n.getSeconds()).padStart(2,"0"),u=`${o}-${r}-${s} ${a}:${i}`;return e?u+`:${l}`:u}async function ti(t=!1){const e=await(P==null?void 0:P.listAll())??[];for(const n of e){const r=await Ko(n);n.filePath!=r&&(n.filePath!=null&&await ba(n.filePath,t),await $t(n))}}const wd=(t,e=rt.RECENTLY_MODIFIED)=>{const n=[...t];switch(e){case rt.AZ:n.sort((r,o)=>r.name.localeCompare(o.name));break;case rt.ZA:n.sort((r,o)=>o.name.localeCompare(r.name));break;case rt.RECENTLY_MODIFIED:n.sort((r,o)=>o.updateTime-r.updateTime);break;case rt.OLDEST_MODIFIED:n.sort((r,o)=>r.updateTime-o.updateTime);break}return n};async function Os(t){let e=t??"Untitled Flow";const r=(await(P==null?void 0:P.listAll())??[]).map(o=>o.name);if(r.includes(e)){let o=2,s=!0;for(;s;)r.includes(`${e} ${o}`)?o++:(e=`${e} ${o}`,s=!1)}return e}function yf(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=o=>{const s=new Uint8Array(o.target.result),a=new DataView(s.buffer);a.getUint32(0)!==2303741511&&(console.error("Not a valid PNG file"),n());let i=8;const l={};for(;i<s.length;){const u=a.getUint32(i),c=String.fromCharCode(...s.slice(i+4,i+8));if(c==="tEXt"||c=="comf"){let d=i+8;for(;s[d]!==0;)d++;const f=String.fromCharCode(...s.slice(i+8,d)),h=s.slice(d+1,i+8+u),v=Array.from(h).map(p=>String.fromCharCode(p)).join("");l[f]=v}i+=12+u}e(l)},r.readAsArrayBuffer(t)})}function bd(t){const e=new Uint16Array(t.slice(0,2))[0]===18761;function n(a,i,l){const u=t.slice(a,a+l);if(l===2)return new DataView(u.buffer,u.byteOffset,u.byteLength).getUint16(0,i);if(l===4)return new DataView(u.buffer,u.byteOffset,u.byteLength).getUint32(0,i)}const r=n(4,e,4);function o(a){const i=n(a,e,2),l={};for(let u=0;u<i;u++){const c=a+2+u*12,d=n(c,e,2),f=n(c+2,e,2),h=n(c+4,e,4),v=n(c+8,e,4);let p;f===2&&(p=String.fromCharCode(...t.slice(v,v+h-1))),l[d]=p}return l}return o(r)}function gf(t){return new Promise(e=>{const n=new FileReader;n.onload=r=>{var l;const o=new Uint8Array((l=r==null?void 0:r.target)==null?void 0:l.result),s=new DataView(o.buffer);if(s.getUint32(0)!==1380533830||s.getUint32(8)!==1464156752){console.error("Not a valid WEBP file"),e();return}let a=12;const i={};for(;a<o.length;){const u=s.getUint32(a+4,!0);if(String.fromCharCode(...o.slice(a,a+4))==="EXIF"){String.fromCharCode(...o.slice(a+8,a+8+6))=="Exif\0\0"&&(a+=6);const d=bd(o.slice(a+8,a+8+u));for(const f in d){const h=d[f],v=h.indexOf(":");i[h.slice(0,v)]=h.slice(v+1)}}a+=8+u}e(i)},n.readAsArrayBuffer(t)})}function wf(t){return!!(t!=null&&t.endsWith(".webm")||t!=null&&t.endsWith(".mp4"))}function bf(t){return new Promise(e=>{const n=new FileReader;n.onload=r=>{const o=new Uint8Array(r.target.result),s=new DataView(o.buffer),a=new TextDecoder;if(s.getUint32(0)==440786851){let i=12;for(;i<o.length-16;){if(s.getUint16(i)==17543&&String.fromCharCode(...o.slice(i-7,i))==="COMMENT"){const u=s.getUint32(i+2),c=Math.clz32(u)+1;if(c<4){const d=u>>8*(4-c)&~(1<<7*c),f=a.decode(o.slice(i+2+c,i+2+c+d)),h=JSON.parse(f);e(h);return}}i+=1}}else if(s.getUint32(4)==1718909296&&s.getUint32(8)==1769172845){let i=o.length-4;for(;i>16;){if(s.getUint32(i)==1684108385&&s.getUint32(i-8)==2841865588){s.getUint32(i+4),s.getUint32(i+8);const l=s.getUint32(i-4)-4*4,u=a.decode(o.slice(i+12,i+12+l)),c=JSON.parse(u);e(c);return}i-=1}}else{console.error("Unknown magic: "+s.getUint32(0)),e();return}},n.readAsArrayBuffer(t)})}const xd=t=>{var n;const e=(n=W==null?void 0:W.getSetting("shortcuts"))==null?void 0:n.save;return e?_d(t,e):!1},_d=(t,e)=>{const n=e.split("+"),r={Control:t.ctrlKey,Shift:t.shiftKey,Alt:t.altKey,Command:t.metaKey,[t.key.toUpperCase()]:!0};return n.every(o=>r[o])};function xf(t){const e=["png","jpg","jpeg","gif","bmp","webp"],n=t.split(".").pop();return n!=null&&e.includes(n)}function kd(t){return`/workspace/view_media?filename=${t}`}async function Cd(t,e){if(t.length&&await(P==null?void 0:P.batchCreateFlows(t,!0)),e.length){const n=await(G==null?void 0:G.listAll());for(const r of e){const o=n==null?void 0:n.find(a=>a.name===r.name);let s;if(o)s=o.id;else{const a=await(G==null?void 0:G.create({name:r.name}));s=a==null?void 0:a.id}await(P==null?void 0:P.batchCreateFlows(r.list,!0,s))}}}function Ds(){const e=window.location.hash.slice(1).split("/").find(n=>n.includes("workspaceId@"));return e?e.split("@")[1]:null}function ni(t){const e=window.location.hash.slice(1).split("/"),n=e.findIndex(o=>o.includes("workspaceId@")),r=`workspaceId@${t}`;return n>=0?e[n]=r:e.push(r),`${e.join("/")}`}const Ed=t=>{const e=ni(t);window.open(`${window.location.origin}/#${e}`)};async function Od(){const t=await(P==null?void 0:P.listAll())??[];for(const e of t)try{const n=await Ko(e),r=JSON.parse(e.json);r.extra[ei]={id:e.id,name:e.name},delete r.extra[Qa],n&&await wa(n,JSON.stringify(r))}catch(n){console.error(n)}}const oo={last_node_id:9,last_link_id:9,nodes:[{id:7,type:"CLIPTextEncode",pos:[413,389],size:{0:425.27801513671875,1:180.6060791015625},flags:{},order:3,mode:0,inputs:[{name:"clip",type:"CLIP",link:5}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[6],slot_index:0}],properties:{},widgets_values:["text, watermark"]},{id:6,type:"CLIPTextEncode",pos:[415,186],size:{0:422.84503173828125,1:164.31304931640625},flags:{},order:2,mode:0,inputs:[{name:"clip",type:"CLIP",link:3}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[4],slot_index:0}],properties:{},widgets_values:["beautiful scenery nature glass bottle landscape, , purple galaxy bottle,"]},{id:5,type:"EmptyLatentImage",pos:[473,609],size:{0:315,1:106},flags:{},order:1,mode:0,outputs:[{name:"LATENT",type:"LATENT",links:[2],slot_index:0}],properties:{},widgets_values:[512,512,1]},{id:3,type:"KSampler",pos:[863,186],size:{0:315,1:262},flags:{},order:4,mode:0,inputs:[{name:"model",type:"MODEL",link:1},{name:"positive",type:"CONDITIONING",link:4},{name:"negative",type:"CONDITIONING",link:6},{name:"latent_image",type:"LATENT",link:2}],outputs:[{name:"LATENT",type:"LATENT",links:[7],slot_index:0}],properties:{},widgets_values:[0x8e7ff42ed37e,!0,20,8,"euler","normal",1]},{id:8,type:"VAEDecode",pos:[1209,188],size:{0:210,1:46},flags:{},order:5,mode:0,inputs:[{name:"samples",type:"LATENT",link:7},{name:"vae",type:"VAE",link:8}],outputs:[{name:"IMAGE",type:"IMAGE",links:[9],slot_index:0}],properties:{}},{id:9,type:"SaveImage",pos:[1451,189],size:{0:210,1:26},flags:{},order:6,mode:0,inputs:[{name:"images",type:"IMAGE",link:9}],properties:{}},{id:4,type:"CheckpointLoaderSimple",pos:[26,474],size:{0:315,1:98},flags:{},order:0,mode:0,outputs:[{name:"MODEL",type:"MODEL",links:[1],slot_index:0},{name:"CLIP",type:"CLIP",links:[3,5],slot_index:1},{name:"VAE",type:"VAE",links:[8],slot_index:2}],properties:{},widgets_values:["v1-5-pruned-emaonly.ckpt"]}],links:[[1,4,0,3,0,"MODEL"],[2,5,0,3,3,"LATENT"],[3,4,1,6,0,"CLIP"],[4,6,0,3,1,"CONDITIONING"],[5,4,1,7,0,"CLIP"],[6,7,0,3,2,"CONDITIONING"],[7,3,0,8,0,"LATENT"],[8,4,2,8,1,"VAE"],[9,8,0,9,0,"IMAGE"]],groups:[],config:{},extra:{},version:.4},tr=class tr extends Mt{constructor(){super("workflows");ie(this,"_curWorkflow",null)}get curWorkflow(){return this._curWorkflow}static async load(){return new tr}updateCurWorkflowID(n){if(n==null){this._curWorkflow=null;return}this.get(n).then(r=>{this._curWorkflow=r??null})}async createFlow(n){const{id:r,json:o,name:s}=n,a=await Os(s),i=r??en(),l=Date.now(),u={...n,id:i,json:o??JSON.stringify(oo),name:a,updateTime:l,createTime:l};return await J.workflows.add(u),this.saveDiskDB(),$t(u),u}async updateFlow(n,r){const o=await this.get(n);if(o==null)return;const s={...o,...r,id:n},a=JSON.stringify(o),i=JSON.stringify(s);if(a===i)return;const l=s,u=Object.keys(r);if(u.length===1&&["tags","parentFolderID"].includes(u[0])||(l.updateTime=Date.now(),l.parentFolderID!=null&&await(G==null?void 0:G.update({id:l.parentFolderID,updateTime:Date.now()}))),await J.workflows.update(n,l),this._curWorkflow&&this._curWorkflow.id===n&&(this._curWorkflow=l),await this.saveDiskDB(),r.name!=null||r.parentFolderID!=null){await Cr(o),await $t(s);return}r.json!=null&&await $t(s)}async batchCreateFlows(n=[],r=!1,o){const s=[];for(const a of n){const i=a.name&&r?a.name:await Os(a.name),l=en(),u=Date.now(),c={id:l,name:i,json:a.json,parentFolderID:o,updateTime:u,createTime:u,tags:[]};s.push(c),await $t(c)}await J.workflows.bulkAdd(s),this.saveDiskDB()}async deleteFlow(n){const r=await this.get(n);r&&Cr({...r}),await J.workflows.delete(n),this.saveDiskDB()}async batchDeleteFlow(n){const r=await J.workflows.bulkGet(n);for(const o of r)o&&await Cr(o);await J.workflows.bulkDelete(n),this.saveDiskDB()}async listFolderContent(n,r){const o=await this.listAll().then(i=>i.filter(l=>l.parentFolderID==n))??[],s=await(G==null?void 0:G.listAll().then(i=>i.filter(l=>l.parentFolderID==n)))??[],a=[...o,...s];return wd(a,r??rt.RECENTLY_MODIFIED)}};ie(tr,"TABLE_NAME","workflows");let so=tr;const nr=class nr extends Mt{constructor(){super("folders")}static async load(){return new nr}async create(e){const n=await this.generateUniqueName(e.name),r={id:en(),name:n,parentFolderID:e.parentFolderID??null,updateTime:Date.now(),createTime:Date.now(),type:"folder"};return await J.folders.add(r),this.saveDiskDB(),r}async update(e){const n=await this.get(e.id);n!=null&&({...n,...e},e.name!=null,await J.folders.update(e.id,e),this.saveDiskDB(),(e.name!=null||e.parentFolderID!=null)&&ti(!0))}async deleteFolder(e,n=Ln.DELETE){const r=await vd(e),o=await(P==null?void 0:P.listAll())??[],s=await this.listAll(),a=[e];for(;a.length>0;){const i=a.shift();if(i){for(const u of o)if(u.parentFolderID===i)switch(n){case Ln.DELETE:await(P==null?void 0:P.deleteFlow(u.id));break;case Ln.MOVE_TO_ROOT_FOLDER:await(P==null?void 0:P.updateFlow(u.id,{parentFolderID:void 0}));break}await J.folders.delete(i);const l=s.filter(u=>u.parentFolderID===i).map(u=>u.id);l.length&&a.push(...l)}}r&&await wu(r),this.saveDiskDB()}async generateUniqueName(e){let n=e??"New folder";const r=await this.listAll().then(o=>o.map(s=>s.name));if(r.includes(n)){let o=2,s=!0;for(;s;)r.includes(`${n} ${o}`)?o++:(n=`${n} ${o}`,s=!1)}return n}};ie(nr,"TABLE_NAME","folders");let ao=nr;class ri extends Mt{constructor(){super("media")}async listByWorkflowID(e){const n=await J.media.where("workflowID").equals(e).reverse().sortBy("createTime");if(n.length>0)return n;const r=await this.getRecords();return Object.values(r).filter(o=>o.workflowID===e).sort((o,s)=>s.createTime-o.createTime)}async create(e){const n=e.localPath.split(".").pop();if(n==null)return null;const r={id:en(),localPath:e.localPath,workflowID:e.workflowID,createTime:Date.now(),format:n},o=await(P==null?void 0:P.get(e.workflowID)),s=new Set((o==null?void 0:o.mediaIDs)??[]).add(r.id);return await(P==null?void 0:P.updateFlow(e.workflowID,{mediaIDs:Array.from(s),coverMediaPath:r.localPath})),J.media.add(r),this.saveDiskDB(),r}}ie(ri,"TABLE_NAME","media");const Er="guest",ot=class ot extends Mt{constructor(){super("userSettings");ie(this,"records");this.records={id:Er,topBarStyle:{top:0,left:0},myWorkflowsDir:"",shortcuts:{save:"Shift+S"},autoSave:!0,twoWaySync:!1}}getSetting(n){return this.records[n]}upsert(n){this.records={...this.records,...n},J.userSettings.put(this.records),Oo(ot.TABLE_NAME,JSON.stringify(this.records))}static async load(){const n=new ot;let r=await J.userSettings.get(Er);if(r==null){const o=await ga(ot.TABLE_NAME);if(r=o!=null?JSON.parse(o):null,r==null){const s=await xa()??"{}";r=JSON.parse(s)[ot.TABLE_NAME]||{}}}if(r==null&&(r=n.records),!r.myWorkflowsDir){const o=await yu();r.myWorkflowsDir=`${o.dir_path}/my_workflows`}return r.id||(r.id=Er),n.records=r,n}};ie(ot,"TABLE_NAME","userSettings");let io=ot;const rr=class rr extends Mt{constructor(){super("tags")}static async load(){return new rr}async upsert(e){const n={name:e,workflowIDs:[],updateTime:Date.now()};J.tags.put(n);const r=await this.getRecords();return r[e]==null&&(r[e]=n),r[e].updateTime=Date.now(),Oo("tags",JSON.stringify(r)),r[e]}};ie(rr,"TABLE_NAME","tags");let lo=rr;function _f(t){return t.type==="folder"}let P=null,Kn=null,W=null,G=null,Ae=null,dt=null;async function Dd(){const t=async()=>{P=await so.load()},e=async()=>{Kn=await lo.load()},n=async()=>{W=await io.load()},r=async()=>{G=await ao.load()},o=async()=>{Ae=await ro.load()},s=async()=>{dt=new ri};await Promise.all([t(),e(),n(),r(),o(),s()]),localStorage.getItem("WORKSPACE_INDEXDB_BACKFILL")!=="true"&&(await Id(),localStorage.setItem("WORKSPACE_INDEXDB_BACKFILL","true"))}async function Id(){const t=async()=>{try{const a=await(P==null?void 0:P.getRecords());a&&await J.workflows.bulkAdd(Object.values(a))}catch(a){console.error(a)}},e=async()=>{try{const a=await(G==null?void 0:G.getRecords());a&&await J.folders.bulkAdd(Object.values(a))}catch(a){console.error(a)}},n=async()=>{try{const a=await(dt==null?void 0:dt.getRecords());a&&await J.media.bulkAdd(Object.values(a))}catch(a){console.error(a)}},r=async()=>{try{const a=await(Ae==null?void 0:Ae.getRecords());a&&await J.changelogs.bulkAdd(Object.values(a))}catch(a){console.error(a)}},o=async()=>{try{const a=await(Kn==null?void 0:Kn.getRecords());a&&await J.tags.bulkAdd(Object.values(a))}catch(a){console.error(a)}},s=async()=>{try{W!=null&&W.records&&await J.userSettings.put(W==null?void 0:W.records)}catch(a){console.error(a)}};await Promise.all([t(),e(),n(),r(),o(),s()])}const yn=w.createContext({curFlowID:null,loadWorkflowID:()=>{},saveCurWorkflow:()=>{},discardUnsavedChanges:()=>{},isDirty:!1,loadNewWorkflow:()=>{},loadFilePath:()=>{},setRoute:()=>{}}),kf=w.createContext({refreshFolderStamp:0,setRefreshFolderStamp:()=>{}}),Or={x:0,y:0};function Sd({children:t,onDragEnd:e}){const n=w.useRef(Or),r=w.useRef(!1),[o,s]=w.useState(Or),a=c=>{var d,f,h;if([(d=c.target)==null?void 0:d.id,(h=(f=c.target)==null?void 0:f.parentNode)==null?void 0:h.id].includes("dragPanelIcon")){n.current={x:c.clientX,y:c.clientY},r.current=!0,window.addEventListener("mousemove",i),window.addEventListener("mouseup",l);const v=document.getElementsByTagName("body")[0];v.style.userSelect="none"}},i=w.useCallback(c=>{const d={x:c.clientX-n.current.x,y:c.clientY-n.current.y};s(d)},[]),l=w.useCallback(()=>{s(d=>(e(d),Or)),r.current=!1;const c=document.getElementsByTagName("body")[0];c.style.userSelect="auto",window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",l)},[e,i]),u={transform:`translate(${o.x}px, ${o.y}px)`,zIndex:r.current?1e3:1};return x.jsx("div",{style:u,onMouseDown:a,children:t})}var Pd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},jd=Object.defineProperty,Nd=Object.defineProperties,Ad=Object.getOwnPropertyDescriptors,Qn=Object.getOwnPropertySymbols,oi=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable,Is=(t,e,n)=>e in t?jd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ss=(t,e)=>{for(var n in e||(e={}))oi.call(e,n)&&Is(t,n,e[n]);if(Qn)for(var n of Qn(e))si.call(e,n)&&Is(t,n,e[n]);return t},Fd=(t,e)=>Nd(t,Ad(e)),Md=(t,e)=>{var n={};for(var r in t)oi.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Qn)for(var r of Qn(t))e.indexOf(r)<0&&si.call(t,r)&&(n[r]=t[r]);return n},Ee=(t,e,n)=>{const r=w.forwardRef((o,s)=>{var a=o,{color:i="currentColor",size:l=24,stroke:u=2,children:c}=a,d=Md(a,["color","size","stroke","children"]);return w.createElement("svg",Ss(Fd(Ss({ref:s},Pd),{width:l,height:l,stroke:i,strokeWidth:u,className:`tabler-icon tabler-icon-${t}`}),d),[...n.map(([f,h])=>w.createElement(f,h)),...c||[]])});return r.propTypes={color:tt.string,size:tt.oneOfType([tt.string,tt.number]),stroke:tt.oneOfType([tt.string,tt.number])},r.displayName=`${e}`,r},Rd=Ee("arrow-back-up-double","IconArrowBackUpDouble",[["path",{d:"M13 14l-4 -4l4 -4",key:"svg-0"}],["path",{d:"M8 14l-4 -4l4 -4",key:"svg-1"}],["path",{d:"M9 10h7a4 4 0 1 1 0 8h-1",key:"svg-2"}]]),Td=Ee("chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]),co=Ee("device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]]),Bd=Ee("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),Ld=Ee("external-link","IconExternalLink",[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]]),Kd=Ee("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]),Wd=Ee("grip-vertical","IconGripVertical",[["path",{d:"M9 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M9 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M9 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M15 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}],["path",{d:"M15 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-4"}],["path",{d:"M15 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-5"}]]),$d=Ee("history","IconHistory",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]),Ud=Ee("photo","IconPhoto",[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5",key:"svg-2"}],["path",{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3",key:"svg-3"}]]),qd=Ee("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),zd=Ee("triangle-inverted-filled","IconTriangleInvertedFilled",[["path",{d:"M20.118 3h-16.225a2.914 2.914 0 0 0 -2.503 4.371l8.116 13.549a2.917 2.917 0 0 0 4.987 .005l8.11 -13.539a2.914 2.914 0 0 0 -2.486 -4.386z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),Vd=Ee("x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);function Hd({backgroundColor:t}){const e=t===void 0?"rgba(0,0,0,0.5)":t??void 0;return x.jsx("div",{style:{position:"fixed",top:0,bottom:0,left:0,right:0,backgroundColor:e}})}function Jd({onClose:t}){const{curFlowID:e,isDirty:n}=w.useContext(yn),[r,o]=w.useState(null),[s,a]=w.useState(),[i,l]=w.useState([]);return w.useEffect(()=>{(async c=>{var p;const d=await(P==null?void 0:P.get(c));if(!d||!c){alert("No current workflow found!");return}a(d);const f=await(Ae==null?void 0:Ae.listByWorkflowID(c));l(f??[]);const h=f==null?void 0:f.filter(g=>g.json===(d==null?void 0:d.lastSavedJson)),v=(p=h==null?void 0:h[0])==null?void 0:p.id;v&&o(v)})(e??"")},[]),!e||!s?null:x.jsxs(Wi,{width:400,height:"100vh",pl:4,pr:5,pt:4,gap:0,position:"fixed",top:0,left:0,zIndex:1e3,children:[x.jsx(Ki,{pb:1,mb:0,children:x.jsxs(Zs,{justifyContent:"space-between",alignItems:"center",children:[x.jsx(Gs,{size:"md",children:"Version History"}),x.jsx(Xt,{size:"sm",icon:x.jsx(Vd,{}),onClick:t,variant:"ghost","aria-label":"close version history"})]})}),x.jsxs(Li,{overflowY:"auto",gap:0,children:[x.jsx($n,{mb:4,children:"All the saved changes of this workflow"}),x.jsx(yo,{divider:x.jsx(Js,{}),spacing:2,children:i==null?void 0:i.map(u=>x.jsxs(Ye,{size:"sm",variant:"ghost",onClick:()=>{if(n){alert("You have unsaved changes, please save or discard your changes to proceed switching version, in case losing your changes.");return}Ie.loadGraphData(JSON.parse(u.json)),P==null||P.updateFlow(e,{lastSavedJson:u.json}),t()},isActive:u.id===r,children:["Saved at ",gd(u.createTime,!0)]}))})]})]})}function Yd({onClick:t}){var j;const{curFlowID:e,onDuplicateWorkflow:n,discardUnsavedChanges:r,saveCurWorkflow:o}=w.useContext(yn),[s,a]=w.useState(!1),[i,l]=w.useState(!1),[u,c]=w.useState(""),[d,f]=w.useState(""),[h,v]=w.useState(),[p,g]=w.useState(!1);w.useEffect(()=>{e&&(P==null||P.get(e).then(N=>{c((N==null?void 0:N.name)??""),v(N)}))},[e]);const y=N=>{c(N.target.value),d&&f("")},m=()=>{if(!e){alert("Flow ID is required");return}n==null||n(e,u),_()},_=()=>{a(!1)},k=w.useCallback(async()=>{const N=e?await(P==null?void 0:P.get(e)):null;if(!N){alert("Workspace does not exist");return}const L=new Blob([N.json],{type:"application/json"}),T=URL.createObjectURL(L),R=document.createElement("a");R.href=T,R.download=`${N.name}.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(T)},[e]),O=(j=W==null?void 0:W.getSetting("shortcuts"))==null?void 0:j.save,[C,b]=w.useState(),I=()=>{b(setTimeout(()=>g(!1),300))},E=()=>{g(!0),clearTimeout(C),b(void 0)};return x.jsxs(x.Fragment,{children:[x.jsxs(ha,{isLazy:!0,isOpen:p,gutter:4,children:[x.jsx(ya,{onMouseEnter:E,onMouseLeave:I,children:x.jsx(Xt,{icon:x.jsx(Td,{size:20}),"aria-label":"menu",size:"xs",backgroundColor:"#323232",color:"white"})}),x.jsxs(uo,{children:[x.jsxs(va,{minWidth:150,zIndex:1e3,onMouseEnter:E,onMouseLeave:I,children:[x.jsx(wt,{onClick:o,icon:x.jsx(co,{size:20}),iconSpacing:1,command:O,children:"Save"}),x.jsx(_t,{label:"Revert workflow to your last saved version. You will lose all changes made since your last save.",children:x.jsx(wt,{onClick:r,icon:x.jsx(Rd,{size:20}),iconSpacing:1,isDisabled:(h==null?void 0:h.lastSavedJson)==null,children:"Discard unsaved changes"})}),x.jsx(wt,{onClick:k,icon:x.jsx(Bd,{size:20}),iconSpacing:1,children:"Download"}),x.jsx(wt,{onClick:()=>a(!0),icon:x.jsx(co,{size:20}),iconSpacing:1,children:"Save As"}),x.jsx(wt,{onClick:()=>l(!0),icon:x.jsx($d,{size:20}),iconSpacing:1,children:"Versions History"})]}),p&&x.jsx(Hd,{backgroundColor:null})]})]}),i&&x.jsx(Jd,{onClose:()=>l(!1)}),s&&x.jsxs(Ns,{isOpen:!0,onClose:_,children:[x.jsx(As,{}),x.jsxs(Fs,{children:[x.jsx(Ms,{children:"Save As"}),x.jsx(Rs,{}),x.jsx(Ts,{children:x.jsxs(po,{isInvalid:!!d,children:[x.jsx(vo,{children:"Workflow name"}),x.jsx(ar,{value:u,onChange:y,autoFocus:!0,onKeyUp:N=>{N.code==="Enter"&&!d&&m()}}),d&&x.jsx(mo,{children:d})]})}),x.jsxs(Bs,{children:[x.jsx(Ye,{colorScheme:"teal",mr:3,onClick:m,isDisabled:!u||!!d,children:"Save"}),x.jsx(Ye,{onClick:_,children:"Cancel"})]})]})]})]})}function Gd({displayName:t,updateFlowName:e,isDirty:n}){const{isOpen:r,onOpen:o,onClose:s}=il(),{curFlowID:a}=w.useContext(yn),[i,l]=w.useState(t),[u,c]=w.useState(""),d=()=>{l(t),o()},f=p=>{l(p.target.value),u&&c("")},h=async()=>{if(a){const p=i.trim();if(l(p),t===p)return v();const g=await(P==null?void 0:P.listAll())??[];(g==null?void 0:g.map(m=>m.name)).includes(p)?c("The name is duplicated, please modify it and submit again."):(await(P==null?void 0:P.updateFlow(a,{name:p})),e(p),v())}},v=()=>{c(""),s()};return a==null?null:x.jsxs(xt,{children:[x.jsx(_t,{label:t,placement:"bottom",children:x.jsxs($n,{color:"white",onClick:d,maxW:240,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:[x.jsx("div",{style:{width:8,display:"inline-block"},children:x.jsx($n,{as:"span",children:n&&"* "})}),t]})}),x.jsxs(Ns,{isOpen:r,onClose:v,children:[x.jsx(As,{}),x.jsxs(Fs,{children:[x.jsx(Ms,{children:"Edit workflow name"}),x.jsx(Rs,{}),x.jsx(Ts,{children:x.jsxs(po,{isInvalid:!!u,children:[x.jsx(vo,{children:"Workflow name"}),x.jsx(ar,{value:i,onChange:f,autoFocus:!0,onKeyUp:p=>{p.code==="Enter"&&!u&&h()}}),u&&x.jsx(mo,{children:u})]})}),x.jsxs(Bs,{children:[x.jsx(Ye,{colorScheme:"teal",mr:3,onClick:h,isDisabled:!i||!!u,children:"Save"}),x.jsx(Ye,{onClick:v,children:"Cancel"})]})]})]})]})}function Xd({updatePanelPosition:t,positionStyle:e,curFlowName:n,setCurFlowName:r}){const{isDirty:o,loadNewWorkflow:s,saveCurWorkflow:a,setRoute:i,curFlowID:l}=w.useContext(yn);return x.jsx(Sd,{onDragEnd:u=>{t({top:u.y,left:u.x},!0)},children:x.jsxs(xt,{style:{padding:2,position:"fixed",...e},justifyContent:"space-between",alignItems:"center",gap:2,draggable:!1,id:"workspaceManagerPanel",className:"workspaceManagerPanel",children:[x.jsx(Ye,{size:"sm","aria-label":"workspace folder",onClick:()=>i("recentFlows"),px:2,children:x.jsxs(xt,{gap:1,children:[x.jsx(Kd,{size:21}),x.jsx(zd,{size:8})]})}),x.jsx(_t,{label:"New workflow",children:x.jsx(Ye,{size:"sm",variant:"outline",colorScheme:"teal","aria-label":"new workflow",onClick:()=>s(),px:2,py:2,children:x.jsx(xt,{gap:0,children:x.jsx(qd,{size:16,color:"white"})})})}),x.jsx(Gd,{isDirty:o,displayName:n??"",updateFlowName:u=>{r(u),requestAnimationFrame(()=>{t()})}}),l&&x.jsxs(xt,{gap:"1px",children:[x.jsx(_t,{label:"Open gallery",children:x.jsx(Xt,{onClick:()=>i("gallery"),icon:x.jsx(Ud,{size:20,color:"white"}),size:"sm","aria-label":"open gallery",variant:"ghost"})}),x.jsx(Yd,{})]}),l&&o?x.jsx(_t,{label:"Save workflow",children:x.jsx(Xt,{style:{width:22},onClick:a,icon:x.jsx(co,{size:22,color:"white"}),size:"xs","aria-label":"save workspace",variant:"ghost"})}):x.jsx("div",{style:{width:22}}),x.jsx(Wd,{id:"dragPanelIcon",className:"dragPanelIcon",cursor:"move",size:15,color:"#FFF"})]})})}const Zd=fo.lazy(()=>ho(()=>import("./RecentFilesDrawer-xINb5DPL.js"),__vite__mapDeps([0,1,2,3,4,5]))),Qd=fo.lazy(()=>ho(()=>import("./GalleryModal-4oMlixZ7.js"),__vite__mapDeps([6,1,2,3,5]))),ef=fo.lazy(()=>ho(()=>import("./ModelManagerTopbar-Clt4PNkc.js").then(t=>t.M),__vite__mapDeps([7,1,3,4]))),tf=["download_progress","download_error","model_list"];function nf(){const[t,e]=w.useState(null),[n,r]=w.useState("root"),[o,s]=w.useState(!0),[a,i]=w.useState(null),l=w.useRef(null),[u,c]=w.useState(),[d,f]=w.useState(!1),h=w.useRef(null),{showDialog:v}=Ei(),[p,g]=w.useState(!1);w.useRef(!1);const y=w.useRef(0),m=w.useCallback(()=>{if(l.current){const S=JSON.stringify(Ie.graph.serialize());P==null||P.updateFlow(l.current,{lastSavedJson:S,json:S}),Ae==null||Ae.create({workflowID:l.current,json:S})}},[]),_=async()=>{if(confirm("Are you sure you want to discard unsaved changes? This will revert current workflow to your last saved version. You will lose all changes made since your last save.")&&l.current){const F=await(P==null?void 0:P.get(l.current));F&&F.lastSavedJson&&Ie.loadGraphData(JSON.parse(F.lastSavedJson))}},k=(S,F)=>{if(l.current=S,i(S),e(F),P==null||P.updateCurWorkflowID(S),S==null){document.title="ComfyUI";return}if(Ds()){const K=ni(S);window.location.hash=K,document.title=F+" - ComfyUI"}else localStorage.setItem("curFlowID",S),document.title="ComfyUI - "+F},O=async()=>{C(),localStorage.removeItem("workspace"),localStorage.removeItem("comfyspace");try{await Dd(),R(W==null?void 0:W.getSetting("topBarStyle"),!1)}catch(F){console.error("error loading db",F)}s(!1);let S=null;if(S=Ds(),S==null&&(S=localStorage.getItem("curFlowID")),S&&E(S),localStorage.getItem("REWRITTEN_ALL_LOCAL_DISK_FILE")==="true"?await ti():(await Od(),localStorage.setItem("REWRITTEN_ALL_LOCAL_DISK_FILE","true")),(W==null?void 0:W.getSetting("twoWaySync"))===!0){const F=W==null?void 0:W.getSetting("myWorkflowsDir"),K=await(P==null?void 0:P.listAll()),z=K&&K.map(V=>V.id)||[],{fileList:q,folderList:U}=await gu(F,z);await Cd(q,U)}},C=()=>{tf.forEach(S=>{Yo.addEventListener(S,()=>null)})},b=async()=>{if(l.current!=null){const S=await(P==null?void 0:P.get(l.current));return!!S&&I(S)}return!1},I=S=>{if(S.lastSavedJson==null)return!0;const F=Ie.graph.serialize()??{};let K={};try{K=S!=null&&S.lastSavedJson?JSON.parse(S==null?void 0:S.lastSavedJson):{}}catch(q){console.error("error parsing json",q)}return!(JSON.stringify(F)===JSON.stringify(K))},E=async S=>{if(Ie.graph==null){console.error("app.graph is null cannot load workflow");return}const F=await(P==null?void 0:P.get(S));if(F==null){alert("Error: Workflow not found! id: "+S);return}k(S,F.name),Ie.ui.dialog.close(),Ie.loadGraphData(JSON.parse(F.json)),r("root")},j=S=>{if(S===null){k(null,""),Ie.graph.clear();return}if(((W==null?void 0:W.getSetting("autoSave"))??!0)||!d){E(S);return}v(`Do you want to save the changes you made to, ${t}?`,[{label:"Open in new tab",icon:x.jsx(Ld,{}),onClick:()=>{Ed(S)}},{label:"Save",colorScheme:"teal",onClick:()=>{m(),E(S)}},{label:"Discard",colorScheme:"red",onClick:()=>{E(S)}}])},N=async S=>{const F=(S==null?void 0:S.json)??JSON.stringify(oo),K=await(P==null?void 0:P.createFlow({json:F,name:S==null?void 0:S.name}));K&&j(K.id),r("root")},L=async(S,F=!1)=>{const K=S.split("/").pop()??S;F?m():N({name:K});const z=await fetch(kd(S)),q=await z.blob(),U=new File([q],K,{type:z.headers.get("Content-Type")||""});await Ie.handleFile(U),r("root")},T=async(S,F)=>{const K=await(P==null?void 0:P.get(S));if(K==null)return;const z=await(P==null?void 0:P.createFlow({json:K.json,lastSavedJson:K.lastSavedJson,name:F||K.name,parentFolderID:K.parentFolderID,tags:K.tags}));z&&j(z.id)},R=w.useCallback((S,F=!1)=>{const{top:K=0,left:z=0}=u||{};let{top:q=0,left:U=0}=S??{};q+=K,U+=z;const V=document.documentElement.clientWidth,H=document.documentElement.clientHeight,ce=document.getElementById("workspaceManagerPanel"),ve=(ce==null?void 0:ce.offsetWidth)||392;q+36>H&&(q=H-36),U+ve>=V&&(U=V-ve),c({top:Math.max(0,q),left:Math.max(0,U)}),F&&(W==null||W.upsert({topBarStyle:{top:q,left:U}}))},[u]),Z=S=>{xd(S)&&m()},$=w.useCallback(S=>{if(l.current==null)return;let F=S.filename;S.subfolder!=null&&S.subfolder!==""&&(F=S.subfolder+"/"+F),dt==null||dt.create({workflowID:l.current,localPath:F})},[]),D=w.useCallback(()=>{r("root")},[]);return w.useEffect(()=>{O(),g(!0),y.current=setInterval(async()=>{const z=(W==null?void 0:W.getSetting("autoSave"))??!0;if(l.current!=null&&z){const q=JSON.stringify(Ie.graph.serialize());q!=null&&await(P==null?void 0:P.updateFlow(l.current,{json:q}))}b().then(q=>{f(q)})},1e3),window.addEventListener("keydown",Z);const S=document.getElementById("comfy-file-input"),F=async()=>{if(S&&S.files&&S.files.length>0){const z=await(P==null?void 0:P.createFlow({name:S.files[0].name,json:JSON.stringify(oo)}));z&&k(z.id,z.name??"Unknown name")}};S==null||S.addEventListener("change",F);const K=async z=>{const q=(W==null?void 0:W.getSetting("autoSave"))??!0,U=!!(P!=null&&P.curWorkflow)&&I(P==null?void 0:P.curWorkflow);!q&&U&&(z.preventDefault(),z.returnValue="You have unsaved changes!"),v("Please save or discard your changes before leaving, or your changes will be lost.",[{label:"Save",colorScheme:"teal",onClick:()=>{m()}},{label:"Discard",colorScheme:"red",onClick:()=>{_()}}])};return window.addEventListener("beforeunload",K),Yo.addEventListener("executed",z=>{var q,U,V,H,ce,ve;(V=(U=(q=z.detail)==null?void 0:q.output)==null?void 0:U.images)==null||V.forEach(ae=>{ae.type==="output"&&$(ae)}),(ve=(ce=(H=z.detail)==null?void 0:H.output)==null?void 0:ce.gifs)==null||ve.forEach(ae=>{ae.type==="output"&&$(ae)})}),()=>{window.removeEventListener("keydown",Z),window.removeEventListener("change",F),window.removeEventListener("beforeunload",K),clearInterval(y.current)}},[]),o||!u?null:x.jsx(yn.Provider,{value:{curFlowID:a,onDuplicateWorkflow:T,loadWorkflowID:j,discardUnsavedChanges:_,saveCurWorkflow:m,isDirty:d,loadNewWorkflow:N,loadFilePath:L,setRoute:r},children:x.jsx("div",{ref:h,className:"workspace_manager",children:x.jsx(uo,{containerRef:h,children:x.jsxs(go,{style:{width:"100vh",position:"absolute",top:0,left:0,lineHeight:"24px"},zIndex:1e3,draggable:!1,children:[x.jsx(Xd,{curFlowName:t,setCurFlowName:e,updatePanelPosition:R,positionStyle:u}),p&&x.jsx(w.Suspense,{children:x.jsx(ef,{})}),p&&n==="recentFlows"&&x.jsx(w.Suspense,{children:x.jsx(Zd,{onClose:D,onClickNewFlow:()=>{N(),r("root")}})}),n==="gallery"&&x.jsx(Qd,{onclose:()=>r("root")})]})})})})}const Cf=Object.freeze(Object.defineProperty({__proto__:null,default:nf},Symbol.toStringTag,{value:"Module"}));export{Td as $,Yi as A,go as B,P as C,qd as D,_f as E,Zs as F,xf as G,xt as H,Xt as I,gd as J,Ed as K,Ld as L,ma as M,Bd as N,Vd as O,po as P,vo as Q,kf as R,ru as S,$n as T,mo as U,G as V,yn as W,yf as X,oo as Y,vf as Z,Ln as _,lf as a,mf as a0,rt as a1,Wi as a2,Kd as a3,ff as a4,wd as a5,wf as a6,bf as a7,gf as a8,Gs as a9,dt as aa,Gi as ab,cl as ac,Ii as ad,J as ae,pf as af,il as ag,hf as ah,Ki as ai,Cf as aj,ll as b,hn as c,df as d,uf as e,ca as f,la as g,$c as h,gl as i,cf as j,de as k,Uc as l,Ee as m,yo as n,ar as o,W as p,Js as q,_t as r,yu as s,Kn as t,Ut as u,ti as v,ha as w,ya as x,va as y,wt as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/RecentFilesDrawer-xINb5DPL.js","workspace_web/input.js","workspace_web/IconTrash-wJH79cV-.js","workspace_web/chunk-JARCRF6W-po8hqWTL.js","workspace_web/chunk-6RSEZNRH-3Efv3ksN.js","workspace_web/chunk-NTCQBYKE-qX6uHBx-.js","workspace_web/GalleryModal-4oMlixZ7.js","workspace_web/ModelManagerTopbar-Clt4PNkc.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}