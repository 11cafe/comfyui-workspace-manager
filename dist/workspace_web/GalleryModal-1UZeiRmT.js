import{r as u,d as be,y as Ot,m as we,b as ut,f as A,l as dt,o as Ae,E as Gt,j as r,g as _,h as ht,p as Ut,W as Ht,i as Kt,M as Wt,N as Yt,O as Xt,Q as Zt,R as qt,S as Jt}from"./input.js";import{aj as Qt,a0 as en,h as Fe,F as v,ak as tn,al as nn,I as z,o as sn,k as Ee,B as ft,l as V,a7 as $e,am as rn,C as ne,H as Y,n as W,A as mt,ac as pt,a9 as L,i as an,an as on,G as ln}from"./App-PTPvqEC2.js";import{c as je,p as cn,r as rt,v as at,I as un,N as dn,a as hn,b as fn,d as mn,e as pn,M as xt,u as xn,S as gn}from"./MediaPreview-hJrqqsEr.js";import{S as vn}from"./chunk-3RSXBRAN-VrmlCuqY.js";import{u as yn,C as Ve,G as Sn}from"./chunk-JARCRF6W-4kW2563U.js";import{app as ot}from"/scripts/app.js";import{L as Ne}from"./chunk-K7XRJ7NL-Vyo84f0U.js";import"/scripts/api.js";import"./IconSearch-11tIHWXO.js";import"./index-pz0vT7Or.js";const gt=1/60*1e3,bn=typeof performance<"u"?()=>performance.now():()=>Date.now(),vt=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(bn()),gt);function wn(e){let t=[],s=[],n=0,a=!1,o=!1;const l=new WeakSet,i={schedule:(c,h=!1,m=!1)=>{const f=m&&a,g=f?t:s;return h&&l.add(c),g.indexOf(c)===-1&&(g.push(c),f&&a&&(n=t.length)),c},cancel:c=>{const h=s.indexOf(c);h!==-1&&s.splice(h,1),l.delete(c)},process:c=>{if(a){o=!0;return}if(a=!0,[t,s]=[s,t],s.length=0,n=t.length,n)for(let h=0;h<n;h++){const m=t[h];m(c),l.has(m)&&(i.schedule(m),e())}a=!1,o&&(o=!1,i.process(c))}};return i}const jn=40;let _e=!0,X=!1,Me=!1;const B={delta:0,timestamp:0},Z=["read","update","preRender","render","postRender"],le=Z.reduce((e,t)=>(e[t]=wn(()=>X=!0),e),{}),kn=Z.reduce((e,t)=>{const s=le[t];return e[t]=(n,a=!1,o=!1)=>(X||In(),s.schedule(n,a,o)),e},{}),Pn=Z.reduce((e,t)=>(e[t]=le[t].cancel,e),{});Z.reduce((e,t)=>(e[t]=()=>le[t].process(B),e),{});const Cn=e=>le[e].process(B),yt=e=>{X=!1,B.delta=_e?gt:Math.max(Math.min(e-B.timestamp,jn),1),B.timestamp=e,Me=!0,Z.forEach(Cn),Me=!1,X&&(_e=!1,vt(yt))},In=()=>{X=!0,_e=!0,Me||vt(yt)},lt=()=>B;var $=e=>e?"":void 0,ke=e=>e?!0:void 0,q=(...e)=>e.filter(Boolean).join(" ");function Pe(...e){return function(s){e.some(n=>(n==null||n(s),s==null?void 0:s.defaultPrevented))}}function ee(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}var se={width:0,height:0},te=e=>e||se;function Tn(e){const{orientation:t,thumbPercents:s,thumbRects:n,isReversed:a}=e,o=y=>{var S;const E=(S=n[y])!=null?S:se;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...ee({orientation:t,vertical:{bottom:`calc(${s[y]}% - ${E.height/2}px)`},horizontal:{left:`calc(${s[y]}% - ${E.width/2}px)`}})}},l=t==="vertical"?n.reduce((y,S)=>te(y).height>te(S).height?y:S,se):n.reduce((y,S)=>te(y).width>te(S).width?y:S,se),i={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...ee({orientation:t,vertical:l?{paddingLeft:l.width/2,paddingRight:l.width/2}:{},horizontal:l?{paddingTop:l.height/2,paddingBottom:l.height/2}:{}})},c={position:"absolute",...ee({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},h=s.length===1,m=[0,a?100-s[0]:s[0]],f=h?m:s;let g=f[0];!h&&a&&(g=100-g);const x=Math.abs(f[f.length-1]-f[0]),j={...c,...ee({orientation:t,vertical:a?{height:`${x}%`,top:`${g}%`}:{height:`${x}%`,bottom:`${g}%`},horizontal:a?{width:`${x}%`,right:`${g}%`}:{width:`${x}%`,left:`${g}%`}})};return{trackStyle:c,innerTrackStyle:j,rootStyle:i,getThumbStyle:o}}function En(e){const{isReversed:t,direction:s,orientation:n}=e;return s==="ltr"||n==="vertical"?t:!t}function Nn(e,t,s,n){return e.addEventListener(t,s,n),()=>{e.removeEventListener(t,s,n)}}function _n(e){const t=Dn(e);return typeof t.PointerEvent<"u"&&e instanceof t.PointerEvent?e.pointerType==="mouse":e instanceof t.MouseEvent}function St(e){return!!e.touches}function Mn(e){return St(e)&&e.touches.length>1}function Dn(e){var t;return(t=e.view)!=null?t:window}function Rn(e,t="page"){const s=e.touches[0]||e.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function zn(e,t="page"){return{x:e[`${t}X`],y:e[`${t}Y`]}}function bt(e,t="page"){return St(e)?Rn(e,t):zn(e,t)}function An(e){return t=>{const s=_n(t);(!s||s&&t.button===0)&&e(t)}}function Fn(e,t=!1){function s(a){e(a,{point:bt(a)})}return t?An(s):s}function re(e,t,s,n){return Nn(e,t,Fn(s,t==="pointerdown"),n)}var $n=Object.defineProperty,Vn=(e,t,s)=>t in e?$n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t,s)=>(Vn(e,typeof t!="symbol"?t+"":t,s),s),Bn=class{constructor(e,t,s){N(this,"history",[]),N(this,"startEvent",null),N(this,"lastEvent",null),N(this,"lastEventInfo",null),N(this,"handlers",{}),N(this,"removeListeners",()=>{}),N(this,"threshold",3),N(this,"win"),N(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const i=Ce(this.lastEventInfo,this.history),c=this.startEvent!==null,h=Un(i.offset,{x:0,y:0})>=this.threshold;if(!c&&!h)return;const{timestamp:m}=lt();this.history.push({...i.point,timestamp:m});const{onStart:f,onMove:g}=this.handlers;c||(f==null||f(this.lastEvent,i),this.startEvent=this.lastEvent),g==null||g(this.lastEvent,i)}),N(this,"onPointerMove",(i,c)=>{this.lastEvent=i,this.lastEventInfo=c,kn.update(this.updatePoint,!0)}),N(this,"onPointerUp",(i,c)=>{const h=Ce(c,this.history),{onEnd:m,onSessionEnd:f}=this.handlers;f==null||f(i,h),this.end(),!(!m||!this.startEvent)&&(m==null||m(i,h))});var n;if(this.win=(n=e.view)!=null?n:window,Mn(e))return;this.handlers=t,s&&(this.threshold=s),e.stopPropagation(),e.preventDefault();const a={point:bt(e)},{timestamp:o}=lt();this.history=[{...a.point,timestamp:o}];const{onSessionStart:l}=t;l==null||l(e,Ce(a,this.history)),this.removeListeners=Gn(re(this.win,"pointermove",this.onPointerMove),re(this.win,"pointerup",this.onPointerUp),re(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Pn.update(this.updatePoint)}};function it(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ce(e,t){return{point:e.point,delta:it(e.point,t[t.length-1]),offset:it(e.point,t[0]),velocity:On(t,.1)}}var Ln=e=>e*1e3;function On(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,n=null;const a=e[e.length-1];for(;s>=0&&(n=e[s],!(a.timestamp-n.timestamp>Ln(t)));)s--;if(!n)return{x:0,y:0};const o=(a.timestamp-n.timestamp)/1e3;if(o===0)return{x:0,y:0};const l={x:(a.x-n.x)/o,y:(a.y-n.y)/o};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}function Gn(...e){return t=>e.reduce((s,n)=>n(s),t)}function Ie(e,t){return Math.abs(e-t)}function ct(e){return"x"in e&&"y"in e}function Un(e,t){if(typeof e=="number"&&typeof t=="number")return Ie(e,t);if(ct(e)&&ct(t)){const s=Ie(e.x,t.x),n=Ie(e.y,t.y);return Math.sqrt(s**2+n**2)}return 0}function wt(e){const t=u.useRef(null);return t.current=e,t}function Hn(e,t){const{onPan:s,onPanStart:n,onPanEnd:a,onPanSessionStart:o,onPanSessionEnd:l,threshold:i}=t,c=!!(s||n||a||o||l),h=u.useRef(null),m=wt({onSessionStart:o,onSessionEnd:l,onStart:n,onMove:s,onEnd(f,g){h.current=null,a==null||a(f,g)}});u.useEffect(()=>{var f;(f=h.current)==null||f.updateHandlers(m.current)}),u.useEffect(()=>{const f=e.current;if(!f||!c)return;function g(x){h.current=new Bn(x,m.current,i)}return re(f,"pointerdown",g)},[e,c,m,i]),u.useEffect(()=>()=>{var f;(f=h.current)==null||f.end(),h.current=null},[])}function Kn(e,t){if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const s=e.ownerDocument.defaultView??window,n=new s.ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const[o]=a;let l,i;if("borderBoxSize"in o){const c=o.borderBoxSize,h=Array.isArray(c)?c[0]:c;l=h.inlineSize,i=h.blockSize}else l=e.offsetWidth,i=e.offsetHeight;t({width:l,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}var Wn=globalThis!=null&&globalThis.document?u.useLayoutEffect:u.useEffect;function Yn(e,t){var s,n;if(!e||!e.parentElement)return;const a=(n=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?n:window,o=new a.MutationObserver(()=>{t()});return o.observe(e.parentElement,{childList:!0}),()=>{o.disconnect()}}function Xn({getNodes:e,observeMutation:t=!0}){const[s,n]=u.useState([]),[a,o]=u.useState(0);return Wn(()=>{const l=e(),i=l.map((c,h)=>Kn(c,m=>{n(f=>[...f.slice(0,h),m,...f.slice(h+1)])}));if(t){const c=l[0];i.push(Yn(c,()=>{o(h=>h+1)}))}return()=>{i.forEach(c=>{c==null||c()})}},[a]),s}function Zn(e){return typeof e=="object"&&e!==null&&"current"in e}function qn(e){const[t]=Xn({observeMutation:!1,getNodes(){return[Zn(e)?e.current:e]}});return t}function Jn(e){var t;const{min:s=0,max:n=100,onChange:a,value:o,defaultValue:l,isReversed:i,direction:c="ltr",orientation:h="horizontal",id:m,isDisabled:f,isReadOnly:g,onChangeStart:x,onChangeEnd:j,step:y=1,getAriaValueText:S,"aria-valuetext":E,"aria-label":F,"aria-labelledby":J,name:O,focusThumbOnChange:k=!0,...P}=e,Le=be(x),G=be(j),Oe=be(S),T=En({isReversed:i,direction:c,orientation:h}),[Et,de]=Qt({value:o,defaultValue:l??es(s,n),onChange:a}),[he,Ge]=u.useState(!1),[fe,Ue]=u.useState(!1),me=!(f||g),pe=(n-s)/10,U=y||(n-s)/100,b=je(Et,s,n),Nt=n-b+s,He=at(T?Nt:b,s,n),Q=h==="vertical",w=wt({min:s,max:n,step:y,isDisabled:f,value:b,isInteractive:me,isReversed:T,isVertical:Q,eventSource:null,focusThumbOnChange:k,orientation:h}),xe=u.useRef(null),ge=u.useRef(null),Ke=u.useRef(null),_t=u.useId(),We=m??_t,[Ye,Xe]=[`slider-thumb-${We}`,`slider-track-${We}`],Mt=u.useCallback(d=>{var p,H;if(!xe.current)return;const C=w.current;C.eventSource="pointer";const M=xe.current.getBoundingClientRect(),{clientX:ye,clientY:Vt}=(H=(p=d.touches)==null?void 0:p[0])!=null?H:d,Bt=Q?M.bottom-Vt:ye-M.left,Lt=Q?M.height:M.width;let Se=Bt/Lt;T&&(Se=1-Se);let K=cn(Se,C.min,C.max);return C.step&&(K=parseFloat(rt(K,C.min,C.step))),K=je(K,C.min,C.max),K},[Q,T,w]),D=u.useCallback(d=>{const p=w.current;p.isInteractive&&(d=parseFloat(rt(d,p.min,U)),d=je(d,p.min,p.max),de(d))},[U,de,w]),R=u.useMemo(()=>({stepUp(d=U){const p=T?b-d:b+d;D(p)},stepDown(d=U){const p=T?b+d:b-d;D(p)},reset(){D(l||0)},stepTo(d){D(d)}}),[D,T,b,U,l]),Ze=u.useCallback(d=>{const p=w.current,C={ArrowRight:()=>R.stepUp(),ArrowUp:()=>R.stepUp(),ArrowLeft:()=>R.stepDown(),ArrowDown:()=>R.stepDown(),PageUp:()=>R.stepUp(pe),PageDown:()=>R.stepDown(pe),Home:()=>D(p.min),End:()=>D(p.max)}[d.key];C&&(d.preventDefault(),d.stopPropagation(),C(d),p.eventSource="keyboard")},[R,D,pe,w]),qe=(t=Oe==null?void 0:Oe(b))!=null?t:E,ve=qn(ge),{getThumbStyle:Je,rootStyle:Qe,trackStyle:et,innerTrackStyle:tt}=u.useMemo(()=>{const d=w.current,p=ve??{width:0,height:0};return Tn({isReversed:T,orientation:d.orientation,thumbRects:[p],thumbPercents:[He]})},[T,ve,He,w]),nt=u.useCallback(()=>{w.current.focusThumbOnChange&&setTimeout(()=>{var p;return(p=ge.current)==null?void 0:p.focus()})},[w]);Ot(()=>{const d=w.current;nt(),d.eventSource==="keyboard"&&(G==null||G(d.value))},[b,G]);function st(d){const p=Mt(d);p!=null&&p!==w.current.value&&de(p)}Hn(Ke,{onPanSessionStart(d){const p=w.current;p.isInteractive&&(Ge(!0),nt(),st(d),Le==null||Le(p.value))},onPanSessionEnd(){const d=w.current;d.isInteractive&&(Ge(!1),G==null||G(d.value))},onPan(d){w.current.isInteractive&&st(d)}});const Dt=u.useCallback((d={},p=null)=>({...d,...P,ref:we(p,Ke),tabIndex:-1,"aria-disabled":ke(f),"data-focused":$(fe),style:{...d.style,...Qe}}),[P,f,fe,Qe]),Rt=u.useCallback((d={},p=null)=>({...d,ref:we(p,xe),id:Xe,"data-disabled":$(f),style:{...d.style,...et}}),[f,Xe,et]),zt=u.useCallback((d={},p=null)=>({...d,ref:p,style:{...d.style,...tt}}),[tt]),At=u.useCallback((d={},p=null)=>({...d,ref:we(p,ge),role:"slider",tabIndex:me?0:void 0,id:Ye,"data-active":$(he),"aria-valuetext":qe,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":b,"aria-orientation":h,"aria-disabled":ke(f),"aria-readonly":ke(g),"aria-label":F,"aria-labelledby":F?void 0:J,style:{...d.style,...Je(0)},onKeyDown:Pe(d.onKeyDown,Ze),onFocus:Pe(d.onFocus,()=>Ue(!0)),onBlur:Pe(d.onBlur,()=>Ue(!1))}),[me,Ye,he,qe,s,n,b,h,f,g,F,J,Je,Ze]),Ft=u.useCallback((d,p=null)=>{const H=!(d.value<s||d.value>n),C=b>=d.value,M=at(d.value,s,n),ye={position:"absolute",pointerEvents:"none",...Qn({orientation:h,vertical:{bottom:T?`${100-M}%`:`${M}%`},horizontal:{left:T?`${100-M}%`:`${M}%`}})};return{...d,ref:p,role:"presentation","aria-hidden":!0,"data-disabled":$(f),"data-invalid":$(!H),"data-highlighted":$(C),style:{...d.style,...ye}}},[f,T,n,s,h,b]),$t=u.useCallback((d={},p=null)=>({...d,ref:p,type:"hidden",value:b,name:O}),[O,b]);return{state:{value:b,isFocused:fe,isDragging:he},actions:R,getRootProps:Dt,getTrackProps:Rt,getInnerTrackProps:zt,getThumbProps:At,getMarkerProps:Ft,getInputProps:$t}}function Qn(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}function es(e,t){return t<e?e:e+(t-e)/2}var[ts,ie]=ut({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[ns,ce]=ut({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),jt=A((e,t)=>{var s;const n={...e,orientation:(s=e==null?void 0:e.orientation)!=null?s:"horizontal"},a=dt("Slider",n),o=Ae(n),{direction:l}=Gt();o.direction=l;const{getInputProps:i,getRootProps:c,...h}=Jn(o),m=c(),f=i({},t);return r.jsx(ts,{value:h,children:r.jsx(ns,{value:a,children:r.jsxs(_.div,{...m,className:q("chakra-slider",n.className),__css:a.container,children:[n.children,r.jsx("input",{...f})]})})})});jt.displayName="Slider";var kt=A((e,t)=>{const{getThumbProps:s}=ie(),n=ce(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__thumb",e.className),__css:n.thumb})});kt.displayName="SliderThumb";var Pt=A((e,t)=>{const{getTrackProps:s}=ie(),n=ce(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__track",e.className),__css:n.track})});Pt.displayName="SliderTrack";var Ct=A((e,t)=>{const{getInnerTrackProps:s}=ie(),n=ce(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__filled-track",e.className),__css:n.filledTrack})});Ct.displayName="SliderFilledTrack";var ss=A((e,t)=>{const{getMarkerProps:s}=ie(),n=ce(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__marker",e.className),__css:n.mark})});ss.displayName="SliderMark";var De=A(function(t,s){const n=dt("Switch",t),{spacing:a="0.5rem",children:o,...l}=Ae(t),{getIndicatorProps:i,getInputProps:c,getCheckboxProps:h,getRootProps:m,getLabelProps:f}=yn(l),g=u.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...n.container}),[n.container]),x=u.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...n.track}),[n.track]),j=u.useMemo(()=>({userSelect:"none",marginStart:a,...n.label}),[a,n.label]);return r.jsxs(_.label,{...m(),className:ht("chakra-switch",t.className),__css:g,children:[r.jsx("input",{className:"chakra-switch__input",...c({},s)}),r.jsx(_.span,{...h(),className:"chakra-switch__track",__css:x,children:r.jsx(_.span,{__css:n.thumb,className:"chakra-switch__thumb",...i()})}),o&&r.jsx(_.span,{className:"chakra-switch__label",...f(),__css:j,children:o})]})});De.displayName="Switch";function rs(e,t=[]){const s=Object.assign({},e);for(const n of t)n in s&&delete s[n];return s}var as=["h","minH","height","minHeight"],It=A((e,t)=>{const s=Ut("Textarea",e),{className:n,rows:a,...o}=Ae(e),l=en(o),i=a?rs(s,as):s;return r.jsx(_.textarea,{ref:t,rows:a,...l,className:ht("chakra-textarea",n),__css:i})});It.displayName="Textarea";var os=Fe("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),ls=Fe("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),is=Fe("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);const cs=({setMediaAct:e,media:t,currentNum:s})=>{const n=l=>{const i=(s+l+t.length)%t.length;e&&e(t[i])},a={width:"100%",height:"100%"};if(t.length===0)return r.jsx("p",{children:"No images found, let's start generating 🪄"});const o=t.at(s);return o?r.jsxs(v,{justifyContent:"center",alignItems:"center",position:"relative",width:a.width,height:a.height,overflow:"hidden",children:[r.jsx("div",{style:{position:"absolute",cursor:"pointer",width:"100%",height:"100%"},onClick:()=>{window.open(o.imageUrl)},children:tn(o.imageUrl)?r.jsx(nn,{src:o.imageUrl,alt:`image-${o.id}`,width:"100%",height:"100%",objectFit:"contain"}):r.jsx("video",{style:{objectFit:"contain"},width:"100%",height:"100%",src:o.imageUrl,loop:!0,autoPlay:!0,muted:!0,children:r.jsx("track",{kind:"captions"})})},o.id),r.jsx(z,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Previous image",icon:r.jsx(os,{}),onClick:()=>n(-1),position:"absolute",left:"0",zIndex:"2"}),r.jsx(z,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Next image",icon:r.jsx(un,{}),onClick:()=>n(1),position:"absolute",right:"0",zIndex:"2"})]}):null},us=({inputItem:e})=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.label??e.inputName}),r.jsx(sn,{value:e.inputValue,onChange:t=>{}})]}),ds=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsxs(dn,{width:"100%",step:e==null?void 0:e.step,value:t.inputValue,min:e==null?void 0:e.min,max:e==null?void 0:e.max,onChange:s=>{},children:[r.jsx(hn,{}),r.jsxs(fn,{children:[r.jsx(mn,{}),r.jsx(pn,{})]})]})]}),r.jsx(v,{children:r.jsxs(jt,{maxWidth:"400px",step:e==null?void 0:e.step,value:Number(t.inputValue),min:(e==null?void 0:e.min)??0,max:(e==null?void 0:e.max)??100,onChange:s=>{},children:[r.jsx(Pt,{children:r.jsx(Ct,{})}),r.jsx(kt,{})]})})]})},hs=e=>{var s;const{inputItem:t}=e;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx(vn,{value:t.inputValue,onChange:n=>{},children:(s=e==null?void 0:e.options)==null?void 0:s.map((n,a)=>r.jsx("option",{value:n,children:n},`select${t.nodeID}${t.inputName}${a}`))})]})},fs=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsx(v,{children:t.label??t.inputName}),r.jsx(It,{value:t.inputValue,onChange:s=>{},rows:5})]})};var I=(e=>(e.Input="Input",e.InputSlider="InputSlider",e.Select="Select",e.Textarea="Textarea",e.Checkbox="Checkbox",e.NoSupport="NoSupport",e))(I||{});const ms=e=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.inputItem.label??e.inputItem.inputName}),r.jsx(v,{children:"No Support"})]}),ps=e=>{const t=e.inputItem;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx(Ve,{defaultChecked:!!t.inputValue,onChange:s=>{var n;(n=e==null?void 0:e.updateMetaData)==null||n.call(e,{promptKey:e.promptKey,name:e.name,value:s.target.checked})}})]})},ue=u.createContext({topFields:[],calcInputList:[],showNodeName:!1,updateTopField(){}}),xs={[I.Input]:us,[I.InputSlider]:ds,[I.Select]:hs,[I.Textarea]:fs,[I.Checkbox]:ps,NoSupport:ms},gs=LiteGraph.registered_node_types;function vs(e,t){var a,o,l,i,c;const s=(a=gs[e])==null?void 0:a.nodeData,n={...((o=s==null?void 0:s.input)==null?void 0:o.required)??{},...((l=s==null?void 0:s.input)==null?void 0:l.optional)??{}}[t];return(n==null?void 0:n[0])==="STRING"?(i=n==null?void 0:n[1])!=null&&i.multiline?{type:I.Textarea}:{type:I.Input}:(n==null?void 0:n[0])==="BOOLEAN"?{type:I.Checkbox}:(n==null?void 0:n[0])==="FLOAT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:(n==null?void 0:n[0])==="INT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:Array.isArray(n==null?void 0:n[0])&&((c=n==null?void 0:n[0])!=null&&c.every(h=>typeof h=="string"))?{options:n==null?void 0:n[0],type:I.Select}:{type:I.NoSupport}}const Re=({inputItem:e})=>{const t=vs(e.classType,e.inputName),[s,n]=u.useState(!1),a=xs[t.type??"Input"],{updateTopField:o,topFields:l}=u.useContext(ue),i=e.children[0]==="negative"||e.children[0]==="positive"?`-${e.children[0]}`:"",c={...e,label:e.label??e.inputName+i};return r.jsxs(v,{alignItems:"center",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[r.jsx(z,{size:"xs",onClick:()=>o==null?void 0:o({name:e.inputName,promptKey:e.nodeID,class_type:e.classType}),variant:"ghost",icon:oe(l,{name:e.inputName,promptKey:e.nodeID,classType:e.classType})?r.jsx(ls,{size:14}):r.jsx(is,{size:14}),"aria-label":"pin"}),r.jsx("div",{style:{flex:1},children:r.jsx(a,{inputItem:c,...t})})]})};function ys(){const{topFields:e,updateTopField:t,calcInputList:s}=u.useContext(ue);return e.length===0?null:r.jsx(r.Fragment,{children:r.jsx(v,{px:2,gap:2,direction:"column",children:e==null?void 0:e.map(n=>{const a=s.find(o=>o.nodeID==n.promptKey&&o.inputName===n.name&&o.classType===n.class_type);return!n.class_type||!a?null:r.jsx(Re,{inputItem:a},`formTopField${n.promptKey}${n.name}`)})})})}function Ss(){const{topFields:e,calcInputList:t,showNodeName:s}=u.useContext(ue),n=u.useCallback(o=>{const l=[];return o.forEach(i=>{const c=l[l.length-1];!c||c[0].nodeID!==i.nodeID||c[0].classType!==i.classType?l.push([i]):c.push(i)}),l},[]);if(u.useEffect(()=>{},[s]),!s)return r.jsx(Ee,{children:t.map(o=>oe(e,{name:o.inputName,promptKey:o.nodeID,classType:o.classType})?null:r.jsx(Re,{inputItem:o},`form${o.nodeID}${o.inputName}`))});const a=n(t);return r.jsx(Ee,{children:a.map(o=>o[0]?r.jsx(bs,{title:o[0].classType+" #"+o[0].nodeID,children:r.jsx(v,{px:2,gap:1,direction:"column",children:o.map(l=>oe(e,{name:l.inputName,promptKey:l.nodeID,classType:l.classType})?null:r.jsx(Re,{inputItem:l},`form${l.nodeID}${l.inputName}`))})},o[0].nodeID):null)})}function bs({title:e,children:t}){return r.jsxs(ft,{border:"1px",borderColor:"gray.500",borderRadius:"md",p:4,children:[r.jsx(V,{size:"sm",mb:1,color:"GrayText",children:e}),r.jsx("div",{children:t})]})}let ae=[],ze=new Set;function Tt(e,t){if(!ze.has(e.nodeID))return ze.add(e.nodeID),Object.entries(e.inputs).forEach(([s,n])=>{if(Array.isArray(n)){const a=n[0];Tt(t[a],t)}}),Object.entries(e.inputs).forEach(([s,n])=>{Array.isArray(n)||ae.push({classType:e.class_type,inputName:s,inputValue:n,nodeID:e.nodeID,children:e.children||[]})}),ae}function ws(e){ae=[],ze=new Set;for(const t of Object.keys(e))e[t].nodeID=t,Object.entries(e[t].inputs).forEach(([s,n])=>{if(Array.isArray(n)){const a=n[0],o=e[a];o.children||(o.children=[]),o.children.push(s)}});for(const t of Object.keys(e))Tt(e[t],e);return ae}const oe=(e,t)=>e==null?void 0:e.some(s=>s.promptKey===(t==null?void 0:t.promptKey)&&s.name===(t==null?void 0:t.name)&&s.class_type===t.classType);function js({media:e}){const[t,s]=u.useState([]),{curFlowID:n}=u.useContext($e),[a,o]=u.useState(),[l,i]=u.useState(!0),[c,h]=u.useState(!0);u.useEffect(()=>{e?rn(`/workspace/view_media?filename=${e.localPath}`).then(x=>{o(x.prompt)}):ot.graphToPrompt(ot.graph).then(x=>{o(x.output)})},[e]),u.useEffect(()=>{if(!a)return;const x=ws(a);s(x)},[a]);const[m,f]=u.useState([]);u.useEffect(()=>{(async()=>{var x,j;if(n){const y=(j=await((x=ne)==null?void 0:x.get(n)))==null?void 0:j.topFieldsConfig;y&&(f(y),i(!1))}})()},[n]);const g=x=>{var j,y;if(oe(m,{name:x.name,promptKey:x==null?void 0:x.promptKey,classType:(x==null?void 0:x.class_type)??""})){const S=m.filter(E=>E.name!==x.name||E.promptKey!==x.promptKey);f(S),n&&((j=ne)==null||j.updateTopFields(n,{topFieldsConfig:S}))}else{const S=[...m,x];f(S),n&&((y=ne)==null||y.updateTopFields(n,{topFieldsConfig:S}))}};return r.jsx(ue.Provider,{value:{topFields:m,showNodeName:c,calcInputList:t,updateTopField:g},children:r.jsxs(v,{direction:"column",align:"stretch",gap:5,children:[r.jsx(ys,{}),r.jsxs(Y,{children:[r.jsx("p",{children:"Show all inputs"}),r.jsx(De,{isChecked:l,onChange:x=>i(!l)}),r.jsx("p",{children:"Show node names"}),r.jsx(De,{isChecked:c,onChange:x=>h(!c)})]}),l&&r.jsx(Ss,{})]})})}const ks=({media:e})=>r.jsxs(v,{overflowY:"auto",mb:4,direction:"column",gap:2,flex:1,children:[r.jsxs(v,{flexWrap:"wrap",gap:3,children:[r.jsx(v,{alignItems:"center",gap:2,children:(e==null?void 0:e.localPath)&&r.jsxs(r.Fragment,{children:[r.jsx(V,{children:e==null?void 0:e.localPath}),r.jsx(W,{label:"Donwload image from gallery",children:r.jsx(Ne,{href:`/workspace/view_media?filename=${e==null?void 0:e.localPath}`,download:e==null?void 0:e.localPath,children:r.jsx(z,{size:"sm",icon:r.jsx(mt,{size:19}),"aria-label":"donwload image from gallery"})})})]})}),r.jsx(v,{gap:1,alignItems:"center",color:"GrayText",children:!!(e!=null&&e.createTime)&&r.jsxs(r.Fragment,{children:[r.jsx(V,{children:"Created:"}),r.jsx(V,{children:pt((e==null?void 0:e.createTime)??0,!0)})]})})]}),r.jsx(js,{media:e??null})]}),Be=u.createContext({showAllImages:!1,curMedia:null,setCurMedia(){},setMediaList(){},setShowAllImages(){}}),Te=120;function Ps({mediaList:e}){const{curMedia:t,setCurMedia:s}=u.useContext(Be);return r.jsxs(v,{gap:3,h:"100%",children:[r.jsxs(Sn,{gridTemplateRows:e.length<=6?"1fr 20%":"1fr",flex:1,gap:2,children:[r.jsx(cs,{media:e.map(n=>({id:n.id,imageUrl:`/workspace/view_media?filename=${n.localPath}`})),currentNum:(e==null?void 0:e.findIndex(n=>n.id===(t==null?void 0:t.id)))??0,setMediaAct:n=>s((e==null?void 0:e.find(a=>a.id===n.id))??null)}),r.jsx(v,{wrap:"wrap",children:e==null?void 0:e.map(n=>r.jsx(ft,{display:"inline-block",p:1,borderRadius:"4px",width:`${Te+3}px`,height:`${Te+3}px`,cursor:"pointer",border:(t==null?void 0:t.id)===n.id?"1px solid gray":"",onClick:()=>s(n),children:r.jsx(xt,{mediaLocalPath:n.localPath,size:Te,objectFit:"contain",hideBrokenImage:!0,onBrokenLink:()=>{var a;(a=L)==null||a.delete(n.id)}})},`image-bottom-${n.id}`))})]}),r.jsx(ks,{media:t??void 0})]})}const Cs=({media:e,isSelecting:t,selectedID:s,onClickMedia:n})=>{const{curFlowID:o,loadFilePath:l}=u.useContext($e),{showDialog:i}=Ht();if(e.localPath==null||o==null)return null;const c=r.jsxs(Ne,{isExternal:!0,onClick:()=>n(e),position:"relative",children:[t&&r.jsx(Ve,{isChecked:s.includes(e.id),position:"absolute",top:2,left:2}),r.jsx(xt,{mediaLocalPath:e.localPath,size:180,onBrokenLink:()=>{var h;(h=L)==null||h.delete(e.id)},hideBrokenImage:!0,autoPlay:!0,isPreview:!0})]});return r.jsxs(Ee,{width:180,mb:2,children:[r.jsx(W,{label:pt(e.createTime,!0),children:c}),r.jsx(W,{label:e.localPath,children:r.jsx(V,{color:"GrayText",noOfLines:1,children:e.localPath})}),r.jsxs(Y,{hidden:t,gap:0,children:[r.jsx(Kt,{flexGrow:1,onClick:()=>i("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{l(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>l(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),r.jsx(W,{label:"Donwload image from gallery",children:r.jsx(Ne,{href:`/workspace/view_media?filename=${e.localPath}`,download:e.localPath,children:r.jsx(z,{size:"sm",variant:"ghost",icon:r.jsx(mt,{size:19}),"aria-label":"donwload image from gallery"})})}),r.jsx(W,{label:"Remove image from gallery",children:r.jsx(z,{size:"sm",variant:"ghost",icon:r.jsx(an,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var m;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&await((m=L)==null?void 0:m.delete(e.id))}})})]})]})},Is=Cs;function Ts({searchQuery:e}){const[t,s]=u.useState([]),{setCurMedia:n,setShowAllImages:a,setMediaList:o}=u.useContext(Be);u.useEffect(()=>{var i,c;e===""?(i=L)==null||i.listAll().then(h=>{s(h.slice(0,50)??[])}):(c=L)==null||c.filter(h=>{var m;return((m=h.workflowJSON)==null?void 0:m.includes(e))??!1}).then(h=>{s(h)})},[e]);const l=i=>{o([i].concat(t.filter(c=>c.id!==i.id))),n(i),a(!1)};return r.jsx(Y,{wrap:"wrap",children:t.map(i=>r.jsx(Is,{selectedID:[],media:i,isSelecting:!1,onClickMedia:l},i.id))})}function Ls({onclose:e}){const{curFlowID:t}=u.useContext($e),[s,n]=u.useState(""),[a,o]=u.useState([]),[l,i]=u.useState(!1),[c,h]=u.useState(""),[m,f]=u.useState([]),[g,x]=u.useState(),[j,y]=u.useState(""),S=xn(j,300),[E,F]=u.useState(!1),J=async()=>{var P;if(t==null)return;const k=await((P=L)==null?void 0:P.listByWorkflowID(t));f(k??[]),k!=null&&k.length&&x(k[0])};if(u.useEffect(()=>{var k;J(),t&&((k=ne)==null||k.get(t).then(P=>{P&&(n(P.name),P!=null&&P.coverMediaPath&&h(P==null?void 0:P.coverMediaPath))}))},[]),t==null)return null;const O=m.length>0&&a.length===m.length;return r.jsx(Be.Provider,{value:{curMedia:g??null,setCurMedia:x,setMediaList:f,showAllImages:E,setShowAllImages:F},children:r.jsxs(Wt,{isOpen:!0,onClose:e,blockScrollOnMount:!0,children:[r.jsx(Yt,{}),r.jsxs(Xt,{width:"90%",maxWidth:"90vw",height:"90vh",children:[r.jsxs(Zt,{children:[r.jsxs(Y,{gap:2,mb:2,children:[r.jsxs(on,{size:"md",mr:2,children:["Gallery - ",s]}),r.jsx(gn,{searchValue:j,onUpdateSearchValue:k=>{y(k),E||F(!0)},placeholder:"Search prompt, model name, etc.",style:{width:"300px"}})]}),l&&r.jsxs(Y,{gap:3,children:[r.jsx(Ve,{isChecked:O,onChange:()=>{o(O?[]:m.map(k=>k.id))},children:"All"}),r.jsxs(V,{fontSize:16,children:[a.length," Selected"]}),r.jsx(z,{size:"sm",icon:r.jsx(ln,{size:19}),onClick:()=>i(!1),"aria-label":"cancel"})]})]}),r.jsx(qt,{}),r.jsx(Jt,{overflowY:"auto",children:E?r.jsx(Ts,{searchQuery:S}):r.jsx(Ps,{mediaList:m})})]})]})})}export{Ls as default};
