import{r as p}from"./input.js";import{app as e}from"/scripts/app.js";import{a6 as k,j as m,ar as y,o as S,E as h,A as o}from"./App-seCzORuQ.js";import"/scripts/api.js";function x(){const{setIsDirty:c,setRoute:w,saveCurWorkflow:g}=p.useContext(k),v=m();p.useEffect(()=>{const r=async t=>{switch(t){case h.SAVE:g();break;case h.SAVE_AS:w("saveAsModal");break}},a=e.graph.onAfterChange;e.graph.onAfterChange=function(){a==null||a.apply(e.canvas,arguments),i()},document.addEventListener("click",t=>{(e.canvas.node_over!=null||e.canvas.node_capturing_input!=null||e.canvas.node_widget!=null)&&i()}),document.addEventListener("keydown",async function(t){var n;if(document.visibilityState==="hidden")return;const s=await y(t);s?r(s):(n=t.target)!=null&&n.matches("input, textarea")&&i()})},[]);const i=async()=>{var a,t,s,n,u,l,f;if((t=(a=o)==null?void 0:a.curWorkflow)!=null&&t.saveLock)return;const r=await((s=S)==null?void 0:s.getSetting("autoSave"));if(!r){c(!0);return}if((u=(n=o)==null?void 0:n.curWorkflow)!=null&&u.id&&r)if(!await((l=o)==null?void 0:l.latestVersionCheck()))v({title:"Your changes cannot be saved!",description:"You are working on an outdated version. This workflow is changed by another tab. Please refresh to get the latest version.",status:"warning",isClosable:!0,duration:null});else{const d=JSON.stringify(e.graph.serialize());d!=null&&await((f=o)==null?void 0:f.updateFlow(o.curWorkflow.id,{json:d})),c(!1)}};return null}export{x as default};
