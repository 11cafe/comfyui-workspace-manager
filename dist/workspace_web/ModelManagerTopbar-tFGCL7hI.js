import{f as I,r as u,j as e,g as M,h as K,a3 as R,b as _e,o as ne,i as oe,k as be,ab as Me,B as w,a8 as H,ac as Ce,L as ae,ad as Ie,O as ie,R as re,S as Te,X as ke,M as Ee,N as Ae,Q as Pe,P as Le,_ as Ne}from"./input.js";import{ae as De,ad as Be,W as Re,af as D,l as P,F as E,T as b,B as le,a5 as ce,j as z,o as Z,w as ze,H as A,k as F,ag as Fe,m as de,ah as ue,X as Oe,Y as We,Z as Ge,_ as Ke,$ as He,ac as he,ai as Ve,a6 as $e,aj as Ue,ak as Ye}from"./App-T2mWw1R4.js";import{I as pe,G as qe,C as Qe}from"./chunk-JARCRF6W-lbPfS4C_.js";import{app as N}from"/scripts/app.js";import{api as B}from"/scripts/api.js";var me=I(function(s,n){const{spacing:o="0.5rem",spacingX:i,spacingY:a,children:r,justify:c,direction:l,align:d,className:p,shouldWrapChildren:g,...h}=s,f=u.useMemo(()=>g?u.Children.map(r,(m,j)=>e.jsx(V,{children:m},j)):r,[r,g]);return e.jsx(M.div,{ref:n,className:K("chakra-wrap",p),...h,children:e.jsx(M.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:c,alignItems:d,flexDirection:l,listStyleType:"none",gap:o,columnGap:i,rowGap:a,padding:"0"},children:f})})});me.displayName="Wrap";var V=I(function(s,n){const{className:o,...i}=s;return e.jsx(M.li,{ref:n,__css:{display:"flex",alignItems:"flex-start"},className:K("chakra-wrap__listitem",o),...i})});V.displayName="WrapItem";function J(t){return Be(t,s=>s==="auto"?"auto":`span ${s}/span ${s}`)}var fe=I(function(s,n){const{area:o,colSpan:i,colStart:a,colEnd:r,rowEnd:c,rowSpan:l,rowStart:d,...p}=s,g=De({gridArea:o,gridColumn:J(i),gridRow:J(l),gridColumnStart:a,gridColumnEnd:r,gridRowStart:d,gridRowEnd:c});return e.jsx(M.div,{ref:n,__css:g,...p})});fe.displayName="GridItem";function Xe(t,s,n){return(t-s)*100/(n-s)}R({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});R({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var Ze=R({"0%":{left:"-40%"},"100%":{left:"100%"}}),Je=R({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function et(t){const{value:s=0,min:n,max:o,valueText:i,getValueText:a,isIndeterminate:r,role:c="progressbar"}=t,l=Xe(s,n,o);return{bind:{"data-indeterminate":r?"":void 0,"aria-valuemax":o,"aria-valuemin":n,"aria-valuenow":r?void 0:s,"aria-valuetext":(()=>{if(s!=null)return typeof a=="function"?a(s,l):i})(),role:c},percent:l,value:s}}var[tt,st]=_e({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),nt=I((t,s)=>{const{min:n,max:o,value:i,isIndeterminate:a,role:r,...c}=t,l=et({value:i,min:n,max:o,isIndeterminate:a,role:r}),p={height:"100%",...st().filledTrack};return e.jsx(M.div,{ref:s,style:{width:`${l.percent}%`,...c.style},...l.bind,...c,__css:p})}),ge=I((t,s)=>{var n;const{value:o,min:i=0,max:a=100,hasStripe:r,isAnimated:c,children:l,borderRadius:d,isIndeterminate:p,"aria-label":g,"aria-labelledby":h,"aria-valuetext":f,title:m,role:j,...x}=ne(t),y=oe("Progress",t),_=d??((n=y.track)==null?void 0:n.borderRadius),S={animation:`${Je} 1s linear infinite`},W={...!p&&r&&c&&S,...p&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Ze} 1s ease infinite normal none running`}},v={overflow:"hidden",position:"relative",...y.track};return e.jsx(M.div,{ref:s,borderRadius:_,__css:v,...x,children:e.jsxs(tt,{value:y,children:[e.jsx(nt,{"aria-label":g,"aria-labelledby":h,"aria-valuetext":f,min:i,max:a,value:o,isIndeterminate:p,css:W,borderRadius:_,title:m,role:j}),l]})})});ge.displayName="Progress";var xe=I(function(s,n){const{children:o,placeholder:i,className:a,...r}=s;return e.jsxs(M.select,{...r,ref:n,className:K("chakra-select",a),children:[i&&e.jsx("option",{value:"",children:i}),o]})});xe.displayName="SelectField";function ot(t,s){const n={},o={};for(const[i,a]of Object.entries(t))s.includes(i)?n[i]=a:o[i]=a;return[n,o]}var $=I((t,s)=>{var n;const o=oe("Select",t),{rootProps:i,placeholder:a,icon:r,color:c,height:l,h:d,minH:p,minHeight:g,iconColor:h,iconSize:f,...m}=ne(t),[j,x]=ot(m,Me),y=Re(x),_={width:"100%",height:"fit-content",position:"relative",color:c},S={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(n=o.field)==null?void 0:n._focus}};return e.jsxs(M.div,{className:"chakra-select__wrapper",__css:_,...j,...i,children:[e.jsx(xe,{ref:s,height:d??l,minH:p??g,placeholder:a,...y,__css:S,children:t.children}),e.jsx(je,{"data-disabled":be(y.disabled),...(h||c)&&{color:h||c},__css:o.icon,...f&&{fontSize:f},children:r})]})});$.displayName="Select";var at=t=>e.jsx("svg",{viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),it=M("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),je=t=>{const{children:s=e.jsx(at,{}),...n}=t,o=u.cloneElement(s,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e.jsx(it,{...n,className:"chakra-select__icon-wrapper",children:u.isValidElement(s)?o:null})};je.displayName="SelectIcon";function rt({selectedModel:t,setSelectedModel:s,modelTypeList:n}){const o=i=>{s(i)};return e.jsx(me,{children:n.map(i=>e.jsx(V,{children:e.jsx(w,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>o(i),size:"sm",children:i})},i))})}const lt={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function ct({data:t}){const[s,n]=u.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[o,i]=u.useState(!t.file_hash),[a,r]=u.useState();u.useEffect(()=>{i(!t.file_hash),c()},[t.file_hash]);const c=async()=>{var p,g,h,f;const d=await D.models.get(t.model_name+"@"+t.model_type);if(d!=null)r(d),(p=d.imageUrl)!=null&&p.length&&n(d.imageUrl);else if(t.file_hash!=null)try{const m=`https://civitai.com/api/v1/model-versions/by-hash/${t.file_hash}`,x=await(await fetch(m)).json();let y;if(await((g=P)==null?void 0:g.getSetting("showNsfwModelThumbnail"))===!0)y=(f=(h=x==null?void 0:x.images)==null?void 0:h[0])==null?void 0:f.url;else if(!x.model.nsfw){const S=x.images.find(L=>L.nsfw==="None");y=S==null?void 0:S.url}y&&n(y),D.models.add({id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,civitModelID:String(x.modelId),civitModelVersionID:String(x.id),imageUrl:y??null})}catch{}t.preview&&n(t.preview)},l=d=>{const p=lt[t.model_type];p&&(d.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),d.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),d.dataTransfer.setData("nodeType",p))};return o?e.jsxs(E,{position:"relative",borderRadius:4,bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:[o&&e.jsx(H,{}),e.jsx(b,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:12,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]}):e.jsxs(le,{position:"relative",borderRadius:4,draggable:!0,onDragStart:l,children:[e.jsx(pe,{src:s,draggable:!1,boxSize:"100%",height:178,objectFit:"cover",borderRadius:4,cursor:(a==null?void 0:a.civitModelID)!=null?"pointer":"auto",onClick:()=>{(a==null?void 0:a.civitModelID)==null||(a==null?void 0:a.civitModelVersionID)==null||window.open(`https://civitai.com/models/${a==null?void 0:a.civitModelID}?modelVersionId=${a==null?void 0:a.civitModelVersionID}`)}}),e.jsx(b,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:14,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]})}function dt({list:t}){return e.jsx(qe,{templateColumns:"repeat(3, 1fr)",gap:1,marginTop:2,children:t.map(s=>e.jsx(fe,{children:e.jsx(ct,{data:s})},s.model_name))})}const ut=async t=>{try{const n=await(await B.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:n}))}catch(s){console.error("Failed to connect to the server:",s)}},ht=["Checkpoint","TextualInversion","Hypernetwork","LORA","Controlnet","Upscaler","VAE"],pt={Checkpoint:"checkpoints",TextualInversion:"embeddings",Hypernetwork:"hypernetworks",LORA:"loras",Controlnet:"controlnet",Upscaler:"upscale_models",VAE:"vae"};function ye(t){return t.modelVersions!==void 0}function mt(t){var s;return((s=t.files)==null?void 0:s[0])!==void 0}function ee(t,s){var o,i,a,r,c,l;if(!t)return;let n;return mt(t)?n={id:t.id,SHA256:(i=(o=t.files)==null?void 0:o[0].hashes)==null?void 0:i.SHA256,name:(a=t.files)==null?void 0:a[0].name,sizeKB:(c=(r=t.files)==null?void 0:r[0])==null?void 0:c.sizeKB}:n={id:t.id,SHA256:(l=t.hashes)==null?void 0:l[2],name:`${s} ${t.name}`},n}function te(t,s=1){const i=t/1024;return i>=1024?(i/1024).toFixed(s)+" GB":i.toFixed(s)+" MB"}function se(t,s){if(!t||t.length===0)return;let n=t.find(o=>o.nsfw==="None");return s&&(n=n??t[0]),n}function ft(t,s=280,n){var o,i,a,r;if(t)return ye(t)?(a=se((i=(o=t.modelVersions)==null?void 0:o.at(0))==null?void 0:i.images,n))==null?void 0:a.url:`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(r=se(t.images,n))==null?void 0:r.url}/width=${s}/`}const G=280;function gt({model:t,onClickInstallModel:s,installing:n}){var h,f;const[o,i]=u.useState();u.useEffect(()=>{m();async function m(){var x;const j=await((x=P)==null?void 0:x.getSetting("showNsfwModelThumbnail"));i(ft(t,G,j))}},[t]);const a=ye(t)?t.modelVersions:t.versions,[r,c]=u.useState(((h=a==null?void 0:a[0])==null?void 0:h.name)??""),l=a==null?void 0:a.find(m=>(m==null?void 0:m.name)===r),d=()=>{window.open(`https://civitai.com/models/${t.id}`)},p=u.useCallback(()=>{if(l==null){console.error("no file is find by name",r);return}s(ee(l,t.name),t)},[r]),g=(f=ee(l))==null?void 0:f.sizeKB;return e.jsxs(ce,{width:G,justifyContent:"space-between",mb:2,gap:1,children:[e.jsx(pe,{borderRadius:3,boxSize:G+"px",objectFit:"cover",src:o,alt:"model cover image",cursor:"pointer",onClick:()=>d()}),e.jsxs(z,{p:1,children:[e.jsx(Z,{label:t.name,children:e.jsx(b,{fontWeight:500,noOfLines:1,children:t.name})}),e.jsxs(E,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(w,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:e.jsx(b,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),e.jsx(w,{leftIcon:e.jsx(ze,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>p(),isDisabled:!!(r&&n.includes(r)),children:"Install"})]}),e.jsxs(A,{children:[e.jsx($,{size:"md",style:{paddingLeft:4},onChange:m=>{c(m.target.value)},children:a==null?void 0:a.map(m=>{const j=m==null?void 0:m.name;return j?e.jsx("option",{value:j,style:{padding:0},children:j},m.id):null})}),g&&e.jsx(Z,{label:te(g),children:e.jsx(b,{flexShrink:1,noOfLines:1,width:"40%",children:te(g)})})]})]})]})}function xt({searchQuery:t,setSearchQuery:s,onSearch:n}){return e.jsxs(E,{gap:1,alignItems:"center",grow:1,children:[e.jsx(F,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:o=>s(o.target.value),onKeyUp:o=>{o.code==="Enter"&&n()}}),e.jsx(w,{size:"sm",onClick:()=>n(),colorScheme:"teal",children:"Search"})]})}function jt({isOpen:t,fileSelected:s,onClose:n,selectFolder:o}){const[i,a]=u.useState(""),[r,c]=u.useState([]),[l,d]=u.useState(""),p=u.useRef(null);u.useEffect(()=>{g()},[]);const g=async()=>{const h=await Fe();h&&c(h.filter(f=>!["custom_nodes","config","saved_prompts"].includes(f)))};return e.jsx(Ce,{isOpen:t,leastDestructiveRef:p,onClose:n,children:e.jsx(ae,{children:e.jsxs(Ie,{children:[e.jsx(ie,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),e.jsx(re,{children:e.jsxs(z,{spacing:4,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(b,{children:"Model download url"}),e.jsx(F,{placeholder:"https://civitai.com/api/download/models/311399",onChange:h=>d(h.target.value),value:l})]}),e.jsx(b,{children:"Choose model install folder"}),e.jsx($,{placeholder:"Select option",value:i,onChange:h=>a(h.target.value),children:r.map(h=>e.jsx("option",{value:h,children:h},h))})]})}),e.jsxs(Te,{children:[e.jsx(w,{ref:p,onClick:n,children:"Cancel"}),e.jsx(w,{onClick:()=>o(i,l),ml:3,isDisabled:l.length===0,children:"Confirm"})]})]})})})}function yt(){const{colorMode:t}=ke(),s=de(),[n,o]=u.useState([]);return u.useEffect(()=>{B.addEventListener("download_progress",i=>{o(i.detail)}),B.addEventListener("download_error",i=>{s({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),e.jsx(z,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,children:n.map(({save_path:i,progress:a})=>e.jsxs(A,{children:[e.jsx(b,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),e.jsx(ge,{isIndeterminate:!a,hasStripe:!0,width:"50%",value:a}),e.jsxs(b,{fontSize:16,width:"10%",children:[a.toFixed(1),"%"]})]},i))})}const ve="WORKSPACE_CIVIT_API_KEY_STORAGE_KEY";function vt(){return localStorage.getItem(ve)}function St(t){localStorage.setItem(ve,t)}function wt(){const[t,s]=u.useState(""),{onOpen:n,onClose:o,isOpen:i}=ue(),a=()=>{St(t),o()};return e.jsxs(Oe,{isOpen:i,onOpen:n,onClose:o,placement:"right",closeOnBlur:!1,children:[e.jsx(We,{children:e.jsx(w,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),e.jsxs(Ge,{p:5,children:[e.jsx(Ke,{}),e.jsx(He,{}),e.jsxs(z,{spacing:4,children:[e.jsx(b,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),e.jsx(F,{value:t,onChange:r=>s(r.target.value),placeholder:"API Key"}),e.jsx(w,{size:"sm",py:1,mr:8,onClick:a,children:"Save"})]})]})]})}const _t=t=>typeof t=="function",Se=t=>{const[s,n]=u.useState(t),o=u.useRef(s),i=u.useCallback(a=>{o.current=_t(a)?a(o.current):a,n(o.current)},[]);return[s,i,o]};async function bt(t,s){var r,c;const n={queries:[{q:t,indexUid:"models_v5",facets:["category.name","checkpointType","fileFormats","lastVersionAtUnix","tags.name","type","user.username","version.baseModel"],attributesToHighlight:["*"],highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__",limit:80,offset:0}]};return s&&(n.queries[0].filter=[[`"type"="${s}"`]]),((c=(r=await(await fetch("https://meilisearch-v1-6.civitai.com/multi-search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(n)})).json())==null?void 0:r.results)==null?void 0:c.at(0)).hits??[]}function Mt({onclose:t,searchQuery:s="",modelType:n}){const[o,i]=u.useState([]),[a,r]=u.useState(!1),[c,l]=u.useState(n),d=de(),[p,g]=u.useState([]),[h,f]=u.useState(s),{isOpen:m,onOpen:j,onClose:x}=ue(),[y,_,S]=Se(),L=u.useCallback(async()=>{r(!0);const v=await bt(h,c);i(v),r(!1)},[h,c]),O=(v,T)=>{var Y,q,Q,X;if(!((Y=S.current)!=null&&Y.id)&&!T){console.error("no url to download");return}let k=T??`https://civitai.com/api/download/models/${(q=S.current)==null?void 0:q.id}`,C=(Q=S.current)==null?void 0:Q.name;if(!C&&(C=k.split("/").pop(),!C)){console.error("downloadUrl is malformed");return}d({title:"Installing...",description:C,status:"info",duration:4e3,isClosable:!0}),C!=null&&g(we=>[...we,C??""]);const U=vt();U&&(k+=`?token=${U}`),ut({file_hash:(X=S.current)==null?void 0:X.SHA256,filename:C,save_path:v,url:k}),_(void 0),x()},W=(v,T)=>{const k=pt[T.type];_(v),k==null?j():O(k)};return u.useEffect(()=>{L()},[c]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[e.jsx(ae,{}),e.jsxs(Ae,{width:"90%",maxWidth:"90vw",height:"90vh",children:[e.jsxs(ie,{children:[e.jsxs(A,{gap:2,mb:2,alignItems:"center",children:[e.jsx(he,{size:"md",mr:2,children:"Models"}),e.jsx(xt,{searchQuery:h,setSearchQuery:f,onSearch:L}),e.jsx(w,{size:"sm",py:1,mr:8,onClick:j,children:"Custom URL Install"}),e.jsx(wt,{})]}),e.jsxs(A,{gap:2,mb:2,wrap:"wrap",children:[e.jsx(w,{size:"sm",py:1,onClick:()=>{l(void 0)},isActive:c==null,children:"All"}),ht.map(v=>e.jsx(w,{size:"sm",py:1,isActive:c===v,onClick:()=>{l(v)},children:v},v))]}),a&&e.jsx(H,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),e.jsx(Pe,{}),e.jsxs(re,{overflowY:"auto",children:[e.jsx(A,{wrap:"wrap",children:o==null?void 0:o.map(v=>e.jsx(gt,{model:v,onClickInstallModel:W,installing:p},v.id))}),e.jsx(yt,{})]})]})]}),e.jsx(jt,{fileSelected:!!y,isOpen:m,onClose:x,selectFolder:(v,T)=>{O(v,S.current?void 0:T)}})]})}function Ct(){const[t,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",colorScheme:"teal",onClick:()=>s(!0),children:"Install Models"}),t&&e.jsx(Mt,{modelType:"Checkpoint",onclose:()=>s(!1)})]})}const It=()=>{const[t,s]=u.useState(["checkpoints"]),[n,o]=u.useState([]),[i,a]=u.useState(!0);u.useEffect(()=>{r(),B.addEventListener("model_list",l=>{c(l.detail)})},[]);const r=async()=>{const l=await Ve();c(l)},c=async l=>{if(!l)return;a(!1);const d=Array.from(new Set(l.map(g=>g.model_type))),p=d.indexOf("checkpoints");p>=0&&d.splice(p,1),d.unshift("checkpoints"),s(d),o(l)};return{modelTypeList:t,modelsList:n,loading:i}};function Tt(){const[t,s,n]=Se(!1),o=()=>{var c;(c=P)==null||c.getSetting("showNsfwModelThumbnail").then(l=>{s(l??!1)})};u.useEffect(()=>{o()},[]);const i=c=>{var d;const l=c.target.checked;(d=P)==null||d.upsert({showNsfwModelThumbnail:l}).then(()=>{o(),a(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},a=async()=>{const c=await D.models.toArray();for(let l=0;l<c.length;l+=5){const d=c.slice(l,l+5);await Promise.all(d.map(r))}},r=async c=>{var l,d;try{const p=`https://civitai.com/api/v1/model-versions/by-hash/${c.fileHash}`,h=await(await fetch(p)).json();let f;if(n.current)f=(d=(l=h==null?void 0:h.images)==null?void 0:l[0])==null?void 0:d.url;else if(!h.model.nsfw){const m=h.images.find(j=>j.nsfw==="None");f=m==null?void 0:m.url}D.models.update(c.id,{imageUrl:f??null})}catch{}};return e.jsx(Qe,{isChecked:t,onChange:i,width:"100px",children:"Show NSFW"})}function kt({onClose:t}){const[s,n]=u.useState("checkpoints"),[o,i]=u.useState(""),{loading:a,modelTypeList:r,modelsList:c}=It(),[l,d]=u.useState([]);u.useEffect(()=>{const h=c.filter(f=>o.length?f.model_name.toLowerCase().includes(o.toLowerCase()):f.model_type===s);d(h)},[s,c,o]),u.useEffect(()=>(N.canvasEl.addEventListener("click",t),()=>{N.canvasEl.removeEventListener("click",t)}),[]);const p=440,g=()=>e.jsxs(e.Fragment,{children:[e.jsxs(E,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:[e.jsx(F,{size:"sm",placeholder:"Search",value:o,onChange:h=>i(h.target.value)}),e.jsx(Tt,{})]}),!o.length&&e.jsx(rt,{modelTypeList:r,setSelectedModel:n,selectedModel:s}),e.jsx(dt,{list:l}),a&&e.jsx(E,{justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(H,{})})]});return e.jsx(Le,{children:e.jsx(le,{style:{width:p},children:e.jsxs(ce,{width:p,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:$e,overflowY:"auto",children:[e.jsxs(E,{justifyContent:"space-between",alignContent:"center",py:3,children:[e.jsx(he,{size:"md",mr:2,children:"Models"}),e.jsx(Ct,{})]}),g()]})})})}const Et=u.lazy(()=>Ne(()=>import("./InstallMissingModelsButton-ak7be-3i.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function At(){const[t,s]=u.useState(!1),[n,o]=u.useState(),i=async r=>{if(r.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const l=r.dataTransfer.getData("modelRelativePath"),d=r.dataTransfer.getData("nodeType"),p=LiteGraph.createNode(d);p.pos=[r.canvasX,r.canvasY],p.configure({widgets_values:[l]}),N.graph.add(p)};u.useEffect(()=>{var r;return(r=P)==null||r.getSetting("modelManagerTopBarStyle").then(c=>{a(c,!1)}),N.canvasEl.addEventListener("drop",i),()=>{N.canvasEl.removeEventListener("drop",i)}},[]);const a=(r,c=!1)=>{var _;const{top:l=0,right:d=0}=n||{},{top:p=0,right:g=0}=r??{};let h=l+p,f=n===void 0?g:d-g;const m=document.documentElement.clientWidth,j=document.documentElement.clientHeight,x=document.getElementById("modelManagerTopBar"),y=(x==null?void 0:x.offsetWidth)||224;h+32>j&&(h=j-38),f+y>m&&(f=m-y-4),o({top:Math.max(4,h),right:Math.max(4,f)}),c&&((_=P)==null||_.upsert({modelManagerTopBarStyle:{top:h,right:f}}))};return e.jsx(Ue,{onDragEnd:r=>{a({top:r.y,right:r.x},!0)},dragIconId:"dragModelManagerTopBarIcon",children:n?e.jsxs(A,{style:{position:"fixed",...n},gap:2,draggable:!1,id:"modelManagerTopBar",className:"model-manager-top-bar",children:[e.jsx(Ye,{id:"dragModelManagerTopBarIcon",className:"drag-model-manager-top-bar-icon",cursor:"move",size:15,color:"#FFF"}),e.jsx(Et,{}),e.jsx(w,{size:"sm",colorScheme:"blue","aria-label":"My models",onClick:()=>s(!0),px:1,children:"Models"}),t&&e.jsx(kt,{onClose:()=>s(!1)})]}):""})}const Rt=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"}));export{fe as G,Ct as I,Rt as M,bt as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-ak7be-3i.js","workspace_web/input.js","workspace_web/App-T2mWw1R4.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-NTCQBYKE-cfJRVRmk.js","workspace_web/chunk-JARCRF6W-lbPfS4C_.js","workspace_web/index-pz0vT7Or.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}