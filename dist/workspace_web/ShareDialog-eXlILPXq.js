import{r as s,m as te,x as Y,b as ae,f as ne,j as e,g as re,h as ie,i as F,M as le,N as ce,O as de,Q as ue,S as fe}from"./input.js";import{B as he,A as pe,a4 as ge,f as we,k as z,F as Q,g as H,aI as me,H as X,j as xe,aJ as ke,aK as ve,x as T,aL as V,aM as be,aN as je,aO as Se,h as ye,T as Ce,aP as Ie,_ as De}from"./App-CrjjADF1.js";import{app as Re}from"/scripts/app.js";import{S as Ee,L as Le}from"./chunk-VTV6N5LE-q3vNp9vA.js";import{I as Te}from"./IconCopy-Y0CxuD7w.js";import"/scripts/api.js";import"./chunk-7D6N5TE5-xH4ur8L5.js";function We(r){return r&&Y(r)&&Y(r.target)}function _e(r={}){const{onChange:d,value:f,defaultValue:p,name:g,isDisabled:h,isFocusable:i,isNative:c,...t}=r,[b,w]=s.useState(p||""),m=typeof f<"u",x=m?f:b,n=s.useRef(null),D=s.useCallback(()=>{const l=n.current;if(!l)return;let u="input:not(:disabled):checked";const j=l.querySelector(u);if(j){j.focus();return}u="input:not(:disabled)";const y=l.querySelector(u);y==null||y.focus()},[]),C=`radio-${s.useId()}`,E=g||C,I=s.useCallback(l=>{const u=We(l)?l.target.value:l;m||w(u),d==null||d(String(u))},[d,m]),W=s.useCallback((l={},u=null)=>({...l,ref:te(u,n),role:"radiogroup"}),[]),M=s.useCallback((l={},u=null)=>({...l,ref:u,name:E,[c?"checked":"isChecked"]:x!=null?l.value===x:void 0,onChange(y){I(y)},"data-radiogroup":!0}),[c,E,I,x]);return{getRootProps:W,getRadioProps:M,name:E,ref:n,focus:D,setValue:w,value:x,onChange:I,isDisabled:h,isFocusable:i,htmlProps:t}}var[Pe,Be]=ae({name:"RadioGroupContext",strict:!1}),Z=ne((r,d)=>{const{colorScheme:f,size:p,variant:g,children:h,className:i,isDisabled:c,isFocusable:t,...b}=r,{value:w,onChange:m,getRootProps:x,name:n,htmlProps:D}=_e(b),R=s.useMemo(()=>({name:n,size:p,onChange:m,colorScheme:f,value:w,variant:g,isDisabled:c,isFocusable:t}),[n,p,m,f,w,g,c,t]);return e.jsx(Pe,{value:R,children:e.jsx(re.div,{...x(D,d),className:ie("chakra-radio-group",i),children:h})})});Z.displayName="RadioGroup";function Ne({options:r,value:d,onChange:f}){const[p,g]=s.useState(!1),h=s.useRef(null),i=r.find(t=>t.value===d);s.useEffect(()=>{const t=b=>{h.current&&!h.current.contains(b.target)&&g(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[h]);const c=()=>g(!p);return e.jsxs(he,{position:"relative",children:[e.jsx(F,{onClick:c,rightIcon:e.jsx(pe,{}),leftIcon:i==null?void 0:i.icon,children:i==null?void 0:i.label}),p&&e.jsx(ge,{gap:4,ref:h,mt:"2",shadow:"md",borderWidth:"1px",p:"2",position:"absolute",zIndex:100,children:r.map(t=>e.jsx(F,{onClick:()=>{g(!1),f(t.value)},leftIcon:t.icon,justifyContent:"flex-start",variant:"ghost",width:"full",children:t.label},t.label))})]})}function Ke({onClose:r}){var y,O,$,G,B;const[d,f]=s.useState("v"+Ve()),[p,g]=s.useState([]),[h,i]=s.useState(!1),c=(O=(y=z)==null?void 0:y.settings)==null?void 0:O.cloudHost,[t,b]=s.useState("PRIVATE"),[w,m]=s.useState("new_version"),x=s.useRef(""),n=($=T)==null?void 0:$.curWorkflow,D=we(),R=s.useRef(null),[C,E]=s.useState(!0),I=async o=>{var _,P;const a=o.data;if(a.type!=="share_workflow_success")return;const k=a.localWorkflowID,v=a.localVersionID,S=a.version.id,L=a.version.workflowID;L&&k&&await((_=T)==null?void 0:_.updateMetaInfo(k,{cloudID:L,cloudOrigin:o.origin,privacy:t})),v&&S&&await((P=V)==null?void 0:P.update(v,{cloudID:S,cloudOrigin:o.origin})),W(),window.open(x.current+"/workflow/"+L+"/"+S,"_blank"),i(!1)};s.useEffect(()=>{W(),window.addEventListener("message",I);const o=a=>{a.detail&&l(a.detail?JSON.stringify(a.detail):void 0)};return window.addEventListener("workspace_info_deps_updated",o),()=>{window.removeEventListener("message",I),window.removeEventListener("workspace_info_deps_updated",o)}},[]);const W=async()=>{var a,k;const o=await((a=z)==null?void 0:a.getSetting("cloudHost"));o&&(x.current=o),n!=null&&n.cloudID&&n.cloudOrigin&&Se(n).then(v=>{b(v)}),(k=V)==null||k.listByWorkflowID(n.id).then(v=>{g(v)})},M=o=>{navigator.clipboard.writeText(o).then(()=>{D({title:"Copied to clipboard",status:"success",duration:2e3,isClosable:!0})}).catch(a=>{console.error("Failed to copy text: ",a)})},l=async o=>{var q,A,U;i(!0);const a=be(32),k=await((q=z)==null?void 0:q.getSetting("cloudHost"));let v,S;try{if(v=je(),w==="new_version"?S=await((A=V)==null?void 0:A.add({workflowID:n.id,name:d,createTime:Date.now(),json:o??JSON.stringify(Re.graph.serialize())})):S=await((U=V)==null?void 0:U.get(w)),!S){alert(`Failed to find version: ${w}, please try again.`),i(!1);return}}catch(N){console.error(N),i(!1),alert("Failed to share workflow, please try again.");return}const L=window.location.protocol,_=window.location.host,P=`${L}//${_}`,ee=k+`/share_workflow_confirm/${a}?redirectUrl=${P}`,oe=window.open(ee,"Share Workflow","width=800,height=800"),K=N=>{var J;if(N.origin===k&&N.data==="child_ready"){const se=(J=T)==null?void 0:J.curWorkflow;oe.postMessage({workflow:se,version:S,nodeDefs:v,privacy:t},k),window.removeEventListener("message",K)}};window.addEventListener("message",K)},u=async()=>{var o;C?(o=R.current)==null||o.requestSubmit():l()},j=(B=(G=T)==null?void 0:G.curWorkflow)==null?void 0:B.cloudID;return e.jsxs(le,{isOpen:!0,onClose:r,size:"lg",children:[e.jsx(ce,{}),e.jsxs(de,{width:["98%","90%","50%"],maxWidth:"600px",children:[e.jsxs(ue,{children:[e.jsxs(Q,{justifyContent:"space-between",children:[e.jsxs("p",{children:['Share "',n==null?void 0:n.name,'"']}),e.jsx(F,{colorScheme:"teal",onClick:u,size:"sm",isDisabled:h,children:h?"Sharing":"Share"})]}),c&&e.jsxs(ye,{fontSize:16,color:"GrayText",fontWeight:400,children:["Share to ",new URL(c).host]})]}),e.jsx(fe,{pb:10,children:e.jsxs(H,{gap:5,children:[j==null?e.jsx(Ne,{options:me,value:t,onChange:o=>{b(o)}}):e.jsx(Ce,{variant:"outline",borderRadius:"full",width:"fit-content",children:e.jsx(Ie,{privacy:t,showEmoji:!0})}),j&&e.jsxs(X,{spacing:2,color:"teal.400",children:[e.jsxs(Le,{wordBreak:"break-all",href:c+"/workflow/"+j,isExternal:!0,children:[c+"/workflow/"+j," ",e.jsx(De,{size:20,style:{display:"inline-block",verticalAlign:"middle"}})]}),e.jsx(F,{size:"sm",leftIcon:e.jsx(Te,{size:18}),onClick:()=>{var o,a;M(c+"/workflow/"+((a=(o=T)==null?void 0:o.curWorkflow)==null?void 0:a.cloudID))},children:"Copy link"})]}),e.jsx(Z,{gap:4,onChange:o=>{m(o)},value:w,children:e.jsx(H,{children:e.jsxs(X,{mb:5,alignItems:"center",children:[e.jsx(xe,{value:d,width:"60%",onFocus:()=>{m("new_version")},onChange:o=>{f(o.target.value)}}),e.jsx(Q,{color:"green",children:e.jsx(ke,{colorScheme:"purple",children:"Version Name"})})]})})}),e.jsxs(H,{borderRadius:6,borderWidth:"1px",p:2,children:[e.jsx(Ee,{isChecked:C,onChange:()=>E(!C),fontWeight:"600",children:"Share Resource Links"}),C&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"GrayText"},children:"You can disable reource sharing if you don't want to resolve submit errors"}),e.jsx(ve,{ref:R})]})]})]})})]})]})}function Ve(){const r=new Date,d=r.getFullYear(),f=String(r.getMonth()+1).padStart(2,"0"),p=String(r.getDate()).padStart(2,"0");return`${d}-${f}-${p}`}export{Ke as default};
