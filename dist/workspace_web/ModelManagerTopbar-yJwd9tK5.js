import{f as P,r as u,j as e,g as T,e as V,a4 as z,b as Ee,o as re,k as le,l as Pe,ac as Ae,h as _,a9 as $,ad as De,N as ce,ae as Le,Q as de,S as ue,T as Ne,Z as Be,M as Fe,O as Re,R as ze,P as Oe,_ as We}from"./input.js";import{aj as Ge,ai as Ke,_ as He,ak as F,o as k,F as A,l as I,B as he,al as pe,am as se,aa as me,k as O,m as ne,z as Ve,H as E,n as W,an as fe,j as ge,ao as xe,$ as $e,a0 as Ue,a1 as Ye,a2 as qe,a3 as Qe,ap as je,aq as K,ah as ve,ar as Xe,as as Ze,ab as Je,at as et,au as tt}from"./App-bwnmchpl.js";import{I as ye,G as st,C as nt}from"./chunk-JARCRF6W-yJJssWqi.js";import{app as N}from"/scripts/app.js";import{api as R}from"/scripts/api.js";var we=P(function(s,n){const{spacing:a="0.5rem",spacingX:i,spacingY:o,children:r,justify:l,direction:c,align:d,className:p,shouldWrapChildren:g,...h}=s,m=u.useMemo(()=>g?u.Children.map(r,(f,v)=>e.jsx(U,{children:f},v)):r,[r,g]);return e.jsx(T.div,{ref:n,className:V("chakra-wrap",p),...h,children:e.jsx(T.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:l,alignItems:d,flexDirection:c,listStyleType:"none",gap:a,columnGap:i,rowGap:o,padding:"0"},children:m})})});we.displayName="Wrap";var U=P(function(s,n){const{className:a,...i}=s;return e.jsx(T.li,{ref:n,__css:{display:"flex",alignItems:"flex-start"},className:V("chakra-wrap__listitem",a),...i})});U.displayName="WrapItem";function oe(t){return Ke(t,s=>s==="auto"?"auto":`span ${s}/span ${s}`)}var Se=P(function(s,n){const{area:a,colSpan:i,colStart:o,colEnd:r,rowEnd:l,rowSpan:c,rowStart:d,...p}=s,g=Ge({gridArea:a,gridColumn:oe(i),gridRow:oe(c),gridColumnStart:o,gridColumnEnd:r,gridRowStart:d,gridRowEnd:l});return e.jsx(T.div,{ref:n,__css:g,...p})});Se.displayName="GridItem";function ot(t,s,n){return(t-s)*100/(n-s)}z({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});z({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var at=z({"0%":{left:"-40%"},"100%":{left:"100%"}}),it=z({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function rt(t){const{value:s=0,min:n,max:a,valueText:i,getValueText:o,isIndeterminate:r,role:l="progressbar"}=t,c=ot(s,n,a);return{bind:{"data-indeterminate":r?"":void 0,"aria-valuemax":a,"aria-valuemin":n,"aria-valuenow":r?void 0:s,"aria-valuetext":(()=>{if(s!=null)return typeof o=="function"?o(s,c):i})(),role:l},percent:c,value:s}}var[lt,ct]=Ee({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),dt=P((t,s)=>{const{min:n,max:a,value:i,isIndeterminate:o,role:r,...l}=t,c=rt({value:i,min:n,max:a,isIndeterminate:o,role:r}),p={height:"100%",...ct().filledTrack};return e.jsx(T.div,{ref:s,style:{width:`${c.percent}%`,...l.style},...c.bind,...l,__css:p})}),_e=P((t,s)=>{var n;const{value:a,min:i=0,max:o=100,hasStripe:r,isAnimated:l,children:c,borderRadius:d,isIndeterminate:p,"aria-label":g,"aria-labelledby":h,"aria-valuetext":m,title:f,role:v,...j}=re(t),y=le("Progress",t),M=d??((n=y.track)==null?void 0:n.borderRadius),w={animation:`${it} 1s linear infinite`},L={...!p&&r&&l&&w,...p&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${at} 1s ease infinite normal none running`}},B={overflow:"hidden",position:"relative",...y.track};return e.jsx(T.div,{ref:s,borderRadius:M,__css:B,...j,children:e.jsxs(lt,{value:y,children:[e.jsx(dt,{"aria-label":g,"aria-labelledby":h,"aria-valuetext":m,min:i,max:o,value:a,isIndeterminate:p,css:L,borderRadius:M,title:f,role:v}),c]})})});_e.displayName="Progress";var be=P(function(s,n){const{children:a,placeholder:i,className:o,...r}=s;return e.jsxs(T.select,{...r,ref:n,className:V("chakra-select",o),children:[i&&e.jsx("option",{value:"",children:i}),a]})});be.displayName="SelectField";function ut(t,s){const n={},a={};for(const[i,o]of Object.entries(t))s.includes(i)?n[i]=o:a[i]=o;return[n,a]}var G=P((t,s)=>{var n;const a=le("Select",t),{rootProps:i,placeholder:o,icon:r,color:l,height:c,h:d,minH:p,minHeight:g,iconColor:h,iconSize:m,...f}=re(t),[v,j]=ut(f,Ae),y=He(j),M={width:"100%",height:"fit-content",position:"relative",color:l},w={paddingEnd:"2rem",...a.field,_focus:{zIndex:"unset",...(n=a.field)==null?void 0:n._focus}};return e.jsxs(T.div,{className:"chakra-select__wrapper",__css:M,...v,...i,children:[e.jsx(be,{ref:s,height:d??c,minH:p??g,placeholder:o,...y,__css:w,children:t.children}),e.jsx(Me,{"data-disabled":Pe(y.disabled),...(h||l)&&{color:h||l},__css:a.icon,...m&&{fontSize:m},children:r})]})});G.displayName="Select";var ht=t=>e.jsx("svg",{viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),pt=T("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Me=t=>{const{children:s=e.jsx(ht,{}),...n}=t,a=u.cloneElement(s,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e.jsx(pt,{...n,className:"chakra-select__icon-wrapper",children:u.isValidElement(s)?a:null})};Me.displayName="SelectIcon";function mt({selectedModel:t,setSelectedModel:s,modelTypeList:n}){const a=i=>{s(i)};return e.jsx(we,{children:n.map(i=>e.jsx(U,{children:e.jsx(_,{colorScheme:"blue",variant:t===i?"solid":"outline",onClick:()=>a(i),size:"sm",children:i})},i))})}const ft={checkpoints:"CheckpointLoaderSimple",vae:"VAELoader",loras:"LoraLoader",controlnet:"ControlNetLoader",upscale_models:"UpscaleModelLoader"};function gt({data:t}){const[s,n]=u.useState("https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/27fd7433-cb0a-4a87-88c1-21ccb2b1a842/width=450/00060-881622046.jpeg"),[a,i]=u.useState(!t.file_hash),[o,r]=u.useState();u.useEffect(()=>{i(!t.file_hash),l()},[t.file_hash]);const l=async()=>{var p,g,h,m;const d=await F.models.get(t.model_name+"@"+t.model_type);if(d!=null)r(d),(p=d.imageUrl)!=null&&p.length&&n(d.imageUrl);else if(t.file_hash!=null)try{const f=`https://civitai.com/api/v1/model-versions/by-hash/${t.file_hash}`,j=await(await fetch(f)).json();let y;if(await((g=k)==null?void 0:g.getSetting("showNsfwModelThumbnail"))===!0)y=(m=(h=j==null?void 0:j.images)==null?void 0:h[0])==null?void 0:m.url;else if(!j.model.nsfw){const w=j.images.find(D=>D.nsfw==="None");y=w==null?void 0:w.url}y&&n(y),F.models.add({id:t.model_name+"@"+t.model_type,fileHash:t.file_hash,fileFolder:t.model_type,fileName:t.model_name+t.model_extension,civitModelID:String(j.modelId),civitModelVersionID:String(j.id),imageUrl:y??null})}catch{}t.preview&&n(t.preview)},c=d=>{const p=ft[t.model_type];p&&(d.dataTransfer.setData("eventName","WorkspaceManagerAddNode"),d.dataTransfer.setData("modelRelativePath",t.model_name+t.model_extension),d.dataTransfer.setData("nodeType",p))};return a?e.jsxs(A,{position:"relative",borderRadius:4,bg:"rgba(0, 0, 0, 0.5)",height:178,justifyContent:"center",alignItems:"center",children:[a&&e.jsx($,{}),e.jsx(I,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:12,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]}):e.jsxs(he,{position:"relative",borderRadius:4,draggable:!0,onDragStart:c,children:[e.jsx(ye,{src:s,draggable:!1,boxSize:"100%",height:178,objectFit:"cover",borderRadius:4,cursor:(o==null?void 0:o.civitModelID)!=null?"pointer":"auto",onClick:()=>{(o==null?void 0:o.civitModelID)==null||(o==null?void 0:o.civitModelVersionID)==null||window.open(`https://civitai.com/models/${o==null?void 0:o.civitModelID}?modelVersionId=${o==null?void 0:o.civitModelVersionID}`)}}),e.jsx(I,{position:"absolute",bottom:"0",left:"0",right:"0",bg:"rgba(0, 0, 0, 0.5)",color:"white",textAlign:"center",p:"0",fontSize:14,borderBottomRightRadius:4,borderBottomLeftRadius:4,children:t.model_name})]})}function xt({list:t}){return e.jsx(st,{templateColumns:"repeat(3, 1fr)",gap:1,marginTop:2,children:t.map(s=>e.jsx(Se,{children:e.jsx(gt,{data:s})},s.model_name))})}const jt=async t=>{try{const n=await(await R.fetchApi("/model_manager/install_model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).text();window.dispatchEvent(new CustomEvent("model_install_message",{detail:n}))}catch(s){console.error("Failed to connect to the server:",s)}};function ae(t,s=1){const i=t/1024;return i>=1024?(i/1024).toFixed(s)+" GB":i.toFixed(s)+" MB"}function ie(t,s){if(!t||t.length===0)return;let n=t.find(a=>a.nsfw==="None");return s&&(n=n??t[0]),n}function vt(t,s=280,n){var a,i,o,r;if(t)return pe(t)?(o=ie((i=(a=t.modelVersions)==null?void 0:a.at(0))==null?void 0:i.images,n))==null?void 0:o.url:`https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/${(r=ie(t.images,n))==null?void 0:r.url}/width=${s}/`}const H=280;function yt({model:t,onClickInstallModel:s,installing:n}){var h,m;const[a,i]=u.useState();u.useEffect(()=>{f();async function f(){var j;const v=await((j=k)==null?void 0:j.getSetting("showNsfwModelThumbnail"));i(vt(t,H,v))}},[t]);const o=pe(t)?t.modelVersions:t.versions,[r,l]=u.useState(((h=o==null?void 0:o[0])==null?void 0:h.name)??""),c=o==null?void 0:o.find(f=>(f==null?void 0:f.name)===r),d=()=>{window.open(`https://civitai.com/models/${t.id}`)},p=u.useCallback(()=>{if(c==null){console.error("no file is find by name",r);return}s(se(c,t.name),t)},[r]),g=(m=se(c))==null?void 0:m.sizeKB;return e.jsxs(me,{width:H,justifyContent:"space-between",mb:2,gap:1,children:[e.jsx(ye,{borderRadius:3,boxSize:H+"px",objectFit:"cover",src:a,alt:"model cover image",cursor:"pointer",onClick:()=>d()}),e.jsxs(O,{p:1,children:[e.jsx(ne,{label:t.name,children:e.jsx(I,{fontWeight:500,noOfLines:1,children:t.name})}),e.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(_,{borderRadius:14,noOfLines:1,size:"xs",colorScheme:"teal",maxWidth:"40%",flexShrink:1,variant:"outline",px:1,cursor:"text",children:e.jsx(I,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t.type})}),e.jsx(_,{leftIcon:e.jsx(Ve,{size:18}),iconSpacing:1,borderRadius:10,size:"sm",py:1,colorScheme:"teal",type:"submit",onClick:()=>p(),isDisabled:!!(r&&n.includes(r)),children:"Install"})]}),e.jsxs(E,{children:[e.jsx(G,{size:"md",style:{paddingLeft:4},onChange:f=>{l(f.target.value)},children:o==null?void 0:o.map(f=>{const v=f==null?void 0:f.name;return v?e.jsx("option",{value:v,style:{padding:0},children:v},f.id):null})}),g&&e.jsx(ne,{label:ae(g),children:e.jsx(I,{flexShrink:1,noOfLines:1,width:"40%",children:ae(g)})})]})]})]})}function wt({searchQuery:t,setSearchQuery:s,onSearch:n}){return e.jsxs(A,{gap:1,alignItems:"center",grow:1,children:[e.jsx(W,{placeholder:"Search models in CivitAI",width:"60%",value:t,onChange:a=>s(a.target.value),onKeyUp:a=>{a.code==="Enter"&&n()}}),e.jsx(_,{size:"sm",onClick:()=>n(),colorScheme:"teal",children:"Search"})]})}function St({isOpen:t,fileSelected:s,onClose:n,selectFolder:a}){const[i,o]=u.useState(""),[r,l]=u.useState([]),[c,d]=u.useState(""),p=u.useRef(null);u.useEffect(()=>{g()},[]);const g=async()=>{const h=await fe();h&&(["custom_nodes","config","saved_prompts"].forEach(m=>{delete h[m]}),l(Object.values(h).flatMap(m=>m)))};return e.jsx(De,{isOpen:t,leastDestructiveRef:p,onClose:n,children:e.jsx(ce,{children:e.jsxs(Le,{children:[e.jsx(de,{fontSize:"lg",fontWeight:"bold",children:"Choose Folder"}),e.jsx(ue,{children:e.jsxs(O,{spacing:4,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(I,{children:"Model download url"}),e.jsx(W,{placeholder:"https://civitai.com/api/download/models/311399",onChange:h=>d(h.target.value),value:c})]}),e.jsx(I,{children:"Choose model install folder"}),e.jsx(G,{placeholder:"Select option",value:i,onChange:h=>o(h.target.value),children:r.map(h=>e.jsx("option",{value:h,children:h},h))})]})}),e.jsxs(Ne,{children:[e.jsx(_,{ref:p,onClick:n,children:"Cancel"}),e.jsx(_,{onClick:()=>a(i,c),ml:3,isDisabled:c.length===0,children:"Confirm"})]})]})})})}function _t(){const{colorMode:t}=Be(),s=ge(),[n,a]=u.useState([]);return u.useEffect(()=>{R.addEventListener("download_progress",i=>{a(i.detail)}),R.addEventListener("download_error",i=>{s({title:"Download Error",description:i.detail,status:"error",duration:4e3,isClosable:!0})})},[]),e.jsx(O,{spacing:5,pos:"absolute",bottom:"0",left:"0",width:"50%",zIndex:80,backgroundColor:t==="light"?"white":"#242424",paddingX:5,children:n.map(({save_path:i,progress:o})=>e.jsxs(E,{children:[e.jsx(I,{fontSize:16,width:"40%",children:i.replace(/^.*[\\/]/,"")}),e.jsx(_e,{isIndeterminate:!o,hasStripe:!0,width:"50%",value:o}),e.jsxs(I,{fontSize:16,width:"10%",children:[o.toFixed(1),"%"]})]},i))})}const Ce="WORKSPACE_CIVIT_API_KEY_STORAGE_KEY";function bt(){return localStorage.getItem(Ce)}function Mt(t){localStorage.setItem(Ce,t)}function Ct(){const[t,s]=u.useState(""),{onOpen:n,onClose:a,isOpen:i}=xe(),o=()=>{Mt(t),a()};return e.jsxs($e,{isOpen:i,onOpen:n,onClose:a,placement:"right",closeOnBlur:!1,children:[e.jsx(Ue,{children:e.jsx(_,{size:"sm",py:1,mr:8,children:"Set Civitai API Key"})}),e.jsxs(Ye,{p:5,children:[e.jsx(qe,{}),e.jsx(Qe,{}),e.jsxs(O,{spacing:4,children:[e.jsx(I,{fontSize:14,children:"Some Civitai.com models require user login to download, you will nedd a Civitai API key to download in that case"}),e.jsx(W,{value:t,onChange:r=>s(r.target.value),placeholder:"API Key"}),e.jsx(_,{size:"sm",py:1,mr:8,onClick:o,children:"Save"})]})]})]})}async function It(t,s){var r,l;const n={queries:[{q:t,indexUid:"models_v5",facets:["category.name","checkpointType","fileFormats","lastVersionAtUnix","tags.name","type","user.username","version.baseModel"],attributesToHighlight:["*"],highlightPreTag:"__ais-highlight__",highlightPostTag:"__/ais-highlight__",limit:80,offset:0}]};return s&&(n.queries[0].filter=[[`"type"="${s}"`]]),((l=(r=await(await fetch("https://meilisearch-v1-6.civitai.com/multi-search",{headers:{"Content-Type":"application/json",Authorization:"Bearer 102312c2b83ea0ef9ac32e7858f742721bbfd7319a957272e746f84fd1e974af"},method:"POST",body:JSON.stringify(n)})).json())==null?void 0:r.results)==null?void 0:l.at(0)).hits??[]}function Tt({onclose:t,searchQuery:s="",modelType:n}){const[a,i]=u.useState([]),[o,r]=u.useState(!1),[l,c]=u.useState(n),d=ge(),[p,g]=u.useState([]),[h,m]=u.useState(s),{isOpen:f,onOpen:v,onClose:j}=xe(),[y,M,w]=je(),[D,Y]=u.useState({}),[L,B]=u.useState(K),q=u.useCallback(async()=>{var S;r(!0);const x=await It(h,l);i(x);const C=await fe();C&&Y(C);const b=await((S=k)==null?void 0:S.getSetting("defaultFolders"));b&&B(b),r(!1)},[h,l]),Q=(x,C)=>{var Z,J,ee,te;if(!((Z=w.current)!=null&&Z.id)&&!C){console.error("no url to download");return}let b=C??`https://civitai.com/api/download/models/${(J=w.current)==null?void 0:J.id}`,S=(ee=w.current)==null?void 0:ee.name;if(!S&&(S=b.split("/").pop(),!S)){console.error("downloadUrl is malformed");return}d({title:"Installing...",description:S,status:"info",duration:4e3,isClosable:!0}),S!=null&&g(ke=>[...ke,S??""]);const X=bt();X&&(b+=`?token=${X}`),jt({file_hash:(te=w.current)==null?void 0:te.SHA256,filename:S,save_path:x,url:b}),M(void 0),j()},Ie=async(x,C)=>{const b=L[C.type];M(x),b==null?v():Q(b)},Te=async(x,C)=>{var S;const b={...L,[x]:C};await((S=k)==null?void 0:S.upsert({defaultFolders:b})),B(b)};return u.useEffect(()=>{q()},[l]),e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[e.jsx(ce,{}),e.jsxs(Re,{width:"90%",maxWidth:"90vw",height:"90vh",children:[e.jsxs(de,{children:[e.jsxs(E,{gap:2,mb:2,alignItems:"center",children:[e.jsx(ve,{size:"md",mr:2,children:"Models"}),e.jsx(wt,{searchQuery:h,setSearchQuery:m,onSearch:q}),e.jsx(_,{size:"sm",py:1,mr:8,onClick:v,children:"Custom URL Install"}),e.jsx(Ct,{})]}),e.jsxs(E,{gap:2,mb:2,wrap:"wrap",children:[e.jsx(_,{size:"sm",py:1,onClick:()=>{c(void 0)},isActive:l==null,children:"All"}),Xe.map(x=>e.jsx(_,{size:"sm",py:1,isActive:l===x,onClick:()=>{c(x)},children:x},x)),l&&D[K[l]]&&e.jsxs(E,{ml:"auto",children:[e.jsx(I,{whiteSpace:"nowrap",children:"Default Download Folder:"}),e.jsx(G,{value:L[l],onChange:x=>Te(l,x.target.value),children:D[K[l]].map(x=>e.jsx("option",{value:x,children:x}))})]})]}),o&&e.jsx($,{thickness:"4px",emptyColor:"gray.200",color:"pink.500",size:"lg"})]}),e.jsx(ze,{}),e.jsxs(ue,{overflowY:"auto",children:[e.jsx(E,{wrap:"wrap",children:a==null?void 0:a.map(x=>e.jsx(yt,{model:x,onClickInstallModel:Ie,installing:p},x.id))}),e.jsx(_t,{})]})]})]}),e.jsx(St,{fileSelected:!!y,isOpen:f,onClose:j,selectFolder:(x,C)=>{Q(x,w.current?void 0:C)}})]})}function kt(){const[t,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",colorScheme:"teal",onClick:()=>s(!0),children:"Install Models"}),t&&e.jsx(Tt,{modelType:"Checkpoint",onclose:()=>s(!1)})]})}const Et=()=>{const[t,s]=u.useState(["checkpoints"]),[n,a]=u.useState([]),[i,o]=u.useState(!0);u.useEffect(()=>{r(),R.addEventListener("model_list",c=>{l(c.detail)})},[]);const r=async()=>{const c=await Ze();l(c)},l=async c=>{if(!c)return;o(!1);const d=Array.from(new Set(c.map(g=>g.model_type))),p=d.indexOf("checkpoints");p>=0&&d.splice(p,1),d.unshift("checkpoints"),s(d),a(c)};return{modelTypeList:t,modelsList:n,loading:i}};function Pt(){const[t,s,n]=je(!1),a=()=>{var l;(l=k)==null||l.getSetting("showNsfwModelThumbnail").then(c=>{s(c??!1)})};u.useEffect(()=>{a()},[]);const i=l=>{var d;const c=l.target.checked;(d=k)==null||d.upsert({showNsfwModelThumbnail:c}).then(()=>{a(),o(),window.dispatchEvent(new Event("showNsfwModelThumbnail"))})},o=async()=>{const l=await F.models.toArray();for(let c=0;c<l.length;c+=5){const d=l.slice(c,c+5);await Promise.all(d.map(r))}},r=async l=>{var c,d;try{const p=`https://civitai.com/api/v1/model-versions/by-hash/${l.fileHash}`,h=await(await fetch(p)).json();let m;if(n.current)m=(d=(c=h==null?void 0:h.images)==null?void 0:c[0])==null?void 0:d.url;else if(!h.model.nsfw){const f=h.images.find(v=>v.nsfw==="None");m=f==null?void 0:f.url}F.models.update(l.id,{imageUrl:m??null})}catch{}};return e.jsx(nt,{isChecked:t,onChange:i,width:"100px",children:"Show NSFW"})}function At({onClose:t}){const[s,n]=u.useState("checkpoints"),[a,i]=u.useState(""),{loading:o,modelTypeList:r,modelsList:l}=Et(),[c,d]=u.useState([]);u.useEffect(()=>{const h=l.filter(m=>a.length?m.model_name.toLowerCase().includes(a.toLowerCase()):m.model_type===s);d(h)},[s,l,a]),u.useEffect(()=>(N.canvasEl.addEventListener("click",t),()=>{N.canvasEl.removeEventListener("click",t)}),[]);const p=440,g=()=>e.jsxs(e.Fragment,{children:[e.jsxs(A,{gap:4,justifyContent:"center",alignItems:"center",mb:1,children:[e.jsx(W,{size:"sm",placeholder:"Search",value:a,onChange:h=>i(h.target.value)}),e.jsx(Pt,{})]}),!a.length&&e.jsx(mt,{modelTypeList:r,setSelectedModel:n,selectedModel:s}),e.jsx(xt,{list:c}),o&&e.jsx(A,{justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx($,{})})]});return e.jsx(Oe,{children:e.jsx(he,{style:{width:p},children:e.jsxs(me,{width:p,height:"100vh",p:4,gap:2,position:"fixed",top:0,left:0,shadow:"xl",zIndex:Je,overflowY:"auto",children:[e.jsxs(A,{justifyContent:"space-between",alignContent:"center",py:3,children:[e.jsx(ve,{size:"md",mr:2,children:"Models"}),e.jsx(kt,{})]}),g()]})})})}const Dt=u.lazy(()=>We(()=>import("./InstallMissingModelsButton-tTqamchA.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Lt(){const[t,s]=u.useState(!1),[n,a]=u.useState(),i=async r=>{if(r.dataTransfer.getData("eventName")!=="WorkspaceManagerAddNode")return;const c=r.dataTransfer.getData("modelRelativePath"),d=r.dataTransfer.getData("nodeType"),p=LiteGraph.createNode(d);p.pos=[r.canvasX,r.canvasY],p.configure({widgets_values:[c]}),N.graph.add(p)};u.useEffect(()=>{var r;return(r=k)==null||r.getSetting("modelManagerTopBarStyle").then(l=>{o(l,!1)}),N.canvasEl.addEventListener("drop",i),()=>{N.canvasEl.removeEventListener("drop",i)}},[]);const o=(r,l=!1)=>{var M;const{top:c=0,right:d=0}=n||{},{top:p=0,right:g=0}=r??{};let h=c+p,m=n===void 0?g:d-g;const f=document.documentElement.clientWidth,v=document.documentElement.clientHeight,j=document.getElementById("modelManagerTopBar"),y=(j==null?void 0:j.offsetWidth)||224;h+32>v&&(h=v-38),m+y>f&&(m=f-y-4),a({top:Math.max(4,h),right:Math.max(4,m)}),l&&((M=k)==null||M.upsert({modelManagerTopBarStyle:{top:h,right:m}}))};return e.jsx(et,{onDragEnd:r=>{o({top:r.y,right:r.x},!0)},dragIconId:"dragModelManagerTopBarIcon",children:n?e.jsxs(E,{style:{position:"fixed",...n},gap:2,draggable:!1,id:"modelManagerTopBar",className:"model-manager-top-bar",children:[e.jsx(tt,{id:"dragModelManagerTopBarIcon",className:"drag-model-manager-top-bar-icon",cursor:"move",size:15,color:"#FFF"}),e.jsx(Dt,{}),e.jsx(_,{size:"sm",colorScheme:"blue","aria-label":"My models",onClick:()=>s(!0),px:1,children:"Models"}),t&&e.jsx(At,{onClose:()=>s(!1)})]}):""})}const Ot=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"}));export{Se as G,kt as I,Ot as M,It as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["workspace_web/InstallMissingModelsButton-tTqamchA.js","workspace_web/input.js","workspace_web/App-bwnmchpl.js","workspace_web/assets/App-JXePnJiV.css","workspace_web/chunk-NTCQBYKE-X_7oODtg.js","workspace_web/chunk-JARCRF6W-yJJssWqi.js","workspace_web/index-pz0vT7Or.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}