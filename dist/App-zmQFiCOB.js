var dt=Object.defineProperty;var ut=(t,e,o)=>e in t?dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var G=(t,e,o)=>(ut(t,typeof e!="symbol"?e+"":e,o),o);import{g as pt,r as c,u as ft,j as r,M as Ce,a as Oe,b as Ne,c as be,d as Me,e as Te,B as Y,P as Ue,f as $e,R as ht,_ as wt}from"./workspace-manager-IwcWZCSX.js";import{app as L}from"/scripts/app.js";import{api as mt}from"/scripts/api.js";import{H as z,a as Ge,C as je,T as de,I as Q,L as Le,b as yt,S as Ve,c as V,d as gt,e as vt,F as kt,f as xt,g as jt,M as It,h as St,i as Dt,j as ce,k as He,l as Ye,m as Ke,n as qe,u as Et,B as Ct}from"./chunk-TK6VMDNP-eb4SOsAW.js";var Ze={exports:{}},Ot="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Nt=Ot,bt=Nt;function Xe(){}function Qe(){}Qe.resetWarningCache=Xe;var Mt=function(){function t(s,n,a,l,u,w){if(w!==bt){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}t.isRequired=t;function e(){return t}var o={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Qe,resetWarningCache:Xe};return o.PropTypes=o,o};Ze.exports=Mt();var Tt=Ze.exports;const q=pt(Tt);let fe;const _t=new Uint8Array(16);function Ft(){if(!fe&&(fe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fe(_t)}const I=[];for(let t=0;t<256;++t)I.push((t+256).toString(16).slice(1));function Pt(t,e=0){return I[t[e+0]]+I[t[e+1]]+I[t[e+2]]+I[t[e+3]]+"-"+I[t[e+4]]+I[t[e+5]]+"-"+I[t[e+6]]+I[t[e+7]]+"-"+I[t[e+8]]+I[t[e+9]]+"-"+I[t[e+10]]+I[t[e+11]]+I[t[e+12]]+I[t[e+13]]+I[t[e+14]]+I[t[e+15]]}const At=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:At};function pe(t,e,o){if(Re.randomUUID&&!e&&!t)return Re.randomUUID();t=t||{};const s=t.random||(t.rng||Ft)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){o=o||0;for(let n=0;n<16;++n)e[o+n]=s[n];return e}return Pt(s)}async function se(t){try{const e=await fetch(`/workspace/get_db?table=${t}`);return e.ok?await e.json():void 0}catch(e){console.error("Error fetching workspace:",e);return}}async function E(t,e){const o=t+"/"+Date.now()+".json";Rt(o,e);try{return await(await fetch("/workspace/save_db",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:t,json:e})})).text()}catch(s){console.error("Error saving workspace:",s)}}async function Lt(t,e){try{return await(await fetch("/workspace/update_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,json_str:e})})).text()}catch(o){alert("Error saving workflow .json file: "+o),console.error("Error saving workspace:",o)}}async function et(t,e=!0){try{return await(await fetch("/workspace/delete_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,deleteEmptyFolder:e})})).text()}catch(o){console.error("Error deleting file:",o)}}async function Rt(t,e){try{return await(await fetch("/workspace/save_backup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:t,json_str:e})})).text()}catch(o){console.error("Error saving workspace backup:",o)}}async function Lo(t){try{return await(await fetch("/workspace/list_backup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dir:t})})).text()}catch(e){console.error("Error saving workspace:",e)}}async function Wt(t){try{return await(await fetch("/workspace/get_system_dir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({absolute_dir:t})})).json()}catch(e){console.error("Error getting workflows dir:",e)}}async function Ro(){try{return await(await fetch("/workspace/open_workflow_file_browser",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}catch(t){console.error("Error open workflows folder:",t)}}const Wo="CWM_WORKFLOWS_SORT_TYPE";var T=(t=>(t.RECENTLY_MODIFIED="newest",t.OLDEST_MODIFIED="oldest",t.AZ="name A-Z",t.ZA="name Z-A",t))(T||{});const Bt="comfyspace_tracking",Jt="http://localhost:8188/";function _e(t){if(t.name==null)return;const e=Fe(t);e!=null&&et(e)}function Fe(t){let e=zt(t.name)+".json",o=t.parentFolderID;for(;o!=null;){const s=R==null?void 0:R.get(o);if(s==null)break;e=`${s.name}/${e}`,o=s.parentFolderID??void 0}return e??null}function tt(t){const e=Fe(t);let o=k==null?void 0:k.getSetting("myWorkflowsDir");return o==null?(console.error("myWorkflowsDir is not set"),null):(o.endsWith("/")||(o=o+"/"),o+e)}function zt(t){return t=t.replace(/[\\/:*?"<>|]/g,"_"),t.trim()}function ot(t,e=!1){const o=new Date(t),s=String(o.getDate()).padStart(2,"0"),n=String(o.getMonth()+1).padStart(2,"0"),a=o.getFullYear(),l=String(o.getHours()).padStart(2,"0"),u=String(o.getMinutes()).padStart(2,"0"),w=String(o.getSeconds()).padStart(2,"0");let d=`${n}-${s}-${a} ${l}:${u}`;return e?d+`:${w}`:d}function Ut(t=[],e=T.RECENTLY_MODIFIED){const o=[...t];if(o.length)switch(e){case T.AZ:o.sort((s,n)=>s.name.localeCompare(n.name));break;case T.ZA:o.sort((s,n)=>n.name.localeCompare(s.name));break;case T.RECENTLY_MODIFIED:o.sort((s,n)=>n.updateTime-s.updateTime);break;case T.OLDEST_MODIFIED:o.sort((s,n)=>s.updateTime-n.updateTime);break}return o}function De(t=!0){ke().forEach(e=>{const o=tt(e);e.filePath!=o&&(e.filePath!=null&&et(e.filePath,t),ue(e))})}const $t=(t,e=T.RECENTLY_MODIFIED)=>{const o=[...t];switch(e){case T.AZ:o.sort((s,n)=>s.name.localeCompare(n.name));break;case T.ZA:o.sort((s,n)=>n.name.localeCompare(s.name));break;case T.RECENTLY_MODIFIED:o.sort((s,n)=>n.updateTime-s.updateTime);break;case T.OLDEST_MODIFIED:o.sort((s,n)=>s.updateTime-n.updateTime);break}return o};function st(t){var s;let e=t??"Untitled Flow";const o=(s=ke())==null?void 0:s.map(n=>n.name);if(o.includes(e)){let n=2,a=!0;for(;a;)o.includes(`${e} ${n}`)?n++:(e=`${e} ${n}`,a=!1)}return e}function Bo(t){return new Promise((e,o)=>{const s=new FileReader;s.onload=n=>{const a=new Uint8Array(n.target.result),l=new DataView(a.buffer);l.getUint32(0)!==2303741511&&(console.error("Not a valid PNG file"),o());let u=8;const w={};for(;u<a.length;){const d=l.getUint32(u),h=String.fromCharCode(...a.slice(u+4,u+8));if(h==="tEXt"||h=="comf"){let f=u+8;for(;a[f]!==0;)f++;const x=String.fromCharCode(...a.slice(u+8,f)),v=a.slice(f+1,u+8+d),S=Array.from(v).map(D=>String.fromCharCode(D)).join("");w[x]=S}u+=12+d}e(w)},s.readAsArrayBuffer(t)})}const Gt=t=>{var o;const e=(o=k==null?void 0:k.getSetting("shortcuts"))==null?void 0:o.save;return e?Vt(t,e):!1},Vt=(t,e)=>{const o=e.split("+"),s={Control:t.ctrlKey,Shift:t.shiftKey,Alt:t.altKey,Command:t.metaKey,[t.key.toUpperCase()]:!0};return o.every(n=>s[n])};function Ht(t){const e=["png","jpg","jpeg","gif","bmp","webp"],o=t.split(".").pop();return o!=null&&e.includes(o)}function Yt(t){return`/workspace/view_media?filename=${t}`}const rt="backup",oe="workspace";let H=null;function nt(){return new Promise((t,e)=>{const o=indexedDB.open("WorkspaceDB",3);o.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains(oe)||n.createObjectStore(oe,{keyPath:"id"})},o.onsuccess=s=>{t(s.target.result)},o.onerror=s=>{e(s.target.error)}})}async function Kt(t){try{return H==null&&(H=await nt()),new Promise((e,o)=>{if(H==null)return o("indexDB is null");const a=H.transaction([oe],"readwrite").objectStore(oe).put({id:rt,value:t});a.onsuccess=()=>e(),a.onerror=()=>o(a.error)})}catch(e){console.error("Error while opening database:",e)}}async function M(){try{const t=await eo();await Kt(t)}catch(t){console.error("Error writing to IndexedDB:",t)}}async function qt(){try{return H==null&&(H=await nt()),new Promise((t,e)=>{if(H==null)return e("indexDB is null");const n=H.transaction([oe],"readonly").objectStore(oe).get(rt);n.onsuccess=()=>{n.result?t(n.result.value):t(void 0)},n.onerror=()=>e(n.error)})}catch(t){console.error("Error while reading from database:",t)}}async function re(){try{return await qt()}catch(t){console.error("Error retrieving data from IndexedDB:",t)}}const Z=class Z{constructor(){}static async load(){return new Z}async listByWorkflowID(e){const o=await this.getRecords();return Object.values(o).filter(s=>s.workflowID===e).sort((s,n)=>n.createTime-s.createTime)}async getRecords(){let e=await se(Z.TABLE_NAME),o=e!=null?JSON.parse(e):null;if(o==null){const s=await re()??"{}";o=JSON.parse(s)[Z.TABLE_NAME]}return o??{}}async get(e){return(await this.getRecords())[e]}async getLastestByWorkflowID(e){const o=await this.getRecords();return Object.values(o).filter(n=>n.workflowID===e).sort((n,a)=>a.createTime-n.createTime)[0]}async create(e){const o=await this.getLastestByWorkflowID(e.workflowID);if(o!=null&&o.json===e.json)return null;const s={id:pe(),json:e.json,workflowID:e.workflowID,createTime:Date.now()},n=await this.getRecords();return n[s.id]=s,E(Z.TABLE_NAME,JSON.stringify(n)),M(),s}};G(Z,"TABLE_NAME","changelogs");let me=Z;const te=class te{constructor(){G(this,"records");this.records={}}static async load(){const e=new te;let o=await se(te.TABLE_NAME),s=o!=null?JSON.parse(o):null;if(s==null){const n=await re()??"{}";s=JSON.parse(n)[te.TABLE_NAME]}return s!=null&&(e.records=s),e}listAll(){return Object.values(this.records)}getRecords(){return this.records}get(e){return this.records[e]}create(e){const o=this.generateUniqueName(e.name),s={id:pe(),name:o,parentFolderID:e.parentFolderID??null,updateTime:Date.now(),createTime:Date.now(),type:"folder"};return this.records[s.id]=s,E("folders",JSON.stringify(this.records)),M(),s}update(e){const o=this.records[e.id];if(o==null)return;const s={...o,...e};e.name!=null&&(s.updateTime=Date.now()),this.records[e.id]=s,E("folders",JSON.stringify(this.records)),M(),De()}delete(e){delete this.records[e],ke().filter(s=>s.parentFolderID==e).forEach(s=>K(s.id,{parentFolderID:void 0})),E("folders",JSON.stringify(this.records)),M(),De()}generateUniqueName(e){var n;let o=e??"New folder";const s=(n=this.listAll())==null?void 0:n.map(a=>a.name);if(s.includes(o)){let a=2,l=!0;for(;l;)s.includes(`${o} ${a}`)?a++:(o=`${o} ${a}`,l=!1)}return o}};G(te,"TABLE_NAME","folders");let ye=te;class Zt{constructor(e){G(this,"tableName");this.tableName=e}async listAll(){const e=await this.getRecords();return Object.values(e)}async getRecords(){let e=await se(this.tableName),o;try{o=e!=null?JSON.parse(e):null}catch{}if(o==null){const s=await re()??"{}";o=JSON.parse(s)[this.tableName]}return o??{}}async get(e){return(await this.getRecords())[e]}async delete(e){const o=await this.getRecords();delete o[e],E(this.tableName,JSON.stringify(o)),M()}}class Pe extends Zt{constructor(){super("media")}async listByWorkflowID(e){const o=await this.getRecords();return Object.values(o).filter(s=>s.workflowID===e).sort((s,n)=>n.createTime-s.createTime)}async getLastestByWorkflowID(e){const o=await this.getRecords();return Object.values(o).filter(n=>n.workflowID===e).sort((n,a)=>a.createTime-n.createTime)[0]}async create(e){var u;const o=e.localPath.split(".").pop();if(o==null)return null;const s={id:pe(),localPath:e.localPath,workflowID:e.workflowID,createTime:Date.now(),format:o},n=((u=J(e.workflowID))==null?void 0:u.mediaIDs)??[],a=new Set(n).add(s.id);K(e.workflowID,{mediaIDs:Array.from(a),coverMediaPath:s.localPath});const l=await this.getRecords();return l[s.id]=s,E("media",JSON.stringify(l)),M(),s}}G(Pe,"TABLE_NAME","media");async function Xt(){const t=await se("tags");let e;if(t==null){const o=await re()??"{}";e=JSON.parse(o).tags||{}}else e=JSON.parse(t??"{}")??{};return{tags:e,listAll(){return Object.values(e).sort((o,s)=>s.updateTime-o.updateTime)},upsert(o){return e[o]==null&&(e[o]={name:o,workflowIDs:[],updateTime:Date.now()}),e[o].updateTime=Date.now(),E("tags",JSON.stringify(e)),e[o]},delete(o){delete e[o],E("tags",JSON.stringify(e))}}}const X=class X{constructor(){G(this,"records");this.records={topBarStyle:{top:0,left:0},myWorkflowsDir:"",shortcuts:{save:"Shift+S"}}}listSettings(){return this.records}getSetting(e){return this.records[e]}upsert(e){this.records={...this.records,...e},E(X.TABLE_NAME,JSON.stringify(this.records)),M()}static async load(){const e=new X,o=await se(X.TABLE_NAME);let s=o!=null?JSON.parse(o):null;if(s==null){const n=await re()??"{}";s=JSON.parse(n)[X.TABLE_NAME]||{}}if(!s.myWorkflowsDir){const n=await Wt();s.myWorkflowsDir=`${n.dir_path}/my_workflows`}return e.records=s,e}};G(X,"TABLE_NAME","userSettings");let ge=X;function Jo(t){return t.type==="folder"}let p,we=null,k=null,R=null,W=null,b=null;async function Qt(){const t=async()=>{const l=await se("workflows");if(l==null){const u=await re()??"{}";p=JSON.parse(u).workflows||{}}else p=JSON.parse(l)},e=async()=>{we=await Xt()},o=async()=>{k=await ge.load()},s=async()=>{R=await ye.load()},n=async()=>{W=await me.load()},a=async()=>{b=new Pe};await Promise.all([t(),e(),o(),s(),n(),a()])}function zo(t,e){var a;if(p==null)return[];const o=Object.values(p).filter(l=>l.parentFolderID==t),s=((a=R==null?void 0:R.listAll())==null?void 0:a.filter(l=>l.parentFolderID==t))??[],n=[...o,...s];return $t(n,e??T.RECENTLY_MODIFIED)}function K(t,e){if(p==null)return;const o=p[t];if(o==null)return;const s={...o,...e,id:t},n=JSON.stringify(o),a=JSON.stringify(s);if(n===a)return;let l=s;const u=Object.keys(e);if(u.length===1&&["tags","parentFolderID"].includes(u[0])||(l.updateTime=Date.now()),p[t]=l,M(),E("workflows",JSON.stringify(p)),e.name!=null||e.parentFolderID!=null){_e(o),ue(s);return}e.json!=null&&ue(s)}function ue(t){const e=Fe(t);if(e==null)return;if(p!=null){const n=tt(t);p[t.id].filePath=n??void 0,M(),E("workflows",JSON.stringify(p))}const o=t.json,s=JSON.parse(o);s.extra[Bt]={id:t.id,name:t.name},Lt(e,JSON.stringify(s))}function Ie({json:t,name:e,parentFolderID:o,tags:s}){if(p==null)throw new Error("workspace is not loaded");const n=st(e),a=pe(),l=Date.now(),u={id:a,name:n,json:t,parentFolderID:o,updateTime:l,createTime:l,tags:s??[]};return p[a]=u,E("workflows",JSON.stringify(p)),M(),ue(p[a]),p[a]}async function Uo(t){t.forEach(o=>{if(p==null)return;const s=st(o.name),n=pe(),a=Date.now();p[n]={id:n,name:s,json:o.json,updateTime:a,createTime:a,tags:[]},ue(p[n])});const e=JSON.stringify(p);return M(),await E("workflows",e)}function ke(t){if(p==null)throw new Error("workspace is not loaded");const e=Object.values(p);return Ut(e,t)}function J(t){if(p==null){console.error("workspace is not loaded");return}return p[t]}function $o(t){if(p==null)return;const e=p[t];e&&_e({...e}),delete p[t],M(),E("workflows",JSON.stringify(p))}function Go(t){t.forEach(o=>{if(p==null)return;const s=p[o];s&&_e({...s}),p&&delete p[o]});const e=JSON.stringify(p);M(),E("workflows",e)}async function eo(){const t=await(W==null?void 0:W.getRecords()),e=await(b==null?void 0:b.getRecords());return JSON.stringify({[ge.TABLE_NAME]:k==null?void 0:k.records,tags:we==null?void 0:we.tags,workflows:p,[ye.TABLE_NAME]:R==null?void 0:R.getRecords(),[me.TABLE_NAME]:t,[Pe.TABLE_NAME]:e})}const We={last_node_id:9,last_link_id:9,nodes:[{id:7,type:"CLIPTextEncode",pos:[413,389],size:{0:425.27801513671875,1:180.6060791015625},flags:{},order:3,mode:0,inputs:[{name:"clip",type:"CLIP",link:5}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[6],slot_index:0}],properties:{},widgets_values:["text, watermark"]},{id:6,type:"CLIPTextEncode",pos:[415,186],size:{0:422.84503173828125,1:164.31304931640625},flags:{},order:2,mode:0,inputs:[{name:"clip",type:"CLIP",link:3}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[4],slot_index:0}],properties:{},widgets_values:["beautiful scenery nature glass bottle landscape, , purple galaxy bottle,"]},{id:5,type:"EmptyLatentImage",pos:[473,609],size:{0:315,1:106},flags:{},order:1,mode:0,outputs:[{name:"LATENT",type:"LATENT",links:[2],slot_index:0}],properties:{},widgets_values:[512,512,1]},{id:3,type:"KSampler",pos:[863,186],size:{0:315,1:262},flags:{},order:4,mode:0,inputs:[{name:"model",type:"MODEL",link:1},{name:"positive",type:"CONDITIONING",link:4},{name:"negative",type:"CONDITIONING",link:6},{name:"latent_image",type:"LATENT",link:2}],outputs:[{name:"LATENT",type:"LATENT",links:[7],slot_index:0}],properties:{},widgets_values:[0x8e7ff42ed37e,!0,20,8,"euler","normal",1]},{id:8,type:"VAEDecode",pos:[1209,188],size:{0:210,1:46},flags:{},order:5,mode:0,inputs:[{name:"samples",type:"LATENT",link:7},{name:"vae",type:"VAE",link:8}],outputs:[{name:"IMAGE",type:"IMAGE",links:[9],slot_index:0}],properties:{}},{id:9,type:"SaveImage",pos:[1451,189],size:{0:210,1:26},flags:{},order:6,mode:0,inputs:[{name:"images",type:"IMAGE",link:9}],properties:{}},{id:4,type:"CheckpointLoaderSimple",pos:[26,474],size:{0:315,1:98},flags:{},order:0,mode:0,outputs:[{name:"MODEL",type:"MODEL",links:[1],slot_index:0},{name:"CLIP",type:"CLIP",links:[3,5],slot_index:1},{name:"VAE",type:"VAE",links:[8],slot_index:2}],properties:{},widgets_values:["v1-5-pruned-emaonly.ckpt"]}],links:[[1,4,0,3,0,"MODEL"],[2,5,0,3,3,"LATENT"],[3,4,1,6,0,"CLIP"],[4,6,0,3,1,"CONDITIONING"],[5,4,1,7,0,"CLIP"],[6,7,0,3,2,"CONDITIONING"],[7,3,0,8,0,"LATENT"],[8,4,2,8,1,"VAE"],[9,8,0,9,0,"IMAGE"]],groups:[],config:{},extra:{},version:.4},ne=c.createContext({curFlowID:null,loadWorkflowID:()=>{},saveCurWorkflow:()=>{},discardUnsavedChanges:()=>{},isDirty:!1,loadNewWorkflow:()=>{},loadFilePath:()=>{},setRoute:()=>{}}),Vo=c.createContext({refreshFolderStamp:0,setRefreshFolderStamp:()=>{}});var to={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},oo=Object.defineProperty,so=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable,Be=(t,e,o)=>e in t?oo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,Je=(t,e)=>{for(var o in e||(e={}))at.call(e,o)&&Be(t,o,e[o]);if(ve)for(var o of ve(e))lt.call(e,o)&&Be(t,o,e[o]);return t},no=(t,e)=>so(t,ro(e)),ao=(t,e)=>{var o={};for(var s in t)at.call(t,s)&&e.indexOf(s)<0&&(o[s]=t[s]);if(t!=null&&ve)for(var s of ve(t))e.indexOf(s)<0&&lt.call(t,s)&&(o[s]=t[s]);return o},O=(t,e,o)=>{const s=c.forwardRef((n,a)=>{var l=n,{color:u="currentColor",size:w=24,stroke:d=2,children:h}=l,f=ao(l,["color","size","stroke","children"]);return c.createElement("svg",Je(no(Je({ref:a},to),{width:w,height:w,stroke:u,strokeWidth:d,className:`tabler-icon tabler-icon-${t}`}),f),[...o.map(([x,v])=>c.createElement(x,v)),...h||[]])});return s.propTypes={color:q.string,size:q.oneOfType([q.string,q.number]),stroke:q.oneOfType([q.string,q.number])},s.displayName=`${e}`,s},lo=O("arrow-back-up-double","IconArrowBackUpDouble",[["path",{d:"M13 14l-4 -4l4 -4",key:"svg-0"}],["path",{d:"M8 14l-4 -4l4 -4",key:"svg-1"}],["path",{d:"M9 10h7a4 4 0 1 1 0 8h-1",key:"svg-2"}]]),io=O("chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]),Ee=O("device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]]),co=O("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),uo=O("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]),po=O("grip-vertical","IconGripVertical",[["path",{d:"M9 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M9 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M9 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M15 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}],["path",{d:"M15 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-4"}],["path",{d:"M15 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-5"}]]),fo=O("history","IconHistory",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]),ho=O("photo","IconPhoto",[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5",key:"svg-2"}],["path",{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3",key:"svg-3"}]]),wo=O("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),mo=O("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]),yo=O("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),go=O("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),vo=O("triangle-inverted-filled","IconTriangleInvertedFilled",[["path",{d:"M20.118 3h-16.225a2.914 2.914 0 0 0 -2.503 4.371l8.116 13.549a2.917 2.917 0 0 0 4.987 .005l8.11 -13.539a2.914 2.914 0 0 0 -2.486 -4.386z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),it=O("x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const he=200;function ko({onclose:t}){const{curFlowID:e,loadNewWorkflow:o,loadFilePath:s}=c.useContext(ne),n=e!=null?J(e):null,[a,l]=c.useState([]),[u,w]=c.useState(!1),[d,h]=c.useState(n==null?void 0:n.coverMediaPath),[f,x]=c.useState([]),{showDialog:v}=ft(),S=async()=>{if(e==null)return;const m=await(b==null?void 0:b.listByWorkflowID(e));x(m??[])};if(c.useEffect(()=>{S()},[]),e==null)return null;const D=()=>{S()},N=m=>{if(u){a.includes(m.id)?l(a.filter(B=>B!==m.id)):l([...a,m.id]);return}window.open(`/workspace/view_media?filename=${m.localPath}`)},_=f.length>0&&a.length===f.length;return r.jsxs(Ce,{isOpen:!0,onClose:t,blockScrollOnMount:!0,children:[r.jsx(Oe,{}),r.jsxs(Ne,{width:"90%",maxWidth:"90vw",height:"90vh",children:[r.jsxs(be,{children:[r.jsx(z,{gap:2,mb:2,children:r.jsxs(Ge,{size:"md",mr:2,children:["Gallery - ",n==null?void 0:n.name]})}),u&&r.jsxs(z,{gap:3,children:[r.jsx(je,{isChecked:_,onChange:()=>{l(_?[]:f.map(m=>m.id))},children:"All"}),r.jsxs(de,{fontSize:16,children:[a.length," Selected"]}),r.jsx(Q,{size:"sm",icon:r.jsx(it,{size:19}),onClick:()=>w(!1),"aria-label":"cancel"})]})]}),r.jsx(Me,{}),r.jsx(Te,{overflowY:"auto",children:r.jsx(z,{wrap:"wrap",children:f.map(m=>{if(m.localPath==null)return null;const B=Ht(m.localPath)?r.jsxs(Le,{isExternal:!0,onClick:()=>N(m),position:"relative",children:[u&&r.jsx(je,{isChecked:a.includes(m.id),position:"absolute",top:2,left:2}),r.jsx(yt,{borderRadius:3,boxSize:he+"px",objectFit:"cover",src:`/workspace/view_media?filename=${m.localPath}`,alt:"workflow image renamed or moved from output folder"})]}):r.jsxs(Le,{isExternal:!0,onClick:()=>N(m),children:[u&&r.jsx(je,{isChecked:a.includes(m.id)}),r.jsx("video",{width:he,height:he,src:`/workspace/view_media?filename=${m.localPath}`,loop:!0,autoPlay:!0,muted:!0,children:r.jsx("track",{kind:"captions"})})]}),F=d!=null&&d===m.localPath;return r.jsxs(Ve,{width:he,justifyContent:"space-between",mb:2,children:[r.jsx(V,{label:ot(m.createTime,!0),children:B}),r.jsx(V,{label:m.localPath,children:r.jsx(de,{color:"GrayText",noOfLines:1,children:m.localPath})}),r.jsxs(z,{justifyContent:"space-between",hidden:u,children:[r.jsx(V,{label:"Set as cover",children:r.jsx(Q,{size:"sm",variant:"ghost",icon:F?r.jsx(wo,{size:19}):r.jsx(mo,{size:19}),"aria-label":"set as cover",isActive:F,onClick:()=>{K(e,{coverMediaPath:m.localPath}),h(m.localPath)}})}),r.jsx(Y,{flexGrow:1,onClick:()=>v("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{s(m.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>s(m.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),r.jsx(V,{label:"Remove image from gallery",children:r.jsx(Q,{size:"sm",variant:"ghost",icon:r.jsx(go,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:()=>{confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&(b==null||b.delete(m.id),F&&(K(e,{coverMediaPath:void 0}),h(void 0)),D())}})})]})]})})})})]})]})}const Se={x:0,y:0};function xo({children:t,onDragEnd:e}){const o=c.useRef(Se),s=c.useRef(!1),[n,a]=c.useState(Se),l=h=>{var f,x,v;if([(f=h.target)==null?void 0:f.id,(v=(x=h.target)==null?void 0:x.parentNode)==null?void 0:v.id].includes("dragPanelIcon")){o.current={x:h.clientX,y:h.clientY},s.current=!0,window.addEventListener("mousemove",u),window.addEventListener("mouseup",w);const S=document.getElementsByTagName("body")[0];S.style.userSelect="none"}},u=c.useCallback(h=>{const f={x:h.clientX-o.current.x,y:h.clientY-o.current.y};a(f)},[]),w=c.useCallback(()=>{a(f=>(e(f),Se)),s.current=!1;const h=document.getElementsByTagName("body")[0];h.style.userSelect="auto",window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",w)},[e,u]),d={transform:`translate(${n.x}px, ${n.y}px)`,zIndex:s.current?1e3:1};return r.jsx("div",{style:d,onMouseDown:l,children:t})}function jo({backgroundColor:t}){const e=t===void 0?"rgba(0,0,0,0.5)":t??void 0;return r.jsx("div",{style:{position:"fixed",top:0,bottom:0,left:0,right:0,backgroundColor:e}})}function Io({onClose:t}){const{curFlowID:e,isDirty:o}=c.useContext(ne),[s,n]=c.useState(null),a=e!=null?J(e):null,[l,u]=c.useState([]);return e==null||a==null?(alert("No current workflow found!"),null):(c.useEffect(()=>{(async()=>{var x;const d=await(W==null?void 0:W.listByWorkflowID(e));u(d??[]);const h=d==null?void 0:d.filter(v=>v.json===a.lastSavedJson),f=(x=h==null?void 0:h[0])==null?void 0:x.id;f&&n(f)})()},[]),r.jsxs(gt,{width:400,height:"100vh",pl:4,pr:5,pt:4,gap:0,position:"fixed",top:0,left:0,zIndex:1e3,children:[r.jsx(vt,{pb:1,mb:0,children:r.jsxs(kt,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ge,{size:"md",children:"Version History"}),r.jsx(Q,{size:"sm",icon:r.jsx(it,{}),onClick:t,variant:"ghost","aria-label":"close version history"})]})}),r.jsxs(xt,{overflowY:"auto",gap:0,children:[r.jsx(de,{mb:4,children:"All the saved changes of this workflow"}),r.jsx(Ve,{divider:r.jsx(jt,{}),spacing:2,children:l==null?void 0:l.map(w=>r.jsxs(Y,{size:"sm",variant:"ghost",onClick:()=>{if(o){alert("You have unsaved changes, please save or discard your changes to proceed switching version, in case losing your changes.");return}L.loadGraphData(JSON.parse(w.json)),K(e,{lastSavedJson:w.json}),t()},isActive:w.id===s,children:["Saved at ",ot(w.createTime,!0)]}))})]})]}))}function So({onClick:t}){var F;const{curFlowID:e,onDuplicateWorkflow:o,discardUnsavedChanges:s,saveCurWorkflow:n}=c.useContext(ne),[a,l]=c.useState(!1),[u,w]=c.useState(!1),[d,h]=c.useState(""),[f,x]=c.useState(""),[v,S]=c.useState();c.useEffect(()=>{const j=e?J(e):void 0;h((j==null?void 0:j.name)??""),S(j)},[e]);const D=j=>{h(j.target.value),f&&x("")},N=()=>{if(!e){alert("Flow ID is required");return}o==null||o(e,d),_()},_=()=>{l(!1)},m=c.useCallback(()=>{if(!p||!e){alert("You don't have any workspaces");return}const j=p[e];if(!j){alert("Workspace does not exist");return}const xe=new Blob([j.json],{type:"application/json"}),ae=URL.createObjectURL(xe),U=document.createElement("a");U.href=ae,U.download=`${j.name}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(ae)},[e]),B=(F=k==null?void 0:k.getSetting("shortcuts"))==null?void 0:F.save;return r.jsxs(r.Fragment,{children:[r.jsx(It,{isLazy:!0,children:({isOpen:j})=>r.jsxs(r.Fragment,{children:[r.jsx(St,{onClick:t,children:r.jsx(Q,{icon:r.jsx(io,{size:20}),"aria-label":"menu",size:"xs",backgroundColor:"#323232",color:"white"})}),r.jsxs(Ue,{children:[r.jsxs(Dt,{minWidth:150,zIndex:1e3,children:[r.jsx(ce,{onClick:n,icon:r.jsx(Ee,{size:20}),iconSpacing:1,command:B,children:"Save"}),r.jsx(V,{label:"This will revert current workflow to your last saved version. You will lose all changes made since your last save.",children:r.jsx(ce,{onClick:s,icon:r.jsx(lo,{size:20}),iconSpacing:1,isDisabled:(v==null?void 0:v.lastSavedJson)==null,children:"Discard unsaved changes"})}),r.jsx(ce,{onClick:m,icon:r.jsx(co,{size:20}),iconSpacing:1,children:"Download"}),r.jsx(ce,{onClick:()=>l(!0),icon:r.jsx(Ee,{size:20}),iconSpacing:1,children:"Save As"}),r.jsx(ce,{onClick:()=>w(!0),icon:r.jsx(fo,{size:20}),iconSpacing:1,children:"Versions History"})]}),j&&r.jsx(jo,{backgroundColor:null})]})]})}),u&&r.jsx(Io,{onClose:()=>w(!1)}),a&&r.jsxs(Ce,{isOpen:!0,onClose:_,children:[r.jsx(Oe,{}),r.jsxs(Ne,{children:[r.jsx(be,{children:"Save As"}),r.jsx(Me,{}),r.jsx(Te,{children:r.jsxs(He,{isInvalid:!!f,children:[r.jsx(Ye,{children:"Workflow name"}),r.jsx(Ke,{value:d,onChange:D,autoFocus:!0,onKeyUp:j=>{j.code==="Enter"&&!f&&N()}}),f&&r.jsx(qe,{children:f})]})}),r.jsxs($e,{children:[r.jsx(Y,{colorScheme:"teal",mr:3,onClick:N,isDisabled:!d||!!f,children:"Save"}),r.jsx(Y,{onClick:_,children:"Cancel"})]})]})]})]})}function Do({displayName:t,updateFlowName:e,isDirty:o}){const{isOpen:s,onOpen:n,onClose:a}=Et(),{curFlowID:l}=c.useContext(ne),[u,w]=c.useState(t),[d,h]=c.useState(""),f=()=>{w(t),n()},x=D=>{w(D.target.value),d&&h("")},v=()=>{var D;if(l){const N=u.trim();if(w(N),t===N)return S();((D=ke())==null?void 0:D.map(m=>m.name)).includes(N)?h("The name is duplicated, please modify it and submit again."):(K(l,{name:N}),e(N),S())}},S=()=>{h(""),a()};return l==null?null:r.jsxs(z,{children:[r.jsx(V,{label:t,placement:"bottom",children:r.jsxs(de,{color:"white",onClick:f,maxW:240,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:[o&&"* ",t]})}),r.jsxs(Ce,{isOpen:s,onClose:S,children:[r.jsx(Oe,{}),r.jsxs(Ne,{children:[r.jsx(be,{children:"Edit workflow name"}),r.jsx(Me,{}),r.jsx(Te,{children:r.jsxs(He,{isInvalid:!!d,children:[r.jsx(Ye,{children:"Workflow name"}),r.jsx(Ke,{value:u,onChange:x,autoFocus:!0,onKeyUp:D=>{D.code==="Enter"&&!d&&v()}}),d&&r.jsx(qe,{children:d})]})}),r.jsxs($e,{children:[r.jsx(Y,{colorScheme:"teal",mr:3,onClick:v,isDisabled:!u||!!d,children:"Save"}),r.jsx(Y,{onClick:S,children:"Cancel"})]})]})]})]})}function Eo({updatePanelPosition:t,positionStyle:e,curFlowName:o,setCurFlowName:s}){const[n,a]=c.useState(!1),{isDirty:l,loadNewWorkflow:u,saveCurWorkflow:w,setRoute:d,curFlowID:h}=c.useContext(ne);return r.jsx(xo,{onDragEnd:f=>{t({top:f.y,left:f.x},!0)},children:r.jsxs(z,{style:{padding:2,position:"fixed",...e},justifyContent:"space-between",alignItems:"center",gap:2,draggable:!1,id:"workspaceManagerPanel",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[r.jsx(Y,{size:"sm","aria-label":"workspace folder",onClick:()=>d("recentFlows"),px:2,children:r.jsxs(z,{gap:1,children:[r.jsx(uo,{size:21}),r.jsx(vo,{size:8})]})}),r.jsx(Y,{size:"sm",variant:"outline",colorScheme:"teal","aria-label":"new workflow",onClick:()=>u(),px:2,children:r.jsxs(z,{gap:1,children:[r.jsx(yo,{size:16,color:"white"}),r.jsx(de,{color:"white",fontSize:"sm",children:"New"})]})}),r.jsx(Do,{isDirty:l,displayName:o??"",updateFlowName:f=>{s(f),requestAnimationFrame(()=>{t()})}}),h&&r.jsxs(z,{gap:"1px",children:[r.jsx(V,{label:"Open gallery",children:r.jsx(Q,{onClick:()=>d("gallery"),icon:r.jsx(ho,{size:20,color:"white"}),size:"sm","aria-label":"open gallery",variant:"ghost"})}),r.jsx(So,{onClick:()=>a(!1)})]}),h&&l&&r.jsx(V,{label:"Save workflow",children:r.jsx(Q,{onClick:w,icon:r.jsx(Ee,{size:22,color:"white"}),size:"xs","aria-label":"save workspace",variant:"ghost"})}),n&&r.jsx(po,{id:"dragPanelIcon",cursor:"move",size:15,color:"#FFF"})]})})}var Co={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Oo=Co.VITE_AWS_COGNITO_DOMAIN;function No(){if(window.location.href.includes(Jt+"#")){const t=window.location.href.split("#")[1];let o=new URLSearchParams(t).get("access_token");window.opener.postMessage({comfyspace_authToken:o},"http://127.0.0.1:8188/"),window.close()}}function ze(t){const{comfyspace_authToken:e}=t.data;e&&fetch(`${Oo}/oauth2/userInfo`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(o=>o.json()).then(o=>{console.log("User Info:",o)}).catch(o=>{console.error("Error fetching user info:",o)})}const bo=ht.lazy(()=>wt(()=>import("./RecentFilesDrawer-rK5jn-zQ.js"),__vite__mapDeps([0,1,2,3])));function Mo(){const t=c.useRef({}),[e,o]=c.useState(null),[s,n]=c.useState("root"),[a,l]=c.useState(!0),[u,w]=c.useState(null),d=c.useRef(null),[h,f]=c.useState(),[x,v]=c.useState(!1),S=c.useRef(null),D=c.useCallback(()=>{if(d.current){const i=JSON.stringify(L.graph.serialize());K(d.current,{lastSavedJson:i}),W==null||W.create({workflowID:d.current,json:i})}},[]),N=()=>{if(confirm("Are you sure you want to discard unsaved changes? This will revert current workflow to your last saved version. You will lose all changes made since your last save.")&&d.current){const y=J(d.current);y&&y.lastSavedJson&&L.loadGraphData(JSON.parse(y.lastSavedJson))}},_=i=>{d.current=i,w(i),J(i)&&localStorage.setItem("curFlowID",i)},m=async()=>{const i={name:"WorkspaceManager",async setup(C){localStorage.removeItem("workspace"),localStorage.removeItem("comfyspace")},async addCustomNodeDefs(C){t.current=C},async afterConfigureGraph(){localStorage.setItem("workflow",JSON.stringify(L.graph.serialize()))}};L.registerExtension(i);try{await Qt(),ae(k==null?void 0:k.getSetting("topBarStyle"),!1)}catch(C){console.error("error loading db",C)}l(!1);const y=localStorage.getItem("curFlowID"),g=y!=null?J(y):null;g&&(g&&localStorage.setItem("workflow",g.json),_(g.id??null),o(g.name??null)),De()};c.useEffect(()=>{m(),setInterval(()=>{if(d.current!=null){const i=JSON.stringify(L.graph.serialize());i!=null&&K(d.current,{json:i});const y=d.current?J(d.current):void 0;y==null||i===(y==null?void 0:y.lastSavedJson)?v(!1):v(!0)}},1e3),No()},[]);const B=i=>{if(L.graph==null){console.error("app.graph is null cannot load workflow");return}_(i);const y=J(i);if(y==null){alert("Error: Workflow not found! id: "+i);return}L.ui.dialog.close(),L.loadGraphData(JSON.parse(y.json)),o(y.name),n("root")},F=i=>{const y=(i==null?void 0:i.json)??JSON.stringify(We),g=Ie({json:y,name:i==null?void 0:i.name});B(g.id),n("root")},j=async(i,y=!1)=>{const g=i.split("/").pop()??i;y?D():F({name:g});const C=await fetch(Yt(i)),P=await C.blob(),A=new File([P],g,{type:C.headers.get("Content-Type")||""});await L.handleFile(A),n("root")},xe=(i,y)=>{if(p==null)return;const g=p[i];if(g==null)return;const C=Ie({json:g.json,name:y||g.name,parentFolderID:g.parentFolderID,tags:g.tags});B(C.id)},ae=c.useCallback((i,y=!1)=>{const{top:g=0,left:C=0}=h||{};let{top:P=0,left:A=0}=i??{};P+=g,A+=C;const le=document.documentElement.clientWidth,ie=document.documentElement.clientHeight,ee=document.getElementById("workspaceManagerPanel"),$=(ee==null?void 0:ee.offsetWidth)||392;P+36>ie&&(P=ie-36),A+$>=le&&(A=le-$),f({top:Math.max(0,P),left:Math.max(0,A)}),y&&(k==null||k.upsert({topBarStyle:{top:P,left:A}}))},[h]),U=i=>{Gt(i)&&D()},Ae=c.useCallback(i=>{if(d.current==null)return;let y=i.filename;i.subfolder!=null&&i.subfolder!==""&&(y=i.subfolder+"/"+y),b==null||b.create({workflowID:d.current,localPath:y})},[]),ct=c.useCallback(()=>{n("root")},[]);return c.useEffect(()=>{window.addEventListener("keydown",U),window.addEventListener("message",ze);const i=document.getElementById("comfy-file-input"),y=()=>{if(i&&i.files&&i.files.length>0){const g=Ie({name:i.files[0].name,json:JSON.stringify(We)});_(g.id),o(g.name??"Unknown name")}};return i==null||i.addEventListener("change",y),mt.addEventListener("executed",g=>{var C,P,A,le,ie,ee;(A=(P=(C=g.detail)==null?void 0:C.output)==null?void 0:P.images)==null||A.forEach($=>{$.type==="output"&&Ae($)}),(ee=(ie=(le=g.detail)==null?void 0:le.output)==null?void 0:ie.gifs)==null||ee.forEach($=>{$.type==="output"&&Ae($)})}),()=>{window.removeEventListener("message",ze),window.removeEventListener("keydown",U),window.removeEventListener("change",y)}},[]),a||!h?null:r.jsx(ne.Provider,{value:{curFlowID:u,onDuplicateWorkflow:xe,loadWorkflowID:B,discardUnsavedChanges:N,saveCurWorkflow:D,isDirty:x,loadNewWorkflow:F,loadFilePath:j,setRoute:n},children:r.jsx("div",{ref:S,className:"workspace_manager",children:r.jsx(Ue,{containerRef:S,children:r.jsxs(Ct,{style:{width:"100vh",position:"absolute",top:0,left:0,lineHeight:"24px"},zIndex:1e3,draggable:!1,children:[r.jsx(Eo,{curFlowName:e,setCurFlowName:o,updatePanelPosition:ae,positionStyle:h}),s==="recentFlows"&&r.jsx(bo,{onClose:ct,onClickNewFlow:()=>{F(),n("root")}}),s==="gallery"&&r.jsx(ko,{onclose:()=>n("root")})]})})})})}const Ho=Object.freeze(Object.defineProperty({__proto__:null,default:Mo},Symbol.toStringTag,{value:"Module"}));export{p as A,Ho as B,T as E,go as I,Vo as R,ne as W,uo as a,fo as b,O as c,K as d,yo as e,ot as f,Wt as g,Ht as h,Jo as i,Bo as j,Uo as k,Lo as l,co as m,Go as n,it as o,ke as p,R as q,zo as r,Wo as s,we as t,k as u,De as v,io as w,Ro as x,$t as y,$o as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["RecentFilesDrawer-rK5jn-zQ.js","workspace-manager-IwcWZCSX.js","chunk-RPO2WXNL-JnvqhGPi.js","chunk-TK6VMDNP-eb4SOsAW.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}